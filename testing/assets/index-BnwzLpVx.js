(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Fu(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return n=>n in t}const Gt={},Ri=[],Qo=()=>{},$f=()=>!1,Qr=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Uu=e=>e.startsWith("onUpdate:"),kn=Object.assign,zu=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},Tm=Object.prototype.hasOwnProperty,Ot=(e,t)=>Tm.call(e,t),lt=Array.isArray,Bi=e=>jl(e)==="[object Map]",Zi=e=>jl(e)==="[object Set]",Od=e=>jl(e)==="[object Date]",vt=e=>typeof e=="function",en=e=>typeof e=="string",ns=e=>typeof e=="symbol",zt=e=>e!==null&&typeof e=="object",Tf=e=>(zt(e)||vt(e))&&vt(e.then)&&vt(e.catch),Mf=Object.prototype.toString,jl=e=>Mf.call(e),Mm=e=>jl(e).slice(8,-1),Af=e=>jl(e)==="[object Object]",ec=e=>en(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,_l=Fu(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),tc=e=>{const t=Object.create(null);return(n=>t[n]||(t[n]=e(n)))},Am=/-\w/g,Bo=tc(e=>e.replace(Am,t=>t.slice(1).toUpperCase())),Em=/\B([A-Z])/g,Ea=tc(e=>e.replace(Em,"-$1").toLowerCase()),nc=tc(e=>e.charAt(0).toUpperCase()+e.slice(1)),Oc=tc(e=>e?`on${nc(e)}`:""),Ia=(e,t)=>!Object.is(e,t),_r=(e,...t)=>{for(let n=0;n<e.length;n++)e[n](...t)},Ef=(e,t,n,a=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:a,value:n})},oc=e=>{const t=parseFloat(e);return isNaN(t)?e:t},Pm=e=>{const t=en(e)?Number(e):NaN;return isNaN(t)?e:t};let Rd;const sc=()=>Rd||(Rd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Qe(e){if(lt(e)){const t={};for(let n=0;n<e.length;n++){const a=e[n],s=en(a)?Bm(a):Qe(a);if(s)for(const i in s)t[i]=s[i]}return t}else if(en(e)||zt(e))return e}const Dm=/;(?![^(]*\))/g,Om=/:([^]+)/,Rm=/\/\*[^]*?\*\//g;function Bm(e){const t={};return e.replace(Rm,"").split(Dm).forEach(n=>{if(n){const a=n.split(Om);a.length>1&&(t[a[0].trim()]=a[1].trim())}}),t}function pe(e){let t="";if(en(e))t=e;else if(lt(e))for(let n=0;n<e.length;n++){const a=pe(e[n]);a&&(t+=a+" ")}else if(zt(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const Nm="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Fm=Fu(Nm);function Pf(e){return!!e||e===""}function Um(e,t){if(e.length!==t.length)return!1;let n=!0;for(let a=0;n&&a<e.length;a++)n=ci(e[a],t[a]);return n}function ci(e,t){if(e===t)return!0;let n=Od(e),a=Od(t);if(n||a)return n&&a?e.getTime()===t.getTime():!1;if(n=ns(e),a=ns(t),n||a)return e===t;if(n=lt(e),a=lt(t),n||a)return n&&a?Um(e,t):!1;if(n=zt(e),a=zt(t),n||a){if(!n||!a)return!1;const s=Object.keys(e).length,i=Object.keys(t).length;if(s!==i)return!1;for(const l in e){const u=e.hasOwnProperty(l),d=t.hasOwnProperty(l);if(u&&!d||!u&&d||!ci(e[l],t[l]))return!1}}return String(e)===String(t)}function Hu(e,t){return e.findIndex(n=>ci(n,t))}const Df=e=>!!(e&&e.__v_isRef===!0),w=e=>en(e)?e:e==null?"":lt(e)||zt(e)&&(e.toString===Mf||!vt(e.toString))?Df(e)?w(e.value):JSON.stringify(e,Of,2):String(e),Of=(e,t)=>Df(t)?Of(e,t.value):Bi(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[a,s],i)=>(n[Rc(a,i)+" =>"]=s,n),{})}:Zi(t)?{[`Set(${t.size})`]:[...t.values()].map(n=>Rc(n))}:ns(t)?Rc(t):zt(t)&&!lt(t)&&!Af(t)?String(t):t,Rc=(e,t="")=>{var n;return ns(e)?`Symbol(${(n=e.description)!=null?n:t})`:e};function zm(e){return e==null?"initial":typeof e=="string"?e===""?" ":e:String(e)}let Dn;class Rf{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Dn,!t&&Dn&&(this.index=(Dn.scopes||(Dn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].pause();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].resume();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].resume()}}run(t){if(this._active){const n=Dn;try{return Dn=this,t()}finally{Dn=n}}}on(){++this._on===1&&(this.prevScope=Dn,Dn=this)}off(){this._on>0&&--this._on===0&&(Dn=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let n,a;for(n=0,a=this.effects.length;n<a;n++)this.effects[n].stop();for(this.effects.length=0,n=0,a=this.cleanups.length;n<a;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,a=this.scopes.length;n<a;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function Bf(e){return new Rf(e)}function Nf(){return Dn}function Hm(e,t=!1){Dn&&Dn.cleanups.push(e)}let qt;const Bc=new WeakSet;class Ff{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Dn&&Dn.active&&Dn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Bc.has(this)&&(Bc.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||zf(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Bd(this),Hf(this);const t=qt,n=es;qt=this,es=!0;try{return this.fn()}finally{Vf(this),qt=t,es=n,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)ju(t);this.deps=this.depsTail=void 0,Bd(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Bc.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){au(this)&&this.run()}get dirty(){return au(this)}}let Uf=0,wl,Cl;function zf(e,t=!1){if(e.flags|=8,t){e.next=Cl,Cl=e;return}e.next=wl,wl=e}function Vu(){Uf++}function Gu(){if(--Uf>0)return;if(Cl){let t=Cl;for(Cl=void 0;t;){const n=t.next;t.next=void 0,t.flags&=-9,t=n}}let e;for(;wl;){let t=wl;for(wl=void 0;t;){const n=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(a){e||(e=a)}t=n}}if(e)throw e}function Hf(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Vf(e){let t,n=e.depsTail,a=n;for(;a;){const s=a.prevDep;a.version===-1?(a===n&&(n=s),ju(a),Vm(a)):t=a,a.dep.activeLink=a.prevActiveLink,a.prevActiveLink=void 0,a=s}e.deps=t,e.depsTail=n}function au(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Gf(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Gf(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Pl)||(e.globalVersion=Pl,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!au(e))))return;e.flags|=2;const t=e.dep,n=qt,a=es;qt=e,es=!0;try{Hf(e);const s=e.fn(e._value);(t.version===0||Ia(s,e._value))&&(e.flags|=128,e._value=s,t.version++)}catch(s){throw t.version++,s}finally{qt=n,es=a,Vf(e),e.flags&=-3}}function ju(e,t=!1){const{dep:n,prevSub:a,nextSub:s}=e;if(a&&(a.nextSub=s,e.prevSub=void 0),s&&(s.prevSub=a,e.nextSub=void 0),n.subs===e&&(n.subs=a,!a&&n.computed)){n.computed.flags&=-5;for(let i=n.computed.deps;i;i=i.nextDep)ju(i,!0)}!t&&!--n.sc&&n.map&&n.map.delete(n.key)}function Vm(e){const{prevDep:t,nextDep:n}=e;t&&(t.nextDep=n,e.prevDep=void 0),n&&(n.prevDep=t,e.nextDep=void 0)}let es=!0;const jf=[];function js(){jf.push(es),es=!1}function Zs(){const e=jf.pop();es=e===void 0?!0:e}function Bd(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const n=qt;qt=void 0;try{t()}finally{qt=n}}}let Pl=0;class Gm{constructor(t,n){this.sub=t,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Zu{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!qt||!es||qt===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==qt)n=this.activeLink=new Gm(qt,this),qt.deps?(n.prevDep=qt.depsTail,qt.depsTail.nextDep=n,qt.depsTail=n):qt.deps=qt.depsTail=n,Zf(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const a=n.nextDep;a.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=a),n.prevDep=qt.depsTail,n.nextDep=void 0,qt.depsTail.nextDep=n,qt.depsTail=n,qt.deps===n&&(qt.deps=a)}return n}trigger(t){this.version++,Pl++,this.notify(t)}notify(t){Vu();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{Gu()}}}function Zf(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let a=t.deps;a;a=a.nextDep)Zf(a)}const n=e.dep.subs;n!==e&&(e.prevSub=n,n&&(n.nextSub=e)),e.dep.subs=e}}const Mr=new WeakMap,ai=Symbol(""),iu=Symbol(""),Dl=Symbol("");function Rn(e,t,n){if(es&&qt){let a=Mr.get(e);a||Mr.set(e,a=new Map);let s=a.get(n);s||(a.set(n,s=new Zu),s.map=a,s.key=n),s.track()}}function Bs(e,t,n,a,s,i){const l=Mr.get(e);if(!l){Pl++;return}const u=d=>{d&&d.trigger()};if(Vu(),t==="clear")l.forEach(u);else{const d=lt(e),h=d&&ec(n);if(d&&n==="length"){const p=Number(a);l.forEach((g,y)=>{(y==="length"||y===Dl||!ns(y)&&y>=p)&&u(g)})}else switch((n!==void 0||l.has(void 0))&&u(l.get(n)),h&&u(l.get(Dl)),t){case"add":d?h&&u(l.get("length")):(u(l.get(ai)),Bi(e)&&u(l.get(iu)));break;case"delete":d||(u(l.get(ai)),Bi(e)&&u(l.get(iu)));break;case"set":Bi(e)&&u(l.get(ai));break}}Gu()}function jm(e,t){const n=Mr.get(e);return n&&n.get(t)}function Ti(e){const t=At(e);return t===e?t:(Rn(t,"iterate",Dl),Lo(e)?t:t.map(os))}function ac(e){return Rn(e=At(e),"iterate",Dl),e}function ka(e,t){return qs(e)?Gs(e)?zi(os(t)):zi(t):os(t)}const Zm={__proto__:null,[Symbol.iterator](){return Nc(this,Symbol.iterator,e=>ka(this,e))},concat(...e){return Ti(this).concat(...e.map(t=>lt(t)?Ti(t):t))},entries(){return Nc(this,"entries",e=>(e[1]=ka(this,e[1]),e))},every(e,t){return Es(this,"every",e,t,void 0,arguments)},filter(e,t){return Es(this,"filter",e,t,n=>n.map(a=>ka(this,a)),arguments)},find(e,t){return Es(this,"find",e,t,n=>ka(this,n),arguments)},findIndex(e,t){return Es(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Es(this,"findLast",e,t,n=>ka(this,n),arguments)},findLastIndex(e,t){return Es(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Es(this,"forEach",e,t,void 0,arguments)},includes(...e){return Fc(this,"includes",e)},indexOf(...e){return Fc(this,"indexOf",e)},join(e){return Ti(this).join(e)},lastIndexOf(...e){return Fc(this,"lastIndexOf",e)},map(e,t){return Es(this,"map",e,t,void 0,arguments)},pop(){return hl(this,"pop")},push(...e){return hl(this,"push",e)},reduce(e,...t){return Nd(this,"reduce",e,t)},reduceRight(e,...t){return Nd(this,"reduceRight",e,t)},shift(){return hl(this,"shift")},some(e,t){return Es(this,"some",e,t,void 0,arguments)},splice(...e){return hl(this,"splice",e)},toReversed(){return Ti(this).toReversed()},toSorted(e){return Ti(this).toSorted(e)},toSpliced(...e){return Ti(this).toSpliced(...e)},unshift(...e){return hl(this,"unshift",e)},values(){return Nc(this,"values",e=>ka(this,e))}};function Nc(e,t,n){const a=ac(e),s=a[t]();return a!==e&&!Lo(e)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.done||(i.value=n(i.value)),i}),s}const qm=Array.prototype;function Es(e,t,n,a,s,i){const l=ac(e),u=l!==e&&!Lo(e),d=l[t];if(d!==qm[t]){const g=d.apply(e,i);return u?os(g):g}let h=n;l!==e&&(u?h=function(g,y){return n.call(this,ka(e,g),y,e)}:n.length>2&&(h=function(g,y){return n.call(this,g,y,e)}));const p=d.call(l,h,a);return u&&s?s(p):p}function Nd(e,t,n,a){const s=ac(e);let i=n;return s!==e&&(Lo(e)?n.length>3&&(i=function(l,u,d){return n.call(this,l,u,d,e)}):i=function(l,u,d){return n.call(this,l,ka(e,u),d,e)}),s[t](i,...a)}function Fc(e,t,n){const a=At(e);Rn(a,"iterate",Dl);const s=a[t](...n);return(s===-1||s===!1)&&ic(n[0])?(n[0]=At(n[0]),a[t](...n)):s}function hl(e,t,n=[]){js(),Vu();const a=At(e)[t].apply(e,n);return Gu(),Zs(),a}const Wm=Fu("__proto__,__v_isRef,__isVue"),qf=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(ns));function Km(e){ns(e)||(e=String(e));const t=At(this);return Rn(t,"has",e),t.hasOwnProperty(e)}class Wf{constructor(t=!1,n=!1){this._isReadonly=t,this._isShallow=n}get(t,n,a){if(n==="__v_skip")return t.__v_skip;const s=this._isReadonly,i=this._isShallow;if(n==="__v_isReactive")return!s;if(n==="__v_isReadonly")return s;if(n==="__v_isShallow")return i;if(n==="__v_raw")return a===(s?i?ag:Xf:i?Yf:Jf).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(a)?t:void 0;const l=lt(t);if(!s){let d;if(l&&(d=Zm[n]))return d;if(n==="hasOwnProperty")return Km}const u=Reflect.get(t,n,Qt(t)?t:a);if((ns(n)?qf.has(n):Wm(n))||(s||Rn(t,"get",n),i))return u;if(Qt(u)){const d=l&&ec(n)?u:u.value;return s&&zt(d)?ru(d):d}return zt(u)?s?ru(u):di(u):u}}class Kf extends Wf{constructor(t=!1){super(!1,t)}set(t,n,a,s){let i=t[n];const l=lt(t)&&ec(n);if(!this._isShallow){const h=qs(i);if(!Lo(a)&&!qs(a)&&(i=At(i),a=At(a)),!l&&Qt(i)&&!Qt(a))return h||(i.value=a),!0}const u=l?Number(n)<t.length:Ot(t,n),d=Reflect.set(t,n,a,Qt(t)?t:s);return t===At(s)&&(u?Ia(a,i)&&Bs(t,"set",n,a):Bs(t,"add",n,a)),d}deleteProperty(t,n){const a=Ot(t,n);t[n];const s=Reflect.deleteProperty(t,n);return s&&a&&Bs(t,"delete",n,void 0),s}has(t,n){const a=Reflect.has(t,n);return(!ns(n)||!qf.has(n))&&Rn(t,"has",n),a}ownKeys(t){return Rn(t,"iterate",lt(t)?"length":ai),Reflect.ownKeys(t)}}class Jm extends Wf{constructor(t=!1){super(!0,t)}set(t,n){return!0}deleteProperty(t,n){return!0}}const Ym=new Kf,Xm=new Jm,Qm=new Kf(!0);const lu=e=>e,hr=e=>Reflect.getPrototypeOf(e);function eg(e,t,n){return function(...a){const s=this.__v_raw,i=At(s),l=Bi(i),u=e==="entries"||e===Symbol.iterator&&l,d=e==="keys"&&l,h=s[e](...a),p=n?lu:t?zi:os;return!t&&Rn(i,"iterate",d?iu:ai),{next(){const{value:g,done:y}=h.next();return y?{value:g,done:y}:{value:u?[p(g[0]),p(g[1])]:p(g),done:y}},[Symbol.iterator](){return this}}}}function fr(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function tg(e,t){const n={get(s){const i=this.__v_raw,l=At(i),u=At(s);e||(Ia(s,u)&&Rn(l,"get",s),Rn(l,"get",u));const{has:d}=hr(l),h=t?lu:e?zi:os;if(d.call(l,s))return h(i.get(s));if(d.call(l,u))return h(i.get(u));i!==l&&i.get(s)},get size(){const s=this.__v_raw;return!e&&Rn(At(s),"iterate",ai),s.size},has(s){const i=this.__v_raw,l=At(i),u=At(s);return e||(Ia(s,u)&&Rn(l,"has",s),Rn(l,"has",u)),s===u?i.has(s):i.has(s)||i.has(u)},forEach(s,i){const l=this,u=l.__v_raw,d=At(u),h=t?lu:e?zi:os;return!e&&Rn(d,"iterate",ai),u.forEach((p,g)=>s.call(i,h(p),h(g),l))}};return kn(n,e?{add:fr("add"),set:fr("set"),delete:fr("delete"),clear:fr("clear")}:{add(s){!t&&!Lo(s)&&!qs(s)&&(s=At(s));const i=At(this);return hr(i).has.call(i,s)||(i.add(s),Bs(i,"add",s,s)),this},set(s,i){!t&&!Lo(i)&&!qs(i)&&(i=At(i));const l=At(this),{has:u,get:d}=hr(l);let h=u.call(l,s);h||(s=At(s),h=u.call(l,s));const p=d.call(l,s);return l.set(s,i),h?Ia(i,p)&&Bs(l,"set",s,i):Bs(l,"add",s,i),this},delete(s){const i=At(this),{has:l,get:u}=hr(i);let d=l.call(i,s);d||(s=At(s),d=l.call(i,s)),u&&u.call(i,s);const h=i.delete(s);return d&&Bs(i,"delete",s,void 0),h},clear(){const s=At(this),i=s.size!==0,l=s.clear();return i&&Bs(s,"clear",void 0,void 0),l}}),["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=eg(s,e,t)}),n}function qu(e,t){const n=tg(e,t);return(a,s,i)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?a:Reflect.get(Ot(n,s)&&s in a?n:a,s,i)}const ng={get:qu(!1,!1)},og={get:qu(!1,!0)},sg={get:qu(!0,!1)};const Jf=new WeakMap,Yf=new WeakMap,Xf=new WeakMap,ag=new WeakMap;function ig(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function lg(e){return e.__v_skip||!Object.isExtensible(e)?0:ig(Mm(e))}function di(e){return qs(e)?e:Wu(e,!1,Ym,ng,Jf)}function Qf(e){return Wu(e,!1,Qm,og,Yf)}function ru(e){return Wu(e,!0,Xm,sg,Xf)}function Wu(e,t,n,a,s){if(!zt(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=lg(e);if(i===0)return e;const l=s.get(e);if(l)return l;const u=new Proxy(e,i===2?a:n);return s.set(e,u),u}function Gs(e){return qs(e)?Gs(e.__v_raw):!!(e&&e.__v_isReactive)}function qs(e){return!!(e&&e.__v_isReadonly)}function Lo(e){return!!(e&&e.__v_isShallow)}function ic(e){return e?!!e.__v_raw:!1}function At(e){const t=e&&e.__v_raw;return t?At(t):e}function Ku(e){return!Ot(e,"__v_skip")&&Object.isExtensible(e)&&Ef(e,"__v_skip",!0),e}const os=e=>zt(e)?di(e):e,zi=e=>zt(e)?ru(e):e;function Qt(e){return e?e.__v_isRef===!0:!1}function T(e){return ep(e,!1)}function rg(e){return ep(e,!0)}function ep(e,t){return Qt(e)?e:new cg(e,t)}class cg{constructor(t,n){this.dep=new Zu,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?t:At(t),this._value=n?t:os(t),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(t){const n=this._rawValue,a=this.__v_isShallow||Lo(t)||qs(t);t=a?t:At(t),Ia(t,n)&&(this._rawValue=t,this._value=a?t:os(t),this.dep.trigger())}}function O(e){return Qt(e)?e.value:e}function Ar(e){return vt(e)?e():O(e)}const ug={get:(e,t,n)=>t==="__v_raw"?e:O(Reflect.get(e,t,n)),set:(e,t,n,a)=>{const s=e[t];return Qt(s)&&!Qt(n)?(s.value=n,!0):Reflect.set(e,t,n,a)}};function tp(e){return Gs(e)?e:new Proxy(e,ug)}function dg(e){const t=lt(e)?new Array(e.length):{};for(const n in e)t[n]=fg(e,n);return t}class hg{constructor(t,n,a){this._object=t,this._key=n,this._defaultValue=a,this.__v_isRef=!0,this._value=void 0,this._raw=At(t);let s=!0,i=t;if(!lt(t)||!ec(String(n)))do s=!ic(i)||Lo(i);while(s&&(i=i.__v_raw));this._shallow=s}get value(){let t=this._object[this._key];return this._shallow&&(t=O(t)),this._value=t===void 0?this._defaultValue:t}set value(t){if(this._shallow&&Qt(this._raw[this._key])){const n=this._object[this._key];if(Qt(n)){n.value=t;return}}this._object[this._key]=t}get dep(){return jm(this._raw,this._key)}}function fg(e,t,n){return new hg(e,t,n)}class pg{constructor(t,n,a){this.fn=t,this.setter=n,this._value=void 0,this.dep=new Zu(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Pl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=a}notify(){if(this.flags|=16,!(this.flags&8)&&qt!==this)return zf(this,!0),!0}get value(){const t=this.dep.track();return Gf(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function vg(e,t,n=!1){let a,s;return vt(e)?a=e:(a=e.get,s=e.set),new pg(a,s,n)}const pr={},Er=new WeakMap;let Xa;function mg(e,t=!1,n=Xa){if(n){let a=Er.get(n);a||Er.set(n,a=[]),a.push(e)}}function gg(e,t,n=Gt){const{immediate:a,deep:s,once:i,scheduler:l,augmentJob:u,call:d}=n,h=D=>s?D:Lo(D)||s===!1||s===0?Ns(D,1):Ns(D);let p,g,y,b,C=!1,I=!1;if(Qt(e)?(g=()=>e.value,C=Lo(e)):Gs(e)?(g=()=>h(e),C=!0):lt(e)?(I=!0,C=e.some(D=>Gs(D)||Lo(D)),g=()=>e.map(D=>{if(Qt(D))return D.value;if(Gs(D))return h(D);if(vt(D))return d?d(D,2):D()})):vt(e)?t?g=d?()=>d(e,2):e:g=()=>{if(y){js();try{y()}finally{Zs()}}const D=Xa;Xa=p;try{return d?d(e,3,[b]):e(b)}finally{Xa=D}}:g=Qo,t&&s){const D=g,E=s===!0?1/0:s;g=()=>Ns(D(),E)}const M=Nf(),x=()=>{p.stop(),M&&M.active&&zu(M.effects,p)};if(i&&t){const D=t;t=(...E)=>{D(...E),x()}}let S=I?new Array(e.length).fill(pr):pr;const _=D=>{if(!(!(p.flags&1)||!p.dirty&&!D))if(t){const E=p.run();if(s||C||(I?E.some((Z,A)=>Ia(Z,S[A])):Ia(E,S))){y&&y();const Z=Xa;Xa=p;try{const A=[E,S===pr?void 0:I&&S[0]===pr?[]:S,b];S=E,d?d(t,3,A):t(...A)}finally{Xa=Z}}}else p.run()};return u&&u(_),p=new Ff(g),p.scheduler=l?()=>l(_,!1):_,b=D=>mg(D,!1,p),y=p.onStop=()=>{const D=Er.get(p);if(D){if(d)d(D,4);else for(const E of D)E();Er.delete(p)}},t?a?_(!0):S=p.run():l?l(_.bind(null,!0),!0):p.run(),x.pause=p.pause.bind(p),x.resume=p.resume.bind(p),x.stop=x,x}function Ns(e,t=1/0,n){if(t<=0||!zt(e)||e.__v_skip||(n=n||new Map,(n.get(e)||0)>=t))return e;if(n.set(e,t),t--,Qt(e))Ns(e.value,t,n);else if(lt(e))for(let a=0;a<e.length;a++)Ns(e[a],t,n);else if(Zi(e)||Bi(e))e.forEach(a=>{Ns(a,t,n)});else if(Af(e)){for(const a in e)Ns(e[a],t,n);for(const a of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,a)&&Ns(e[a],t,n)}return e}function Zl(e,t,n,a){try{return a?e(...a):e()}catch(s){lc(s,t,n)}}function ss(e,t,n,a){if(vt(e)){const s=Zl(e,t,n,a);return s&&Tf(s)&&s.catch(i=>{lc(i,t,n)}),s}if(lt(e)){const s=[];for(let i=0;i<e.length;i++)s.push(ss(e[i],t,n,a));return s}}function lc(e,t,n,a=!0){const s=t?t.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:l}=t&&t.appContext.config||Gt;if(t){let u=t.parent;const d=t.proxy,h=`https://vuejs.org/error-reference/#runtime-${n}`;for(;u;){const p=u.ec;if(p){for(let g=0;g<p.length;g++)if(p[g](e,d,h)===!1)return}u=u.parent}if(i){js(),Zl(i,null,10,[e,d,h]),Zs();return}}yg(e,n,s,a,l)}function yg(e,t,n,a=!0,s=!1){if(s)throw e;console.error(e)}const Jn=[];let ms=-1;const Ni=[];let ba=null,Ai=0;const np=Promise.resolve();let Pr=null;function an(e){const t=Pr||np;return e?t.then(this?e.bind(this):e):t}function kg(e){let t=ms+1,n=Jn.length;for(;t<n;){const a=t+n>>>1,s=Jn[a],i=Ol(s);i<e||i===e&&s.flags&2?t=a+1:n=a}return t}function Ju(e){if(!(e.flags&1)){const t=Ol(e),n=Jn[Jn.length-1];!n||!(e.flags&2)&&t>=Ol(n)?Jn.push(e):Jn.splice(kg(t),0,e),e.flags|=1,op()}}function op(){Pr||(Pr=np.then(ip))}function sp(e){lt(e)?Ni.push(...e):ba&&e.id===-1?ba.splice(Ai+1,0,e):e.flags&1||(Ni.push(e),e.flags|=1),op()}function Fd(e,t,n=ms+1){for(;n<Jn.length;n++){const a=Jn[n];if(a&&a.flags&2){if(e&&a.id!==e.uid)continue;Jn.splice(n,1),n--,a.flags&4&&(a.flags&=-2),a(),a.flags&4||(a.flags&=-2)}}}function ap(e){if(Ni.length){const t=[...new Set(Ni)].sort((n,a)=>Ol(n)-Ol(a));if(Ni.length=0,ba){ba.push(...t);return}for(ba=t,Ai=0;Ai<ba.length;Ai++){const n=ba[Ai];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}ba=null,Ai=0}}const Ol=e=>e.id==null?e.flags&2?-1:1/0:e.id;function ip(e){try{for(ms=0;ms<Jn.length;ms++){const t=Jn[ms];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Zl(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;ms<Jn.length;ms++){const t=Jn[ms];t&&(t.flags&=-2)}ms=-1,Jn.length=0,ap(),Pr=null,(Jn.length||Ni.length)&&ip()}}let xn=null,lp=null;function Dr(e){const t=xn;return xn=e,lp=e&&e.type.__scopeId||null,t}function He(e,t=xn,n){if(!t||e._n)return e;const a=(...s)=>{a._d&&Br(-1);const i=Dr(t);let l;try{l=e(...s)}finally{Dr(i),a._d&&Br(1)}return l};return a._n=!0,a._c=!0,a._d=!0,a}function ze(e,t){if(xn===null)return e;const n=fc(xn),a=e.dirs||(e.dirs=[]);for(let s=0;s<t.length;s++){let[i,l,u,d=Gt]=t[s];i&&(vt(i)&&(i={mounted:i,updated:i}),i.deep&&Ns(l),a.push({dir:i,instance:n,value:l,oldValue:void 0,arg:u,modifiers:d}))}return e}function qa(e,t,n,a){const s=e.dirs,i=t&&t.dirs;for(let l=0;l<s.length;l++){const u=s[l];i&&(u.oldValue=i[l].value);let d=u.dir[a];d&&(js(),ss(d,n,8,[e.el,u,e,t]),Zs())}}function Ll(e,t){if(Nn){let n=Nn.provides;const a=Nn.parent&&Nn.parent.provides;a===n&&(n=Nn.provides=Object.create(a)),n[e]=t}}function co(e,t,n=!1){const a=hc();if(a||ii){let s=ii?ii._context.provides:a?a.parent==null||a.ce?a.vnode.appContext&&a.vnode.appContext.provides:a.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return n&&vt(t)?t.call(a&&a.proxy):t}}function bg(){return!!(hc()||ii)}const _g=Symbol.for("v-scx"),wg=()=>co(_g);function qe(e,t,n){return rp(e,t,n)}function rp(e,t,n=Gt){const{immediate:a,deep:s,flush:i,once:l}=n,u=kn({},n),d=t&&a||!t&&i!=="post";let h;if(Ul){if(i==="sync"){const b=wg();h=b.__watcherHandles||(b.__watcherHandles=[])}else if(!d){const b=()=>{};return b.stop=Qo,b.resume=Qo,b.pause=Qo,b}}const p=Nn;u.call=(b,C,I)=>ss(b,p,C,I);let g=!1;i==="post"?u.scheduler=b=>{Wn(b,p&&p.suspense)}:i!=="sync"&&(g=!0,u.scheduler=(b,C)=>{C?b():Ju(b)}),u.augmentJob=b=>{t&&(b.flags|=4),g&&(b.flags|=2,p&&(b.id=p.uid,b.i=p))};const y=gg(e,t,u);return Ul&&(h?h.push(y):d&&y()),y}function Cg(e,t,n){const a=this.proxy,s=en(e)?e.includes(".")?cp(a,e):()=>a[e]:e.bind(a,a);let i;vt(t)?i=t:(i=t.handler,n=t);const l=ql(this),u=rp(s,i.bind(a),n);return l(),u}function cp(e,t){const n=t.split(".");return()=>{let a=e;for(let s=0;s<n.length&&a;s++)a=a[n[s]];return a}}const up=Symbol("_vte"),dp=e=>e.__isTeleport,Sl=e=>e&&(e.disabled||e.disabled===""),Ud=e=>e&&(e.defer||e.defer===""),zd=e=>typeof SVGElement<"u"&&e instanceof SVGElement,Hd=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,cu=(e,t)=>{const n=e&&e.to;return en(n)?t?t(n):null:n},hp={name:"Teleport",__isTeleport:!0,process(e,t,n,a,s,i,l,u,d,h){const{mc:p,pc:g,pbc:y,o:{insert:b,querySelector:C,createText:I,createComment:M}}=h,x=Sl(t.props);let{shapeFlag:S,children:_,dynamicChildren:D}=t;if(e==null){const E=t.el=I(""),Z=t.anchor=I("");b(E,n,a),b(Z,n,a);const A=(B,j)=>{S&16&&p(_,B,j,s,i,l,u,d)},N=()=>{const B=t.target=cu(t.props,C),j=fp(B,t,I,b);B&&(l!=="svg"&&zd(B)?l="svg":l!=="mathml"&&Hd(B)&&(l="mathml"),s&&s.isCE&&(s.ce._teleportTargets||(s.ce._teleportTargets=new Set)).add(B),x||(A(B,j),wr(t,!1)))};x&&(A(n,Z),wr(t,!0)),Ud(t.props)?(t.el.__isMounted=!1,Wn(()=>{N(),delete t.el.__isMounted},i)):N()}else{if(Ud(t.props)&&e.el.__isMounted===!1){Wn(()=>{hp.process(e,t,n,a,s,i,l,u,d,h)},i);return}t.el=e.el,t.targetStart=e.targetStart;const E=t.anchor=e.anchor,Z=t.target=e.target,A=t.targetAnchor=e.targetAnchor,N=Sl(e.props),B=N?n:Z,j=N?E:A;if(l==="svg"||zd(Z)?l="svg":(l==="mathml"||Hd(Z))&&(l="mathml"),D?(y(e.dynamicChildren,D,B,s,i,l,u),td(e,t,!0)):d||g(e,t,B,j,s,i,l,u,!1),x)N?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):vr(t,n,E,h,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const R=t.target=cu(t.props,C);R&&vr(t,R,null,h,0)}else N&&vr(t,Z,A,h,1);wr(t,x)}},remove(e,t,n,{um:a,o:{remove:s}},i){const{shapeFlag:l,children:u,anchor:d,targetStart:h,targetAnchor:p,target:g,props:y}=e;if(g&&(s(h),s(p)),i&&s(d),l&16){const b=i||!Sl(y);for(let C=0;C<u.length;C++){const I=u[C];a(I,t,n,b,!!I.dynamicChildren)}}},move:vr,hydrate:Lg};function vr(e,t,n,{o:{insert:a},m:s},i=2){i===0&&a(e.targetAnchor,t,n);const{el:l,anchor:u,shapeFlag:d,children:h,props:p}=e,g=i===2;if(g&&a(l,t,n),(!g||Sl(p))&&d&16)for(let y=0;y<h.length;y++)s(h[y],t,n,2);g&&a(u,t,n)}function Lg(e,t,n,a,s,i,{o:{nextSibling:l,parentNode:u,querySelector:d,insert:h,createText:p}},g){function y(I,M,x,S){M.anchor=g(l(I),M,u(I),n,a,s,i),M.targetStart=x,M.targetAnchor=S}const b=t.target=cu(t.props,d),C=Sl(t.props);if(b){const I=b._lpa||b.firstChild;if(t.shapeFlag&16)if(C)y(e,t,I,I&&l(I));else{t.anchor=l(e);let M=I;for(;M;){if(M&&M.nodeType===8){if(M.data==="teleport start anchor")t.targetStart=M;else if(M.data==="teleport anchor"){t.targetAnchor=M,b._lpa=t.targetAnchor&&l(t.targetAnchor);break}}M=l(M)}t.targetAnchor||fp(b,t,p,h),g(I&&l(I),t,b,n,a,s,i)}wr(t,C)}else C&&t.shapeFlag&16&&y(e,t,e,l(e));return t.anchor&&l(t.anchor)}const Rl=hp;function wr(e,t){const n=e.ctx;if(n&&n.ut){let a,s;for(t?(a=e.el,s=e.anchor):(a=e.targetStart,s=e.targetAnchor);a&&a!==s;)a.nodeType===1&&a.setAttribute("data-v-owner",n.uid),a=a.nextSibling;n.ut()}}function fp(e,t,n,a){const s=t.targetStart=n(""),i=t.targetAnchor=n("");return s[up]=i,e&&(a(s,e),a(i,e)),i}const Rs=Symbol("_leaveCb"),mr=Symbol("_enterCb");function Sg(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return tn(()=>{e.isMounted=!0}),Cp(()=>{e.isUnmounting=!0}),e}const Oo=[Function,Array],pp={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Oo,onEnter:Oo,onAfterEnter:Oo,onEnterCancelled:Oo,onBeforeLeave:Oo,onLeave:Oo,onAfterLeave:Oo,onLeaveCancelled:Oo,onBeforeAppear:Oo,onAppear:Oo,onAfterAppear:Oo,onAppearCancelled:Oo},vp=e=>{const t=e.subTree;return t.component?vp(t.component):t},Ig={name:"BaseTransition",props:pp,setup(e,{slots:t}){const n=hc(),a=Sg();return()=>{const s=t.default&&yp(t.default(),!0);if(!s||!s.length)return;const i=mp(s),l=At(e),{mode:u}=l;if(a.isLeaving)return Uc(i);const d=Vd(i);if(!d)return Uc(i);let h=uu(d,l,a,n,g=>h=g);d.type!==Bn&&Bl(d,h);let p=n.subTree&&Vd(n.subTree);if(p&&p.type!==Bn&&!Qa(p,d)&&vp(n).type!==Bn){let g=uu(p,l,a,n);if(Bl(p,g),u==="out-in"&&d.type!==Bn)return a.isLeaving=!0,g.afterLeave=()=>{a.isLeaving=!1,n.job.flags&8||n.update(),delete g.afterLeave,p=void 0},Uc(i);u==="in-out"&&d.type!==Bn?g.delayLeave=(y,b,C)=>{const I=gp(a,p);I[String(p.key)]=p,y[Rs]=()=>{b(),y[Rs]=void 0,delete h.delayedLeave,p=void 0},h.delayedLeave=()=>{C(),delete h.delayedLeave,p=void 0}}:p=void 0}else p&&(p=void 0);return i}}};function mp(e){let t=e[0];if(e.length>1){for(const n of e)if(n.type!==Bn){t=n;break}}return t}const xg=Ig;function gp(e,t){const{leavingVNodes:n}=e;let a=n.get(t.type);return a||(a=Object.create(null),n.set(t.type,a)),a}function uu(e,t,n,a,s){const{appear:i,mode:l,persisted:u=!1,onBeforeEnter:d,onEnter:h,onAfterEnter:p,onEnterCancelled:g,onBeforeLeave:y,onLeave:b,onAfterLeave:C,onLeaveCancelled:I,onBeforeAppear:M,onAppear:x,onAfterAppear:S,onAppearCancelled:_}=t,D=String(e.key),E=gp(n,e),Z=(B,j)=>{B&&ss(B,a,9,j)},A=(B,j)=>{const R=j[1];Z(B,j),lt(B)?B.every(G=>G.length<=1)&&R():B.length<=1&&R()},N={mode:l,persisted:u,beforeEnter(B){let j=d;if(!n.isMounted)if(i)j=M||d;else return;B[Rs]&&B[Rs](!0);const R=E[D];R&&Qa(e,R)&&R.el[Rs]&&R.el[Rs](),Z(j,[B])},enter(B){let j=h,R=p,G=g;if(!n.isMounted)if(i)j=x||h,R=S||p,G=_||g;else return;let ee=!1;const ne=B[mr]=Ae=>{ee||(ee=!0,Ae?Z(G,[B]):Z(R,[B]),N.delayedLeave&&N.delayedLeave(),B[mr]=void 0)};j?A(j,[B,ne]):ne()},leave(B,j){const R=String(e.key);if(B[mr]&&B[mr](!0),n.isUnmounting)return j();Z(y,[B]);let G=!1;const ee=B[Rs]=ne=>{G||(G=!0,j(),ne?Z(I,[B]):Z(C,[B]),B[Rs]=void 0,E[R]===e&&delete E[R])};E[R]=e,b?A(b,[B,ee]):ee()},clone(B){const j=uu(B,t,n,a,s);return s&&s(j),j}};return N}function Uc(e){if(rc(e))return e=Ta(e),e.children=null,e}function Vd(e){if(!rc(e))return dp(e.type)&&e.children?mp(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:n}=e;if(n){if(t&16)return n[0];if(t&32&&vt(n.default))return n.default()}}function Bl(e,t){e.shapeFlag&6&&e.component?(e.transition=t,Bl(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function yp(e,t=!1,n){let a=[],s=0;for(let i=0;i<e.length;i++){let l=e[i];const u=n==null?l.key:String(n)+String(l.key!=null?l.key:i);l.type===Te?(l.patchFlag&128&&s++,a=a.concat(yp(l.children,t,u))):(t||l.type!==Bn)&&a.push(u!=null?Ta(l,{key:u}):l)}if(s>1)for(let i=0;i<a.length;i++)a[i].patchFlag=-2;return a}function kp(e,t){return vt(e)?kn({name:e.name},t,{setup:e}):e}function bp(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const Or=new WeakMap;function Il(e,t,n,a,s=!1){if(lt(e)){e.forEach((C,I)=>Il(C,t&&(lt(t)?t[I]:t),n,a,s));return}if(Fi(a)&&!s){a.shapeFlag&512&&a.type.__asyncResolved&&a.component.subTree.component&&Il(e,t,n,a.component.subTree);return}const i=a.shapeFlag&4?fc(a.component):a.el,l=s?null:i,{i:u,r:d}=e,h=t&&t.r,p=u.refs===Gt?u.refs={}:u.refs,g=u.setupState,y=At(g),b=g===Gt?$f:C=>Ot(y,C);if(h!=null&&h!==d){if(Gd(t),en(h))p[h]=null,b(h)&&(g[h]=null);else if(Qt(h)){h.value=null;const C=t;C.k&&(p[C.k]=null)}}if(vt(d))Zl(d,u,12,[l,p]);else{const C=en(d),I=Qt(d);if(C||I){const M=()=>{if(e.f){const x=C?b(d)?g[d]:p[d]:d.value;if(s)lt(x)&&zu(x,i);else if(lt(x))x.includes(i)||x.push(i);else if(C)p[d]=[i],b(d)&&(g[d]=p[d]);else{const S=[i];d.value=S,e.k&&(p[e.k]=S)}}else C?(p[d]=l,b(d)&&(g[d]=l)):I&&(d.value=l,e.k&&(p[e.k]=l))};if(l){const x=()=>{M(),Or.delete(e)};x.id=-1,Or.set(e,x),Wn(x,n)}else Gd(e),M()}}}function Gd(e){const t=Or.get(e);t&&(t.flags|=8,Or.delete(e))}sc().requestIdleCallback;sc().cancelIdleCallback;const Fi=e=>!!e.type.__asyncLoader,rc=e=>e.type.__isKeepAlive;function $g(e,t){_p(e,"a",t)}function Tg(e,t){_p(e,"da",t)}function _p(e,t,n=Nn){const a=e.__wdc||(e.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(cc(t,a,n),n){let s=n.parent;for(;s&&s.parent;)rc(s.parent.vnode)&&Mg(a,t,n,s),s=s.parent}}function Mg(e,t,n,a){const s=cc(t,e,a,!0);bn(()=>{zu(a[t],s)},n)}function cc(e,t,n=Nn,a=!1){if(n){const s=n[e]||(n[e]=[]),i=t.__weh||(t.__weh=(...l)=>{js();const u=ql(n),d=ss(t,n,e,l);return u(),Zs(),d});return a?s.unshift(i):s.push(i),i}}const Js=e=>(t,n=Nn)=>{(!Ul||e==="sp")&&cc(e,(...a)=>t(...a),n)},Ag=Js("bm"),tn=Js("m"),wp=Js("bu"),Eg=Js("u"),Cp=Js("bum"),bn=Js("um"),Pg=Js("sp"),Dg=Js("rtg"),Og=Js("rtc");function Rg(e,t=Nn){cc("ec",e,t)}const Lp="components";function Yu(e,t){return Ip(Lp,e,!0,t)||e}const Sp=Symbol.for("v-ndc");function Bg(e){return en(e)?Ip(Lp,e,!1)||e:e||Sp}function Ip(e,t,n=!0,a=!1){const s=xn||Nn;if(s){const i=s.type;{const u=by(i,!1);if(u&&(u===t||u===Bo(t)||u===nc(Bo(t))))return i}const l=jd(s[e]||i[e],t)||jd(s.appContext[e],t);return!l&&a?i:l}}function jd(e,t){return e&&(e[t]||e[Bo(t)]||e[nc(Bo(t))])}function Fe(e,t,n,a){let s;const i=n,l=lt(e);if(l||en(e)){const u=l&&Gs(e);let d=!1,h=!1;u&&(d=!Lo(e),h=qs(e),e=ac(e)),s=new Array(e.length);for(let p=0,g=e.length;p<g;p++)s[p]=t(d?h?zi(os(e[p])):os(e[p]):e[p],p,void 0,i)}else if(typeof e=="number"){s=new Array(e);for(let u=0;u<e;u++)s[u]=t(u+1,u,void 0,i)}else if(zt(e))if(e[Symbol.iterator])s=Array.from(e,(u,d)=>t(u,d,void 0,i));else{const u=Object.keys(e);s=new Array(u.length);for(let d=0,h=u.length;d<h;d++){const p=u[d];s[d]=t(e[p],p,d,i)}}else s=[];return s}function Xu(e,t){for(let n=0;n<t.length;n++){const a=t[n];if(lt(a))for(let s=0;s<a.length;s++)e[a[s].name]=a[s].fn;else a&&(e[a.name]=a.key?(...s)=>{const i=a.fn(...s);return i&&(i.key=a.key),i}:a.fn)}return e}function ro(e,t,n={},a,s){if(xn.ce||xn.parent&&Fi(xn.parent)&&xn.parent.ce){const h=Object.keys(n).length>0;return t!=="default"&&(n.name=t),v(),Ze(Te,null,[Me("slot",n,a&&a())],h?-2:64)}let i=e[t];i&&i._c&&(i._d=!1),v();const l=i&&xp(i(n)),u=n.key||l&&l.key,d=Ze(Te,{key:(u&&!ns(u)?u:`_${t}`)+(!l&&a?"_fb":"")},l||(a?a():[]),l&&e._===1?64:-2);return i&&i._c&&(i._d=!0),d}function xp(e){return e.some(t=>Fl(t)?!(t.type===Bn||t.type===Te&&!xp(t.children)):!0)?e:null}const du=e=>e?Zp(e)?fc(e):du(e.parent):null,xl=kn(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>du(e.parent),$root:e=>du(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>Tp(e),$forceUpdate:e=>e.f||(e.f=()=>{Ju(e.update)}),$nextTick:e=>e.n||(e.n=an.bind(e.proxy)),$watch:e=>Cg.bind(e)}),zc=(e,t)=>e!==Gt&&!e.__isScriptSetup&&Ot(e,t),Ng={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:n,setupState:a,data:s,props:i,accessCache:l,type:u,appContext:d}=e;if(t[0]!=="$"){const y=l[t];if(y!==void 0)switch(y){case 1:return a[t];case 2:return s[t];case 4:return n[t];case 3:return i[t]}else{if(zc(a,t))return l[t]=1,a[t];if(s!==Gt&&Ot(s,t))return l[t]=2,s[t];if(Ot(i,t))return l[t]=3,i[t];if(n!==Gt&&Ot(n,t))return l[t]=4,n[t];hu&&(l[t]=0)}}const h=xl[t];let p,g;if(h)return t==="$attrs"&&Rn(e.attrs,"get",""),h(e);if((p=u.__cssModules)&&(p=p[t]))return p;if(n!==Gt&&Ot(n,t))return l[t]=4,n[t];if(g=d.config.globalProperties,Ot(g,t))return g[t]},set({_:e},t,n){const{data:a,setupState:s,ctx:i}=e;return zc(s,t)?(s[t]=n,!0):a!==Gt&&Ot(a,t)?(a[t]=n,!0):Ot(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(i[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:a,appContext:s,props:i,type:l}},u){let d;return!!(n[u]||e!==Gt&&u[0]!=="$"&&Ot(e,u)||zc(t,u)||Ot(i,u)||Ot(a,u)||Ot(xl,u)||Ot(s.config.globalProperties,u)||(d=l.__cssModules)&&d[u])},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:Ot(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};function Zd(e){return lt(e)?e.reduce((t,n)=>(t[n]=null,t),{}):e}let hu=!0;function Fg(e){const t=Tp(e),n=e.proxy,a=e.ctx;hu=!1,t.beforeCreate&&qd(t.beforeCreate,e,"bc");const{data:s,computed:i,methods:l,watch:u,provide:d,inject:h,created:p,beforeMount:g,mounted:y,beforeUpdate:b,updated:C,activated:I,deactivated:M,beforeDestroy:x,beforeUnmount:S,destroyed:_,unmounted:D,render:E,renderTracked:Z,renderTriggered:A,errorCaptured:N,serverPrefetch:B,expose:j,inheritAttrs:R,components:G,directives:ee,filters:ne}=t;if(h&&Ug(h,a,null),l)for(const te in l){const U=l[te];vt(U)&&(a[te]=U.bind(n))}if(s){const te=s.call(n,n);zt(te)&&(e.data=di(te))}if(hu=!0,i)for(const te in i){const U=i[te],X=vt(U)?U.bind(n,n):vt(U.get)?U.get.bind(n,n):Qo,re=!vt(U)&&vt(U.set)?U.set.bind(n):Qo,ke=z({get:X,set:re});Object.defineProperty(a,te,{enumerable:!0,configurable:!0,get:()=>ke.value,set:Re=>ke.value=Re})}if(u)for(const te in u)$p(u[te],a,n,te);if(d){const te=vt(d)?d.call(n):d;Reflect.ownKeys(te).forEach(U=>{Ll(U,te[U])})}p&&qd(p,e,"c");function J(te,U){lt(U)?U.forEach(X=>te(X.bind(n))):U&&te(U.bind(n))}if(J(Ag,g),J(tn,y),J(wp,b),J(Eg,C),J($g,I),J(Tg,M),J(Rg,N),J(Og,Z),J(Dg,A),J(Cp,S),J(bn,D),J(Pg,B),lt(j))if(j.length){const te=e.exposed||(e.exposed={});j.forEach(U=>{Object.defineProperty(te,U,{get:()=>n[U],set:X=>n[U]=X,enumerable:!0})})}else e.exposed||(e.exposed={});E&&e.render===Qo&&(e.render=E),R!=null&&(e.inheritAttrs=R),G&&(e.components=G),ee&&(e.directives=ee),B&&bp(e)}function Ug(e,t,n=Qo){lt(e)&&(e=fu(e));for(const a in e){const s=e[a];let i;zt(s)?"default"in s?i=co(s.from||a,s.default,!0):i=co(s.from||a):i=co(s),Qt(i)?Object.defineProperty(t,a,{enumerable:!0,configurable:!0,get:()=>i.value,set:l=>i.value=l}):t[a]=i}}function qd(e,t,n){ss(lt(e)?e.map(a=>a.bind(t.proxy)):e.bind(t.proxy),t,n)}function $p(e,t,n,a){let s=a.includes(".")?cp(n,a):()=>n[a];if(en(e)){const i=t[e];vt(i)&&qe(s,i)}else if(vt(e))qe(s,e.bind(n));else if(zt(e))if(lt(e))e.forEach(i=>$p(i,t,n,a));else{const i=vt(e.handler)?e.handler.bind(n):t[e.handler];vt(i)&&qe(s,i,e)}}function Tp(e){const t=e.type,{mixins:n,extends:a}=t,{mixins:s,optionsCache:i,config:{optionMergeStrategies:l}}=e.appContext,u=i.get(t);let d;return u?d=u:!s.length&&!n&&!a?d=t:(d={},s.length&&s.forEach(h=>Rr(d,h,l,!0)),Rr(d,t,l)),zt(t)&&i.set(t,d),d}function Rr(e,t,n,a=!1){const{mixins:s,extends:i}=t;i&&Rr(e,i,n,!0),s&&s.forEach(l=>Rr(e,l,n,!0));for(const l in t)if(!(a&&l==="expose")){const u=zg[l]||n&&n[l];e[l]=u?u(e[l],t[l]):t[l]}return e}const zg={data:Wd,props:Kd,emits:Kd,methods:gl,computed:gl,beforeCreate:qn,created:qn,beforeMount:qn,mounted:qn,beforeUpdate:qn,updated:qn,beforeDestroy:qn,beforeUnmount:qn,destroyed:qn,unmounted:qn,activated:qn,deactivated:qn,errorCaptured:qn,serverPrefetch:qn,components:gl,directives:gl,watch:Vg,provide:Wd,inject:Hg};function Wd(e,t){return t?e?function(){return kn(vt(e)?e.call(this,this):e,vt(t)?t.call(this,this):t)}:t:e}function Hg(e,t){return gl(fu(e),fu(t))}function fu(e){if(lt(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function qn(e,t){return e?[...new Set([].concat(e,t))]:t}function gl(e,t){return e?kn(Object.create(null),e,t):t}function Kd(e,t){return e?lt(e)&&lt(t)?[...new Set([...e,...t])]:kn(Object.create(null),Zd(e),Zd(t??{})):t}function Vg(e,t){if(!e)return t;if(!t)return e;const n=kn(Object.create(null),e);for(const a in t)n[a]=qn(e[a],t[a]);return n}function Mp(){return{app:null,config:{isNativeTag:$f,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Gg=0;function jg(e,t){return function(a,s=null){vt(a)||(a=kn({},a)),s!=null&&!zt(s)&&(s=null);const i=Mp(),l=new WeakSet,u=[];let d=!1;const h=i.app={_uid:Gg++,_component:a,_props:s,_container:null,_context:i,_instance:null,version:wy,get config(){return i.config},set config(p){},use(p,...g){return l.has(p)||(p&&vt(p.install)?(l.add(p),p.install(h,...g)):vt(p)&&(l.add(p),p(h,...g))),h},mixin(p){return i.mixins.includes(p)||i.mixins.push(p),h},component(p,g){return g?(i.components[p]=g,h):i.components[p]},directive(p,g){return g?(i.directives[p]=g,h):i.directives[p]},mount(p,g,y){if(!d){const b=h._ceVNode||Me(a,s);return b.appContext=i,y===!0?y="svg":y===!1&&(y=void 0),e(b,p,y),d=!0,h._container=p,p.__vue_app__=h,fc(b.component)}},onUnmount(p){u.push(p)},unmount(){d&&(ss(u,h._instance,16),e(null,h._container),delete h._container.__vue_app__)},provide(p,g){return i.provides[p]=g,h},runWithContext(p){const g=ii;ii=h;try{return p()}finally{ii=g}}};return h}}let ii=null;const Zg=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Bo(t)}Modifiers`]||e[`${Ea(t)}Modifiers`];function qg(e,t,...n){if(e.isUnmounted)return;const a=e.vnode.props||Gt;let s=n;const i=t.startsWith("update:"),l=i&&Zg(a,t.slice(7));l&&(l.trim&&(s=n.map(p=>en(p)?p.trim():p)),l.number&&(s=n.map(oc)));let u,d=a[u=Oc(t)]||a[u=Oc(Bo(t))];!d&&i&&(d=a[u=Oc(Ea(t))]),d&&ss(d,e,6,s);const h=a[u+"Once"];if(h){if(!e.emitted)e.emitted={};else if(e.emitted[u])return;e.emitted[u]=!0,ss(h,e,6,s)}}const Wg=new WeakMap;function Ap(e,t,n=!1){const a=n?Wg:t.emitsCache,s=a.get(e);if(s!==void 0)return s;const i=e.emits;let l={},u=!1;if(!vt(e)){const d=h=>{const p=Ap(h,t,!0);p&&(u=!0,kn(l,p))};!n&&t.mixins.length&&t.mixins.forEach(d),e.extends&&d(e.extends),e.mixins&&e.mixins.forEach(d)}return!i&&!u?(zt(e)&&a.set(e,null),null):(lt(i)?i.forEach(d=>l[d]=null):kn(l,i),zt(e)&&a.set(e,l),l)}function uc(e,t){return!e||!Qr(t)?!1:(t=t.slice(2).replace(/Once$/,""),Ot(e,t[0].toLowerCase()+t.slice(1))||Ot(e,Ea(t))||Ot(e,t))}function Jd(e){const{type:t,vnode:n,proxy:a,withProxy:s,propsOptions:[i],slots:l,attrs:u,emit:d,render:h,renderCache:p,props:g,data:y,setupState:b,ctx:C,inheritAttrs:I}=e,M=Dr(e);let x,S;try{if(n.shapeFlag&4){const D=s||a,E=D;x=ys(h.call(E,D,p,g,b,y,C)),S=u}else{const D=t;x=ys(D.length>1?D(g,{attrs:u,slots:l,emit:d}):D(g,null)),S=t.props?u:Kg(u)}}catch(D){Tl.length=0,lc(D,e,1),x=Me(Bn)}let _=x;if(S&&I!==!1){const D=Object.keys(S),{shapeFlag:E}=_;D.length&&E&7&&(i&&D.some(Uu)&&(S=Jg(S,i)),_=Ta(_,S,!1,!0))}return n.dirs&&(_=Ta(_,null,!1,!0),_.dirs=_.dirs?_.dirs.concat(n.dirs):n.dirs),n.transition&&Bl(_,n.transition),x=_,Dr(M),x}const Kg=e=>{let t;for(const n in e)(n==="class"||n==="style"||Qr(n))&&((t||(t={}))[n]=e[n]);return t},Jg=(e,t)=>{const n={};for(const a in e)(!Uu(a)||!(a.slice(9)in t))&&(n[a]=e[a]);return n};function Yg(e,t,n){const{props:a,children:s,component:i}=e,{props:l,children:u,patchFlag:d}=t,h=i.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&d>=0){if(d&1024)return!0;if(d&16)return a?Yd(a,l,h):!!l;if(d&8){const p=t.dynamicProps;for(let g=0;g<p.length;g++){const y=p[g];if(l[y]!==a[y]&&!uc(h,y))return!0}}}else return(s||u)&&(!u||!u.$stable)?!0:a===l?!1:a?l?Yd(a,l,h):!0:!!l;return!1}function Yd(e,t,n){const a=Object.keys(t);if(a.length!==Object.keys(e).length)return!0;for(let s=0;s<a.length;s++){const i=a[s];if(t[i]!==e[i]&&!uc(n,i))return!0}return!1}function Xg({vnode:e,parent:t},n){for(;t;){const a=t.subTree;if(a.suspense&&a.suspense.activeBranch===e&&(a.el=e.el),a===e)(e=t.vnode).el=n,t=t.parent;else break}}const Ep={},Pp=()=>Object.create(Ep),Dp=e=>Object.getPrototypeOf(e)===Ep;function Qg(e,t,n,a=!1){const s={},i=Pp();e.propsDefaults=Object.create(null),Op(e,t,s,i);for(const l in e.propsOptions[0])l in s||(s[l]=void 0);n?e.props=a?s:Qf(s):e.type.props?e.props=s:e.props=i,e.attrs=i}function ey(e,t,n,a){const{props:s,attrs:i,vnode:{patchFlag:l}}=e,u=At(s),[d]=e.propsOptions;let h=!1;if((a||l>0)&&!(l&16)){if(l&8){const p=e.vnode.dynamicProps;for(let g=0;g<p.length;g++){let y=p[g];if(uc(e.emitsOptions,y))continue;const b=t[y];if(d)if(Ot(i,y))b!==i[y]&&(i[y]=b,h=!0);else{const C=Bo(y);s[C]=pu(d,u,C,b,e,!1)}else b!==i[y]&&(i[y]=b,h=!0)}}}else{Op(e,t,s,i)&&(h=!0);let p;for(const g in u)(!t||!Ot(t,g)&&((p=Ea(g))===g||!Ot(t,p)))&&(d?n&&(n[g]!==void 0||n[p]!==void 0)&&(s[g]=pu(d,u,g,void 0,e,!0)):delete s[g]);if(i!==u)for(const g in i)(!t||!Ot(t,g))&&(delete i[g],h=!0)}h&&Bs(e.attrs,"set","")}function Op(e,t,n,a){const[s,i]=e.propsOptions;let l=!1,u;if(t)for(let d in t){if(_l(d))continue;const h=t[d];let p;s&&Ot(s,p=Bo(d))?!i||!i.includes(p)?n[p]=h:(u||(u={}))[p]=h:uc(e.emitsOptions,d)||(!(d in a)||h!==a[d])&&(a[d]=h,l=!0)}if(i){const d=At(n),h=u||Gt;for(let p=0;p<i.length;p++){const g=i[p];n[g]=pu(s,d,g,h[g],e,!Ot(h,g))}}return l}function pu(e,t,n,a,s,i){const l=e[n];if(l!=null){const u=Ot(l,"default");if(u&&a===void 0){const d=l.default;if(l.type!==Function&&!l.skipFactory&&vt(d)){const{propsDefaults:h}=s;if(n in h)a=h[n];else{const p=ql(s);a=h[n]=d.call(null,t),p()}}else a=d;s.ce&&s.ce._setProp(n,a)}l[0]&&(i&&!u?a=!1:l[1]&&(a===""||a===Ea(n))&&(a=!0))}return a}const ty=new WeakMap;function Rp(e,t,n=!1){const a=n?ty:t.propsCache,s=a.get(e);if(s)return s;const i=e.props,l={},u=[];let d=!1;if(!vt(e)){const p=g=>{d=!0;const[y,b]=Rp(g,t,!0);kn(l,y),b&&u.push(...b)};!n&&t.mixins.length&&t.mixins.forEach(p),e.extends&&p(e.extends),e.mixins&&e.mixins.forEach(p)}if(!i&&!d)return zt(e)&&a.set(e,Ri),Ri;if(lt(i))for(let p=0;p<i.length;p++){const g=Bo(i[p]);Xd(g)&&(l[g]=Gt)}else if(i)for(const p in i){const g=Bo(p);if(Xd(g)){const y=i[p],b=l[g]=lt(y)||vt(y)?{type:y}:kn({},y),C=b.type;let I=!1,M=!0;if(lt(C))for(let x=0;x<C.length;++x){const S=C[x],_=vt(S)&&S.name;if(_==="Boolean"){I=!0;break}else _==="String"&&(M=!1)}else I=vt(C)&&C.name==="Boolean";b[0]=I,b[1]=M,(I||Ot(b,"default"))&&u.push(g)}}const h=[l,u];return zt(e)&&a.set(e,h),h}function Xd(e){return e[0]!=="$"&&!_l(e)}const Qu=e=>e==="_"||e==="_ctx"||e==="$stable",ed=e=>lt(e)?e.map(ys):[ys(e)],ny=(e,t,n)=>{if(t._n)return t;const a=He((...s)=>ed(t(...s)),n);return a._c=!1,a},Bp=(e,t,n)=>{const a=e._ctx;for(const s in e){if(Qu(s))continue;const i=e[s];if(vt(i))t[s]=ny(s,i,a);else if(i!=null){const l=ed(i);t[s]=()=>l}}},Np=(e,t)=>{const n=ed(t);e.slots.default=()=>n},Fp=(e,t,n)=>{for(const a in t)(n||!Qu(a))&&(e[a]=t[a])},oy=(e,t,n)=>{const a=e.slots=Pp();if(e.vnode.shapeFlag&32){const s=t._;s?(Fp(a,t,n),n&&Ef(a,"_",s,!0)):Bp(t,a)}else t&&Np(e,t)},sy=(e,t,n)=>{const{vnode:a,slots:s}=e;let i=!0,l=Gt;if(a.shapeFlag&32){const u=t._;u?n&&u===1?i=!1:Fp(s,t,n):(i=!t.$stable,Bp(t,s)),l=t}else t&&(Np(e,t),l={default:1});if(i)for(const u in s)!Qu(u)&&l[u]==null&&delete s[u]},Wn=cy;function ay(e){return iy(e)}function iy(e,t){const n=sc();n.__VUE__=!0;const{insert:a,remove:s,patchProp:i,createElement:l,createText:u,createComment:d,setText:h,setElementText:p,parentNode:g,nextSibling:y,setScopeId:b=Qo,insertStaticContent:C}=e,I=(F,K,ae,$e=null,Be=null,Oe=null,Le=void 0,Y=null,he=!!K.dynamicChildren)=>{if(F===K)return;F&&!Qa(F,K)&&($e=Q(F),Re(F,Be,Oe,!0),F=null),K.patchFlag===-2&&(he=!1,K.dynamicChildren=null);const{type:xe,ref:Ie,shapeFlag:be}=K;switch(xe){case dc:M(F,K,ae,$e);break;case Bn:x(F,K,ae,$e);break;case $l:F==null&&S(K,ae,$e,Le);break;case Te:G(F,K,ae,$e,Be,Oe,Le,Y,he);break;default:be&1?E(F,K,ae,$e,Be,Oe,Le,Y,he):be&6?ee(F,K,ae,$e,Be,Oe,Le,Y,he):(be&64||be&128)&&xe.process(F,K,ae,$e,Be,Oe,Le,Y,he,ve)}Ie!=null&&Be?Il(Ie,F&&F.ref,Oe,K||F,!K):Ie==null&&F&&F.ref!=null&&Il(F.ref,null,Oe,F,!0)},M=(F,K,ae,$e)=>{if(F==null)a(K.el=u(K.children),ae,$e);else{const Be=K.el=F.el;K.children!==F.children&&h(Be,K.children)}},x=(F,K,ae,$e)=>{F==null?a(K.el=d(K.children||""),ae,$e):K.el=F.el},S=(F,K,ae,$e)=>{[F.el,F.anchor]=C(F.children,K,ae,$e,F.el,F.anchor)},_=({el:F,anchor:K},ae,$e)=>{let Be;for(;F&&F!==K;)Be=y(F),a(F,ae,$e),F=Be;a(K,ae,$e)},D=({el:F,anchor:K})=>{let ae;for(;F&&F!==K;)ae=y(F),s(F),F=ae;s(K)},E=(F,K,ae,$e,Be,Oe,Le,Y,he)=>{if(K.type==="svg"?Le="svg":K.type==="math"&&(Le="mathml"),F==null)Z(K,ae,$e,Be,Oe,Le,Y,he);else{const xe=F.el&&F.el._isVueCE?F.el:null;try{xe&&xe._beginPatch(),B(F,K,Be,Oe,Le,Y,he)}finally{xe&&xe._endPatch()}}},Z=(F,K,ae,$e,Be,Oe,Le,Y)=>{let he,xe;const{props:Ie,shapeFlag:be,transition:de,dirs:fe}=F;if(he=F.el=l(F.type,Oe,Ie&&Ie.is,Ie),be&8?p(he,F.children):be&16&&N(F.children,he,null,$e,Be,Hc(F,Oe),Le,Y),fe&&qa(F,null,$e,"created"),A(he,F,F.scopeId,Le,$e),Ie){for(const W in Ie)W!=="value"&&!_l(W)&&i(he,W,null,Ie[W],Oe,$e);"value"in Ie&&i(he,"value",null,Ie.value,Oe),(xe=Ie.onVnodeBeforeMount)&&ps(xe,$e,F)}fe&&qa(F,null,$e,"beforeMount");const q=ly(Be,de);q&&de.beforeEnter(he),a(he,K,ae),((xe=Ie&&Ie.onVnodeMounted)||q||fe)&&Wn(()=>{xe&&ps(xe,$e,F),q&&de.enter(he),fe&&qa(F,null,$e,"mounted")},Be)},A=(F,K,ae,$e,Be)=>{if(ae&&b(F,ae),$e)for(let Oe=0;Oe<$e.length;Oe++)b(F,$e[Oe]);if(Be){let Oe=Be.subTree;if(K===Oe||Hp(Oe.type)&&(Oe.ssContent===K||Oe.ssFallback===K)){const Le=Be.vnode;A(F,Le,Le.scopeId,Le.slotScopeIds,Be.parent)}}},N=(F,K,ae,$e,Be,Oe,Le,Y,he=0)=>{for(let xe=he;xe<F.length;xe++){const Ie=F[xe]=Y?_a(F[xe]):ys(F[xe]);I(null,Ie,K,ae,$e,Be,Oe,Le,Y)}},B=(F,K,ae,$e,Be,Oe,Le)=>{const Y=K.el=F.el;let{patchFlag:he,dynamicChildren:xe,dirs:Ie}=K;he|=F.patchFlag&16;const be=F.props||Gt,de=K.props||Gt;let fe;if(ae&&Wa(ae,!1),(fe=de.onVnodeBeforeUpdate)&&ps(fe,ae,K,F),Ie&&qa(K,F,ae,"beforeUpdate"),ae&&Wa(ae,!0),(be.innerHTML&&de.innerHTML==null||be.textContent&&de.textContent==null)&&p(Y,""),xe?j(F.dynamicChildren,xe,Y,ae,$e,Hc(K,Be),Oe):Le||U(F,K,Y,null,ae,$e,Hc(K,Be),Oe,!1),he>0){if(he&16)R(Y,be,de,ae,Be);else if(he&2&&be.class!==de.class&&i(Y,"class",null,de.class,Be),he&4&&i(Y,"style",be.style,de.style,Be),he&8){const q=K.dynamicProps;for(let W=0;W<q.length;W++){const ie=q[W],Ue=be[ie],et=de[ie];(et!==Ue||ie==="value")&&i(Y,ie,Ue,et,Be,ae)}}he&1&&F.children!==K.children&&p(Y,K.children)}else!Le&&xe==null&&R(Y,be,de,ae,Be);((fe=de.onVnodeUpdated)||Ie)&&Wn(()=>{fe&&ps(fe,ae,K,F),Ie&&qa(K,F,ae,"updated")},$e)},j=(F,K,ae,$e,Be,Oe,Le)=>{for(let Y=0;Y<K.length;Y++){const he=F[Y],xe=K[Y],Ie=he.el&&(he.type===Te||!Qa(he,xe)||he.shapeFlag&198)?g(he.el):ae;I(he,xe,Ie,null,$e,Be,Oe,Le,!0)}},R=(F,K,ae,$e,Be)=>{if(K!==ae){if(K!==Gt)for(const Oe in K)!_l(Oe)&&!(Oe in ae)&&i(F,Oe,K[Oe],null,Be,$e);for(const Oe in ae){if(_l(Oe))continue;const Le=ae[Oe],Y=K[Oe];Le!==Y&&Oe!=="value"&&i(F,Oe,Y,Le,Be,$e)}"value"in ae&&i(F,"value",K.value,ae.value,Be)}},G=(F,K,ae,$e,Be,Oe,Le,Y,he)=>{const xe=K.el=F?F.el:u(""),Ie=K.anchor=F?F.anchor:u("");let{patchFlag:be,dynamicChildren:de,slotScopeIds:fe}=K;fe&&(Y=Y?Y.concat(fe):fe),F==null?(a(xe,ae,$e),a(Ie,ae,$e),N(K.children||[],ae,Ie,Be,Oe,Le,Y,he)):be>0&&be&64&&de&&F.dynamicChildren&&F.dynamicChildren.length===de.length?(j(F.dynamicChildren,de,ae,Be,Oe,Le,Y),(K.key!=null||Be&&K===Be.subTree)&&td(F,K,!0)):U(F,K,ae,Ie,Be,Oe,Le,Y,he)},ee=(F,K,ae,$e,Be,Oe,Le,Y,he)=>{K.slotScopeIds=Y,F==null?K.shapeFlag&512?Be.ctx.activate(K,ae,$e,Le,he):ne(K,ae,$e,Be,Oe,Le,he):Ae(F,K,he)},ne=(F,K,ae,$e,Be,Oe,Le)=>{const Y=F.component=vy(F,$e,Be);if(rc(F)&&(Y.ctx.renderer=ve),my(Y,!1,Le),Y.asyncDep){if(Be&&Be.registerDep(Y,J,Le),!F.el){const he=Y.subTree=Me(Bn);x(null,he,K,ae),F.placeholder=he.el}}else J(Y,F,K,ae,Be,Oe,Le)},Ae=(F,K,ae)=>{const $e=K.component=F.component;if(Yg(F,K,ae))if($e.asyncDep&&!$e.asyncResolved){te($e,K,ae);return}else $e.next=K,$e.update();else K.el=F.el,$e.vnode=K},J=(F,K,ae,$e,Be,Oe,Le)=>{const Y=()=>{if(F.isMounted){let{next:be,bu:de,u:fe,parent:q,vnode:W}=F;{const yt=Up(F);if(yt){be&&(be.el=W.el,te(F,be,Le)),yt.asyncDep.then(()=>{F.isUnmounted||Y()});return}}let ie=be,Ue;Wa(F,!1),be?(be.el=W.el,te(F,be,Le)):be=W,de&&_r(de),(Ue=be.props&&be.props.onVnodeBeforeUpdate)&&ps(Ue,q,be,W),Wa(F,!0);const et=Jd(F),dt=F.subTree;F.subTree=et,I(dt,et,g(dt.el),Q(dt),F,Be,Oe),be.el=et.el,ie===null&&Xg(F,et.el),fe&&Wn(fe,Be),(Ue=be.props&&be.props.onVnodeUpdated)&&Wn(()=>ps(Ue,q,be,W),Be)}else{let be;const{el:de,props:fe}=K,{bm:q,m:W,parent:ie,root:Ue,type:et}=F,dt=Fi(K);Wa(F,!1),q&&_r(q),!dt&&(be=fe&&fe.onVnodeBeforeMount)&&ps(be,ie,K),Wa(F,!0);{Ue.ce&&Ue.ce._def.shadowRoot!==!1&&Ue.ce._injectChildStyle(et);const yt=F.subTree=Jd(F);I(null,yt,ae,$e,F,Be,Oe),K.el=yt.el}if(W&&Wn(W,Be),!dt&&(be=fe&&fe.onVnodeMounted)){const yt=K;Wn(()=>ps(be,ie,yt),Be)}(K.shapeFlag&256||ie&&Fi(ie.vnode)&&ie.vnode.shapeFlag&256)&&F.a&&Wn(F.a,Be),F.isMounted=!0,K=ae=$e=null}};F.scope.on();const he=F.effect=new Ff(Y);F.scope.off();const xe=F.update=he.run.bind(he),Ie=F.job=he.runIfDirty.bind(he);Ie.i=F,Ie.id=F.uid,he.scheduler=()=>Ju(Ie),Wa(F,!0),xe()},te=(F,K,ae)=>{K.component=F;const $e=F.vnode.props;F.vnode=K,F.next=null,ey(F,K.props,$e,ae),sy(F,K.children,ae),js(),Fd(F),Zs()},U=(F,K,ae,$e,Be,Oe,Le,Y,he=!1)=>{const xe=F&&F.children,Ie=F?F.shapeFlag:0,be=K.children,{patchFlag:de,shapeFlag:fe}=K;if(de>0){if(de&128){re(xe,be,ae,$e,Be,Oe,Le,Y,he);return}else if(de&256){X(xe,be,ae,$e,Be,Oe,Le,Y,he);return}}fe&8?(Ie&16&&We(xe,Be,Oe),be!==xe&&p(ae,be)):Ie&16?fe&16?re(xe,be,ae,$e,Be,Oe,Le,Y,he):We(xe,Be,Oe,!0):(Ie&8&&p(ae,""),fe&16&&N(be,ae,$e,Be,Oe,Le,Y,he))},X=(F,K,ae,$e,Be,Oe,Le,Y,he)=>{F=F||Ri,K=K||Ri;const xe=F.length,Ie=K.length,be=Math.min(xe,Ie);let de;for(de=0;de<be;de++){const fe=K[de]=he?_a(K[de]):ys(K[de]);I(F[de],fe,ae,null,Be,Oe,Le,Y,he)}xe>Ie?We(F,Be,Oe,!0,!1,be):N(K,ae,$e,Be,Oe,Le,Y,he,be)},re=(F,K,ae,$e,Be,Oe,Le,Y,he)=>{let xe=0;const Ie=K.length;let be=F.length-1,de=Ie-1;for(;xe<=be&&xe<=de;){const fe=F[xe],q=K[xe]=he?_a(K[xe]):ys(K[xe]);if(Qa(fe,q))I(fe,q,ae,null,Be,Oe,Le,Y,he);else break;xe++}for(;xe<=be&&xe<=de;){const fe=F[be],q=K[de]=he?_a(K[de]):ys(K[de]);if(Qa(fe,q))I(fe,q,ae,null,Be,Oe,Le,Y,he);else break;be--,de--}if(xe>be){if(xe<=de){const fe=de+1,q=fe<Ie?K[fe].el:$e;for(;xe<=de;)I(null,K[xe]=he?_a(K[xe]):ys(K[xe]),ae,q,Be,Oe,Le,Y,he),xe++}}else if(xe>de)for(;xe<=be;)Re(F[xe],Be,Oe,!0),xe++;else{const fe=xe,q=xe,W=new Map;for(xe=q;xe<=de;xe++){const Ct=K[xe]=he?_a(K[xe]):ys(K[xe]);Ct.key!=null&&W.set(Ct.key,xe)}let ie,Ue=0;const et=de-q+1;let dt=!1,yt=0;const mt=new Array(et);for(xe=0;xe<et;xe++)mt[xe]=0;for(xe=fe;xe<=be;xe++){const Ct=F[xe];if(Ue>=et){Re(Ct,Be,Oe,!0);continue}let Rt;if(Ct.key!=null)Rt=W.get(Ct.key);else for(ie=q;ie<=de;ie++)if(mt[ie-q]===0&&Qa(Ct,K[ie])){Rt=ie;break}Rt===void 0?Re(Ct,Be,Oe,!0):(mt[Rt-q]=xe+1,Rt>=yt?yt=Rt:dt=!0,I(Ct,K[Rt],ae,null,Be,Oe,Le,Y,he),Ue++)}const St=dt?ry(mt):Ri;for(ie=St.length-1,xe=et-1;xe>=0;xe--){const Ct=q+xe,Rt=K[Ct],Ft=K[Ct+1],ht=Ct+1<Ie?Ft.el||zp(Ft):$e;mt[xe]===0?I(null,Rt,ae,ht,Be,Oe,Le,Y,he):dt&&(ie<0||xe!==St[ie]?ke(Rt,ae,ht,2):ie--)}}},ke=(F,K,ae,$e,Be=null)=>{const{el:Oe,type:Le,transition:Y,children:he,shapeFlag:xe}=F;if(xe&6){ke(F.component.subTree,K,ae,$e);return}if(xe&128){F.suspense.move(K,ae,$e);return}if(xe&64){Le.move(F,K,ae,ve);return}if(Le===Te){a(Oe,K,ae);for(let be=0;be<he.length;be++)ke(he[be],K,ae,$e);a(F.anchor,K,ae);return}if(Le===$l){_(F,K,ae);return}if($e!==2&&xe&1&&Y)if($e===0)Y.beforeEnter(Oe),a(Oe,K,ae),Wn(()=>Y.enter(Oe),Be);else{const{leave:be,delayLeave:de,afterLeave:fe}=Y,q=()=>{F.ctx.isUnmounted?s(Oe):a(Oe,K,ae)},W=()=>{Oe._isLeaving&&Oe[Rs](!0),be(Oe,()=>{q(),fe&&fe()})};de?de(Oe,q,W):W()}else a(Oe,K,ae)},Re=(F,K,ae,$e=!1,Be=!1)=>{const{type:Oe,props:Le,ref:Y,children:he,dynamicChildren:xe,shapeFlag:Ie,patchFlag:be,dirs:de,cacheIndex:fe}=F;if(be===-2&&(Be=!1),Y!=null&&(js(),Il(Y,null,ae,F,!0),Zs()),fe!=null&&(K.renderCache[fe]=void 0),Ie&256){K.ctx.deactivate(F);return}const q=Ie&1&&de,W=!Fi(F);let ie;if(W&&(ie=Le&&Le.onVnodeBeforeUnmount)&&ps(ie,K,F),Ie&6)Ke(F.component,ae,$e);else{if(Ie&128){F.suspense.unmount(ae,$e);return}q&&qa(F,null,K,"beforeUnmount"),Ie&64?F.type.remove(F,K,ae,ve,$e):xe&&!xe.hasOnce&&(Oe!==Te||be>0&&be&64)?We(xe,K,ae,!1,!0):(Oe===Te&&be&384||!Be&&Ie&16)&&We(he,K,ae),$e&&Xe(F)}(W&&(ie=Le&&Le.onVnodeUnmounted)||q)&&Wn(()=>{ie&&ps(ie,K,F),q&&qa(F,null,K,"unmounted")},ae)},Xe=F=>{const{type:K,el:ae,anchor:$e,transition:Be}=F;if(K===Te){Ne(ae,$e);return}if(K===$l){D(F);return}const Oe=()=>{s(ae),Be&&!Be.persisted&&Be.afterLeave&&Be.afterLeave()};if(F.shapeFlag&1&&Be&&!Be.persisted){const{leave:Le,delayLeave:Y}=Be,he=()=>Le(ae,Oe);Y?Y(F.el,Oe,he):he()}else Oe()},Ne=(F,K)=>{let ae;for(;F!==K;)ae=y(F),s(F),F=ae;s(K)},Ke=(F,K,ae)=>{const{bum:$e,scope:Be,job:Oe,subTree:Le,um:Y,m:he,a:xe}=F;Qd(he),Qd(xe),$e&&_r($e),Be.stop(),Oe&&(Oe.flags|=8,Re(Le,F,K,ae)),Y&&Wn(Y,K),Wn(()=>{F.isUnmounted=!0},K)},We=(F,K,ae,$e=!1,Be=!1,Oe=0)=>{for(let Le=Oe;Le<F.length;Le++)Re(F[Le],K,ae,$e,Be)},Q=F=>{if(F.shapeFlag&6)return Q(F.component.subTree);if(F.shapeFlag&128)return F.suspense.next();const K=y(F.anchor||F.el),ae=K&&K[up];return ae?y(ae):K};let ge=!1;const Ce=(F,K,ae)=>{let $e;F==null?K._vnode&&(Re(K._vnode,null,null,!0),$e=K._vnode.component):I(K._vnode||null,F,K,null,null,null,ae),K._vnode=F,ge||(ge=!0,Fd($e),ap(),ge=!1)},ve={p:I,um:Re,m:ke,r:Xe,mt:ne,mc:N,pc:U,pbc:j,n:Q,o:e};return{render:Ce,hydrate:void 0,createApp:jg(Ce)}}function Hc({type:e,props:t},n){return n==="svg"&&e==="foreignObject"||n==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function Wa({effect:e,job:t},n){n?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function ly(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function td(e,t,n=!1){const a=e.children,s=t.children;if(lt(a)&&lt(s))for(let i=0;i<a.length;i++){const l=a[i];let u=s[i];u.shapeFlag&1&&!u.dynamicChildren&&((u.patchFlag<=0||u.patchFlag===32)&&(u=s[i]=_a(s[i]),u.el=l.el),!n&&u.patchFlag!==-2&&td(l,u)),u.type===dc&&(u.patchFlag!==-1?u.el=l.el:u.__elIndex=i+(e.type===Te?1:0)),u.type===Bn&&!u.el&&(u.el=l.el)}}function ry(e){const t=e.slice(),n=[0];let a,s,i,l,u;const d=e.length;for(a=0;a<d;a++){const h=e[a];if(h!==0){if(s=n[n.length-1],e[s]<h){t[a]=s,n.push(a);continue}for(i=0,l=n.length-1;i<l;)u=i+l>>1,e[n[u]]<h?i=u+1:l=u;h<e[n[i]]&&(i>0&&(t[a]=n[i-1]),n[i]=a)}}for(i=n.length,l=n[i-1];i-- >0;)n[i]=l,l=t[l];return n}function Up(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:Up(t)}function Qd(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}function zp(e){if(e.placeholder)return e.placeholder;const t=e.component;return t?zp(t.subTree):null}const Hp=e=>e.__isSuspense;function cy(e,t){t&&t.pendingBranch?lt(e)?t.effects.push(...e):t.effects.push(e):sp(e)}const Te=Symbol.for("v-fgt"),dc=Symbol.for("v-txt"),Bn=Symbol.for("v-cmt"),$l=Symbol.for("v-stc"),Tl=[];let Co=null;function v(e=!1){Tl.push(Co=e?null:[])}function uy(){Tl.pop(),Co=Tl[Tl.length-1]||null}let Nl=1;function Br(e,t=!1){Nl+=e,e<0&&Co&&t&&(Co.hasOnce=!0)}function Vp(e){return e.dynamicChildren=Nl>0?Co||Ri:null,uy(),Nl>0&&Co&&Co.push(e),e}function m(e,t,n,a,s,i){return Vp(r(e,t,n,a,s,i,!0))}function Ze(e,t,n,a,s){return Vp(Me(e,t,n,a,s,!0))}function Fl(e){return e?e.__v_isVNode===!0:!1}function Qa(e,t){return e.type===t.type&&e.key===t.key}const Gp=({key:e})=>e??null,Cr=({ref:e,ref_key:t,ref_for:n})=>(typeof e=="number"&&(e=""+e),e!=null?en(e)||Qt(e)||vt(e)?{i:xn,r:e,k:t,f:!!n}:e:null);function r(e,t=null,n=null,a=0,s=null,i=e===Te?0:1,l=!1,u=!1){const d={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Gp(t),ref:t&&Cr(t),scopeId:lp,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:a,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:xn};return u?(nd(d,n),i&128&&e.normalize(d)):n&&(d.shapeFlag|=en(n)?8:16),Nl>0&&!l&&Co&&(d.patchFlag>0||i&6)&&d.patchFlag!==32&&Co.push(d),d}const Me=dy;function dy(e,t=null,n=null,a=0,s=null,i=!1){if((!e||e===Sp)&&(e=Bn),Fl(e)){const u=Ta(e,t,!0);return n&&nd(u,n),Nl>0&&!i&&Co&&(u.shapeFlag&6?Co[Co.indexOf(e)]=u:Co.push(u)),u.patchFlag=-2,u}if(_y(e)&&(e=e.__vccOpts),t){t=hy(t);let{class:u,style:d}=t;u&&!en(u)&&(t.class=pe(u)),zt(d)&&(ic(d)&&!lt(d)&&(d=kn({},d)),t.style=Qe(d))}const l=en(e)?1:Hp(e)?128:dp(e)?64:zt(e)?4:vt(e)?2:0;return r(e,t,n,a,s,l,i,!0)}function hy(e){return e?ic(e)||Dp(e)?kn({},e):e:null}function Ta(e,t,n=!1,a=!1){const{props:s,ref:i,patchFlag:l,children:u,transition:d}=e,h=t?jp(s||{},t):s,p={__v_isVNode:!0,__v_skip:!0,type:e.type,props:h,key:h&&Gp(h),ref:t&&t.ref?n&&i?lt(i)?i.concat(Cr(t)):[i,Cr(t)]:Cr(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:u,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Te?l===-1?16:l|16:l,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:d,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Ta(e.ssContent),ssFallback:e.ssFallback&&Ta(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return d&&a&&Bl(p,d.clone(p)),p}function Ye(e=" ",t=0){return Me(dc,null,e,t)}function Nr(e,t){const n=Me($l,null,e);return n.staticCount=t,n}function P(e="",t=!1){return t?(v(),Ze(Bn,null,e)):Me(Bn,null,e)}function ys(e){return e==null||typeof e=="boolean"?Me(Bn):lt(e)?Me(Te,null,e.slice()):Fl(e)?_a(e):Me(dc,null,String(e))}function _a(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Ta(e)}function nd(e,t){let n=0;const{shapeFlag:a}=e;if(t==null)t=null;else if(lt(t))n=16;else if(typeof t=="object")if(a&65){const s=t.default;s&&(s._c&&(s._d=!1),nd(e,s()),s._c&&(s._d=!0));return}else{n=32;const s=t._;!s&&!Dp(t)?t._ctx=xn:s===3&&xn&&(xn.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else vt(t)?(t={default:t,_ctx:xn},n=32):(t=String(t),a&64?(n=16,t=[Ye(t)]):n=8);e.children=t,e.shapeFlag|=n}function jp(...e){const t={};for(let n=0;n<e.length;n++){const a=e[n];for(const s in a)if(s==="class")t.class!==a.class&&(t.class=pe([t.class,a.class]));else if(s==="style")t.style=Qe([t.style,a.style]);else if(Qr(s)){const i=t[s],l=a[s];l&&i!==l&&!(lt(i)&&i.includes(l))&&(t[s]=i?[].concat(i,l):l)}else s!==""&&(t[s]=a[s])}return t}function ps(e,t,n,a=null){ss(e,t,7,[n,a])}const fy=Mp();let py=0;function vy(e,t,n){const a=e.type,s=(t?t.appContext:e.appContext)||fy,i={uid:py++,vnode:e,type:a,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Rf(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Rp(a,s),emitsOptions:Ap(a,s),emit:null,emitted:null,propsDefaults:Gt,inheritAttrs:a.inheritAttrs,ctx:Gt,data:Gt,props:Gt,attrs:Gt,slots:Gt,refs:Gt,setupState:Gt,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=t?t.root:i,i.emit=qg.bind(null,i),e.ce&&e.ce(i),i}let Nn=null;const hc=()=>Nn||xn;let Fr,vu;{const e=sc(),t=(n,a)=>{let s;return(s=e[n])||(s=e[n]=[]),s.push(a),i=>{s.length>1?s.forEach(l=>l(i)):s[0](i)}};Fr=t("__VUE_INSTANCE_SETTERS__",n=>Nn=n),vu=t("__VUE_SSR_SETTERS__",n=>Ul=n)}const ql=e=>{const t=Nn;return Fr(e),e.scope.on(),()=>{e.scope.off(),Fr(t)}},eh=()=>{Nn&&Nn.scope.off(),Fr(null)};function Zp(e){return e.vnode.shapeFlag&4}let Ul=!1;function my(e,t=!1,n=!1){t&&vu(t);const{props:a,children:s}=e.vnode,i=Zp(e);Qg(e,a,i,t),oy(e,s,n||t);const l=i?gy(e,t):void 0;return t&&vu(!1),l}function gy(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Ng);const{setup:a}=n;if(a){js();const s=e.setupContext=a.length>1?ky(e):null,i=ql(e),l=Zl(a,e,0,[e.props,s]),u=Tf(l);if(Zs(),i(),(u||e.sp)&&!Fi(e)&&bp(e),u){if(l.then(eh,eh),t)return l.then(d=>{th(e,d)}).catch(d=>{lc(d,e,0)});e.asyncDep=l}else th(e,l)}else qp(e)}function th(e,t,n){vt(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:zt(t)&&(e.setupState=tp(t)),qp(e)}function qp(e,t,n){const a=e.type;e.render||(e.render=a.render||Qo);{const s=ql(e);js();try{Fg(e)}finally{Zs(),s()}}}const yy={get(e,t){return Rn(e,"get",""),e[t]}};function ky(e){const t=n=>{e.exposed=n||{}};return{attrs:new Proxy(e.attrs,yy),slots:e.slots,emit:e.emit,expose:t}}function fc(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(tp(Ku(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in xl)return xl[n](e)},has(t,n){return n in t||n in xl}})):e.proxy}function by(e,t=!0){return vt(e)?e.displayName||e.name:e.name||t&&e.__name}function _y(e){return vt(e)&&"__vccOpts"in e}const z=(e,t)=>vg(e,t,Ul);function od(e,t,n){try{Br(-1);const a=arguments.length;return a===2?zt(t)&&!lt(t)?Fl(t)?Me(e,null,[t]):Me(e,t):Me(e,null,t):(a>3?n=Array.prototype.slice.call(arguments,2):a===3&&Fl(n)&&(n=[n]),Me(e,t,n))}finally{Br(1)}}const wy="3.5.26";let mu;const nh=typeof window<"u"&&window.trustedTypes;if(nh)try{mu=nh.createPolicy("vue",{createHTML:e=>e})}catch{}const Wp=mu?e=>mu.createHTML(e):e=>e,Cy="http://www.w3.org/2000/svg",Ly="http://www.w3.org/1998/Math/MathML",Os=typeof document<"u"?document:null,oh=Os&&Os.createElement("template"),Sy={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,a)=>{const s=t==="svg"?Os.createElementNS(Cy,e):t==="mathml"?Os.createElementNS(Ly,e):n?Os.createElement(e,{is:n}):Os.createElement(e);return e==="select"&&a&&a.multiple!=null&&s.setAttribute("multiple",a.multiple),s},createText:e=>Os.createTextNode(e),createComment:e=>Os.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Os.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,a,s,i){const l=n?n.previousSibling:t.lastChild;if(s&&(s===i||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),n),!(s===i||!(s=s.nextSibling)););else{oh.innerHTML=Wp(a==="svg"?`<svg>${e}</svg>`:a==="mathml"?`<math>${e}</math>`:e);const u=oh.content;if(a==="svg"||a==="mathml"){const d=u.firstChild;for(;d.firstChild;)u.appendChild(d.firstChild);u.removeChild(d)}t.insertBefore(u,n)}return[l?l.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},va="transition",fl="animation",zl=Symbol("_vtc"),Kp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Iy=kn({},pp,Kp),xy=e=>(e.displayName="Transition",e.props=Iy,e),ts=xy((e,{slots:t})=>od(xg,$y(e),t)),Ka=(e,t=[])=>{lt(e)?e.forEach(n=>n(...t)):e&&e(...t)},sh=e=>e?lt(e)?e.some(t=>t.length>1):e.length>1:!1;function $y(e){const t={};for(const G in e)G in Kp||(t[G]=e[G]);if(e.css===!1)return t;const{name:n="v",type:a,duration:s,enterFromClass:i=`${n}-enter-from`,enterActiveClass:l=`${n}-enter-active`,enterToClass:u=`${n}-enter-to`,appearFromClass:d=i,appearActiveClass:h=l,appearToClass:p=u,leaveFromClass:g=`${n}-leave-from`,leaveActiveClass:y=`${n}-leave-active`,leaveToClass:b=`${n}-leave-to`}=e,C=Ty(s),I=C&&C[0],M=C&&C[1],{onBeforeEnter:x,onEnter:S,onEnterCancelled:_,onLeave:D,onLeaveCancelled:E,onBeforeAppear:Z=x,onAppear:A=S,onAppearCancelled:N=_}=t,B=(G,ee,ne,Ae)=>{G._enterCancelled=Ae,Ja(G,ee?p:u),Ja(G,ee?h:l),ne&&ne()},j=(G,ee)=>{G._isLeaving=!1,Ja(G,g),Ja(G,b),Ja(G,y),ee&&ee()},R=G=>(ee,ne)=>{const Ae=G?A:S,J=()=>B(ee,G,ne);Ka(Ae,[ee,J]),ah(()=>{Ja(ee,G?d:i),Ps(ee,G?p:u),sh(Ae)||ih(ee,a,I,J)})};return kn(t,{onBeforeEnter(G){Ka(x,[G]),Ps(G,i),Ps(G,l)},onBeforeAppear(G){Ka(Z,[G]),Ps(G,d),Ps(G,h)},onEnter:R(!1),onAppear:R(!0),onLeave(G,ee){G._isLeaving=!0;const ne=()=>j(G,ee);Ps(G,g),G._enterCancelled?(Ps(G,y),ch(G)):(ch(G),Ps(G,y)),ah(()=>{G._isLeaving&&(Ja(G,g),Ps(G,b),sh(D)||ih(G,a,M,ne))}),Ka(D,[G,ne])},onEnterCancelled(G){B(G,!1,void 0,!0),Ka(_,[G])},onAppearCancelled(G){B(G,!0,void 0,!0),Ka(N,[G])},onLeaveCancelled(G){j(G),Ka(E,[G])}})}function Ty(e){if(e==null)return null;if(zt(e))return[Vc(e.enter),Vc(e.leave)];{const t=Vc(e);return[t,t]}}function Vc(e){return Pm(e)}function Ps(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e[zl]||(e[zl]=new Set)).add(t)}function Ja(e,t){t.split(/\s+/).forEach(a=>a&&e.classList.remove(a));const n=e[zl];n&&(n.delete(t),n.size||(e[zl]=void 0))}function ah(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let My=0;function ih(e,t,n,a){const s=e._endId=++My,i=()=>{s===e._endId&&a()};if(n!=null)return setTimeout(i,n);const{type:l,timeout:u,propCount:d}=Ay(e,t);if(!l)return a();const h=l+"end";let p=0;const g=()=>{e.removeEventListener(h,y),i()},y=b=>{b.target===e&&++p>=d&&g()};setTimeout(()=>{p<d&&g()},u+1),e.addEventListener(h,y)}function Ay(e,t){const n=window.getComputedStyle(e),a=C=>(n[C]||"").split(", "),s=a(`${va}Delay`),i=a(`${va}Duration`),l=lh(s,i),u=a(`${fl}Delay`),d=a(`${fl}Duration`),h=lh(u,d);let p=null,g=0,y=0;t===va?l>0&&(p=va,g=l,y=i.length):t===fl?h>0&&(p=fl,g=h,y=d.length):(g=Math.max(l,h),p=g>0?l>h?va:fl:null,y=p?p===va?i.length:d.length:0);const b=p===va&&/\b(?:transform|all)(?:,|$)/.test(a(`${va}Property`).toString());return{type:p,timeout:g,propCount:y,hasTransform:b}}function lh(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((n,a)=>rh(n)+rh(e[a])))}function rh(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function ch(e){return(e?e.ownerDocument:document).body.offsetHeight}function Ey(e,t,n){const a=e[zl];a&&(t=(t?[t,...a]:[...a]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}const Ur=Symbol("_vod"),Jp=Symbol("_vsh"),ws={name:"show",beforeMount(e,{value:t},{transition:n}){e[Ur]=e.style.display==="none"?"":e.style.display,n&&t?n.beforeEnter(e):pl(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:a}){!t!=!n&&(a?t?(a.beforeEnter(e),pl(e,!0),a.enter(e)):a.leave(e,()=>{pl(e,!1)}):pl(e,t))},beforeUnmount(e,{value:t}){pl(e,t)}};function pl(e,t){e.style.display=t?e[Ur]:"none",e[Jp]=!t}const Yp=Symbol("");function Py(e){const t=hc();if(!t)return;const n=t.ut=(s=e(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(i=>zr(i,s))},a=()=>{const s=e(t.proxy);t.ce?zr(t.ce,s):gu(t.subTree,s),n(s)};wp(()=>{sp(a)}),tn(()=>{qe(a,Qo,{flush:"post"});const s=new MutationObserver(a);s.observe(t.subTree.el.parentNode,{childList:!0}),bn(()=>s.disconnect())})}function gu(e,t){if(e.shapeFlag&128){const n=e.suspense;e=n.activeBranch,n.pendingBranch&&!n.isHydrating&&n.effects.push(()=>{gu(n.activeBranch,t)})}for(;e.component;)e=e.component.subTree;if(e.shapeFlag&1&&e.el)zr(e.el,t);else if(e.type===Te)e.children.forEach(n=>gu(n,t));else if(e.type===$l){let{el:n,anchor:a}=e;for(;n&&(zr(n,t),n!==a);)n=n.nextSibling}}function zr(e,t){if(e.nodeType===1){const n=e.style;let a="";for(const s in t){const i=zm(t[s]);n.setProperty(`--${s}`,i),a+=`--${s}: ${i};`}n[Yp]=a}}const Dy=/(?:^|;)\s*display\s*:/;function Oy(e,t,n){const a=e.style,s=en(n);let i=!1;if(n&&!s){if(t)if(en(t))for(const l of t.split(";")){const u=l.slice(0,l.indexOf(":")).trim();n[u]==null&&Lr(a,u,"")}else for(const l in t)n[l]==null&&Lr(a,l,"");for(const l in n)l==="display"&&(i=!0),Lr(a,l,n[l])}else if(s){if(t!==n){const l=a[Yp];l&&(n+=";"+l),a.cssText=n,i=Dy.test(n)}}else t&&e.removeAttribute("style");Ur in e&&(e[Ur]=i?a.display:"",e[Jp]&&(a.display="none"))}const uh=/\s*!important$/;function Lr(e,t,n){if(lt(n))n.forEach(a=>Lr(e,t,a));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const a=Ry(e,t);uh.test(n)?e.setProperty(Ea(a),n.replace(uh,""),"important"):e[a]=n}}const dh=["Webkit","Moz","ms"],Gc={};function Ry(e,t){const n=Gc[t];if(n)return n;let a=Bo(t);if(a!=="filter"&&a in e)return Gc[t]=a;a=nc(a);for(let s=0;s<dh.length;s++){const i=dh[s]+a;if(i in e)return Gc[t]=i}return t}const hh="http://www.w3.org/1999/xlink";function fh(e,t,n,a,s,i=Fm(t)){a&&t.startsWith("xlink:")?n==null?e.removeAttributeNS(hh,t.slice(6,t.length)):e.setAttributeNS(hh,t,n):n==null||i&&!Pf(n)?e.removeAttribute(t):e.setAttribute(t,i?"":ns(n)?String(n):n)}function ph(e,t,n,a,s){if(t==="innerHTML"||t==="textContent"){n!=null&&(e[t]=t==="innerHTML"?Wp(n):n);return}const i=e.tagName;if(t==="value"&&i!=="PROGRESS"&&!i.includes("-")){const u=i==="OPTION"?e.getAttribute("value")||"":e.value,d=n==null?e.type==="checkbox"?"on":"":String(n);(u!==d||!("_value"in e))&&(e.value=d),n==null&&e.removeAttribute(t),e._value=n;return}let l=!1;if(n===""||n==null){const u=typeof e[t];u==="boolean"?n=Pf(n):n==null&&u==="string"?(n="",l=!0):u==="number"&&(n=0,l=!0)}try{e[t]=n}catch{}l&&e.removeAttribute(s||t)}function Fs(e,t,n,a){e.addEventListener(t,n,a)}function By(e,t,n,a){e.removeEventListener(t,n,a)}const vh=Symbol("_vei");function Ny(e,t,n,a,s=null){const i=e[vh]||(e[vh]={}),l=i[t];if(a&&l)l.value=a;else{const[u,d]=Fy(t);if(a){const h=i[t]=Hy(a,s);Fs(e,u,h,d)}else l&&(By(e,u,l,d),i[t]=void 0)}}const mh=/(?:Once|Passive|Capture)$/;function Fy(e){let t;if(mh.test(e)){t={};let a;for(;a=e.match(mh);)e=e.slice(0,e.length-a[0].length),t[a[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Ea(e.slice(2)),t]}let jc=0;const Uy=Promise.resolve(),zy=()=>jc||(Uy.then(()=>jc=0),jc=Date.now());function Hy(e,t){const n=a=>{if(!a._vts)a._vts=Date.now();else if(a._vts<=n.attached)return;ss(Vy(a,n.value),t,5,[a])};return n.value=e,n.attached=zy(),n}function Vy(e,t){if(lt(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(a=>s=>!s._stopped&&a&&a(s))}else return t}const gh=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,Gy=(e,t,n,a,s,i)=>{const l=s==="svg";t==="class"?Ey(e,a,l):t==="style"?Oy(e,n,a):Qr(t)?Uu(t)||Ny(e,t,n,a,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):jy(e,t,a,l))?(ph(e,t,a),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&fh(e,t,a,l,i,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!en(a))?ph(e,Bo(t),a,i,t):(t==="true-value"?e._trueValue=a:t==="false-value"&&(e._falseValue=a),fh(e,t,a,l))};function jy(e,t,n,a){if(a)return!!(t==="innerHTML"||t==="textContent"||t in e&&gh(t)&&vt(n));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&e.tagName==="IFRAME"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const s=e.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return gh(t)&&en(n)?!1:t in e}const Ma=e=>{const t=e.props["onUpdate:modelValue"]||!1;return lt(t)?n=>_r(t,n):t};function Zy(e){e.target.composing=!0}function yh(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Ro=Symbol("_assign");function kh(e,t,n){return t&&(e=e.trim()),n&&(e=oc(e)),e}const nt={created(e,{modifiers:{lazy:t,trim:n,number:a}},s){e[Ro]=Ma(s);const i=a||s.props&&s.props.type==="number";Fs(e,t?"change":"input",l=>{l.target.composing||e[Ro](kh(e.value,n,i))}),(n||i)&&Fs(e,"change",()=>{e.value=kh(e.value,n,i)}),t||(Fs(e,"compositionstart",Zy),Fs(e,"compositionend",yh),Fs(e,"change",yh))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:n,modifiers:{lazy:a,trim:s,number:i}},l){if(e[Ro]=Ma(l),e.composing)return;const u=(i||e.type==="number")&&!/^0\d/.test(e.value)?oc(e.value):e.value,d=t??"";u!==d&&(document.activeElement===e&&e.type!=="range"&&(a&&t===n||s&&e.value.trim()===d)||(e.value=d))}},Ws={deep:!0,created(e,t,n){e[Ro]=Ma(n),Fs(e,"change",()=>{const a=e._modelValue,s=Hi(e),i=e.checked,l=e[Ro];if(lt(a)){const u=Hu(a,s),d=u!==-1;if(i&&!d)l(a.concat(s));else if(!i&&d){const h=[...a];h.splice(u,1),l(h)}}else if(Zi(a)){const u=new Set(a);i?u.add(s):u.delete(s),l(u)}else l(Xp(e,i))})},mounted:bh,beforeUpdate(e,t,n){e[Ro]=Ma(n),bh(e,t,n)}};function bh(e,{value:t,oldValue:n},a){e._modelValue=t;let s;if(lt(t))s=Hu(t,a.props.value)>-1;else if(Zi(t))s=t.has(a.props.value);else{if(t===n)return;s=ci(t,Xp(e,!0))}e.checked!==s&&(e.checked=s)}const _h={created(e,{value:t},n){e.checked=ci(t,n.props.value),e[Ro]=Ma(n),Fs(e,"change",()=>{e[Ro](Hi(e))})},beforeUpdate(e,{value:t,oldValue:n},a){e[Ro]=Ma(a),t!==n&&(e.checked=ci(t,a.props.value))}},Fn={deep:!0,created(e,{value:t,modifiers:{number:n}},a){const s=Zi(t);Fs(e,"change",()=>{const i=Array.prototype.filter.call(e.options,l=>l.selected).map(l=>n?oc(Hi(l)):Hi(l));e[Ro](e.multiple?s?new Set(i):i:i[0]),e._assigning=!0,an(()=>{e._assigning=!1})}),e[Ro]=Ma(a)},mounted(e,{value:t}){wh(e,t)},beforeUpdate(e,t,n){e[Ro]=Ma(n)},updated(e,{value:t}){e._assigning||wh(e,t)}};function wh(e,t){const n=e.multiple,a=lt(t);if(!(n&&!a&&!Zi(t))){for(let s=0,i=e.options.length;s<i;s++){const l=e.options[s],u=Hi(l);if(n)if(a){const d=typeof u;d==="string"||d==="number"?l.selected=t.some(h=>String(h)===String(u)):l.selected=Hu(t,u)>-1}else l.selected=t.has(u);else if(ci(Hi(l),t)){e.selectedIndex!==s&&(e.selectedIndex=s);return}}!n&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function Hi(e){return"_value"in e?e._value:e.value}function Xp(e,t){const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t}const qy=["ctrl","shift","alt","meta"],Wy={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>qy.some(n=>e[`${n}Key`]&&!t.includes(n))},it=(e,t)=>{const n=e._withMods||(e._withMods={}),a=t.join(".");return n[a]||(n[a]=((s,...i)=>{for(let l=0;l<t.length;l++){const u=Wy[t[l]];if(u&&u(s,t))return}return e(s,...i)}))},Ky={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Yo=(e,t)=>{const n=e._withKeys||(e._withKeys={}),a=t.join(".");return n[a]||(n[a]=(s=>{if(!("key"in s))return;const i=Ea(s.key);if(t.some(l=>l===i||Ky[l]===i))return e(s)}))},Jy=kn({patchProp:Gy},Sy);let Ch;function Yy(){return Ch||(Ch=ay(Jy))}const Xy=((...e)=>{const t=Yy().createApp(...e),{mount:n}=t;return t.mount=a=>{const s=e1(a);if(!s)return;const i=t._component;!vt(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const l=n(s,!1,Qy(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),l},t});function Qy(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function e1(e){return en(e)?document.querySelector(e):e}let Qp;const pc=e=>Qp=e,ev=Symbol();function yu(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var Ml;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(Ml||(Ml={}));function t1(){const e=Bf(!0),t=e.run(()=>T({}));let n=[],a=[];const s=Ku({install(i){pc(s),s._a=i,i.provide(ev,s),i.config.globalProperties.$pinia=s,a.forEach(l=>n.push(l)),a=[]},use(i){return this._a?n.push(i):a.push(i),this},_p:n,_a:null,_e:e,_s:new Map,state:t});return s}const tv=()=>{};function Lh(e,t,n,a=tv){e.add(t);const s=()=>{e.delete(t)&&a()};return!n&&Nf()&&Hm(s),s}function Mi(e,...t){e.forEach(n=>{n(...t)})}const n1=e=>e(),Sh=Symbol(),Zc=Symbol();function ku(e,t){e instanceof Map&&t instanceof Map?t.forEach((n,a)=>e.set(a,n)):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const n in t){if(!t.hasOwnProperty(n))continue;const a=t[n],s=e[n];yu(s)&&yu(a)&&e.hasOwnProperty(n)&&!Qt(a)&&!Gs(a)?e[n]=ku(s,a):e[n]=a}return e}const o1=Symbol();function s1(e){return!yu(e)||!Object.prototype.hasOwnProperty.call(e,o1)}const{assign:ga}=Object;function a1(e){return!!(Qt(e)&&e.effect)}function i1(e,t,n,a){const{state:s,actions:i,getters:l}=t,u=n.state.value[e];let d;function h(){u||(n.state.value[e]=s?s():{});const p=dg(n.state.value[e]);return ga(p,i,Object.keys(l||{}).reduce((g,y)=>(g[y]=Ku(z(()=>{pc(n);const b=n._s.get(e);return l[y].call(b,b)})),g),{}))}return d=nv(e,h,t,n,a,!0),d}function nv(e,t,n={},a,s,i){let l;const u=ga({actions:{}},n),d={deep:!0};let h,p,g=new Set,y=new Set,b;const C=a.state.value[e];!i&&!C&&(a.state.value[e]={}),T({});let I;function M(N){let B;h=p=!1,typeof N=="function"?(N(a.state.value[e]),B={type:Ml.patchFunction,storeId:e,events:b}):(ku(a.state.value[e],N),B={type:Ml.patchObject,payload:N,storeId:e,events:b});const j=I=Symbol();an().then(()=>{I===j&&(h=!0)}),p=!0,Mi(g,B,a.state.value[e])}const x=i?function(){const{state:B}=n,j=B?B():{};this.$patch(R=>{ga(R,j)})}:tv;function S(){l.stop(),g.clear(),y.clear(),a._s.delete(e)}const _=(N,B="")=>{if(Sh in N)return N[Zc]=B,N;const j=function(){pc(a);const R=Array.from(arguments),G=new Set,ee=new Set;function ne(te){G.add(te)}function Ae(te){ee.add(te)}Mi(y,{args:R,name:j[Zc],store:E,after:ne,onError:Ae});let J;try{J=N.apply(this&&this.$id===e?this:E,R)}catch(te){throw Mi(ee,te),te}return J instanceof Promise?J.then(te=>(Mi(G,te),te)).catch(te=>(Mi(ee,te),Promise.reject(te))):(Mi(G,J),J)};return j[Sh]=!0,j[Zc]=B,j},D={_p:a,$id:e,$onAction:Lh.bind(null,y),$patch:M,$reset:x,$subscribe(N,B={}){const j=Lh(g,N,B.detached,()=>R()),R=l.run(()=>qe(()=>a.state.value[e],G=>{(B.flush==="sync"?p:h)&&N({storeId:e,type:Ml.direct,events:b},G)},ga({},d,B)));return j},$dispose:S},E=di(D);a._s.set(e,E);const A=(a._a&&a._a.runWithContext||n1)(()=>a._e.run(()=>(l=Bf()).run(()=>t({action:_}))));for(const N in A){const B=A[N];if(Qt(B)&&!a1(B)||Gs(B))i||(C&&s1(B)&&(Qt(B)?B.value=C[N]:ku(B,C[N])),a.state.value[e][N]=B);else if(typeof B=="function"){const j=_(B,N);A[N]=j,u.actions[N]=B}}return ga(E,A),ga(At(E),A),Object.defineProperty(E,"$state",{get:()=>a.state.value[e],set:N=>{M(B=>{ga(B,N)})}}),a._p.forEach(N=>{ga(E,l.run(()=>N({store:E,app:a._a,pinia:a,options:u})))}),C&&i&&n.hydrate&&n.hydrate(E.$state,C),h=!0,p=!0,E}function sd(e,t,n){let a;const s=typeof t=="function";a=s?n:t;function i(l,u){const d=bg();return l=l||(d?co(ev,null):null),l&&pc(l),l=Qp,l._s.has(e)||(s?nv(e,t,a,l):i1(e,a,l)),l._s.get(e)}return i.$id=e,i}const Ei=typeof document<"u";function ov(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function l1(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&ov(e.default)}const Dt=Object.assign;function qc(e,t){const n={};for(const a in t){const s=t[a];n[a]=as(s)?s.map(e):e(s)}return n}const Al=()=>{},as=Array.isArray;function Ih(e,t){const n={};for(const a in e)n[a]=a in t?t[a]:e[a];return n}const sv=/#/g,r1=/&/g,c1=/\//g,u1=/=/g,d1=/\?/g,av=/\+/g,h1=/%5B/g,f1=/%5D/g,iv=/%5E/g,p1=/%60/g,lv=/%7B/g,v1=/%7C/g,rv=/%7D/g,m1=/%20/g;function ad(e){return e==null?"":encodeURI(""+e).replace(v1,"|").replace(h1,"[").replace(f1,"]")}function g1(e){return ad(e).replace(lv,"{").replace(rv,"}").replace(iv,"^")}function bu(e){return ad(e).replace(av,"%2B").replace(m1,"+").replace(sv,"%23").replace(r1,"%26").replace(p1,"`").replace(lv,"{").replace(rv,"}").replace(iv,"^")}function y1(e){return bu(e).replace(u1,"%3D")}function k1(e){return ad(e).replace(sv,"%23").replace(d1,"%3F")}function b1(e){return k1(e).replace(c1,"%2F")}function Hl(e){if(e==null)return null;try{return decodeURIComponent(""+e)}catch{}return""+e}const _1=/\/$/,w1=e=>e.replace(_1,"");function Wc(e,t,n="/"){let a,s={},i="",l="";const u=t.indexOf("#");let d=t.indexOf("?");return d=u>=0&&d>u?-1:d,d>=0&&(a=t.slice(0,d),i=t.slice(d,u>0?u:t.length),s=e(i.slice(1))),u>=0&&(a=a||t.slice(0,u),l=t.slice(u,t.length)),a=I1(a??t,n),{fullPath:a+i+l,path:a,query:s,hash:Hl(l)}}function C1(e,t){const n=t.query?e(t.query):"";return t.path+(n&&"?")+n+(t.hash||"")}function xh(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function L1(e,t,n){const a=t.matched.length-1,s=n.matched.length-1;return a>-1&&a===s&&Vi(t.matched[a],n.matched[s])&&cv(t.params,n.params)&&e(t.query)===e(n.query)&&t.hash===n.hash}function Vi(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function cv(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in e)if(!S1(e[n],t[n]))return!1;return!0}function S1(e,t){return as(e)?$h(e,t):as(t)?$h(t,e):e?.valueOf()===t?.valueOf()}function $h(e,t){return as(t)?e.length===t.length&&e.every((n,a)=>n===t[a]):e.length===1&&e[0]===t}function I1(e,t){if(e.startsWith("/"))return e;if(!e)return t;const n=t.split("/"),a=e.split("/"),s=a[a.length-1];(s===".."||s===".")&&a.push("");let i=n.length-1,l,u;for(l=0;l<a.length;l++)if(u=a[l],u!==".")if(u==="..")i>1&&i--;else break;return n.slice(0,i).join("/")+"/"+a.slice(l).join("/")}const ma={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let _u=(function(e){return e.pop="pop",e.push="push",e})({}),Kc=(function(e){return e.back="back",e.forward="forward",e.unknown="",e})({});function x1(e){if(!e)if(Ei){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),w1(e)}const $1=/^[^#]+#/;function T1(e,t){return e.replace($1,"#")+t}function M1(e,t){const n=document.documentElement.getBoundingClientRect(),a=e.getBoundingClientRect();return{behavior:t.behavior,left:a.left-n.left-(t.left||0),top:a.top-n.top-(t.top||0)}}const vc=()=>({left:window.scrollX,top:window.scrollY});function A1(e){let t;if("el"in e){const n=e.el,a=typeof n=="string"&&n.startsWith("#"),s=typeof n=="string"?a?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!s)return;t=M1(s,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function Th(e,t){return(history.state?history.state.position-t:-1)+e}const wu=new Map;function E1(e,t){wu.set(e,t)}function P1(e){const t=wu.get(e);return wu.delete(e),t}function D1(e){return typeof e=="string"||e&&typeof e=="object"}function uv(e){return typeof e=="string"||typeof e=="symbol"}let nn=(function(e){return e[e.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",e[e.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",e[e.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",e[e.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",e[e.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",e})({});const dv=Symbol("");nn.MATCHER_NOT_FOUND+"",nn.NAVIGATION_GUARD_REDIRECT+"",nn.NAVIGATION_ABORTED+"",nn.NAVIGATION_CANCELLED+"",nn.NAVIGATION_DUPLICATED+"";function Gi(e,t){return Dt(new Error,{type:e,[dv]:!0},t)}function Ds(e,t){return e instanceof Error&&dv in e&&(t==null||!!(e.type&t))}const O1=["params","query","hash"];function R1(e){if(typeof e=="string")return e;if(e.path!=null)return e.path;const t={};for(const n of O1)n in e&&(t[n]=e[n]);return JSON.stringify(t,null,2)}function B1(e){const t={};if(e===""||e==="?")return t;const n=(e[0]==="?"?e.slice(1):e).split("&");for(let a=0;a<n.length;++a){const s=n[a].replace(av," "),i=s.indexOf("="),l=Hl(i<0?s:s.slice(0,i)),u=i<0?null:Hl(s.slice(i+1));if(l in t){let d=t[l];as(d)||(d=t[l]=[d]),d.push(u)}else t[l]=u}return t}function Mh(e){let t="";for(let n in e){const a=e[n];if(n=y1(n),a==null){a!==void 0&&(t+=(t.length?"&":"")+n);continue}(as(a)?a.map(s=>s&&bu(s)):[a&&bu(a)]).forEach(s=>{s!==void 0&&(t+=(t.length?"&":"")+n,s!=null&&(t+="="+s))})}return t}function N1(e){const t={};for(const n in e){const a=e[n];a!==void 0&&(t[n]=as(a)?a.map(s=>s==null?null:""+s):a==null?a:""+a)}return t}const F1=Symbol(""),Ah=Symbol(""),mc=Symbol(""),id=Symbol(""),Cu=Symbol("");function vl(){let e=[];function t(a){return e.push(a),()=>{const s=e.indexOf(a);s>-1&&e.splice(s,1)}}function n(){e=[]}return{add:t,list:()=>e.slice(),reset:n}}function wa(e,t,n,a,s,i=l=>l()){const l=a&&(a.enterCallbacks[s]=a.enterCallbacks[s]||[]);return()=>new Promise((u,d)=>{const h=y=>{y===!1?d(Gi(nn.NAVIGATION_ABORTED,{from:n,to:t})):y instanceof Error?d(y):D1(y)?d(Gi(nn.NAVIGATION_GUARD_REDIRECT,{from:t,to:y})):(l&&a.enterCallbacks[s]===l&&typeof y=="function"&&l.push(y),u())},p=i(()=>e.call(a&&a.instances[s],t,n,h));let g=Promise.resolve(p);e.length<3&&(g=g.then(h)),g.catch(y=>d(y))})}function Jc(e,t,n,a,s=i=>i()){const i=[];for(const l of e)for(const u in l.components){let d=l.components[u];if(!(t!=="beforeRouteEnter"&&!l.instances[u]))if(ov(d)){const h=(d.__vccOpts||d)[t];h&&i.push(wa(h,n,a,l,u,s))}else{let h=d();i.push(()=>h.then(p=>{if(!p)throw new Error(`Couldn't resolve component "${u}" at "${l.path}"`);const g=l1(p)?p.default:p;l.mods[u]=p,l.components[u]=g;const y=(g.__vccOpts||g)[t];return y&&wa(y,n,a,l,u,s)()}))}}return i}function U1(e,t){const n=[],a=[],s=[],i=Math.max(t.matched.length,e.matched.length);for(let l=0;l<i;l++){const u=t.matched[l];u&&(e.matched.find(h=>Vi(h,u))?a.push(u):n.push(u));const d=e.matched[l];d&&(t.matched.find(h=>Vi(h,d))||s.push(d))}return[n,a,s]}let z1=()=>location.protocol+"//"+location.host;function hv(e,t){const{pathname:n,search:a,hash:s}=t,i=e.indexOf("#");if(i>-1){let l=s.includes(e.slice(i))?e.slice(i).length:1,u=s.slice(l);return u[0]!=="/"&&(u="/"+u),xh(u,"")}return xh(n,e)+a+s}function H1(e,t,n,a){let s=[],i=[],l=null;const u=({state:y})=>{const b=hv(e,location),C=n.value,I=t.value;let M=0;if(y){if(n.value=b,t.value=y,l&&l===C){l=null;return}M=I?y.position-I.position:0}else a(b);s.forEach(x=>{x(n.value,C,{delta:M,type:_u.pop,direction:M?M>0?Kc.forward:Kc.back:Kc.unknown})})};function d(){l=n.value}function h(y){s.push(y);const b=()=>{const C=s.indexOf(y);C>-1&&s.splice(C,1)};return i.push(b),b}function p(){if(document.visibilityState==="hidden"){const{history:y}=window;if(!y.state)return;y.replaceState(Dt({},y.state,{scroll:vc()}),"")}}function g(){for(const y of i)y();i=[],window.removeEventListener("popstate",u),window.removeEventListener("pagehide",p),document.removeEventListener("visibilitychange",p)}return window.addEventListener("popstate",u),window.addEventListener("pagehide",p),document.addEventListener("visibilitychange",p),{pauseListeners:d,listen:h,destroy:g}}function Eh(e,t,n,a=!1,s=!1){return{back:e,current:t,forward:n,replaced:a,position:window.history.length,scroll:s?vc():null}}function V1(e){const{history:t,location:n}=window,a={value:hv(e,n)},s={value:t.state};s.value||i(a.value,{back:null,current:a.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function i(d,h,p){const g=e.indexOf("#"),y=g>-1?(n.host&&document.querySelector("base")?e:e.slice(g))+d:z1()+e+d;try{t[p?"replaceState":"pushState"](h,"",y),s.value=h}catch(b){console.error(b),n[p?"replace":"assign"](y)}}function l(d,h){i(d,Dt({},t.state,Eh(s.value.back,d,s.value.forward,!0),h,{position:s.value.position}),!0),a.value=d}function u(d,h){const p=Dt({},s.value,t.state,{forward:d,scroll:vc()});i(p.current,p,!0),i(d,Dt({},Eh(a.value,d,null),{position:p.position+1},h),!1),a.value=d}return{location:a,state:s,push:u,replace:l}}function G1(e){e=x1(e);const t=V1(e),n=H1(e,t.state,t.location,t.replace);function a(i,l=!0){l||n.pauseListeners(),history.go(i)}const s=Dt({location:"",base:e,go:a,createHref:T1.bind(null,e)},t,n);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>t.state.value}),s}function j1(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),G1(e)}let oi=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.Group=2]="Group",e})({});var vn=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.ParamRegExp=2]="ParamRegExp",e[e.ParamRegExpEnd=3]="ParamRegExpEnd",e[e.EscapeNext=4]="EscapeNext",e})(vn||{});const Z1={type:oi.Static,value:""},q1=/[a-zA-Z0-9_]/;function W1(e){if(!e)return[[]];if(e==="/")return[[Z1]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(b){throw new Error(`ERR (${n})/"${h}": ${b}`)}let n=vn.Static,a=n;const s=[];let i;function l(){i&&s.push(i),i=[]}let u=0,d,h="",p="";function g(){h&&(n===vn.Static?i.push({type:oi.Static,value:h}):n===vn.Param||n===vn.ParamRegExp||n===vn.ParamRegExpEnd?(i.length>1&&(d==="*"||d==="+")&&t(`A repeatable param (${h}) must be alone in its segment. eg: '/:ids+.`),i.push({type:oi.Param,value:h,regexp:p,repeatable:d==="*"||d==="+",optional:d==="*"||d==="?"})):t("Invalid state to consume buffer"),h="")}function y(){h+=d}for(;u<e.length;){if(d=e[u++],d==="\\"&&n!==vn.ParamRegExp){a=n,n=vn.EscapeNext;continue}switch(n){case vn.Static:d==="/"?(h&&g(),l()):d===":"?(g(),n=vn.Param):y();break;case vn.EscapeNext:y(),n=a;break;case vn.Param:d==="("?n=vn.ParamRegExp:q1.test(d)?y():(g(),n=vn.Static,d!=="*"&&d!=="?"&&d!=="+"&&u--);break;case vn.ParamRegExp:d===")"?p[p.length-1]=="\\"?p=p.slice(0,-1)+d:n=vn.ParamRegExpEnd:p+=d;break;case vn.ParamRegExpEnd:g(),n=vn.Static,d!=="*"&&d!=="?"&&d!=="+"&&u--,p="";break;default:t("Unknown state");break}}return n===vn.ParamRegExp&&t(`Unfinished custom RegExp for param "${h}"`),g(),l(),s}const Ph="[^/]+?",K1={sensitive:!1,strict:!1,start:!0,end:!0};var Kn=(function(e){return e[e._multiplier=10]="_multiplier",e[e.Root=90]="Root",e[e.Segment=40]="Segment",e[e.SubSegment=30]="SubSegment",e[e.Static=40]="Static",e[e.Dynamic=20]="Dynamic",e[e.BonusCustomRegExp=10]="BonusCustomRegExp",e[e.BonusWildcard=-50]="BonusWildcard",e[e.BonusRepeatable=-20]="BonusRepeatable",e[e.BonusOptional=-8]="BonusOptional",e[e.BonusStrict=.7000000000000001]="BonusStrict",e[e.BonusCaseSensitive=.25]="BonusCaseSensitive",e})(Kn||{});const J1=/[.+*?^${}()[\]/\\]/g;function Y1(e,t){const n=Dt({},K1,t),a=[];let s=n.start?"^":"";const i=[];for(const h of e){const p=h.length?[]:[Kn.Root];n.strict&&!h.length&&(s+="/");for(let g=0;g<h.length;g++){const y=h[g];let b=Kn.Segment+(n.sensitive?Kn.BonusCaseSensitive:0);if(y.type===oi.Static)g||(s+="/"),s+=y.value.replace(J1,"\\$&"),b+=Kn.Static;else if(y.type===oi.Param){const{value:C,repeatable:I,optional:M,regexp:x}=y;i.push({name:C,repeatable:I,optional:M});const S=x||Ph;if(S!==Ph){b+=Kn.BonusCustomRegExp;try{`${S}`}catch(D){throw new Error(`Invalid custom RegExp for param "${C}" (${S}): `+D.message)}}let _=I?`((?:${S})(?:/(?:${S}))*)`:`(${S})`;g||(_=M&&h.length<2?`(?:/${_})`:"/"+_),M&&(_+="?"),s+=_,b+=Kn.Dynamic,M&&(b+=Kn.BonusOptional),I&&(b+=Kn.BonusRepeatable),S===".*"&&(b+=Kn.BonusWildcard)}p.push(b)}a.push(p)}if(n.strict&&n.end){const h=a.length-1;a[h][a[h].length-1]+=Kn.BonusStrict}n.strict||(s+="/?"),n.end?s+="$":n.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const l=new RegExp(s,n.sensitive?"":"i");function u(h){const p=h.match(l),g={};if(!p)return null;for(let y=1;y<p.length;y++){const b=p[y]||"",C=i[y-1];g[C.name]=b&&C.repeatable?b.split("/"):b}return g}function d(h){let p="",g=!1;for(const y of e){(!g||!p.endsWith("/"))&&(p+="/"),g=!1;for(const b of y)if(b.type===oi.Static)p+=b.value;else if(b.type===oi.Param){const{value:C,repeatable:I,optional:M}=b,x=C in h?h[C]:"";if(as(x)&&!I)throw new Error(`Provided param "${C}" is an array but it is not repeatable (* or + modifiers)`);const S=as(x)?x.join("/"):x;if(!S)if(M)y.length<2&&(p.endsWith("/")?p=p.slice(0,-1):g=!0);else throw new Error(`Missing required param "${C}"`);p+=S}}return p||"/"}return{re:l,score:a,keys:i,parse:u,stringify:d}}function X1(e,t){let n=0;for(;n<e.length&&n<t.length;){const a=t[n]-e[n];if(a)return a;n++}return e.length<t.length?e.length===1&&e[0]===Kn.Static+Kn.Segment?-1:1:e.length>t.length?t.length===1&&t[0]===Kn.Static+Kn.Segment?1:-1:0}function fv(e,t){let n=0;const a=e.score,s=t.score;for(;n<a.length&&n<s.length;){const i=X1(a[n],s[n]);if(i)return i;n++}if(Math.abs(s.length-a.length)===1){if(Dh(a))return 1;if(Dh(s))return-1}return s.length-a.length}function Dh(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Q1={strict:!1,end:!0,sensitive:!1};function ek(e,t,n){const a=Y1(W1(e.path),n),s=Dt(a,{record:e,parent:t,children:[],alias:[]});return t&&!s.record.aliasOf==!t.record.aliasOf&&t.children.push(s),s}function tk(e,t){const n=[],a=new Map;t=Ih(Q1,t);function s(g){return a.get(g)}function i(g,y,b){const C=!b,I=Rh(g);I.aliasOf=b&&b.record;const M=Ih(t,g),x=[I];if("alias"in g){const D=typeof g.alias=="string"?[g.alias]:g.alias;for(const E of D)x.push(Rh(Dt({},I,{components:b?b.record.components:I.components,path:E,aliasOf:b?b.record:I})))}let S,_;for(const D of x){const{path:E}=D;if(y&&E[0]!=="/"){const Z=y.record.path,A=Z[Z.length-1]==="/"?"":"/";D.path=y.record.path+(E&&A+E)}if(S=ek(D,y,M),b?b.alias.push(S):(_=_||S,_!==S&&_.alias.push(S),C&&g.name&&!Bh(S)&&l(g.name)),pv(S)&&d(S),I.children){const Z=I.children;for(let A=0;A<Z.length;A++)i(Z[A],S,b&&b.children[A])}b=b||S}return _?()=>{l(_)}:Al}function l(g){if(uv(g)){const y=a.get(g);y&&(a.delete(g),n.splice(n.indexOf(y),1),y.children.forEach(l),y.alias.forEach(l))}else{const y=n.indexOf(g);y>-1&&(n.splice(y,1),g.record.name&&a.delete(g.record.name),g.children.forEach(l),g.alias.forEach(l))}}function u(){return n}function d(g){const y=sk(g,n);n.splice(y,0,g),g.record.name&&!Bh(g)&&a.set(g.record.name,g)}function h(g,y){let b,C={},I,M;if("name"in g&&g.name){if(b=a.get(g.name),!b)throw Gi(nn.MATCHER_NOT_FOUND,{location:g});M=b.record.name,C=Dt(Oh(y.params,b.keys.filter(_=>!_.optional).concat(b.parent?b.parent.keys.filter(_=>_.optional):[]).map(_=>_.name)),g.params&&Oh(g.params,b.keys.map(_=>_.name))),I=b.stringify(C)}else if(g.path!=null)I=g.path,b=n.find(_=>_.re.test(I)),b&&(C=b.parse(I),M=b.record.name);else{if(b=y.name?a.get(y.name):n.find(_=>_.re.test(y.path)),!b)throw Gi(nn.MATCHER_NOT_FOUND,{location:g,currentLocation:y});M=b.record.name,C=Dt({},y.params,g.params),I=b.stringify(C)}const x=[];let S=b;for(;S;)x.unshift(S.record),S=S.parent;return{name:M,path:I,params:C,matched:x,meta:ok(x)}}e.forEach(g=>i(g));function p(){n.length=0,a.clear()}return{addRoute:i,resolve:h,removeRoute:l,clearRoutes:p,getRoutes:u,getRecordMatcher:s}}function Oh(e,t){const n={};for(const a of t)a in e&&(n[a]=e[a]);return n}function Rh(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:nk(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function nk(e){const t={},n=e.props||!1;if("component"in e)t.default=n;else for(const a in e.components)t[a]=typeof n=="object"?n[a]:n;return t}function Bh(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function ok(e){return e.reduce((t,n)=>Dt(t,n.meta),{})}function sk(e,t){let n=0,a=t.length;for(;n!==a;){const i=n+a>>1;fv(e,t[i])<0?a=i:n=i+1}const s=ak(e);return s&&(a=t.lastIndexOf(s,a-1)),a}function ak(e){let t=e;for(;t=t.parent;)if(pv(t)&&fv(e,t)===0)return t}function pv({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Nh(e){const t=co(mc),n=co(id),a=z(()=>{const d=O(e.to);return t.resolve(d)}),s=z(()=>{const{matched:d}=a.value,{length:h}=d,p=d[h-1],g=n.matched;if(!p||!g.length)return-1;const y=g.findIndex(Vi.bind(null,p));if(y>-1)return y;const b=Fh(d[h-2]);return h>1&&Fh(p)===b&&g[g.length-1].path!==b?g.findIndex(Vi.bind(null,d[h-2])):y}),i=z(()=>s.value>-1&&uk(n.params,a.value.params)),l=z(()=>s.value>-1&&s.value===n.matched.length-1&&cv(n.params,a.value.params));function u(d={}){if(ck(d)){const h=t[O(e.replace)?"replace":"push"](O(e.to)).catch(Al);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>h),h}return Promise.resolve()}return{route:a,href:z(()=>a.value.href),isActive:i,isExactActive:l,navigate:u}}function ik(e){return e.length===1?e[0]:e}const lk=kp({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Nh,setup(e,{slots:t}){const n=di(Nh(e)),{options:a}=co(mc),s=z(()=>({[Uh(e.activeClass,a.linkActiveClass,"router-link-active")]:n.isActive,[Uh(e.exactActiveClass,a.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const i=t.default&&ik(t.default(n));return e.custom?i:od("a",{"aria-current":n.isExactActive?e.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:s.value},i)}}}),rk=lk;function ck(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function uk(e,t){for(const n in t){const a=t[n],s=e[n];if(typeof a=="string"){if(a!==s)return!1}else if(!as(s)||s.length!==a.length||a.some((i,l)=>i.valueOf()!==s[l].valueOf()))return!1}return!0}function Fh(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Uh=(e,t,n)=>e??t??n,dk=kp({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:n}){const a=co(Cu),s=z(()=>e.route||a.value),i=co(Ah,0),l=z(()=>{let h=O(i);const{matched:p}=s.value;let g;for(;(g=p[h])&&!g.components;)h++;return h}),u=z(()=>s.value.matched[l.value]);Ll(Ah,z(()=>l.value+1)),Ll(F1,u),Ll(Cu,s);const d=T();return qe(()=>[d.value,u.value,e.name],([h,p,g],[y,b,C])=>{p&&(p.instances[g]=h,b&&b!==p&&h&&h===y&&(p.leaveGuards.size||(p.leaveGuards=b.leaveGuards),p.updateGuards.size||(p.updateGuards=b.updateGuards))),h&&p&&(!b||!Vi(p,b)||!y)&&(p.enterCallbacks[g]||[]).forEach(I=>I(h))},{flush:"post"}),()=>{const h=s.value,p=e.name,g=u.value,y=g&&g.components[p];if(!y)return zh(n.default,{Component:y,route:h});const b=g.props[p],C=b?b===!0?h.params:typeof b=="function"?b(h):b:null,M=od(y,Dt({},C,t,{onVnodeUnmounted:x=>{x.component.isUnmounted&&(g.instances[p]=null)},ref:d}));return zh(n.default,{Component:M,route:h})||M}}});function zh(e,t){if(!e)return null;const n=e(t);return n.length===1?n[0]:n}const hk=dk;function fk(e){const t=tk(e.routes,e),n=e.parseQuery||B1,a=e.stringifyQuery||Mh,s=e.history,i=vl(),l=vl(),u=vl(),d=rg(ma);let h=ma;Ei&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const p=qc.bind(null,Q=>""+Q),g=qc.bind(null,b1),y=qc.bind(null,Hl);function b(Q,ge){let Ce,ve;return uv(Q)?(Ce=t.getRecordMatcher(Q),ve=ge):ve=Q,t.addRoute(ve,Ce)}function C(Q){const ge=t.getRecordMatcher(Q);ge&&t.removeRoute(ge)}function I(){return t.getRoutes().map(Q=>Q.record)}function M(Q){return!!t.getRecordMatcher(Q)}function x(Q,ge){if(ge=Dt({},ge||d.value),typeof Q=="string"){const ae=Wc(n,Q,ge.path),$e=t.resolve({path:ae.path},ge),Be=s.createHref(ae.fullPath);return Dt(ae,$e,{params:y($e.params),hash:Hl(ae.hash),redirectedFrom:void 0,href:Be})}let Ce;if(Q.path!=null)Ce=Dt({},Q,{path:Wc(n,Q.path,ge.path).path});else{const ae=Dt({},Q.params);for(const $e in ae)ae[$e]==null&&delete ae[$e];Ce=Dt({},Q,{params:g(ae)}),ge.params=g(ge.params)}const ve=t.resolve(Ce,ge),ue=Q.hash||"";ve.params=p(y(ve.params));const F=C1(a,Dt({},Q,{hash:g1(ue),path:ve.path})),K=s.createHref(F);return Dt({fullPath:F,hash:ue,query:a===Mh?N1(Q.query):Q.query||{}},ve,{redirectedFrom:void 0,href:K})}function S(Q){return typeof Q=="string"?Wc(n,Q,d.value.path):Dt({},Q)}function _(Q,ge){if(h!==Q)return Gi(nn.NAVIGATION_CANCELLED,{from:ge,to:Q})}function D(Q){return A(Q)}function E(Q){return D(Dt(S(Q),{replace:!0}))}function Z(Q,ge){const Ce=Q.matched[Q.matched.length-1];if(Ce&&Ce.redirect){const{redirect:ve}=Ce;let ue=typeof ve=="function"?ve(Q,ge):ve;return typeof ue=="string"&&(ue=ue.includes("?")||ue.includes("#")?ue=S(ue):{path:ue},ue.params={}),Dt({query:Q.query,hash:Q.hash,params:ue.path!=null?{}:Q.params},ue)}}function A(Q,ge){const Ce=h=x(Q),ve=d.value,ue=Q.state,F=Q.force,K=Q.replace===!0,ae=Z(Ce,ve);if(ae)return A(Dt(S(ae),{state:typeof ae=="object"?Dt({},ue,ae.state):ue,force:F,replace:K}),ge||Ce);const $e=Ce;$e.redirectedFrom=ge;let Be;return!F&&L1(a,ve,Ce)&&(Be=Gi(nn.NAVIGATION_DUPLICATED,{to:$e,from:ve}),ke(ve,ve,!0,!1)),(Be?Promise.resolve(Be):j($e,ve)).catch(Oe=>Ds(Oe)?Ds(Oe,nn.NAVIGATION_GUARD_REDIRECT)?Oe:re(Oe):U(Oe,$e,ve)).then(Oe=>{if(Oe){if(Ds(Oe,nn.NAVIGATION_GUARD_REDIRECT))return A(Dt({replace:K},S(Oe.to),{state:typeof Oe.to=="object"?Dt({},ue,Oe.to.state):ue,force:F}),ge||$e)}else Oe=G($e,ve,!0,K,ue);return R($e,ve,Oe),Oe})}function N(Q,ge){const Ce=_(Q,ge);return Ce?Promise.reject(Ce):Promise.resolve()}function B(Q){const ge=Ne.values().next().value;return ge&&typeof ge.runWithContext=="function"?ge.runWithContext(Q):Q()}function j(Q,ge){let Ce;const[ve,ue,F]=U1(Q,ge);Ce=Jc(ve.reverse(),"beforeRouteLeave",Q,ge);for(const ae of ve)ae.leaveGuards.forEach($e=>{Ce.push(wa($e,Q,ge))});const K=N.bind(null,Q,ge);return Ce.push(K),We(Ce).then(()=>{Ce=[];for(const ae of i.list())Ce.push(wa(ae,Q,ge));return Ce.push(K),We(Ce)}).then(()=>{Ce=Jc(ue,"beforeRouteUpdate",Q,ge);for(const ae of ue)ae.updateGuards.forEach($e=>{Ce.push(wa($e,Q,ge))});return Ce.push(K),We(Ce)}).then(()=>{Ce=[];for(const ae of F)if(ae.beforeEnter)if(as(ae.beforeEnter))for(const $e of ae.beforeEnter)Ce.push(wa($e,Q,ge));else Ce.push(wa(ae.beforeEnter,Q,ge));return Ce.push(K),We(Ce)}).then(()=>(Q.matched.forEach(ae=>ae.enterCallbacks={}),Ce=Jc(F,"beforeRouteEnter",Q,ge,B),Ce.push(K),We(Ce))).then(()=>{Ce=[];for(const ae of l.list())Ce.push(wa(ae,Q,ge));return Ce.push(K),We(Ce)}).catch(ae=>Ds(ae,nn.NAVIGATION_CANCELLED)?ae:Promise.reject(ae))}function R(Q,ge,Ce){u.list().forEach(ve=>B(()=>ve(Q,ge,Ce)))}function G(Q,ge,Ce,ve,ue){const F=_(Q,ge);if(F)return F;const K=ge===ma,ae=Ei?history.state:{};Ce&&(ve||K?s.replace(Q.fullPath,Dt({scroll:K&&ae&&ae.scroll},ue)):s.push(Q.fullPath,ue)),d.value=Q,ke(Q,ge,Ce,K),re()}let ee;function ne(){ee||(ee=s.listen((Q,ge,Ce)=>{if(!Ke.listening)return;const ve=x(Q),ue=Z(ve,Ke.currentRoute.value);if(ue){A(Dt(ue,{replace:!0,force:!0}),ve).catch(Al);return}h=ve;const F=d.value;Ei&&E1(Th(F.fullPath,Ce.delta),vc()),j(ve,F).catch(K=>Ds(K,nn.NAVIGATION_ABORTED|nn.NAVIGATION_CANCELLED)?K:Ds(K,nn.NAVIGATION_GUARD_REDIRECT)?(A(Dt(S(K.to),{force:!0}),ve).then(ae=>{Ds(ae,nn.NAVIGATION_ABORTED|nn.NAVIGATION_DUPLICATED)&&!Ce.delta&&Ce.type===_u.pop&&s.go(-1,!1)}).catch(Al),Promise.reject()):(Ce.delta&&s.go(-Ce.delta,!1),U(K,ve,F))).then(K=>{K=K||G(ve,F,!1),K&&(Ce.delta&&!Ds(K,nn.NAVIGATION_CANCELLED)?s.go(-Ce.delta,!1):Ce.type===_u.pop&&Ds(K,nn.NAVIGATION_ABORTED|nn.NAVIGATION_DUPLICATED)&&s.go(-1,!1)),R(ve,F,K)}).catch(Al)}))}let Ae=vl(),J=vl(),te;function U(Q,ge,Ce){re(Q);const ve=J.list();return ve.length?ve.forEach(ue=>ue(Q,ge,Ce)):console.error(Q),Promise.reject(Q)}function X(){return te&&d.value!==ma?Promise.resolve():new Promise((Q,ge)=>{Ae.add([Q,ge])})}function re(Q){return te||(te=!Q,ne(),Ae.list().forEach(([ge,Ce])=>Q?Ce(Q):ge()),Ae.reset()),Q}function ke(Q,ge,Ce,ve){const{scrollBehavior:ue}=e;if(!Ei||!ue)return Promise.resolve();const F=!Ce&&P1(Th(Q.fullPath,0))||(ve||!Ce)&&history.state&&history.state.scroll||null;return an().then(()=>ue(Q,ge,F)).then(K=>K&&A1(K)).catch(K=>U(K,Q,ge))}const Re=Q=>s.go(Q);let Xe;const Ne=new Set,Ke={currentRoute:d,listening:!0,addRoute:b,removeRoute:C,clearRoutes:t.clearRoutes,hasRoute:M,getRoutes:I,resolve:x,options:e,push:D,replace:E,go:Re,back:()=>Re(-1),forward:()=>Re(1),beforeEach:i.add,beforeResolve:l.add,afterEach:u.add,onError:J.add,isReady:X,install(Q){Q.component("RouterLink",rk),Q.component("RouterView",hk),Q.config.globalProperties.$router=Ke,Object.defineProperty(Q.config.globalProperties,"$route",{enumerable:!0,get:()=>O(d)}),Ei&&!Xe&&d.value===ma&&(Xe=!0,D(s.location).catch(ve=>{}));const ge={};for(const ve in ma)Object.defineProperty(ge,ve,{get:()=>d.value[ve],enumerable:!0});Q.provide(mc,Ke),Q.provide(id,Qf(ge)),Q.provide(Cu,d);const Ce=Q.unmount;Ne.add(Q),Q.unmount=function(){Ne.delete(Q),Ne.size<1&&(h=ma,ee&&ee(),ee=null,d.value=ma,Xe=!1,te=!1),Ce()}}};function We(Q){return Q.reduce((ge,Ce)=>ge.then(()=>B(Ce)),Promise.resolve())}return Ke}function qi(){return co(mc)}function gc(e){return co(id)}const pk=500,vk=3e3,mk=500,ei=T(new Map),ld=T(!1),Hr=T("");let gk=0,El=null;function yk(e){const t=(e||"get").toUpperCase();return["POST","PUT","PATCH","DELETE"].includes(t)?{message:"Saving...",delay:pk}:{message:"Loading...",delay:vk}}function kk(){El&&(clearTimeout(El),El=null)}function bk(e){kk();const t=++gk,{message:n,delay:a}=yk(e.method),s=setTimeout(()=>{ei.value.has(t)&&(Hr.value=n,ld.value=!0)},a);return ei.value.set(t,{config:e,message:n,timeoutId:s}),e._loadingRequestId=t,t}function Hh(e){const t=ei.value.get(e);if(t)if(clearTimeout(t.timeoutId),ei.value.delete(e),ei.value.size===0)El=setTimeout(()=>{ei.value.size===0&&(ld.value=!1,Hr.value=""),El=null},mk);else{const n=ei.value.values().next().value;n&&(Hr.value=n.message)}}function Vh(e){return e?._loadingRequestId}function _k(){return{showOverlay:ld,overlayMessage:Hr}}const Ge=(e,t)=>{const n=e.__vccOpts||e;for(const[a,s]of t)n[a]=s;return n},wk={key:0,class:"loading-overlay"},Ck={class:"loading-content"},Lk={class:"loading-message"},Sk={__name:"LoadingOverlay",setup(e){const{showOverlay:t,overlayMessage:n}=_k();return(a,s)=>(v(),Ze(ts,{name:"fade"},{default:He(()=>[O(t)?(v(),m("div",wk,[r("div",Ck,[s[0]||(s[0]=r("div",{class:"spinner"},null,-1)),r("p",Lk,w(O(n)||"Loading..."),1)])])):P("",!0)]),_:1}))}},Ik=Ge(Sk,[["__scopeId","data-v-fdee3530"]]),xk={__name:"App",setup(e){const t=qi(),n=T(""),a=["/","/sessions"];return qe(()=>t.currentRoute.value,(s,i)=>{if(!i?.path){n.value="";return}const l=a.indexOf(s.path),u=a.indexOf(i.path);l!==-1&&u!==-1?n.value=l>u?"slide-left":"slide-right":n.value=""},{immediate:!0}),(s,i)=>{const l=Yu("router-view");return v(),m(Te,null,[Me(l,null,{default:He(({Component:u,route:d})=>[Me(ts,{name:n.value,mode:"out-in"},{default:He(()=>[(v(),Ze(Bg(u),{key:d.path}))]),_:2},1032,["name"])]),_:1}),Me(Ik)],64)}}},Wi="marshalSessions",$k=30;function Vr(e,t){return`${e}:${t}`}function rd(e){const[t,n]=e.split(":");return{eventId:t,marshalId:n}}function Pa(){try{return JSON.parse(localStorage.getItem(Wi)||"{}")}catch{return{}}}function Gr(e){const t=Pa(),n=Object.entries(t).filter(([a])=>a.startsWith(`${e}:`)).map(([a,s])=>({sessionKey:a,...s}));return n.length===0?null:(n.sort((a,s)=>new Date(s.lastAccessed)-new Date(a.lastAccessed)),n[0])}function Gh(e,t){if(!t.marshalId){console.error("Cannot save session without marshalId");return}const n=Pa(),a=Vr(e,t.marshalId);n[a]={...n[a],...t,eventId:e,lastAccessed:new Date().toISOString()},localStorage.setItem(Wi,JSON.stringify(n))}function Lu(e){const t=Pa(),{eventId:n,marshalId:a}=rd(e);delete t[e],localStorage.setItem(Wi,JSON.stringify(t)),localStorage.removeItem(`marshalCode_${n}_${a}`)}function vv(e,t){const n=Pa(),a=Vr(e,t);n[a]&&(n[a].lastAccessed=new Date().toISOString(),localStorage.setItem(Wi,JSON.stringify(n)))}function mv(){const e=Pa(),t=new Date;t.setDate(t.getDate()-$k);let n=!1;for(const a of Object.keys(e))if(new Date(e[a].lastAccessed)<t){const{eventId:i,marshalId:l}=rd(a);delete e[a],localStorage.removeItem(`marshalCode_${i}_${l}`),n=!0}n&&localStorage.setItem(Wi,JSON.stringify(e))}function gv(){const e=Pa(),t=[];for(let a=0;a<localStorage.length;a++){const s=localStorage.key(a);if(s&&s.startsWith("marshal_")&&!s.startsWith("marshalCode_")&&!s.startsWith("marshalSessions")){const i=s.replace("marshal_",""),l=localStorage.getItem(s);if(l){const u=Vr(i,l);e[u]||(e[u]={marshalId:l,eventId:i,token:null,lastAccessed:new Date().toISOString()})}t.push(s)}}const n=Object.keys(e).filter(a=>!a.includes(":"));for(const a of n){const s=e[a];if(s&&s.marshalId){const i=Vr(a,s.marshalId);e[i]||(e[i]={...s,eventId:a}),delete e[a]}}(t.length>0||n.length>0)&&(localStorage.setItem(Wi,JSON.stringify(e)),t.forEach(a=>localStorage.removeItem(a)))}function Tk(){const e=Pa();return Object.entries(e).map(([t,n])=>{const{eventId:a,marshalId:s}=rd(t);return{sessionKey:t,eventId:a,marshalId:s,...n}}).filter(t=>t.token).sort((t,n)=>t.eventDate&&n.eventDate?new Date(t.eventDate)-new Date(n.eventDate):new Date(n.lastAccessed)-new Date(t.lastAccessed))}function yv(){const e=Pa();return Object.values(e).some(t=>t.token)}function kv(e,t){const n=`marshalCode_${e}_${t}`,a=localStorage.getItem(n);return a||localStorage.getItem(`marshalCode_${e}`)}function Mk(e,t,n){localStorage.setItem(`marshalCode_${e}_${t}`,n)}function bv(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ak}=Object.prototype,{getPrototypeOf:cd}=Object,{iterator:yc,toStringTag:_v}=Symbol,kc=(e=>t=>{const n=Ak.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),is=e=>(e=e.toLowerCase(),t=>kc(t)===e),bc=e=>t=>typeof t===e,{isArray:Ki}=Array,ji=bc("undefined");function Wl(e){return e!==null&&!ji(e)&&e.constructor!==null&&!ji(e.constructor)&&uo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const wv=is("ArrayBuffer");function Ek(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&wv(e.buffer),t}const Pk=bc("string"),uo=bc("function"),Cv=bc("number"),Kl=e=>e!==null&&typeof e=="object",Dk=e=>e===!0||e===!1,Sr=e=>{if(kc(e)!=="object")return!1;const t=cd(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(_v in e)&&!(yc in e)},Ok=e=>{if(!Kl(e)||Wl(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Rk=is("Date"),Bk=is("File"),Nk=is("Blob"),Fk=is("FileList"),Uk=e=>Kl(e)&&uo(e.pipe),zk=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||uo(e.append)&&((t=kc(e))==="formdata"||t==="object"&&uo(e.toString)&&e.toString()==="[object FormData]"))},Hk=is("URLSearchParams"),[Vk,Gk,jk,Zk]=["ReadableStream","Request","Response","Headers"].map(is),qk=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Jl(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let a,s;if(typeof e!="object"&&(e=[e]),Ki(e))for(a=0,s=e.length;a<s;a++)t.call(null,e[a],a,e);else{if(Wl(e))return;const i=n?Object.getOwnPropertyNames(e):Object.keys(e),l=i.length;let u;for(a=0;a<l;a++)u=i[a],t.call(null,e[u],u,e)}}function Lv(e,t){if(Wl(e))return null;t=t.toLowerCase();const n=Object.keys(e);let a=n.length,s;for(;a-- >0;)if(s=n[a],t===s.toLowerCase())return s;return null}const si=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Sv=e=>!ji(e)&&e!==si;function Su(){const{caseless:e,skipUndefined:t}=Sv(this)&&this||{},n={},a=(s,i)=>{const l=e&&Lv(n,i)||i;Sr(n[l])&&Sr(s)?n[l]=Su(n[l],s):Sr(s)?n[l]=Su({},s):Ki(s)?n[l]=s.slice():(!t||!ji(s))&&(n[l]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&Jl(arguments[s],a);return n}const Wk=(e,t,n,{allOwnKeys:a}={})=>(Jl(t,(s,i)=>{n&&uo(s)?e[i]=bv(s,n):e[i]=s},{allOwnKeys:a}),e),Kk=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Jk=(e,t,n,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},Yk=(e,t,n,a)=>{let s,i,l;const u={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)l=s[i],(!a||a(l,e,t))&&!u[l]&&(t[l]=e[l],u[l]=!0);e=n!==!1&&cd(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},Xk=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const a=e.indexOf(t,n);return a!==-1&&a===n},Qk=e=>{if(!e)return null;if(Ki(e))return e;let t=e.length;if(!Cv(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},e0=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&cd(Uint8Array)),t0=(e,t)=>{const a=(e&&e[yc]).call(e);let s;for(;(s=a.next())&&!s.done;){const i=s.value;t.call(e,i[0],i[1])}},n0=(e,t)=>{let n;const a=[];for(;(n=e.exec(t))!==null;)a.push(n);return a},o0=is("HTMLFormElement"),s0=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,a,s){return a.toUpperCase()+s}),jh=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),a0=is("RegExp"),Iv=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),a={};Jl(n,(s,i)=>{let l;(l=t(s,i,e))!==!1&&(a[i]=l||s)}),Object.defineProperties(e,a)},i0=e=>{Iv(e,(t,n)=>{if(uo(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const a=e[n];if(uo(a)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},l0=(e,t)=>{const n={},a=s=>{s.forEach(i=>{n[i]=!0})};return Ki(e)?a(e):a(String(e).split(t)),n},r0=()=>{},c0=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function u0(e){return!!(e&&uo(e.append)&&e[_v]==="FormData"&&e[yc])}const d0=e=>{const t=new Array(10),n=(a,s)=>{if(Kl(a)){if(t.indexOf(a)>=0)return;if(Wl(a))return a;if(!("toJSON"in a)){t[s]=a;const i=Ki(a)?[]:{};return Jl(a,(l,u)=>{const d=n(l,s+1);!ji(d)&&(i[u]=d)}),t[s]=void 0,i}}return a};return n(e,0)},h0=is("AsyncFunction"),f0=e=>e&&(Kl(e)||uo(e))&&uo(e.then)&&uo(e.catch),xv=((e,t)=>e?setImmediate:t?((n,a)=>(si.addEventListener("message",({source:s,data:i})=>{s===si&&i===n&&a.length&&a.shift()()},!1),s=>{a.push(s),si.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",uo(si.postMessage)),p0=typeof queueMicrotask<"u"?queueMicrotask.bind(si):typeof process<"u"&&process.nextTick||xv,v0=e=>e!=null&&uo(e[yc]),Pe={isArray:Ki,isArrayBuffer:wv,isBuffer:Wl,isFormData:zk,isArrayBufferView:Ek,isString:Pk,isNumber:Cv,isBoolean:Dk,isObject:Kl,isPlainObject:Sr,isEmptyObject:Ok,isReadableStream:Vk,isRequest:Gk,isResponse:jk,isHeaders:Zk,isUndefined:ji,isDate:Rk,isFile:Bk,isBlob:Nk,isRegExp:a0,isFunction:uo,isStream:Uk,isURLSearchParams:Hk,isTypedArray:e0,isFileList:Fk,forEach:Jl,merge:Su,extend:Wk,trim:qk,stripBOM:Kk,inherits:Jk,toFlatObject:Yk,kindOf:kc,kindOfTest:is,endsWith:Xk,toArray:Qk,forEachEntry:t0,matchAll:n0,isHTMLForm:o0,hasOwnProperty:jh,hasOwnProp:jh,reduceDescriptors:Iv,freezeMethods:i0,toObjectSet:l0,toCamelCase:s0,noop:r0,toFiniteNumber:c0,findKey:Lv,global:si,isContextDefined:Sv,isSpecCompliantForm:u0,toJSONObject:d0,isAsyncFn:h0,isThenable:f0,setImmediate:xv,asap:p0,isIterable:v0};function gt(e,t,n,a,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),a&&(this.request=a),s&&(this.response=s,this.status=s.status?s.status:null)}Pe.inherits(gt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pe.toJSONObject(this.config),code:this.code,status:this.status}}});const $v=gt.prototype,Tv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Tv[e]={value:e}});Object.defineProperties(gt,Tv);Object.defineProperty($v,"isAxiosError",{value:!0});gt.from=(e,t,n,a,s,i)=>{const l=Object.create($v);Pe.toFlatObject(e,l,function(p){return p!==Error.prototype},h=>h!=="isAxiosError");const u=e&&e.message?e.message:"Error",d=t==null&&e?e.code:t;return gt.call(l,u,d,n,a,s),e&&l.cause==null&&Object.defineProperty(l,"cause",{value:e,configurable:!0}),l.name=e&&e.name||"Error",i&&Object.assign(l,i),l};const m0=null;function Iu(e){return Pe.isPlainObject(e)||Pe.isArray(e)}function Mv(e){return Pe.endsWith(e,"[]")?e.slice(0,-2):e}function Zh(e,t,n){return e?e.concat(t).map(function(s,i){return s=Mv(s),!n&&i?"["+s+"]":s}).join(n?".":""):t}function g0(e){return Pe.isArray(e)&&!e.some(Iu)}const y0=Pe.toFlatObject(Pe,{},null,function(t){return/^is[A-Z]/.test(t)});function _c(e,t,n){if(!Pe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=Pe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,M){return!Pe.isUndefined(M[I])});const a=n.metaTokens,s=n.visitor||p,i=n.dots,l=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&Pe.isSpecCompliantForm(t);if(!Pe.isFunction(s))throw new TypeError("visitor must be a function");function h(C){if(C===null)return"";if(Pe.isDate(C))return C.toISOString();if(Pe.isBoolean(C))return C.toString();if(!d&&Pe.isBlob(C))throw new gt("Blob is not supported. Use a Buffer instead.");return Pe.isArrayBuffer(C)||Pe.isTypedArray(C)?d&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function p(C,I,M){let x=C;if(C&&!M&&typeof C=="object"){if(Pe.endsWith(I,"{}"))I=a?I:I.slice(0,-2),C=JSON.stringify(C);else if(Pe.isArray(C)&&g0(C)||(Pe.isFileList(C)||Pe.endsWith(I,"[]"))&&(x=Pe.toArray(C)))return I=Mv(I),x.forEach(function(_,D){!(Pe.isUndefined(_)||_===null)&&t.append(l===!0?Zh([I],D,i):l===null?I:I+"[]",h(_))}),!1}return Iu(C)?!0:(t.append(Zh(M,I,i),h(C)),!1)}const g=[],y=Object.assign(y0,{defaultVisitor:p,convertValue:h,isVisitable:Iu});function b(C,I){if(!Pe.isUndefined(C)){if(g.indexOf(C)!==-1)throw Error("Circular reference detected in "+I.join("."));g.push(C),Pe.forEach(C,function(x,S){(!(Pe.isUndefined(x)||x===null)&&s.call(t,x,Pe.isString(S)?S.trim():S,I,y))===!0&&b(x,I?I.concat(S):[S])}),g.pop()}}if(!Pe.isObject(e))throw new TypeError("data must be an object");return b(e),t}function qh(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(a){return t[a]})}function ud(e,t){this._pairs=[],e&&_c(e,this,t)}const Av=ud.prototype;Av.append=function(t,n){this._pairs.push([t,n])};Av.toString=function(t){const n=t?function(a){return t.call(this,a,qh)}:qh;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function k0(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ev(e,t,n){if(!t)return e;const a=n&&n.encode||k0;Pe.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let i;if(s?i=s(t,n):i=Pe.isURLSearchParams(t)?t.toString():new ud(t,n).toString(a),i){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class Wh{constructor(){this.handlers=[]}use(t,n,a){return this.handlers.push({fulfilled:t,rejected:n,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Pe.forEach(this.handlers,function(a){a!==null&&t(a)})}}const Pv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},b0=typeof URLSearchParams<"u"?URLSearchParams:ud,_0=typeof FormData<"u"?FormData:null,w0=typeof Blob<"u"?Blob:null,C0={isBrowser:!0,classes:{URLSearchParams:b0,FormData:_0,Blob:w0},protocols:["http","https","file","blob","url","data"]},dd=typeof window<"u"&&typeof document<"u",xu=typeof navigator=="object"&&navigator||void 0,L0=dd&&(!xu||["ReactNative","NativeScript","NS"].indexOf(xu.product)<0),S0=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",I0=dd&&window.location.href||"http://localhost",x0=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dd,hasStandardBrowserEnv:L0,hasStandardBrowserWebWorkerEnv:S0,navigator:xu,origin:I0},Symbol.toStringTag,{value:"Module"})),Un={...x0,...C0};function $0(e,t){return _c(e,new Un.classes.URLSearchParams,{visitor:function(n,a,s,i){return Un.isNode&&Pe.isBuffer(n)?(this.append(a,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function T0(e){return Pe.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function M0(e){const t={},n=Object.keys(e);let a;const s=n.length;let i;for(a=0;a<s;a++)i=n[a],t[i]=e[i];return t}function Dv(e){function t(n,a,s,i){let l=n[i++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),d=i>=n.length;return l=!l&&Pe.isArray(s)?s.length:l,d?(Pe.hasOwnProp(s,l)?s[l]=[s[l],a]:s[l]=a,!u):((!s[l]||!Pe.isObject(s[l]))&&(s[l]=[]),t(n,a,s[l],i)&&Pe.isArray(s[l])&&(s[l]=M0(s[l])),!u)}if(Pe.isFormData(e)&&Pe.isFunction(e.entries)){const n={};return Pe.forEachEntry(e,(a,s)=>{t(T0(a),s,n,0)}),n}return null}function A0(e,t,n){if(Pe.isString(e))try{return(t||JSON.parse)(e),Pe.trim(e)}catch(a){if(a.name!=="SyntaxError")throw a}return(n||JSON.stringify)(e)}const Yl={transitional:Pv,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const a=n.getContentType()||"",s=a.indexOf("application/json")>-1,i=Pe.isObject(t);if(i&&Pe.isHTMLForm(t)&&(t=new FormData(t)),Pe.isFormData(t))return s?JSON.stringify(Dv(t)):t;if(Pe.isArrayBuffer(t)||Pe.isBuffer(t)||Pe.isStream(t)||Pe.isFile(t)||Pe.isBlob(t)||Pe.isReadableStream(t))return t;if(Pe.isArrayBufferView(t))return t.buffer;if(Pe.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return $0(t,this.formSerializer).toString();if((u=Pe.isFileList(t))||a.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return _c(u?{"files[]":t}:t,d&&new d,this.formSerializer)}}return i||s?(n.setContentType("application/json",!1),A0(t)):t}],transformResponse:[function(t){const n=this.transitional||Yl.transitional,a=n&&n.forcedJSONParsing,s=this.responseType==="json";if(Pe.isResponse(t)||Pe.isReadableStream(t))return t;if(t&&Pe.isString(t)&&(a&&!this.responseType||s)){const l=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(u){if(l)throw u.name==="SyntaxError"?gt.from(u,gt.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Un.classes.FormData,Blob:Un.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Pe.forEach(["delete","get","head","post","put","patch"],e=>{Yl.headers[e]={}});const E0=Pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),P0=e=>{const t={};let n,a,s;return e&&e.split(`
`).forEach(function(l){s=l.indexOf(":"),n=l.substring(0,s).trim().toLowerCase(),a=l.substring(s+1).trim(),!(!n||t[n]&&E0[n])&&(n==="set-cookie"?t[n]?t[n].push(a):t[n]=[a]:t[n]=t[n]?t[n]+", "+a:a)}),t},Kh=Symbol("internals");function ml(e){return e&&String(e).trim().toLowerCase()}function Ir(e){return e===!1||e==null?e:Pe.isArray(e)?e.map(Ir):String(e)}function D0(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=n.exec(e);)t[a[1]]=a[2];return t}const O0=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Yc(e,t,n,a,s){if(Pe.isFunction(a))return a.call(this,t,n);if(s&&(t=n),!!Pe.isString(t)){if(Pe.isString(a))return t.indexOf(a)!==-1;if(Pe.isRegExp(a))return a.test(t)}}function R0(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,a)=>n.toUpperCase()+a)}function B0(e,t){const n=Pe.toCamelCase(" "+t);["get","set","has"].forEach(a=>{Object.defineProperty(e,a+n,{value:function(s,i,l){return this[a].call(this,t,s,i,l)},configurable:!0})})}let ho=class{constructor(t){t&&this.set(t)}set(t,n,a){const s=this;function i(u,d,h){const p=ml(d);if(!p)throw new Error("header name must be a non-empty string");const g=Pe.findKey(s,p);(!g||s[g]===void 0||h===!0||h===void 0&&s[g]!==!1)&&(s[g||d]=Ir(u))}const l=(u,d)=>Pe.forEach(u,(h,p)=>i(h,p,d));if(Pe.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(Pe.isString(t)&&(t=t.trim())&&!O0(t))l(P0(t),n);else if(Pe.isObject(t)&&Pe.isIterable(t)){let u={},d,h;for(const p of t){if(!Pe.isArray(p))throw TypeError("Object iterator must return a key-value pair");u[h=p[0]]=(d=u[h])?Pe.isArray(d)?[...d,p[1]]:[d,p[1]]:p[1]}l(u,n)}else t!=null&&i(n,t,a);return this}get(t,n){if(t=ml(t),t){const a=Pe.findKey(this,t);if(a){const s=this[a];if(!n)return s;if(n===!0)return D0(s);if(Pe.isFunction(n))return n.call(this,s,a);if(Pe.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=ml(t),t){const a=Pe.findKey(this,t);return!!(a&&this[a]!==void 0&&(!n||Yc(this,this[a],a,n)))}return!1}delete(t,n){const a=this;let s=!1;function i(l){if(l=ml(l),l){const u=Pe.findKey(a,l);u&&(!n||Yc(a,a[u],u,n))&&(delete a[u],s=!0)}}return Pe.isArray(t)?t.forEach(i):i(t),s}clear(t){const n=Object.keys(this);let a=n.length,s=!1;for(;a--;){const i=n[a];(!t||Yc(this,this[i],i,t,!0))&&(delete this[i],s=!0)}return s}normalize(t){const n=this,a={};return Pe.forEach(this,(s,i)=>{const l=Pe.findKey(a,i);if(l){n[l]=Ir(s),delete n[i];return}const u=t?R0(i):String(i).trim();u!==i&&delete n[i],n[u]=Ir(s),a[u]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return Pe.forEach(this,(a,s)=>{a!=null&&a!==!1&&(n[s]=t&&Pe.isArray(a)?a.join(", "):a)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const a=new this(t);return n.forEach(s=>a.set(s)),a}static accessor(t){const a=(this[Kh]=this[Kh]={accessors:{}}).accessors,s=this.prototype;function i(l){const u=ml(l);a[u]||(B0(s,l),a[u]=!0)}return Pe.isArray(t)?t.forEach(i):i(t),this}};ho.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Pe.reduceDescriptors(ho.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(a){this[n]=a}}});Pe.freezeMethods(ho);function Xc(e,t){const n=this||Yl,a=t||n,s=ho.from(a.headers);let i=a.data;return Pe.forEach(e,function(u){i=u.call(n,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function Ov(e){return!!(e&&e.__CANCEL__)}function Ji(e,t,n){gt.call(this,e??"canceled",gt.ERR_CANCELED,t,n),this.name="CanceledError"}Pe.inherits(Ji,gt,{__CANCEL__:!0});function Rv(e,t,n){const a=n.config.validateStatus;!n.status||!a||a(n.status)?e(n):t(new gt("Request failed with status code "+n.status,[gt.ERR_BAD_REQUEST,gt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function N0(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function F0(e,t){e=e||10;const n=new Array(e),a=new Array(e);let s=0,i=0,l;return t=t!==void 0?t:1e3,function(d){const h=Date.now(),p=a[i];l||(l=h),n[s]=d,a[s]=h;let g=i,y=0;for(;g!==s;)y+=n[g++],g=g%e;if(s=(s+1)%e,s===i&&(i=(i+1)%e),h-l<t)return;const b=p&&h-p;return b?Math.round(y*1e3/b):void 0}}function U0(e,t){let n=0,a=1e3/t,s,i;const l=(h,p=Date.now())=>{n=p,s=null,i&&(clearTimeout(i),i=null),e(...h)};return[(...h)=>{const p=Date.now(),g=p-n;g>=a?l(h,p):(s=h,i||(i=setTimeout(()=>{i=null,l(s)},a-g)))},()=>s&&l(s)]}const jr=(e,t,n=3)=>{let a=0;const s=F0(50,250);return U0(i=>{const l=i.loaded,u=i.lengthComputable?i.total:void 0,d=l-a,h=s(d),p=l<=u;a=l;const g={loaded:l,total:u,progress:u?l/u:void 0,bytes:d,rate:h||void 0,estimated:h&&u&&p?(u-l)/h:void 0,event:i,lengthComputable:u!=null,[t?"download":"upload"]:!0};e(g)},n)},Jh=(e,t)=>{const n=e!=null;return[a=>t[0]({lengthComputable:n,total:e,loaded:a}),t[1]]},Yh=e=>(...t)=>Pe.asap(()=>e(...t)),z0=Un.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Un.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Un.origin),Un.navigator&&/(msie|trident)/i.test(Un.navigator.userAgent)):()=>!0,H0=Un.hasStandardBrowserEnv?{write(e,t,n,a,s,i,l){if(typeof document>"u")return;const u=[`${e}=${encodeURIComponent(t)}`];Pe.isNumber(n)&&u.push(`expires=${new Date(n).toUTCString()}`),Pe.isString(a)&&u.push(`path=${a}`),Pe.isString(s)&&u.push(`domain=${s}`),i===!0&&u.push("secure"),Pe.isString(l)&&u.push(`SameSite=${l}`),document.cookie=u.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function V0(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function G0(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Bv(e,t,n){let a=!V0(t);return e&&(a||n==!1)?G0(e,t):t}const Xh=e=>e instanceof ho?{...e}:e;function ui(e,t){t=t||{};const n={};function a(h,p,g,y){return Pe.isPlainObject(h)&&Pe.isPlainObject(p)?Pe.merge.call({caseless:y},h,p):Pe.isPlainObject(p)?Pe.merge({},p):Pe.isArray(p)?p.slice():p}function s(h,p,g,y){if(Pe.isUndefined(p)){if(!Pe.isUndefined(h))return a(void 0,h,g,y)}else return a(h,p,g,y)}function i(h,p){if(!Pe.isUndefined(p))return a(void 0,p)}function l(h,p){if(Pe.isUndefined(p)){if(!Pe.isUndefined(h))return a(void 0,h)}else return a(void 0,p)}function u(h,p,g){if(g in t)return a(h,p);if(g in e)return a(void 0,h)}const d={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(h,p,g)=>s(Xh(h),Xh(p),g,!0)};return Pe.forEach(Object.keys({...e,...t}),function(p){const g=d[p]||s,y=g(e[p],t[p],p);Pe.isUndefined(y)&&g!==u||(n[p]=y)}),n}const Nv=e=>{const t=ui({},e);let{data:n,withXSRFToken:a,xsrfHeaderName:s,xsrfCookieName:i,headers:l,auth:u}=t;if(t.headers=l=ho.from(l),t.url=Ev(Bv(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),Pe.isFormData(n)){if(Un.hasStandardBrowserEnv||Un.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(Pe.isFunction(n.getHeaders)){const d=n.getHeaders(),h=["content-type","content-length"];Object.entries(d).forEach(([p,g])=>{h.includes(p.toLowerCase())&&l.set(p,g)})}}if(Un.hasStandardBrowserEnv&&(a&&Pe.isFunction(a)&&(a=a(t)),a||a!==!1&&z0(t.url))){const d=s&&i&&H0.read(i);d&&l.set(s,d)}return t},j0=typeof XMLHttpRequest<"u",Z0=j0&&function(e){return new Promise(function(n,a){const s=Nv(e);let i=s.data;const l=ho.from(s.headers).normalize();let{responseType:u,onUploadProgress:d,onDownloadProgress:h}=s,p,g,y,b,C;function I(){b&&b(),C&&C(),s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let M=new XMLHttpRequest;M.open(s.method.toUpperCase(),s.url,!0),M.timeout=s.timeout;function x(){if(!M)return;const _=ho.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders()),E={data:!u||u==="text"||u==="json"?M.responseText:M.response,status:M.status,statusText:M.statusText,headers:_,config:e,request:M};Rv(function(A){n(A),I()},function(A){a(A),I()},E),M=null}"onloadend"in M?M.onloadend=x:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(x)},M.onabort=function(){M&&(a(new gt("Request aborted",gt.ECONNABORTED,e,M)),M=null)},M.onerror=function(D){const E=D&&D.message?D.message:"Network Error",Z=new gt(E,gt.ERR_NETWORK,e,M);Z.event=D||null,a(Z),M=null},M.ontimeout=function(){let D=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const E=s.transitional||Pv;s.timeoutErrorMessage&&(D=s.timeoutErrorMessage),a(new gt(D,E.clarifyTimeoutError?gt.ETIMEDOUT:gt.ECONNABORTED,e,M)),M=null},i===void 0&&l.setContentType(null),"setRequestHeader"in M&&Pe.forEach(l.toJSON(),function(D,E){M.setRequestHeader(E,D)}),Pe.isUndefined(s.withCredentials)||(M.withCredentials=!!s.withCredentials),u&&u!=="json"&&(M.responseType=s.responseType),h&&([y,C]=jr(h,!0),M.addEventListener("progress",y)),d&&M.upload&&([g,b]=jr(d),M.upload.addEventListener("progress",g),M.upload.addEventListener("loadend",b)),(s.cancelToken||s.signal)&&(p=_=>{M&&(a(!_||_.type?new Ji(null,e,M):_),M.abort(),M=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const S=N0(s.url);if(S&&Un.protocols.indexOf(S)===-1){a(new gt("Unsupported protocol "+S+":",gt.ERR_BAD_REQUEST,e));return}M.send(i||null)})},q0=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let a=new AbortController,s;const i=function(h){if(!s){s=!0,u();const p=h instanceof Error?h:this.reason;a.abort(p instanceof gt?p:new Ji(p instanceof Error?p.message:p))}};let l=t&&setTimeout(()=>{l=null,i(new gt(`timeout ${t} of ms exceeded`,gt.ETIMEDOUT))},t);const u=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(i):h.removeEventListener("abort",i)}),e=null)};e.forEach(h=>h.addEventListener("abort",i));const{signal:d}=a;return d.unsubscribe=()=>Pe.asap(u),d}},W0=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let a=0,s;for(;a<n;)s=a+t,yield e.slice(a,s),a=s},K0=async function*(e,t){for await(const n of J0(e))yield*W0(n,t)},J0=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:a}=await t.read();if(n)break;yield a}}finally{await t.cancel()}},Qh=(e,t,n,a)=>{const s=K0(e,t);let i=0,l,u=d=>{l||(l=!0,a&&a(d))};return new ReadableStream({async pull(d){try{const{done:h,value:p}=await s.next();if(h){u(),d.close();return}let g=p.byteLength;if(n){let y=i+=g;n(y)}d.enqueue(new Uint8Array(p))}catch(h){throw u(h),h}},cancel(d){return u(d),s.return()}},{highWaterMark:2})},ef=64*1024,{isFunction:gr}=Pe,Y0=(({Request:e,Response:t})=>({Request:e,Response:t}))(Pe.global),{ReadableStream:tf,TextEncoder:nf}=Pe.global,of=(e,...t)=>{try{return!!e(...t)}catch{return!1}},X0=e=>{e=Pe.merge.call({skipUndefined:!0},Y0,e);const{fetch:t,Request:n,Response:a}=e,s=t?gr(t):typeof fetch=="function",i=gr(n),l=gr(a);if(!s)return!1;const u=s&&gr(tf),d=s&&(typeof nf=="function"?(C=>I=>C.encode(I))(new nf):async C=>new Uint8Array(await new n(C).arrayBuffer())),h=i&&u&&of(()=>{let C=!1;const I=new n(Un.origin,{body:new tf,method:"POST",get duplex(){return C=!0,"half"}}).headers.has("Content-Type");return C&&!I}),p=l&&u&&of(()=>Pe.isReadableStream(new a("").body)),g={stream:p&&(C=>C.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(C=>{!g[C]&&(g[C]=(I,M)=>{let x=I&&I[C];if(x)return x.call(I);throw new gt(`Response type '${C}' is not supported`,gt.ERR_NOT_SUPPORT,M)})});const y=async C=>{if(C==null)return 0;if(Pe.isBlob(C))return C.size;if(Pe.isSpecCompliantForm(C))return(await new n(Un.origin,{method:"POST",body:C}).arrayBuffer()).byteLength;if(Pe.isArrayBufferView(C)||Pe.isArrayBuffer(C))return C.byteLength;if(Pe.isURLSearchParams(C)&&(C=C+""),Pe.isString(C))return(await d(C)).byteLength},b=async(C,I)=>{const M=Pe.toFiniteNumber(C.getContentLength());return M??y(I)};return async C=>{let{url:I,method:M,data:x,signal:S,cancelToken:_,timeout:D,onDownloadProgress:E,onUploadProgress:Z,responseType:A,headers:N,withCredentials:B="same-origin",fetchOptions:j}=Nv(C),R=t||fetch;A=A?(A+"").toLowerCase():"text";let G=q0([S,_&&_.toAbortSignal()],D),ee=null;const ne=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let Ae;try{if(Z&&h&&M!=="get"&&M!=="head"&&(Ae=await b(N,x))!==0){let ke=new n(I,{method:"POST",body:x,duplex:"half"}),Re;if(Pe.isFormData(x)&&(Re=ke.headers.get("content-type"))&&N.setContentType(Re),ke.body){const[Xe,Ne]=Jh(Ae,jr(Yh(Z)));x=Qh(ke.body,ef,Xe,Ne)}}Pe.isString(B)||(B=B?"include":"omit");const J=i&&"credentials"in n.prototype,te={...j,signal:G,method:M.toUpperCase(),headers:N.normalize().toJSON(),body:x,duplex:"half",credentials:J?B:void 0};ee=i&&new n(I,te);let U=await(i?R(ee,j):R(I,te));const X=p&&(A==="stream"||A==="response");if(p&&(E||X&&ne)){const ke={};["status","statusText","headers"].forEach(Ke=>{ke[Ke]=U[Ke]});const Re=Pe.toFiniteNumber(U.headers.get("content-length")),[Xe,Ne]=E&&Jh(Re,jr(Yh(E),!0))||[];U=new a(Qh(U.body,ef,Xe,()=>{Ne&&Ne(),ne&&ne()}),ke)}A=A||"text";let re=await g[Pe.findKey(g,A)||"text"](U,C);return!X&&ne&&ne(),await new Promise((ke,Re)=>{Rv(ke,Re,{data:re,headers:ho.from(U.headers),status:U.status,statusText:U.statusText,config:C,request:ee})})}catch(J){throw ne&&ne(),J&&J.name==="TypeError"&&/Load failed|fetch/i.test(J.message)?Object.assign(new gt("Network Error",gt.ERR_NETWORK,C,ee),{cause:J.cause||J}):gt.from(J,J&&J.code,C,ee)}}},Q0=new Map,Fv=e=>{let t=e&&e.env||{};const{fetch:n,Request:a,Response:s}=t,i=[a,s,n];let l=i.length,u=l,d,h,p=Q0;for(;u--;)d=i[u],h=p.get(d),h===void 0&&p.set(d,h=u?new Map:X0(t)),p=h;return h};Fv();const hd={http:m0,xhr:Z0,fetch:{get:Fv}};Pe.forEach(hd,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const sf=e=>`- ${e}`,eb=e=>Pe.isFunction(e)||e===null||e===!1;function tb(e,t){e=Pe.isArray(e)?e:[e];const{length:n}=e;let a,s;const i={};for(let l=0;l<n;l++){a=e[l];let u;if(s=a,!eb(a)&&(s=hd[(u=String(a)).toLowerCase()],s===void 0))throw new gt(`Unknown adapter '${u}'`);if(s&&(Pe.isFunction(s)||(s=s.get(t))))break;i[u||"#"+l]=s}if(!s){const l=Object.entries(i).map(([d,h])=>`adapter ${d} `+(h===!1?"is not supported by the environment":"is not available in the build"));let u=n?l.length>1?`since :
`+l.map(sf).join(`
`):" "+sf(l[0]):"as no adapter specified";throw new gt("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return s}const Uv={getAdapter:tb,adapters:hd};function Qc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ji(null,e)}function af(e){return Qc(e),e.headers=ho.from(e.headers),e.data=Xc.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Uv.getAdapter(e.adapter||Yl.adapter,e)(e).then(function(a){return Qc(e),a.data=Xc.call(e,e.transformResponse,a),a.headers=ho.from(a.headers),a},function(a){return Ov(a)||(Qc(e),a&&a.response&&(a.response.data=Xc.call(e,e.transformResponse,a.response),a.response.headers=ho.from(a.response.headers))),Promise.reject(a)})}const zv="1.13.2",wc={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{wc[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}});const lf={};wc.transitional=function(t,n,a){function s(i,l){return"[Axios v"+zv+"] Transitional option '"+i+"'"+l+(a?". "+a:"")}return(i,l,u)=>{if(t===!1)throw new gt(s(l," has been removed"+(n?" in "+n:"")),gt.ERR_DEPRECATED);return n&&!lf[l]&&(lf[l]=!0,console.warn(s(l," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(i,l,u):!0}};wc.spelling=function(t){return(n,a)=>(console.warn(`${a} is likely a misspelling of ${t}`),!0)};function nb(e,t,n){if(typeof e!="object")throw new gt("options must be an object",gt.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let s=a.length;for(;s-- >0;){const i=a[s],l=t[i];if(l){const u=e[i],d=u===void 0||l(u,i,e);if(d!==!0)throw new gt("option "+i+" must be "+d,gt.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new gt("Unknown option "+i,gt.ERR_BAD_OPTION)}}const xr={assertOptions:nb,validators:wc},vs=xr.validators;let li=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Wh,response:new Wh}}async request(t,n){try{return await this._request(t,n)}catch(a){if(a instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{a.stack?i&&!String(a.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+i):a.stack=i}catch{}}throw a}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=ui(this.defaults,n);const{transitional:a,paramsSerializer:s,headers:i}=n;a!==void 0&&xr.assertOptions(a,{silentJSONParsing:vs.transitional(vs.boolean),forcedJSONParsing:vs.transitional(vs.boolean),clarifyTimeoutError:vs.transitional(vs.boolean)},!1),s!=null&&(Pe.isFunction(s)?n.paramsSerializer={serialize:s}:xr.assertOptions(s,{encode:vs.function,serialize:vs.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),xr.assertOptions(n,{baseUrl:vs.spelling("baseURL"),withXsrfToken:vs.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let l=i&&Pe.merge(i.common,i[n.method]);i&&Pe.forEach(["delete","get","head","post","put","patch","common"],C=>{delete i[C]}),n.headers=ho.concat(l,i);const u=[];let d=!0;this.interceptors.request.forEach(function(I){typeof I.runWhen=="function"&&I.runWhen(n)===!1||(d=d&&I.synchronous,u.unshift(I.fulfilled,I.rejected))});const h=[];this.interceptors.response.forEach(function(I){h.push(I.fulfilled,I.rejected)});let p,g=0,y;if(!d){const C=[af.bind(this),void 0];for(C.unshift(...u),C.push(...h),y=C.length,p=Promise.resolve(n);g<y;)p=p.then(C[g++],C[g++]);return p}y=u.length;let b=n;for(;g<y;){const C=u[g++],I=u[g++];try{b=C(b)}catch(M){I.call(this,M);break}}try{p=af.call(this,b)}catch(C){return Promise.reject(C)}for(g=0,y=h.length;g<y;)p=p.then(h[g++],h[g++]);return p}getUri(t){t=ui(this.defaults,t);const n=Bv(t.baseURL,t.url,t.allowAbsoluteUrls);return Ev(n,t.params,t.paramsSerializer)}};Pe.forEach(["delete","get","head","options"],function(t){li.prototype[t]=function(n,a){return this.request(ui(a||{},{method:t,url:n,data:(a||{}).data}))}});Pe.forEach(["post","put","patch"],function(t){function n(a){return function(i,l,u){return this.request(ui(u||{},{method:t,headers:a?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}li.prototype[t]=n(),li.prototype[t+"Form"]=n(!0)});let ob=class Hv{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const a=this;this.promise.then(s=>{if(!a._listeners)return;let i=a._listeners.length;for(;i-- >0;)a._listeners[i](s);a._listeners=null}),this.promise.then=s=>{let i;const l=new Promise(u=>{a.subscribe(u),i=u}).then(s);return l.cancel=function(){a.unsubscribe(i)},l},t(function(i,l,u){a.reason||(a.reason=new Ji(i,l,u),n(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=a=>{t.abort(a)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Hv(function(s){t=s}),cancel:t}}};function sb(e){return function(n){return e.apply(null,n)}}function ab(e){return Pe.isObject(e)&&e.isAxiosError===!0}const $u={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries($u).forEach(([e,t])=>{$u[t]=e});function Vv(e){const t=new li(e),n=bv(li.prototype.request,t);return Pe.extend(n,li.prototype,t,{allOwnKeys:!0}),Pe.extend(n,t,null,{allOwnKeys:!0}),n.create=function(s){return Vv(ui(e,s))},n}const ln=Vv(Yl);ln.Axios=li;ln.CanceledError=Ji;ln.CancelToken=ob;ln.isCancel=Ov;ln.VERSION=zv;ln.toFormData=_c;ln.AxiosError=gt;ln.Cancel=ln.CanceledError;ln.all=function(t){return Promise.all(t)};ln.spread=sb;ln.isAxiosError=ab;ln.mergeConfig=ui;ln.AxiosHeaders=ho;ln.formToJSON=e=>Dv(Pe.isHTMLForm(e)?new FormData(e):e);ln.getAdapter=Uv.getAdapter;ln.HttpStatusCode=$u;ln.default=ln;const{Axios:SV,AxiosError:IV,CanceledError:xV,isCancel:$V,CancelToken:TV,VERSION:MV,all:AV,Cancel:EV,isAxiosError:PV,spread:DV,toFormData:OV,AxiosHeaders:RV,HttpStatusCode:BV,formToJSON:NV,getAdapter:FV,mergeConfig:UV}=ln,Ca="https://sterobson-volunteercheckin-testing.azurewebsites.net/api",ib="VolunteerCheckinOffline",lb=1;let Xo=null;async function Ys(){return Xo||new Promise((e,t)=>{const n=indexedDB.open(ib,lb);n.onerror=()=>{console.error("Failed to open IndexedDB:",n.error),t(n.error)},n.onsuccess=()=>{Xo=n.result,e(Xo)},n.onupgradeneeded=a=>{const s=a.target.result;s.objectStoreNames.contains("eventData")||s.createObjectStore("eventData",{keyPath:"eventId"}),s.objectStoreNames.contains("pendingActions")||s.createObjectStore("pendingActions",{keyPath:"id",autoIncrement:!0}).createIndex("createdAt","createdAt",{unique:!1}),s.objectStoreNames.contains("syncMeta")||s.createObjectStore("syncMeta",{keyPath:"key"})}})}async function Vl(e,t){return await Ys(),new Promise((n,a)=>{const s=Xo.transaction(["eventData","syncMeta"],"readwrite"),i=s.objectStore("eventData"),l=s.objectStore("syncMeta"),u={eventId:e,...t,cachedAt:new Date().toISOString()};i.put(u),l.put({key:`lastSync_${e}`,value:new Date().toISOString()}),s.oncomplete=()=>n(),s.onerror=()=>a(s.error)})}async function xa(e){return await Ys(),new Promise((t,n)=>{const i=Xo.transaction(["eventData"],"readonly").objectStore("eventData").get(e);i.onsuccess=()=>t(i.result||null),i.onerror=()=>n(i.error)})}async function $r(e,t,n){const a=await xa(e);a&&(a[t]=n,a.cachedAt=new Date().toISOString(),await Vl(e,a))}async function rb(e){return await Ys(),new Promise((t,n)=>{const s=Xo.transaction(["pendingActions"],"readwrite").objectStore("pendingActions"),i={...e,createdAt:new Date().toISOString(),attempts:0,lastAttempt:null,status:"pending"},l=s.add(i);l.onsuccess=()=>t(l.result),l.onerror=()=>n(l.error)})}async function Gv(){return await Ys(),new Promise((e,t)=>{const i=Xo.transaction(["pendingActions"],"readonly").objectStore("pendingActions").index("createdAt").getAll();i.onsuccess=()=>{const l=i.result.filter(u=>u.status==="pending"||u.status==="retrying");e(l)},i.onerror=()=>t(i.error)})}async function Zr(){return(await Gv()).length}async function rf(e,t){return await Ys(),new Promise((n,a)=>{const s=Xo.transaction(["pendingActions"],"readwrite"),i=s.objectStore("pendingActions"),l=i.get(e);l.onsuccess=()=>{const u=l.result;u&&(Object.assign(u,t),i.put(u))},s.oncomplete=()=>n(),s.onerror=()=>a(s.error)})}async function cf(e){return await Ys(),new Promise((t,n)=>{const i=Xo.transaction(["pendingActions"],"readwrite").objectStore("pendingActions").delete(e);i.onsuccess=()=>t(),i.onerror=()=>n(i.error)})}async function cb(e){return await Ys(),new Promise((t,n)=>{const i=Xo.transaction(["syncMeta"],"readonly").objectStore("syncMeta").get(`lastSync_${e}`);i.onsuccess=()=>t(i.result?.value||null),i.onerror=()=>n(i.error)})}const Je=ln.create({baseURL:Ca,headers:{"Content-Type":"application/json"},timeout:15e3});let Tu=!1,jv={type:null,eventId:null};function wo(e,t=null){jv={type:e,eventId:t}}async function ub(){}function uf(e){const t=[/\/events\/([^/]+)/,/\/assignments\/([^/]+)/,/\/locations\/([^/]+)/,/\/checklist-items\/([^/]+)/,/\/areas\/([^/]+)/,/\/marshals\/([^/]+)/];for(const n of t){const a=e.match(n);if(a)return a[1]}return null}function db(e){return!!(!e.response&&e.request||e.response&&e.response.status>=500||e.code==="ECONNABORTED")}function Zv(){const e=window.location.hash||"";if(e.includes("/admin/"))return{type:"admin",eventId:null};const t=e.match(/#\/event\/([^/?]+)/);return t?{type:"marshal",eventId:t[1]}:e.includes("/marshal")?{type:null,eventId:null}:jv}const hb=["/auth/marshal-login","/auth/request-login","/auth/verify-token","/auth/instant-login"];Je.interceptors.request.use(e=>{if(hb.some(i=>e.url?.includes(i)))return e;const n=localStorage.getItem("adminEmail");n&&(e.headers["X-Admin-Email"]=n);const a=Zv();let s=null;if(a.type==="marshal"&&a.eventId){const i=Gr(a.eventId);i?.token&&(s=i.token)}return s||(s=localStorage.getItem("sessionToken")),s&&(e.headers.Authorization=`Bearer ${s}`),bk(e),e});let qr=0;const fb=2;function pb(){if(qr++,qr>=fb&&Zv().type!=="marshal"){localStorage.removeItem("adminEmail"),localStorage.removeItem("sessionToken");const t=window.location.hash||"";!t.includes("login")&&!t.includes("/verify")&&(window.location.href="/VolunteerCheckin/testing/#/?login=true")}}function vb(){qr=0}function eu(){qr=0}function mb(e){if(!e?.url)return!1;const t=localStorage.getItem("sessionToken"),n=e.headers?.Authorization||e.headers?.authorization;if(n&&t&&n.replace("Bearer ","")!==t||(e.url||"").includes("/auth/marshal-login"))return!0;const s=window.location.hash||"";return!!(s.match(/#\/event\/[^/?]+/)||s==="#/marshal"||s.startsWith("#/marshal?"))}Je.interceptors.response.use(e=>{const t=Vh(e.config);t&&Hh(t),Tu=!1,vb();const n=e.config.url,a=uf(n);return e.config.method,e},async e=>{const t=e.config,n=Vh(t);if(n&&Hh(n),e.response&&(e.response.status===401||e.response.status===403))return mb(t)||pb(),Promise.reject(e);if(db(e)&&(Tu=!0,t.method==="get")){const a=uf(t.url);if(a){const s=await xa(a);if(s)return console.log("Returning cached data for:",t.url),Promise.resolve({data:s,status:200,statusText:"OK (cached)",headers:{},config:t,cached:!0})}}return Promise.reject(e)});async function _o(e,t,n){return await rb({type:e,payload:t,eventId:t.eventId}),await ub(),{data:n,status:200,statusText:"OK (queued)",queued:!0}}function On(){return Tu||!navigator.onLine}const gb={check:()=>Je.head("/health")},Mu=()=>"https://sterobson.github.io/VolunteerCheckin/testing".replace(/\/?#?\/?$/,""),bs={requestLogin:e=>Je.post("/auth/request-login",{email:e,frontendUrl:Mu()}),verifyToken:e=>Je.post("/auth/verify-token",{token:e}),instantLogin:e=>Je.post("/auth/instant-login",{email:e}),createAdmin:e=>Je.post("/auth/create-admin",{email:e}),marshalLogin:(e,t)=>Je.post("/auth/marshal-login",{eventId:e,magicCode:t}),getMe:e=>Je.get("/auth/me",{params:{eventId:e}}),logout:()=>Je.post("/auth/logout")},yr={getProfile:()=>Je.get("/auth/profile"),updateProfile:e=>Je.put("/auth/profile",e),getPerson:(e,t)=>Je.get(`/people/${e}`,{params:{eventId:t}}),updatePerson:(e,t,n)=>Je.put(`/people/${e}`,n,{params:{eventId:t}})},La={create:e=>Je.post("/events",e),getAll:()=>Je.get("/events"),getById:e=>Je.get(`/events/${e}`),update:(e,t)=>Je.put(`/events/${e}`,t),delete:e=>Je.delete(`/events/${e}`),uploadGpx:(e,t)=>{const n=new FormData;return n.append("gpx",t),Je.post(`/events/${e}/upload-gpx`,n,{headers:{"Content-Type":"multipart/form-data"}})}},Yn={create:e=>Je.post("/locations",e),getById:(e,t)=>Je.get(`/locations/${e}/${t}`),getByEvent:e=>Je.get(`/events/${e}/locations`),update:(e,t,n)=>Je.put(`/locations/${e}/${t}`,n),delete:(e,t)=>Je.delete(`/locations/${e}/${t}`),importCsv:(e,t,n)=>{const a=new FormData;return a.append("csv",t),Je.post(`/locations/import/${e}?deleteExisting=${n}`,a,{headers:{"Content-Type":"multipart/form-data"}})},bulkUpdateTimes:(e,t)=>Je.post(`/locations/bulk-update-times/${e}`,{timeDelta:t}),updatePosition:(e,t,n)=>Je.post(`/locations/${e}/${t}/update-position`,n),getDynamicCheckpoints:e=>Je.get(`/events/${e}/dynamic-checkpoints`)},yl={create:e=>Je.post("/assignments",e),getById:(e,t)=>Je.get(`/assignments/${e}/${t}`),getByEvent:e=>Je.get(`/assignments/event/${e}`),delete:(e,t)=>Je.delete(`/assignments/${e}/${t}`),getEventStatus:e=>Je.get(`/events/${e}/status`)},$a={checkIn:e=>Je.post("/checkin",e),toggleCheckIn:(e,t,{latitude:n,longitude:a,action:s}={})=>Je.post(`/checkin/${e}/${t}/toggle`,{latitude:n??null,longitude:a??null,action:s??null}),adminCheckIn:(e,t)=>Je.post(`/checkin/admin/${e}/${t}`)},tu={getAdmins:e=>Je.get(`/events/${e}/admins`),addAdmin:(e,t)=>Je.post(`/events/${e}/admins`,{userEmail:t}),removeAdmin:(e,t)=>Je.delete(`/events/${e}/admins/${t}`)},_s={create:e=>Je.post("/marshals",e),getByEvent:e=>Je.get(`/events/${e}/marshals`),getById:(e,t)=>Je.get(`/marshals/${e}/${t}`),update:(e,t,n)=>Je.put(`/marshals/${e}/${t}`,n),delete:(e,t)=>Je.delete(`/marshals/${e}/${t}`),getMagicLink:(e,t)=>Je.get(`/marshals/${e}/${t}/magic-link`,{params:{frontendUrl:Mu()}}),sendMagicLink:(e,t)=>Je.post(`/marshals/${e}/${t}/send-magic-link`,{frontendUrl:Mu()}),importCsv:(e,t)=>{const n=new FormData;return n.append("csv",t),Je.post(`/marshals/import/${e}`,n,{headers:{"Content-Type":"multipart/form-data"}})}},Us={create:e=>Je.post("/areas",e),getByEvent:e=>Je.get(`/events/${e}/areas`),getById:(e,t)=>Je.get(`/areas/${e}/${t}`),update:(e,t,n)=>Je.put(`/areas/${e}/${t}`,n),delete:(e,t)=>Je.delete(`/areas/${e}/${t}`),recalculate:e=>Je.post(`/areas/recalculate/${e}`),getCheckpoints:(e,t)=>Je.get(`/areas/${e}/${t}/locations`),getAreaLeadDashboard:e=>Je.get(`/events/${e}/area-lead-dashboard`)},Nt={create:(e,t)=>Je.post(`/events/${e}/checklist-items`,t),getByEvent:e=>Je.get(`/events/${e}/checklist-items`),getById:(e,t)=>Je.get(`/checklist-items/${e}/${t}`),update:(e,t,n)=>Je.put(`/checklist-items/${e}/${t}`,n),delete:(e,t)=>Je.delete(`/checklist-items/${e}/${t}`),getReport:e=>Je.get(`/events/${e}/checklist-report`),getMarshalChecklist:(e,t)=>Je.get(`/events/${e}/marshals/${t}/checklist`),getCheckpointChecklist:(e,t)=>Je.get(`/events/${e}/locations/${t}/checklist`),getAreaChecklist:(e,t)=>Je.get(`/events/${e}/areas/${t}/checklist`),complete:(e,t,n)=>Je.post(`/checklist-items/${e}/${t}/complete`,n),uncomplete:(e,t,n)=>Je.post(`/checklist-items/${e}/${t}/uncomplete`,n)},gs={create:(e,t)=>Je.post(`/events/${e}/notes`,t),getByEvent:e=>Je.get(`/events/${e}/notes`),getById:(e,t)=>Je.get(`/events/${e}/notes/${t}`),update:(e,t,n)=>Je.put(`/events/${e}/notes/${t}`,n),delete:(e,t)=>Je.delete(`/events/${e}/notes/${t}`),getMarshalNotes:(e,t)=>Je.get(`/events/${e}/marshals/${t}/notes`),getMyNotes:e=>Je.get(`/events/${e}/my-notes`)},ya={create:(e,t)=>Je.post(`/events/${e}/contacts`,t),getByEvent:e=>Je.get(`/events/${e}/contacts`),getById:(e,t)=>Je.get(`/events/${e}/contacts/${t}`),update:(e,t,n)=>Je.put(`/events/${e}/contacts/${t}`,n),delete:(e,t)=>Je.delete(`/events/${e}/contacts/${t}`),getRoles:e=>Je.get(`/events/${e}/contact-roles`),getMarshalContacts:(e,t)=>Je.get(`/events/${e}/marshals/${t}/contacts`),getMyContacts:e=>Je.get(`/events/${e}/my-contacts`)},ks={create:(e,t)=>Je.post(`/events/${e}/incidents`,t),getAll:(e,t={})=>Je.get(`/events/${e}/incidents`,{params:t}),getForArea:(e,t)=>Je.get(`/events/${e}/areas/${t}/incidents`),get:(e,t)=>Je.get(`/events/${e}/incidents/${t}`),updateStatus:(e,t,n)=>Je.patch(`/events/${e}/incidents/${t}`,n),addNote:(e,t,n)=>Je.post(`/events/${e}/incidents/${t}/notes`,{note:n})},yb={class:"hero-animation-container"},kb={__name:"HeroMapAnimation",props:{animate:{type:Boolean,default:!0}},setup(e){const t=e,n=T(!1);return tn(()=>{t.animate?requestAnimationFrame(()=>{n.value=!0}):n.value=!0}),(a,s)=>(v(),m("div",yb,[(v(),m("svg",{viewBox:"0 0 400 350",class:pe(["hero-map-svg",{animate:n.value&&e.animate,"no-animate":n.value&&!e.animate}])},[...s[0]||(s[0]=[Nr(`<defs data-v-cec8ae43><clipPath id="mapClip" data-v-cec8ae43><polygon points="80,0 320,0 420,350 -20,350" data-v-cec8ae43></polygon></clipPath></defs><g class="map-group" data-v-cec8ae43><polygon points="80,0 320,0 420,350 -20,350" fill="#c8e6c0" stroke="#8fbc8f" stroke-width="3" data-v-cec8ae43></polygon><g clip-path="url(#mapClip)" class="contours" data-v-cec8ae43><ellipse cx="300" cy="60" rx="35" ry="12" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="300" cy="60" rx="25" ry="8" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="300" cy="60" rx="15" ry="5" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="80" cy="220" rx="80" ry="40" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="80" cy="220" rx="55" ry="28" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="80" cy="220" rx="30" ry="15" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="320" cy="180" rx="50" ry="25" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse><ellipse cx="320" cy="180" rx="30" ry="15" fill="none" stroke="#b8d4b0" stroke-width="1.5" data-v-cec8ae43></ellipse></g><g clip-path="url(#mapClip)" class="roads" data-v-cec8ae43><path d="M 30,350 Q 80,300 100,250 C 120,200 90,150 110,100 Q 130,50 160,-10" fill="none" stroke="#1a5276" stroke-width="18" stroke-linecap="round" data-v-cec8ae43></path><path d="M 30,350 Q 80,300 100,250 C 120,200 90,150 110,100 Q 130,50 160,-10" fill="none" stroke="#5dade2" stroke-width="12" stroke-linecap="round" data-v-cec8ae43></path><path d="M -20,180 Q 80,160 160,150 T 300,100 Q 340,80 380,50" fill="none" stroke="#cc8800" stroke-width="10" stroke-linecap="round" data-v-cec8ae43></path><path d="M -20,180 Q 80,160 160,150 T 300,100 Q 340,80 380,50" fill="none" stroke="#ffcc00" stroke-width="6" stroke-linecap="round" data-v-cec8ae43></path></g><path id="routePath" d="M 60,360
             L 200,250
             L 150,150
             L 280,100
             L 450,60" fill="none" stroke="none" data-v-cec8ae43></path><g class="trail-segments" data-v-cec8ae43><path class="trail-seg trail-seg-1" d="M 60,360 L 200,250" fill="none" stroke="#dc3545" stroke-width="12" stroke-linecap="round" stroke-linejoin="round" data-v-cec8ae43></path><path class="trail-seg trail-seg-2" d="M 200,250 L 150,150" fill="none" stroke="#dc3545" stroke-width="9" stroke-linecap="round" stroke-linejoin="round" data-v-cec8ae43></path><path class="trail-seg trail-seg-3" d="M 150,150 L 280,100" fill="none" stroke="#dc3545" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" data-v-cec8ae43></path><path class="trail-seg trail-seg-4" d="M 280,100 L 450,60" fill="none" stroke="#dc3545" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" data-v-cec8ae43></path></g><g class="checkpoint checkpoint-1" transform="translate(200, 250)" data-v-cec8ae43><ellipse cx="0" cy="8" rx="40" ry="12" fill="#4a5aba" opacity="0.4" data-v-cec8ae43></ellipse><ellipse cx="0" cy="4" rx="30" ry="10" fill="#667eea" data-v-cec8ae43></ellipse><ellipse cx="0" cy="0" rx="25" ry="8" fill="#8b9ff0" data-v-cec8ae43></ellipse></g><g class="checkpoint checkpoint-2" transform="translate(150, 150)" data-v-cec8ae43><ellipse cx="0" cy="6" rx="18" ry="8" fill="#4a5aba" opacity="0.4" data-v-cec8ae43></ellipse><ellipse cx="0" cy="3" rx="15" ry="6" fill="#667eea" data-v-cec8ae43></ellipse><ellipse cx="0" cy="0" rx="12" ry="5" fill="#8b9ff0" data-v-cec8ae43></ellipse></g><g class="checkpoint checkpoint-3" transform="translate(280, 100)" data-v-cec8ae43><ellipse cx="0" cy="4" rx="12" ry="5" fill="#4a5aba" opacity="0.4" data-v-cec8ae43></ellipse><ellipse cx="0" cy="2" rx="10" ry="4" fill="#667eea" data-v-cec8ae43></ellipse><ellipse cx="0" cy="0" rx="8" ry="3" fill="#8b9ff0" data-v-cec8ae43></ellipse></g><g class="marshal marshal-1" transform="translate(200, 250)" data-v-cec8ae43><circle cx="0" cy="-28" r="12" fill="#444" data-v-cec8ae43></circle><path d="M 20,0 v-8 a12 12 0 0 0-12-12 h-16 a12 12 0 0 0-12 12 v8" fill="#444" data-v-cec8ae43></path></g><g class="marshal marshal-2" transform="translate(150, 150)" data-v-cec8ae43><circle cx="0" cy="-18" r="8" fill="#444" data-v-cec8ae43></circle><path d="M 12,0 v-5 a8 8 0 0 0-8-8 h-8 a8 8 0 0 0-8 8 v5" fill="#444" data-v-cec8ae43></path></g><g class="marshal marshal-3" transform="translate(280, 100)" data-v-cec8ae43><circle cx="0" cy="-12" r="6" fill="#444" data-v-cec8ae43></circle><path d="M 9,0 v-4 a6 6 0 0 0-6-6 h-6 a6 6 0 0 0-6 6 v4" fill="#444" data-v-cec8ae43></path></g><g clip-path="url(#mapClip)" class="trees" data-v-cec8ae43><g transform="translate(45, 280)" data-v-cec8ae43><polygon points="0,-20 12,0 -12,0" fill="#2d5a2d" data-v-cec8ae43></polygon><polygon points="0,-34 10,-12 -10,-12" fill="#2d5a2d" data-v-cec8ae43></polygon><polygon points="0,-46 8,-26 -8,-26" fill="#2d5a2d" data-v-cec8ae43></polygon><rect x="-3" y="0" width="6" height="8" fill="#5d4037" data-v-cec8ae43></rect></g><g transform="translate(75, 255)" data-v-cec8ae43><polygon points="0,-18 10,0 -10,0" fill="#3d6a3d" data-v-cec8ae43></polygon><polygon points="0,-30 8,-10 -8,-10" fill="#3d6a3d" data-v-cec8ae43></polygon><polygon points="0,-40 6,-22 -6,-22" fill="#3d6a3d" data-v-cec8ae43></polygon><rect x="-2.5" y="0" width="5" height="6" fill="#5d4037" data-v-cec8ae43></rect></g><g transform="translate(350, 230)" data-v-cec8ae43><polygon points="0,-20 11,0 -11,0" fill="#2d5a2d" data-v-cec8ae43></polygon><polygon points="0,-33 9,-11 -9,-11" fill="#2d5a2d" data-v-cec8ae43></polygon><polygon points="0,-44 7,-24 -7,-24" fill="#2d5a2d" data-v-cec8ae43></polygon><rect x="-2.5" y="0" width="5" height="7" fill="#5d4037" data-v-cec8ae43></rect></g><g transform="translate(60, 140)" data-v-cec8ae43><polygon points="0,-12 7,0 -7,0" fill="#3d6a3d" data-v-cec8ae43></polygon><polygon points="0,-20 5.5,-8 -5.5,-8" fill="#3d6a3d" data-v-cec8ae43></polygon><polygon points="0,-27 4,-15 -4,-15" fill="#3d6a3d" data-v-cec8ae43></polygon><rect x="-1.5" y="0" width="3" height="4" fill="#5d4037" data-v-cec8ae43></rect></g><g transform="translate(320, 70)" data-v-cec8ae43><polygon points="0,-9 5,0 -5,0" fill="#2d5a2d" data-v-cec8ae43></polygon><polygon points="0,-15 4,-6 -4,-6" fill="#2d5a2d" data-v-cec8ae43></polygon><polygon points="0,-20 3,-11 -3,-11" fill="#2d5a2d" data-v-cec8ae43></polygon><rect x="-1" y="0" width="2" height="3" fill="#5d4037" data-v-cec8ae43></rect></g><g transform="translate(320, 140)" data-v-cec8ae43><polygon points="0,-14 8,0 -8,0" fill="#3d6a3d" data-v-cec8ae43></polygon><polygon points="0,-24 6,-9 -6,-9" fill="#3d6a3d" data-v-cec8ae43></polygon><polygon points="0,-32 5,-18 -5,-18" fill="#3d6a3d" data-v-cec8ae43></polygon><rect x="-1.5" y="0" width="3" height="5" fill="#5d4037" data-v-cec8ae43></rect></g></g></g>`,2)])],2))]))}},bb=Ge(kb,[["__scopeId","data-v-cec8ae43"]]),_b={class:"hero-header"},wb={__name:"HeroHeader",props:{title:{type:String,default:""}},setup(e){const t=T(!1);return tn(()=>{window.__heroAnimationPlayed?t.value=!1:(t.value=!0,window.__heroAnimationPlayed=!0)}),(n,a)=>(v(),m("div",_b,[Me(bb,{animate:t.value},null,8,["animate"]),e.title?(v(),m("div",{key:0,class:pe(["hero-overlay",{"no-animate":!t.value}])},[r("h1",null,w(e.title),1)],2)):P("",!0)]))}},qv=Ge(wb,[["__scopeId","data-v-c824ab01"]]),Xl=sd("auth",()=>{const e=T(localStorage.getItem("adminEmail")||null),t=T(!!e.value),n=T(!1);return{adminEmail:e,isAuthenticated:t,loginPending:n,requestLogin:async u=>{const d=await bs.requestLogin(u);return d.data.success&&(n.value=!0),d.data},verifyToken:async u=>{const d=await bs.verifyToken(u);return d.data.success&&(e.value=d.data.person?.email,t.value=!0,n.value=!1,localStorage.setItem("adminEmail",d.data.person?.email),localStorage.setItem("sessionToken",d.data.sessionToken),wo("admin")),d.data},instantLogin:async u=>{const d=await bs.instantLogin(u);return d.data.success&&(e.value=d.data.email,t.value=!0,localStorage.setItem("adminEmail",d.data.email),d.data.sessionToken&&localStorage.setItem("sessionToken",d.data.sessionToken),wo("admin")),d.data},logout:async()=>{try{await bs.logout()}catch{}e.value=null,t.value=!1,n.value=!1,localStorage.removeItem("adminEmail"),localStorage.removeItem("sessionToken"),wo(null)}}}),Cb={class:"modal-card"},Lb={key:0,class:"email-sent"},Sb={key:1},Ib={class:"form-group"},xb=["disabled"],$b={key:0,class:"error"},Tb={__name:"LoginModal",props:{show:{type:Boolean,default:!1},zIndex:{type:Number,default:1e3}},emits:["close","success"],setup(e,{emit:t}){const n=e,a=t,s=Xl(),i=T(""),l=T(!1),u=T(null),d=T(!1);async function h(){l.value=!0,u.value=null;try{const y=await s.requestLogin(i.value);y.success?(d.value=!0,a("success",i.value)):u.value=y.message||"Failed to send login link. Please try again."}catch{u.value="Failed to send login link. Please try again."}finally{l.value=!1}}function p(){i.value="",d.value=!1,u.value=null}function g(){a("close")}return qe(()=>n.show,y=>{y||setTimeout(()=>{p()},200)}),(y,b)=>(v(),Ze(Rl,{to:"body"},[Me(ts,{name:"modal"},{default:He(()=>[e.show?(v(),m("div",{key:0,class:"modal-overlay",style:Qe({zIndex:e.zIndex}),onClick:it(g,["self"])},[r("div",Cb,[r("button",{class:"modal-close",onClick:g},""),d.value?(v(),m("div",Lb,[b[2]||(b[2]=r("div",{class:"check-icon"},"",-1)),b[3]||(b[3]=r("h3",null,"Check your email!",-1)),r("p",null,[b[1]||(b[1]=Ye("We've sent a login link to ",-1)),r("strong",null,w(i.value),1)]),b[4]||(b[4]=r("p",{class:"hint"},"The link will expire in 15 minutes.",-1)),r("button",{onClick:p,class:"btn btn-secondary"}," Use a different email ")])):(v(),m("div",Sb,[b[5]||(b[5]=r("h2",null,"Join us or login",-1)),b[6]||(b[6]=r("p",{class:"instruction"},"Enter your email to receive a login link",-1)),r("form",{onSubmit:it(h,["prevent"])},[r("div",Ib,[ze(r("input",{"onUpdate:modelValue":b[0]||(b[0]=C=>i.value=C),type:"email",placeholder:"you@example.com",required:"",class:"form-input"},null,512),[[nt,i.value]])]),r("button",{type:"submit",class:"btn btn-primary btn-full",disabled:l.value},w(l.value?"Sending...":"Send login link"),9,xb)],32),u.value?(v(),m("div",$b,w(u.value),1)):P("",!0)]))])],4)):P("",!0)]),_:1})]))}},Wv=Ge(Tb,[["__scopeId","data-v-7c646305"]]),Mb={class:"home"},Ab={class:"hero-section"},Eb={class:"content-section"},Pb={class:"container"},Db={class:"carousel"},Ob={class:"carousel-indicators"},Rb=["onClick"],Bb={__name:"Home",setup(e){const t=gc(),n=qi();function a(){const y=!!localStorage.getItem("adminEmail"),b=yv();return y||b}function s(){a()?n.push("/sessions"):p.value=!0}const i=T(0);let l=null;function u(y){i.value=y,h()}function d(){i.value=(i.value+1)%2}function h(){l&&clearInterval(l),l=setInterval(d,1e4)}const p=T(!1);function g(){p.value=!1,t.query.login&&n.replace({query:{}})}return tn(()=>{h(),t.query.login&&(a()?n.replace("/sessions"):p.value=!0)}),bn(()=>{l&&clearInterval(l)}),(y,b)=>(v(),m("div",Mb,[r("section",Ab,[Me(qv,{title:"OnTheDay"}),b[0]||(b[0]=r("p",{class:"subtitle"},"Manage your event's marshals and volunteers with ease",-1)),r("button",{class:"btn btn-primary",onClick:s}," Join us or login ")]),r("section",Eb,[r("div",Pb,[b[2]||(b[2]=Nr('<div class="features-grid" data-v-aaecbd22><div class="feature-card" data-v-aaecbd22><h3 data-v-aaecbd22>For admins</h3><ul data-v-aaecbd22><li data-v-aaecbd22>Create and manage events</li><li data-v-aaecbd22>Define marshal locations</li><li data-v-aaecbd22>Real-time check-in monitoring</li><li data-v-aaecbd22>Map view of everything in your event</li><li data-v-aaecbd22>Manage incidents</li></ul></div><div class="feature-card" data-v-aaecbd22><h3 data-v-aaecbd22>For marshals</h3><ul data-v-aaecbd22><li data-v-aaecbd22>View the entire route</li><li data-v-aaecbd22>View your assigned location</li><li data-v-aaecbd22>Check in with GPS verification</li><li data-v-aaecbd22>Access emergency contact info</li><li data-v-aaecbd22>Record incidents</li></ul></div></div>',1)),r("div",Db,[r("div",{class:"carousel-track",style:Qe({transform:`translateX(-${i.value*100}%)`})},[...b[1]||(b[1]=[Nr('<div class="feature-card" data-v-aaecbd22><h3 data-v-aaecbd22>For admins</h3><ul data-v-aaecbd22><li data-v-aaecbd22>Create and manage events</li><li data-v-aaecbd22>Define marshal locations</li><li data-v-aaecbd22>Real-time check-in monitoring</li><li data-v-aaecbd22>Map view of everything in your event</li><li data-v-aaecbd22>Manage incidents</li></ul></div><div class="feature-card" data-v-aaecbd22><h3 data-v-aaecbd22>For marshals</h3><ul data-v-aaecbd22><li data-v-aaecbd22>View the entire route</li><li data-v-aaecbd22>View your assigned location</li><li data-v-aaecbd22>Check in with GPS verification</li><li data-v-aaecbd22>Access emergency contact info</li><li data-v-aaecbd22>Record incidents</li></ul></div>',2)])],4),r("div",Ob,[(v(),m(Te,null,Fe(2,(C,I)=>r("button",{key:I,class:pe(["indicator",{active:i.value===I}]),onClick:M=>u(I)},null,10,Rb)),64))])])])]),Me(Wv,{show:p.value,onClose:g},null,8,["show"])]))}},Nb=Ge(Bb,[["__scopeId","data-v-aaecbd22"]]),Fb={class:"admin-login"},Ub={class:"login-card"},zb={key:0,class:"email-sent"},Hb={class:"form-group"},Vb=["disabled"],Gb={key:0,class:"error"},jb={__name:"AdminLogin",setup(e){const t=Xl(),n=T(""),a=T(!1),s=T(null),i=T(!1),l=async()=>{a.value=!0,s.value=null;try{const d=await t.requestLogin(n.value);d.success?i.value=!0:s.value=d.message||"Failed to send login link. Please try again."}catch{s.value="Failed to send login link. Please try again."}finally{a.value=!1}},u=()=>{n.value="",i.value=!1,s.value=null};return(d,h)=>{const p=Yu("router-link");return v(),m("div",Fb,[r("div",Ub,[h[7]||(h[7]=r("h2",null,"Admin login",-1)),i.value?(v(),m("div",zb,[h[2]||(h[2]=r("div",{class:"check-icon"},"",-1)),h[3]||(h[3]=r("h3",null,"Check your email!",-1)),r("p",null,[h[1]||(h[1]=Ye("We've sent a login link to ",-1)),r("strong",null,w(n.value),1)]),h[4]||(h[4]=r("p",{class:"hint"},"The link will expire in 15 minutes.",-1)),r("button",{onClick:u,class:"btn btn-secondary"}," Use a different email ")])):(v(),m(Te,{key:1},[h[5]||(h[5]=r("p",{class:"instruction"},"Enter your email to receive a login link",-1)),r("form",{onSubmit:it(l,["prevent"])},[r("div",Hb,[ze(r("input",{"onUpdate:modelValue":h[0]||(h[0]=g=>n.value=g),type:"email",placeholder:"admin@example.com",required:"",class:"form-input"},null,512),[[nt,n.value]])]),r("button",{type:"submit",class:"btn btn-primary",disabled:a.value},w(a.value?"Sending...":"Send login link"),9,Vb)],32),s.value?(v(),m("div",Gb,w(s.value),1)):P("",!0)],64)),Me(p,{to:"/",class:"back-link"},{default:He(()=>[...h[6]||(h[6]=[Ye(" Back to Home",-1)])]),_:1})])])}}},Zb=Ge(jb,[["__scopeId","data-v-5d0a88c2"]]),qb={class:"admin-verify"},Wb={class:"verify-card"},Kb={key:0,class:"status"},Jb={key:1,class:"status error"},Yb={key:2,class:"status success"},Xb={__name:"AdminVerify",setup(e){const t=qi(),n=gc(),a=Xl(),s=T(!0),i=T(null);return tn(async()=>{const l=n.query.token;if(!l){i.value="No login token provided. Please request a new login link.",s.value=!1;return}try{const u=await a.verifyToken(l);u.success?setTimeout(()=>{t.push({name:"Sessions"})},1e3):i.value=u.message||"Invalid or expired login link. Please request a new one."}catch(u){console.error("Verification error:",u),i.value="Failed to verify login. Please try again."}finally{s.value=!1}}),(l,u)=>{const d=Yu("router-link");return v(),m("div",qb,[r("div",Wb,[s.value?(v(),m("div",Kb,[...u[0]||(u[0]=[r("div",{class:"spinner"},null,-1),r("h2",null,"Verifying your login...",-1),r("p",null,"Please wait while we confirm your identity.",-1)])])):i.value?(v(),m("div",Jb,[u[2]||(u[2]=r("h2",null,"Login failed",-1)),r("p",null,w(i.value),1),Me(d,{to:{name:"Home",query:{login:"true"}},class:"btn btn-primary"},{default:He(()=>[...u[1]||(u[1]=[Ye(" Try again ",-1)])]),_:1})])):(v(),m("div",Yb,[...u[3]||(u[3]=[r("h2",null,"Login successful!",-1),r("p",null,"Redirecting to your sessions...",-1)])]))])])}}},Qb=Ge(Xb,[["__scopeId","data-v-b2435a84"]]),Kv=sd("events",()=>{const e=T([]),t=T(null),n=T([]),a=T([]),s=T(null),i=T(!1),l=T(null),u=async()=>{i.value=!0,l.value=null;try{const Z=await La.getAll();e.value=Z.data}catch(Z){throw l.value=Z.message,Z}finally{i.value=!1}},d=async Z=>{i.value=!0,l.value=null;try{const A=await La.getById(Z);t.value=A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}},h=async Z=>{i.value=!0,l.value=null;try{const A=await La.create(Z);return e.value.push(A.data),A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}},p=async(Z,A)=>{i.value=!0,l.value=null;try{const N=await La.update(Z,A),B=e.value.findIndex(j=>j.id===Z);return B!==-1&&(e.value[B]=N.data),t.value?.id===Z&&(t.value=N.data),N.data}catch(N){throw l.value=N.message,N}finally{i.value=!1}},g=async Z=>{i.value=!0,l.value=null;try{await La.delete(Z),e.value=e.value.filter(A=>A.id!==Z)}catch(A){throw l.value=A.message,A}finally{i.value=!1}},y=async Z=>{i.value=!0,l.value=null;try{const A=await Yn.getByEvent(Z);n.value=A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}};return{events:e,currentEvent:t,locations:n,assignments:a,eventStatus:s,loading:i,error:l,fetchEvents:u,fetchEvent:d,createEvent:h,updateEvent:p,deleteEvent:g,fetchLocations:y,createLocation:async Z=>{i.value=!0,l.value=null;try{const A=await Yn.create(Z);return n.value.push(A.data),A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}},updateLocation:async(Z,A,N)=>{i.value=!0,l.value=null;try{const B=await Yn.update(Z,A,N),j=n.value.findIndex(R=>R.id===A);return j!==-1&&(n.value[j]=B.data),B.data}catch(B){throw l.value=B.message,B}finally{i.value=!1}},deleteLocation:async(Z,A)=>{i.value=!0,l.value=null;try{await Yn.delete(Z,A),n.value=n.value.filter(N=>N.id!==A)}catch(N){throw l.value=N.message,N}finally{i.value=!1}},bulkUpdateLocationTimes:async(Z,A)=>{i.value=!0,l.value=null;try{const N=await Yn.bulkUpdateTimes(Z,A);return await y(Z),N.data}catch(N){throw l.value=N.message,N}finally{i.value=!1}},fetchAssignments:async Z=>{i.value=!0,l.value=null;try{const A=await yl.getByEvent(Z);a.value=A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}},createAssignment:async Z=>{i.value=!0,l.value=null;try{const A=await yl.create(Z);return a.value.push(A.data),A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}},deleteAssignment:async(Z,A)=>{i.value=!0,l.value=null;try{await yl.delete(Z,A),a.value=a.value.filter(N=>N.id!==A)}catch(N){throw l.value=N.message,N}finally{i.value=!1}},fetchEventStatus:async Z=>{i.value=!0,l.value=null;try{const A=await yl.getEventStatus(Z);return s.value=A.data,A.data}catch(A){throw l.value=A.message,A}finally{i.value=!1}},updateAssignmentCheckIn:Z=>{const A=a.value.findIndex(N=>N.id===Z.id);A!==-1&&(a.value[A]=Z),s.value&&s.value.locations.forEach(N=>{const B=N.assignments.findIndex(j=>j.id===Z.id);B!==-1&&(N.assignments[B]=Z,N.checkedInCount=N.assignments.filter(j=>j.isCheckedIn).length)})}}});function Jv(e="details",t=[]){const n=T(e),a=g=>{n.value=g},s=()=>{n.value=e},i=g=>n.value===g,l=z(()=>t.length===0?-1:t.indexOf(n.value)),u=(g=!1)=>{if(t.length===0)return;const y=l.value;if(y===-1)return;const b=y+1;b<t.length?n.value=t[b]:g&&(n.value=t[0])},d=(g=!1)=>{if(t.length===0)return;const y=l.value;if(y===-1)return;const b=y-1;b>=0?n.value=t[b]:g&&(n.value=t[t.length-1])},h=z(()=>{if(t.length===0)return!1;const g=l.value;return g!==-1&&g<t.length-1}),p=z(()=>t.length===0?!1:l.value>0);return{activeTab:n,activeTabIndex:l,hasNextTab:h,hasPreviousTab:p,switchTab:a,resetTab:s,isActiveTab:i,nextTab:u,previousTab:d}}function e_(){const e=T(!1),t=T(""),n=T(""),a=T(null),s=T(!1),i=T("OK");return{showConfirmModal:e,confirmModalTitle:t,confirmModalMessage:n,confirmModalIsDanger:s,confirmModalConfirmText:i,showConfirm:(p,g,y,b={})=>{t.value=p,n.value=g,a.value=y,s.value=b.isDanger||!1,i.value=b.confirmText||"OK",e.value=!0},handleConfirmModalConfirm:()=>{e.value=!1,a.value&&(a.value(),a.value=null)},handleConfirmModalCancel:()=>{e.value=!1,a.value=null},closeConfirmModal:()=>{e.value=!1,a.value=null}}}const Pi=T({people:"Marshals",checkpoint:"Checkpoints",area:"Areas",checklist:"Checklists",course:"Course"}),Hs={people:{People:{singular:"Person",plural:"People"},Marshals:{singular:"Marshal",plural:"Marshals"},Volunteers:{singular:"Volunteer",plural:"Volunteers"},Helpers:{singular:"Helper",plural:"Helpers"},Staff:{singular:"Staff member",plural:"Staff"},Stewards:{singular:"Steward",plural:"Stewards"},"Team members":{singular:"Team member",plural:"Team members"},Drivers:{singular:"Driver",plural:"Drivers"},Pilots:{singular:"Pilot",plural:"Pilots"}},checkpoint:{Checkpoints:{singular:"Checkpoint",plural:"Checkpoints"},Stations:{singular:"Station",plural:"Stations"},Locations:{singular:"Location",plural:"Locations"},"Feed stations":{singular:"Feed station",plural:"Feed stations"},"Aid stations":{singular:"Aid station",plural:"Aid stations"},"Water stations":{singular:"Water station",plural:"Water stations"},"Person points":{singular:null,plural:null,dynamic:!0}},area:{Areas:{singular:"Area",plural:"Areas"},Regions:{singular:"Region",plural:"Regions"},Zones:{singular:"Zone",plural:"Zones"}},checklist:{Checklists:{singular:"Checklist",plural:"Checklists"},Tasks:{singular:"Task",plural:"Tasks"},Jobs:{singular:"Job",plural:"Jobs"}},course:{Course:{singular:"Course",plural:"Courses"},Route:{singular:"Route",plural:"Routes"},Track:{singular:"Track",plural:"Tracks"},Trail:{singular:"Trail",plural:"Trails"},Path:{singular:"Path",plural:"Paths"}}},zs={people:["Drivers","Helpers","Marshals","People","Pilots","Staff","Stewards","Team members","Volunteers"],checkpoint:["Aid stations","Checkpoints","Feed stations","Locations","Person points","Stations","Water stations"],area:["Areas","Regions","Zones"],checklist:["Checklists","Jobs","Tasks"],course:["Course","Path","Route","Track","Trail"]};function ti(e,t,n="Marshals"){if(!t)return"";const a=Hs[e]?.[t];return e==="checkpoint"&&t==="Person points"?`${Hs.people[n]?.singular||"Person"} point`:a?.singular?a.singular:t.endsWith("s")&&!t.endsWith("ss")?t.slice(0,-1):t}function Yv(e,t,n="Marshals"){if(!t)return"";const a=Hs[e]?.[t];return t==="Person points"?`${Hs.people[n]?.singular||"Person"} points`:a?.plural?a.plural:t}function Au(e,t){return e==="Person points"?`${Hs.people[t]?.singular||"Person"} points`:e}function Eu(e){e&&(Pi.value={people:e.peopleTerm||"Marshals",checkpoint:e.checkpointTerm||"Checkpoints",area:e.areaTerm||"Areas",checklist:e.checklistTerm||"Checklists",course:e.courseTerm||"Course"})}const Wo=e=>e.toLowerCase(),Ko=e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();function rt(){const e=p=>{const g=Pi.value[p],y=Hs[p]?.[g];if(p==="checkpoint"&&g==="Person points"){const b=Pi.value.people;return`${Hs.people[b]?.singular||"Person"} point`}return y?.singular||g},t=p=>{const g=Pi.value[p],y=Hs[p]?.[g];if(p==="checkpoint"&&g==="Person points"){const b=Pi.value.people;return`${Hs.people[b]?.singular||"Person"} points`}return y?.plural||g},n=z(()=>({person:e("people"),checkpoint:e("checkpoint"),area:e("area"),checklist:e("checklist"),course:e("course"),people:t("people"),checkpoints:t("checkpoint"),areas:t("area"),checklists:t("checklist"),courses:t("course")})),a=z(()=>({person:Wo(e("people")),checkpoint:Wo(e("checkpoint")),area:Wo(e("area")),checklist:Wo(e("checklist")),course:Wo(e("course")),people:Wo(t("people")),checkpoints:Wo(t("checkpoint")),areas:Wo(t("area")),checklists:Wo(t("checklist")),courses:Wo(t("course"))})),s=z(()=>({person:Ko(e("people")),checkpoint:Ko(e("checkpoint")),area:Ko(e("area")),checklist:Ko(e("checklist")),course:Ko(e("course")),people:Ko(t("people")),checkpoints:Ko(t("checkpoint")),areas:Ko(t("area")),checklists:Ko(t("checklist")),courses:Ko(t("course"))})),i=z(()=>({course:n.value.course,checkpoints:n.value.checkpoints,areas:n.value.areas,marshals:n.value.people,checklists:n.value.checklists,notes:"Notes",details:"Event details"}));return{terms:n,termsLower:a,termsSentence:s,tabLabels:i,singular:e,plural:t,formatCount:(p,g)=>g===1?`1 ${e(p)}`:`${g} ${t(p)}`,lower:(p,g=!0)=>Wo(g?t(p):e(p)),title:(p,g=!0)=>g?t(p):e(p),sentence:(p,g=!0)=>Ko(g?t(p):e(p)),terminology:Pi}}function t_(){const e=T(!1),t=T(null),n=T({}),a=T(null),s=T(null),i=T([]),l=T(null),u=T(null),d=T(!1),h=T(!1),p=T(1),g=z(()=>t.value==="place-checkpoint"||t.value==="move-checkpoint"?a.value!==null:t.value==="draw-area"?s.value&&s.value.length>=3:t.value==="add-multiple"),y=ee=>{if(ee){const ne=ee.getMapCenter?.(),Ae=ee.getMapZoom?.();ne&&Ae!==null&&(l.value=ne,u.value=Ae)}},b=(ee={})=>{a.value=null,e.value=!0,t.value="place-checkpoint",n.value={title:ee.title||"Select checkpoint location",description:ee.description||"Click on the map to set the location. Click again to reposition."}},C=(ee,ne="checkpoint")=>{a.value=null,e.value=!0,t.value="move-checkpoint",n.value={title:`Move ${ne}: ${ee}`,description:"Click on the map to set the new location"}},I=(ee={})=>{e.value=!0,t.value="draw-area",d.value=!0,n.value={title:ee.title||"Draw area boundary",description:ee.description||"Click to add points. Click Done when finished to complete the area."}},M=(ee=1)=>{p.value=ee,i.value=[],e.value=!0,t.value="add-multiple",h.value=!0,n.value={title:"Add multiple checkpoints",description:`Click on map to add checkpoints. Next: Checkpoint ${p.value}`}},x=ee=>{t.value==="place-checkpoint"||t.value==="move-checkpoint"?a.value=ee:t.value==="add-multiple"&&S(ee)},S=ee=>{i.value.push({id:`temp-${p.value}`,name:`Checkpoint ${p.value}`,description:"",latitude:ee.lat,longitude:ee.lng,requiredMarshals:1,what3Words:"",assignments:[],isTemporary:!0}),p.value++,n.value={...n.value,description:`Click on map to add checkpoints. Next: Checkpoint ${p.value}`}},_=ee=>{s.value=ee},D=()=>s.value&&s.value.length>=3?s.value.map(ee=>({lat:ee.lat,lng:ee.lng})):null,E=()=>{e.value=!1,t.value=null,n.value={},a.value=null,l.value=null,u.value=null,s.value=null,d.value&&(d.value=!1)};return{isFullscreenMapActive:e,fullscreenMode:t,fullscreenContext:n,tempLocationCoords:a,currentDrawingPolygon:s,tempCheckpoints:i,savedMapCenter:l,savedMapZoom:u,isDrawingAreaBoundary:d,isAddingMultipleCheckpoints:h,multiCheckpointCounter:p,canCompleteFullscreen:g,saveMapState:y,enterPlaceCheckpointMode:b,enterMoveCheckpointMode:C,enterDrawAreaMode:I,enterAddMultipleMode:M,handleFullscreenMapClick:x,handlePolygonDrawing:_,getCompletedPolygon:D,exitFullscreen:E,cancelFullscreen:()=>{t.value==="add-multiple"?(i.value=[],h.value=!1):t.value==="draw-area"&&(d.value=!1,s.value=null),E()},getTempCheckpoints:()=>[...i.value],clearTempCheckpoints:()=>{i.value=[],h.value=!1},getPlacedCoords:()=>a.value,createDisplayCheckpoints:(ee,ne,Ae)=>z(()=>{const J=[...ee.value];return t.value==="place-checkpoint"&&a.value&&J.push({id:"temp-single",name:ne.value?.name||"New Checkpoint",latitude:a.value.lat,longitude:a.value.lng,requiredMarshals:ne.value?.requiredMarshals||1,assignments:[],isTemporary:!0}),t.value==="move-checkpoint"&&a.value&&Ae.value&&J.push({id:"temp-move",name:Ae.value.name+" (new position)",latitude:a.value.lat,longitude:a.value.lng,requiredMarshals:Ae.value.requiredMarshals,assignments:[],isTemporary:!0}),t.value==="add-multiple"&&J.push(...i.value),J}),createDisplayAreas:(ee,ne)=>z(()=>{const Ae=[...ee.value];if(t.value==="draw-area"&&ne.value?.polygon?.length>0){const J=Ae.findIndex(te=>te.id===ne.value.id);J>=0?Ae[J]={...ne.value}:Ae.push({...ne.value,id:ne.value.id||"temp-area"})}return Ae}),calculateStartingNumber:ee=>{const ne=ee.value.map(Ae=>{const J=Ae.name.match(/^Checkpoint (\d+)$/);return J?parseInt(J[1]):0}).filter(Ae=>Ae>0);return ne.length>0?Math.max(...ne)+1:1}}}function n_(e){const t=T([]),n=T(!1);return{eventAdmins:t,showAddAdmin:n,loadEventAdmins:async()=>{try{const d=await tu.getAdmins(e.value);return t.value=d.data,d.data}catch(d){throw console.error("Failed to load event admins:",d),d}},openAddAdminModal:()=>{n.value=!0},closeAddAdminModal:()=>{n.value=!1},addAdmin:async d=>{await tu.addAdmin(e.value,d)},removeAdmin:async d=>{await tu.removeAdmin(e.value,d)}}}function o_(e){const t=T(!1),n=T(!1),a=T(!1),s=T(!1),i=T(!1),l=T(!1),u=T(null),d=T(null),h=T(null),p=T(null);return{showUploadRoute:t,showImportLocations:n,showImportMarshals:a,uploading:s,importing:i,importingMarshals:l,uploadError:u,importError:d,importResult:h,importMarshalsResult:p,openUploadRouteModal:()=>{u.value=null,t.value=!0},closeUploadRouteModal:()=>{t.value=!1,u.value=null},uploadRoute:async E=>{if(!E)return u.value="Please select a GPX file",null;s.value=!0,u.value=null;try{return await La.uploadGpx(e.value,E),!0}catch(Z){return console.error("Failed to upload route:",Z),u.value=Z.response?.data?.message||"Failed to upload route. Please try again.",null}finally{s.value=!1}},openImportLocationsModal:()=>{d.value=null,h.value=null,n.value=!0},closeImportLocationsModal:()=>{n.value=!1,d.value=null,h.value=null},importLocations:async(E,Z)=>{if(!E)return d.value="Please select a CSV file",null;i.value=!0,d.value=null,h.value=null;try{const A=await Yn.importCsv(e.value,E,Z);return h.value=A.data,A.data}catch(A){return console.error("Failed to import locations:",A),d.value=A.response?.data?.message||"Failed to import locations. Please try again.",null}finally{i.value=!1}},openImportMarshalsModal:()=>{d.value=null,p.value=null,a.value=!0},closeImportMarshalsModal:()=>{a.value=!1,d.value=null,p.value=null},importMarshals:async E=>{if(!E)return d.value="Please select a CSV file",null;l.value=!0,d.value=null,p.value=null;try{const Z=await _s.importCsv(e.value,E);return p.value=Z.data,Z.data}catch(Z){return console.error("Failed to import marshals:",Z),d.value=Z.response?.data?.message||"Failed to import marshals. Please try again.",null}finally{l.value=!1}},formatImportResultMessage:(E,Z="location")=>{const A=Z==="location"?"location(s)":"marshal(s)";let B=`<p>Created <strong>${E[Z==="location"?"locationsCreated":"marshalsCreated"]}</strong> ${A} and <strong>${E.assignmentsCreated}</strong> assignment(s)</p>`;return E.errors&&E.errors.length>0&&(B+='<br><p><strong>Errors:</strong></p><ul style="margin: 0; padding-left: 1.5rem;">',E.errors.forEach(j=>{B+=`<li>${j}</li>`}),B+="</ul>"),B}}}const Xv="admin-theme-preference",Ya=T(s_());function s_(){return typeof window>"u"?"system":localStorage.getItem(Xv)||"system"}function a_(e){localStorage.setItem(Xv,e)}function Qv(){const e=z(()=>Ya.value==="system"?"light dark":Ya.value),t=(s,i=!0)=>{i&&typeof document<"u"&&(document.documentElement.classList.add("theme-transitioning"),setTimeout(()=>{document.documentElement.classList.remove("theme-transitioning")},1e3)),Ya.value=s,a_(s)},n=()=>{const s=["system","light","dark"],l=(s.indexOf(Ya.value)+1)%s.length;t(s[l])},a=z(()=>Ya.value==="dark"?!0:Ya.value==="light"?!1:typeof window<"u"?window.matchMedia("(prefers-color-scheme: dark)").matches:!1);return{theme:Ya,colorScheme:e,isDark:a,setTheme:t,cycleTheme:n}}const em=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",Gl=e=>{if(!e)return"";const t=new Date(e),n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return`${n}-${a}-${s}T${i}:${l}`},Wr=e=>{if(!e||e.trim()==="")return!0;if(!/^[a-z]{1,20}[./][a-z]{1,20}[./][a-z]{1,20}$/.test(e))return!1;const n=e.includes("."),a=e.includes("/");return n!==a},hi=(e,t,n,a)=>{const i=e*Math.PI/180,l=n*Math.PI/180,u=(n-e)*Math.PI/180,d=(a-t)*Math.PI/180,h=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i)*Math.cos(l)*Math.sin(d/2)*Math.sin(d/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))},i_=e=>!e&&e!==0?"":e<1e3?`${Math.round(e)} m`:`${(e/1e3).toFixed(2)} km`;function nu(e,{areas:t=[],locations:n=[],marshals:a=[]}){if(!e||e.length===0)return e;const s=new Set(t.map(h=>h.id)),i=new Set(n.map(h=>h.id)),l=new Set(a.map(h=>h.id)),u=new Set(["ALL_MARSHALS","ALL_AREAS","ALL_CHECKPOINTS","THIS_CHECKPOINT"]);return e.map(h=>{const p=h.itemType,g=h.ids||[];if(!p||g.length===0)return h;const y=g.filter(b=>u.has(b)?!0:p==="Area"?s.has(b):p==="Checkpoint"?i.has(b):p==="Marshal"?l.has(b):!0);return{...h,ids:y}}).filter(h=>h.itemType?h.ids&&h.ids.length>0:!0)}function tm({scopeConfigurations:e=[],marshalId:t,marshalAssignmentLocationIds:n=[],areaLeadAreaIds:a=[],locationId:s,locationAreaIds:i=[]}){if(!e||e.length===0)return!0;for(const l of e){const u=l.scope||l.Scope,d=l.ids||l.Ids||[];switch(u){case"SpecificPeople":if(d.includes("ALL_MARSHALS")||d.includes(t))return!0;break;case"EveryoneAtCheckpoints":if(d.includes("ALL_CHECKPOINTS")){if(n.length>0)return!0}else if((d.includes("THIS_CHECKPOINT")||d.includes(s))&&n.includes(s)||d.some(p=>n.includes(p)))return!0;break;case"EveryoneInAreas":if(d.includes("ALL_AREAS")){if(n.length>0)return!0}else if(d.some(p=>i.includes(p))&&n.includes(s))return!0;break;case"EveryAreaLead":if(d.includes("ALL_AREAS")){if(a.length>0)return!0}else if(d.some(p=>a.includes(p)))return!0;break}}return!1}function l_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kl={exports:{}};var r_=kl.exports,df;function c_(){return df||(df=1,(function(e,t){(function(n,a){a(t)})(r_,(function(n){var a="1.9.4";function s(o){var c,f,k,$;for(f=1,k=arguments.length;f<k;f++){$=arguments[f];for(c in $)o[c]=$[c]}return o}var i=Object.create||(function(){function o(){}return function(c){return o.prototype=c,new o}})();function l(o,c){var f=Array.prototype.slice;if(o.bind)return o.bind.apply(o,f.call(arguments,1));var k=f.call(arguments,2);return function(){return o.apply(c,k.length?k.concat(f.call(arguments)):arguments)}}var u=0;function d(o){return"_leaflet_id"in o||(o._leaflet_id=++u),o._leaflet_id}function h(o,c,f){var k,$,V,oe;return oe=function(){k=!1,$&&(V.apply(f,$),$=!1)},V=function(){k?$=arguments:(o.apply(f,arguments),setTimeout(oe,c),k=!0)},V}function p(o,c,f){var k=c[1],$=c[0],V=k-$;return o===k&&f?o:((o-$)%V+V)%V+$}function g(){return!1}function y(o,c){if(c===!1)return o;var f=Math.pow(10,c===void 0?6:c);return Math.round(o*f)/f}function b(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function C(o){return b(o).split(/\s+/)}function I(o,c){Object.prototype.hasOwnProperty.call(o,"options")||(o.options=o.options?i(o.options):{});for(var f in c)o.options[f]=c[f];return o.options}function M(o,c,f){var k=[];for(var $ in o)k.push(encodeURIComponent(f?$.toUpperCase():$)+"="+encodeURIComponent(o[$]));return(!c||c.indexOf("?")===-1?"?":"&")+k.join("&")}var x=/\{ *([\w_ -]+) *\}/g;function S(o,c){return o.replace(x,function(f,k){var $=c[k];if($===void 0)throw new Error("No value provided for variable "+f);return typeof $=="function"&&($=$(c)),$})}var _=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function D(o,c){for(var f=0;f<o.length;f++)if(o[f]===c)return f;return-1}var E="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Z(o){return window["webkit"+o]||window["moz"+o]||window["ms"+o]}var A=0;function N(o){var c=+new Date,f=Math.max(0,16-(c-A));return A=c+f,window.setTimeout(o,f)}var B=window.requestAnimationFrame||Z("RequestAnimationFrame")||N,j=window.cancelAnimationFrame||Z("CancelAnimationFrame")||Z("CancelRequestAnimationFrame")||function(o){window.clearTimeout(o)};function R(o,c,f){if(f&&B===N)o.call(c);else return B.call(window,l(o,c))}function G(o){o&&j.call(window,o)}var ee={__proto__:null,extend:s,create:i,bind:l,get lastId(){return u},stamp:d,throttle:h,wrapNum:p,falseFn:g,formatNum:y,trim:b,splitWords:C,setOptions:I,getParamString:M,template:S,isArray:_,indexOf:D,emptyImageUrl:E,requestFn:B,cancelFn:j,requestAnimFrame:R,cancelAnimFrame:G};function ne(){}ne.extend=function(o){var c=function(){I(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},f=c.__super__=this.prototype,k=i(f);k.constructor=c,c.prototype=k;for(var $ in this)Object.prototype.hasOwnProperty.call(this,$)&&$!=="prototype"&&$!=="__super__"&&(c[$]=this[$]);return o.statics&&s(c,o.statics),o.includes&&(Ae(o.includes),s.apply(null,[k].concat(o.includes))),s(k,o),delete k.statics,delete k.includes,k.options&&(k.options=f.options?i(f.options):{},s(k.options,o.options)),k._initHooks=[],k.callInitHooks=function(){if(!this._initHooksCalled){f.callInitHooks&&f.callInitHooks.call(this),this._initHooksCalled=!0;for(var V=0,oe=k._initHooks.length;V<oe;V++)k._initHooks[V].call(this)}},c},ne.include=function(o){var c=this.prototype.options;return s(this.prototype,o),o.options&&(this.prototype.options=c,this.mergeOptions(o.options)),this},ne.mergeOptions=function(o){return s(this.prototype.options,o),this},ne.addInitHook=function(o){var c=Array.prototype.slice.call(arguments,1),f=typeof o=="function"?o:function(){this[o].apply(this,c)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(f),this};function Ae(o){if(!(typeof L>"u"||!L||!L.Mixin)){o=_(o)?o:[o];for(var c=0;c<o.length;c++)o[c]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var J={on:function(o,c,f){if(typeof o=="object")for(var k in o)this._on(k,o[k],c);else{o=C(o);for(var $=0,V=o.length;$<V;$++)this._on(o[$],c,f)}return this},off:function(o,c,f){if(!arguments.length)delete this._events;else if(typeof o=="object")for(var k in o)this._off(k,o[k],c);else{o=C(o);for(var $=arguments.length===1,V=0,oe=o.length;V<oe;V++)$?this._off(o[V]):this._off(o[V],c,f)}return this},_on:function(o,c,f,k){if(typeof c!="function"){console.warn("wrong listener type: "+typeof c);return}if(this._listens(o,c,f)===!1){f===this&&(f=void 0);var $={fn:c,ctx:f};k&&($.once=!0),this._events=this._events||{},this._events[o]=this._events[o]||[],this._events[o].push($)}},_off:function(o,c,f){var k,$,V;if(this._events&&(k=this._events[o],!!k)){if(arguments.length===1){if(this._firingCount)for($=0,V=k.length;$<V;$++)k[$].fn=g;delete this._events[o];return}if(typeof c!="function"){console.warn("wrong listener type: "+typeof c);return}var oe=this._listens(o,c,f);if(oe!==!1){var we=k[oe];this._firingCount&&(we.fn=g,this._events[o]=k=k.slice()),k.splice(oe,1)}}},fire:function(o,c,f){if(!this.listens(o,f))return this;var k=s({},c,{type:o,target:this,sourceTarget:c&&c.sourceTarget||this});if(this._events){var $=this._events[o];if($){this._firingCount=this._firingCount+1||1;for(var V=0,oe=$.length;V<oe;V++){var we=$[V],Ee=we.fn;we.once&&this.off(o,Ee,we.ctx),Ee.call(we.ctx||this,k)}this._firingCount--}}return f&&this._propagateEvent(k),this},listens:function(o,c,f,k){typeof o!="string"&&console.warn('"string" type argument expected');var $=c;typeof c!="function"&&(k=!!c,$=void 0,f=void 0);var V=this._events&&this._events[o];if(V&&V.length&&this._listens(o,$,f)!==!1)return!0;if(k){for(var oe in this._eventParents)if(this._eventParents[oe].listens(o,c,f,k))return!0}return!1},_listens:function(o,c,f){if(!this._events)return!1;var k=this._events[o]||[];if(!c)return!!k.length;f===this&&(f=void 0);for(var $=0,V=k.length;$<V;$++)if(k[$].fn===c&&k[$].ctx===f)return $;return!1},once:function(o,c,f){if(typeof o=="object")for(var k in o)this._on(k,o[k],c,!0);else{o=C(o);for(var $=0,V=o.length;$<V;$++)this._on(o[$],c,f,!0)}return this},addEventParent:function(o){return this._eventParents=this._eventParents||{},this._eventParents[d(o)]=o,this},removeEventParent:function(o){return this._eventParents&&delete this._eventParents[d(o)],this},_propagateEvent:function(o){for(var c in this._eventParents)this._eventParents[c].fire(o.type,s({layer:o.target,propagatedFrom:o.target},o),!0)}};J.addEventListener=J.on,J.removeEventListener=J.clearAllEventListeners=J.off,J.addOneTimeEventListener=J.once,J.fireEvent=J.fire,J.hasEventListeners=J.listens;var te=ne.extend(J);function U(o,c,f){this.x=f?Math.round(o):o,this.y=f?Math.round(c):c}var X=Math.trunc||function(o){return o>0?Math.floor(o):Math.ceil(o)};U.prototype={clone:function(){return new U(this.x,this.y)},add:function(o){return this.clone()._add(re(o))},_add:function(o){return this.x+=o.x,this.y+=o.y,this},subtract:function(o){return this.clone()._subtract(re(o))},_subtract:function(o){return this.x-=o.x,this.y-=o.y,this},divideBy:function(o){return this.clone()._divideBy(o)},_divideBy:function(o){return this.x/=o,this.y/=o,this},multiplyBy:function(o){return this.clone()._multiplyBy(o)},_multiplyBy:function(o){return this.x*=o,this.y*=o,this},scaleBy:function(o){return new U(this.x*o.x,this.y*o.y)},unscaleBy:function(o){return new U(this.x/o.x,this.y/o.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=X(this.x),this.y=X(this.y),this},distanceTo:function(o){o=re(o);var c=o.x-this.x,f=o.y-this.y;return Math.sqrt(c*c+f*f)},equals:function(o){return o=re(o),o.x===this.x&&o.y===this.y},contains:function(o){return o=re(o),Math.abs(o.x)<=Math.abs(this.x)&&Math.abs(o.y)<=Math.abs(this.y)},toString:function(){return"Point("+y(this.x)+", "+y(this.y)+")"}};function re(o,c,f){return o instanceof U?o:_(o)?new U(o[0],o[1]):o==null?o:typeof o=="object"&&"x"in o&&"y"in o?new U(o.x,o.y):new U(o,c,f)}function ke(o,c){if(o)for(var f=c?[o,c]:o,k=0,$=f.length;k<$;k++)this.extend(f[k])}ke.prototype={extend:function(o){var c,f;if(!o)return this;if(o instanceof U||typeof o[0]=="number"||"x"in o)c=f=re(o);else if(o=Re(o),c=o.min,f=o.max,!c||!f)return this;return!this.min&&!this.max?(this.min=c.clone(),this.max=f.clone()):(this.min.x=Math.min(c.x,this.min.x),this.max.x=Math.max(f.x,this.max.x),this.min.y=Math.min(c.y,this.min.y),this.max.y=Math.max(f.y,this.max.y)),this},getCenter:function(o){return re((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,o)},getBottomLeft:function(){return re(this.min.x,this.max.y)},getTopRight:function(){return re(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(o){var c,f;return typeof o[0]=="number"||o instanceof U?o=re(o):o=Re(o),o instanceof ke?(c=o.min,f=o.max):c=f=o,c.x>=this.min.x&&f.x<=this.max.x&&c.y>=this.min.y&&f.y<=this.max.y},intersects:function(o){o=Re(o);var c=this.min,f=this.max,k=o.min,$=o.max,V=$.x>=c.x&&k.x<=f.x,oe=$.y>=c.y&&k.y<=f.y;return V&&oe},overlaps:function(o){o=Re(o);var c=this.min,f=this.max,k=o.min,$=o.max,V=$.x>c.x&&k.x<f.x,oe=$.y>c.y&&k.y<f.y;return V&&oe},isValid:function(){return!!(this.min&&this.max)},pad:function(o){var c=this.min,f=this.max,k=Math.abs(c.x-f.x)*o,$=Math.abs(c.y-f.y)*o;return Re(re(c.x-k,c.y-$),re(f.x+k,f.y+$))},equals:function(o){return o?(o=Re(o),this.min.equals(o.getTopLeft())&&this.max.equals(o.getBottomRight())):!1}};function Re(o,c){return!o||o instanceof ke?o:new ke(o,c)}function Xe(o,c){if(o)for(var f=c?[o,c]:o,k=0,$=f.length;k<$;k++)this.extend(f[k])}Xe.prototype={extend:function(o){var c=this._southWest,f=this._northEast,k,$;if(o instanceof Ke)k=o,$=o;else if(o instanceof Xe){if(k=o._southWest,$=o._northEast,!k||!$)return this}else return o?this.extend(We(o)||Ne(o)):this;return!c&&!f?(this._southWest=new Ke(k.lat,k.lng),this._northEast=new Ke($.lat,$.lng)):(c.lat=Math.min(k.lat,c.lat),c.lng=Math.min(k.lng,c.lng),f.lat=Math.max($.lat,f.lat),f.lng=Math.max($.lng,f.lng)),this},pad:function(o){var c=this._southWest,f=this._northEast,k=Math.abs(c.lat-f.lat)*o,$=Math.abs(c.lng-f.lng)*o;return new Xe(new Ke(c.lat-k,c.lng-$),new Ke(f.lat+k,f.lng+$))},getCenter:function(){return new Ke((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ke(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ke(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(o){typeof o[0]=="number"||o instanceof Ke||"lat"in o?o=We(o):o=Ne(o);var c=this._southWest,f=this._northEast,k,$;return o instanceof Xe?(k=o.getSouthWest(),$=o.getNorthEast()):k=$=o,k.lat>=c.lat&&$.lat<=f.lat&&k.lng>=c.lng&&$.lng<=f.lng},intersects:function(o){o=Ne(o);var c=this._southWest,f=this._northEast,k=o.getSouthWest(),$=o.getNorthEast(),V=$.lat>=c.lat&&k.lat<=f.lat,oe=$.lng>=c.lng&&k.lng<=f.lng;return V&&oe},overlaps:function(o){o=Ne(o);var c=this._southWest,f=this._northEast,k=o.getSouthWest(),$=o.getNorthEast(),V=$.lat>c.lat&&k.lat<f.lat,oe=$.lng>c.lng&&k.lng<f.lng;return V&&oe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(o,c){return o?(o=Ne(o),this._southWest.equals(o.getSouthWest(),c)&&this._northEast.equals(o.getNorthEast(),c)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ne(o,c){return o instanceof Xe?o:new Xe(o,c)}function Ke(o,c,f){if(isNaN(o)||isNaN(c))throw new Error("Invalid LatLng object: ("+o+", "+c+")");this.lat=+o,this.lng=+c,f!==void 0&&(this.alt=+f)}Ke.prototype={equals:function(o,c){if(!o)return!1;o=We(o);var f=Math.max(Math.abs(this.lat-o.lat),Math.abs(this.lng-o.lng));return f<=(c===void 0?1e-9:c)},toString:function(o){return"LatLng("+y(this.lat,o)+", "+y(this.lng,o)+")"},distanceTo:function(o){return ge.distance(this,We(o))},wrap:function(){return ge.wrapLatLng(this)},toBounds:function(o){var c=180*o/40075017,f=c/Math.cos(Math.PI/180*this.lat);return Ne([this.lat-c,this.lng-f],[this.lat+c,this.lng+f])},clone:function(){return new Ke(this.lat,this.lng,this.alt)}};function We(o,c,f){return o instanceof Ke?o:_(o)&&typeof o[0]!="object"?o.length===3?new Ke(o[0],o[1],o[2]):o.length===2?new Ke(o[0],o[1]):null:o==null?o:typeof o=="object"&&"lat"in o?new Ke(o.lat,"lng"in o?o.lng:o.lon,o.alt):c===void 0?null:new Ke(o,c,f)}var Q={latLngToPoint:function(o,c){var f=this.projection.project(o),k=this.scale(c);return this.transformation._transform(f,k)},pointToLatLng:function(o,c){var f=this.scale(c),k=this.transformation.untransform(o,f);return this.projection.unproject(k)},project:function(o){return this.projection.project(o)},unproject:function(o){return this.projection.unproject(o)},scale:function(o){return 256*Math.pow(2,o)},zoom:function(o){return Math.log(o/256)/Math.LN2},getProjectedBounds:function(o){if(this.infinite)return null;var c=this.projection.bounds,f=this.scale(o),k=this.transformation.transform(c.min,f),$=this.transformation.transform(c.max,f);return new ke(k,$)},infinite:!1,wrapLatLng:function(o){var c=this.wrapLng?p(o.lng,this.wrapLng,!0):o.lng,f=this.wrapLat?p(o.lat,this.wrapLat,!0):o.lat,k=o.alt;return new Ke(f,c,k)},wrapLatLngBounds:function(o){var c=o.getCenter(),f=this.wrapLatLng(c),k=c.lat-f.lat,$=c.lng-f.lng;if(k===0&&$===0)return o;var V=o.getSouthWest(),oe=o.getNorthEast(),we=new Ke(V.lat-k,V.lng-$),Ee=new Ke(oe.lat-k,oe.lng-$);return new Xe(we,Ee)}},ge=s({},Q,{wrapLng:[-180,180],R:6371e3,distance:function(o,c){var f=Math.PI/180,k=o.lat*f,$=c.lat*f,V=Math.sin((c.lat-o.lat)*f/2),oe=Math.sin((c.lng-o.lng)*f/2),we=V*V+Math.cos(k)*Math.cos($)*oe*oe,Ee=2*Math.atan2(Math.sqrt(we),Math.sqrt(1-we));return this.R*Ee}}),Ce=6378137,ve={R:Ce,MAX_LATITUDE:85.0511287798,project:function(o){var c=Math.PI/180,f=this.MAX_LATITUDE,k=Math.max(Math.min(f,o.lat),-f),$=Math.sin(k*c);return new U(this.R*o.lng*c,this.R*Math.log((1+$)/(1-$))/2)},unproject:function(o){var c=180/Math.PI;return new Ke((2*Math.atan(Math.exp(o.y/this.R))-Math.PI/2)*c,o.x*c/this.R)},bounds:(function(){var o=Ce*Math.PI;return new ke([-o,-o],[o,o])})()};function ue(o,c,f,k){if(_(o)){this._a=o[0],this._b=o[1],this._c=o[2],this._d=o[3];return}this._a=o,this._b=c,this._c=f,this._d=k}ue.prototype={transform:function(o,c){return this._transform(o.clone(),c)},_transform:function(o,c){return c=c||1,o.x=c*(this._a*o.x+this._b),o.y=c*(this._c*o.y+this._d),o},untransform:function(o,c){return c=c||1,new U((o.x/c-this._b)/this._a,(o.y/c-this._d)/this._c)}};function F(o,c,f,k){return new ue(o,c,f,k)}var K=s({},ge,{code:"EPSG:3857",projection:ve,transformation:(function(){var o=.5/(Math.PI*ve.R);return F(o,.5,-o,.5)})()}),ae=s({},K,{code:"EPSG:900913"});function $e(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Be(o,c){var f="",k,$,V,oe,we,Ee;for(k=0,V=o.length;k<V;k++){for(we=o[k],$=0,oe=we.length;$<oe;$++)Ee=we[$],f+=($?"L":"M")+Ee.x+" "+Ee.y;f+=c?je.svg?"z":"x":""}return f||"M0 0"}var Oe=document.documentElement.style,Le="ActiveXObject"in window,Y=Le&&!document.addEventListener,he="msLaunchUri"in navigator&&!("documentMode"in document),xe=st("webkit"),Ie=st("android"),be=st("android 2")||st("android 3"),de=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),fe=Ie&&st("Google")&&de<537&&!("AudioNode"in window),q=!!window.opera,W=!he&&st("chrome"),ie=st("gecko")&&!xe&&!q&&!Le,Ue=!W&&st("safari"),et=st("phantom"),dt="OTransition"in Oe,yt=navigator.platform.indexOf("Win")===0,mt=Le&&"transition"in Oe,St="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!be,Ct="MozPerspective"in Oe,Rt=!window.L_DISABLE_3D&&(mt||St||Ct)&&!dt&&!et,Ft=typeof orientation<"u"||st("mobile"),ht=Ft&&xe,on=Ft&&St,dn=!window.PointerEvent&&window.MSPointerEvent,Et=!!(window.PointerEvent||dn),Lt="ontouchstart"in window||!!window.TouchEvent,Qn=!window.L_NO_TOUCH&&(Lt||Et),zn=Ft&&q,eo=Ft&&ie,fo=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ht=(function(){var o=!1;try{var c=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("testPassiveEventSupport",g,c),window.removeEventListener("testPassiveEventSupport",g,c)}catch{}return o})(),ls=(function(){return!!document.createElement("canvas").getContext})(),to=!!(document.createElementNS&&$e("svg").createSVGRect),So=!!to&&(function(){var o=document.createElement("div");return o.innerHTML="<svg/>",(o.firstChild&&o.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),le=!to&&(function(){try{var o=document.createElement("div");o.innerHTML='<v:shape adj="1"/>';var c=o.firstChild;return c.style.behavior="url(#default#VML)",c&&typeof c.adj=="object"}catch{return!1}})(),ce=navigator.platform.indexOf("Mac")===0,ye=navigator.platform.indexOf("Linux")===0;function st(o){return navigator.userAgent.toLowerCase().indexOf(o)>=0}var je={ie:Le,ielt9:Y,edge:he,webkit:xe,android:Ie,android23:be,androidStock:fe,opera:q,chrome:W,gecko:ie,safari:Ue,phantom:et,opera12:dt,win:yt,ie3d:mt,webkit3d:St,gecko3d:Ct,any3d:Rt,mobile:Ft,mobileWebkit:ht,mobileWebkit3d:on,msPointer:dn,pointer:Et,touch:Qn,touchNative:Lt,mobileOpera:zn,mobileGecko:eo,retina:fo,passiveEvents:Ht,canvas:ls,svg:to,vml:le,inlineSvg:So,mac:ce,linux:ye},Tt=je.msPointer?"MSPointerDown":"pointerdown",Wt=je.msPointer?"MSPointerMove":"pointermove",Xt=je.msPointer?"MSPointerUp":"pointerup",No=je.msPointer?"MSPointerCancel":"pointercancel",po={touchstart:Tt,touchmove:Wt,touchend:Xt,touchcancel:No},Fo={touchstart:Io,touchmove:hn,touchend:hn,touchcancel:hn},Hn={},Da=!1;function Cs(o,c,f){return c==="touchstart"&&Qs(),Fo[c]?(f=Fo[c].bind(this,f),o.addEventListener(po[c],f,!1),f):(console.warn("wrong event specified:",c),g)}function Uo(o,c,f){if(!po[c]){console.warn("wrong event specified:",c);return}o.removeEventListener(po[c],f,!1)}function rs(o){Hn[o.pointerId]=o}function Xs(o){Hn[o.pointerId]&&(Hn[o.pointerId]=o)}function Vn(o){delete Hn[o.pointerId]}function Qs(){Da||(document.addEventListener(Tt,rs,!0),document.addEventListener(Wt,Xs,!0),document.addEventListener(Xt,Vn,!0),document.addEventListener(No,Vn,!0),Da=!0)}function hn(o,c){if(c.pointerType!==(c.MSPOINTER_TYPE_MOUSE||"mouse")){c.touches=[];for(var f in Hn)c.touches.push(Hn[f]);c.changedTouches=[c],o(c)}}function Io(o,c){c.MSPOINTER_TYPE_TOUCH&&c.pointerType===c.MSPOINTER_TYPE_TOUCH&&Jt(c),hn(o,c)}function xo(o){var c={},f,k;for(k in o)f=o[k],c[k]=f&&f.bind?f.bind(o):f;return o=c,c.type="dblclick",c.detail=2,c.isTrusted=!1,c._simulated=!0,c}var Ls=200;function vo(o,c){o.addEventListener("dblclick",c);var f=0,k;function $(V){if(V.detail!==1){k=V.detail;return}if(!(V.pointerType==="mouse"||V.sourceCapabilities&&!V.sourceCapabilities.firesTouchEvents)){var oe=aa(V);if(!(oe.some(function(Ee){return Ee instanceof HTMLLabelElement&&Ee.attributes.for})&&!oe.some(function(Ee){return Ee instanceof HTMLInputElement||Ee instanceof HTMLSelectElement}))){var we=Date.now();we-f<=Ls?(k++,k===2&&c(xo(V))):k=1,f=we}}}return o.addEventListener("click",$),{dblclick:c,simDblclick:$}}function mo(o,c){o.removeEventListener("dblclick",c.dblclick),o.removeEventListener("click",c.simDblclick)}var no=cs(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),$o=cs(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),mn=$o==="webkitTransition"||$o==="OTransition"?$o+"End":"transitionend";function go(o){return typeof o=="string"?document.getElementById(o):o}function oo(o,c){var f=o.style[c]||o.currentStyle&&o.currentStyle[c];if((!f||f==="auto")&&document.defaultView){var k=document.defaultView.getComputedStyle(o,null);f=k?k[c]:null}return f==="auto"?null:f}function kt(o,c,f){var k=document.createElement(o);return k.className=c||"",f&&f.appendChild(k),k}function Pt(o){var c=o.parentNode;c&&c.removeChild(o)}function To(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function zo(o){var c=o.parentNode;c&&c.lastChild!==o&&c.appendChild(o)}function yo(o){var c=o.parentNode;c&&c.firstChild!==o&&c.insertBefore(o,c.firstChild)}function ea(o,c){if(o.classList!==void 0)return o.classList.contains(c);var f=Ss(o);return f.length>0&&new RegExp("(^|\\s)"+c+"(\\s|$)").test(f)}function ft(o,c){if(o.classList!==void 0)for(var f=C(c),k=0,$=f.length;k<$;k++)o.classList.add(f[k]);else if(!ea(o,c)){var V=Ss(o);Oa(o,(V?V+" ":"")+c)}}function Vt(o,c){o.classList!==void 0?o.classList.remove(c):Oa(o,b((" "+Ss(o)+" ").replace(" "+c+" "," ")))}function Oa(o,c){o.className.baseVal===void 0?o.className=c:o.className.baseVal=c}function Ss(o){return o.correspondingElement&&(o=o.correspondingElement),o.className.baseVal===void 0?o.className:o.className.baseVal}function $n(o,c){"opacity"in o.style?o.style.opacity=c:"filter"in o.style&&Xi(o,c)}function Xi(o,c){var f=!1,k="DXImageTransform.Microsoft.Alpha";try{f=o.filters.item(k)}catch{if(c===1)return}c=Math.round(c*100),f?(f.Enabled=c!==100,f.Opacity=c):o.style.filter+=" progid:"+k+"(opacity="+c+")"}function cs(o){for(var c=document.documentElement.style,f=0;f<o.length;f++)if(o[f]in c)return o[f];return!1}function Mo(o,c,f){var k=c||new U(0,0);o.style[no]=(je.ie3d?"translate("+k.x+"px,"+k.y+"px)":"translate3d("+k.x+"px,"+k.y+"px,0)")+(f?" scale("+f+")":"")}function Kt(o,c){o._leaflet_pos=c,je.any3d?Mo(o,c):(o.style.left=c.x+"px",o.style.top=c.y+"px")}function Ho(o){return o._leaflet_pos||new U(0,0)}var Vo,Is,Ra;if("onselectstart"in document)Vo=function(){ct(window,"selectstart",Jt)},Is=function(){It(window,"selectstart",Jt)};else{var _n=cs(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Vo=function(){if(_n){var o=document.documentElement.style;Ra=o[_n],o[_n]="none"}},Is=function(){_n&&(document.documentElement.style[_n]=Ra,Ra=void 0)}}function so(){ct(window,"dragstart",Jt)}function Zt(){It(window,"dragstart",Jt)}var wn,ta;function na(o){for(;o.tabIndex===-1;)o=o.parentNode;o.style&&(oa(),wn=o,ta=o.style.outlineStyle,o.style.outlineStyle="none",ct(window,"keydown",oa))}function oa(){wn&&(wn.style.outlineStyle=ta,wn=void 0,ta=void 0,It(window,"keydown",oa))}function pi(o){do o=o.parentNode;while((!o.offsetWidth||!o.offsetHeight)&&o!==document.body);return o}function Tn(o){var c=o.getBoundingClientRect();return{x:c.width/o.offsetWidth||1,y:c.height/o.offsetHeight||1,boundingClientRect:c}}var sa={__proto__:null,TRANSFORM:no,TRANSITION:$o,TRANSITION_END:mn,get:go,getStyle:oo,create:kt,remove:Pt,empty:To,toFront:zo,toBack:yo,hasClass:ea,addClass:ft,removeClass:Vt,setClass:Oa,getClass:Ss,setOpacity:$n,testProp:cs,setTransform:Mo,setPosition:Kt,getPosition:Ho,get disableTextSelection(){return Vo},get enableTextSelection(){return Is},disableImageDrag:so,enableImageDrag:Zt,preventOutline:na,restoreOutline:oa,getSizedParentNode:pi,getScale:Tn};function ct(o,c,f,k){if(c&&typeof c=="object")for(var $ in c)Ao(o,$,c[$],f);else{c=C(c);for(var V=0,oe=c.length;V<oe;V++)Ao(o,c[V],f,k)}return this}var fn="_leaflet_events";function It(o,c,f,k){if(arguments.length===1)us(o),delete o[fn];else if(c&&typeof c=="object")for(var $ in c)ds(o,$,c[$],f);else if(c=C(c),arguments.length===2)us(o,function(we){return D(c,we)!==-1});else for(var V=0,oe=c.length;V<oe;V++)ds(o,c[V],f,k);return this}function us(o,c){for(var f in o[fn]){var k=f.split(/\d/)[0];(!c||c(k))&&ds(o,k,null,null,f)}}var Go={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ao(o,c,f,k){var $=c+d(f)+(k?"_"+d(k):"");if(o[fn]&&o[fn][$])return this;var V=function(we){return f.call(k||o,we||window.event)},oe=V;!je.touchNative&&je.pointer&&c.indexOf("touch")===0?V=Cs(o,c,V):je.touch&&c==="dblclick"?V=vo(o,V):"addEventListener"in o?c==="touchstart"||c==="touchmove"||c==="wheel"||c==="mousewheel"?o.addEventListener(Go[c]||c,V,je.passiveEvents?{passive:!1}:!1):c==="mouseenter"||c==="mouseleave"?(V=function(we){we=we||window.event,Fa(o,we)&&oe(we)},o.addEventListener(Go[c],V,!1)):o.addEventListener(c,oe,!1):o.attachEvent("on"+c,V),o[fn]=o[fn]||{},o[fn][$]=V}function ds(o,c,f,k,$){$=$||c+d(f)+(k?"_"+d(k):"");var V=o[fn]&&o[fn][$];if(!V)return this;!je.touchNative&&je.pointer&&c.indexOf("touch")===0?Uo(o,c,V):je.touch&&c==="dblclick"?mo(o,V):"removeEventListener"in o?o.removeEventListener(Go[c]||c,V,!1):o.detachEvent("on"+c,V),o[fn][$]=null}function Eo(o){return o.stopPropagation?o.stopPropagation():o.originalEvent?o.originalEvent._stopped=!0:o.cancelBubble=!0,this}function Ba(o){return Ao(o,"wheel",Eo),this}function ao(o){return ct(o,"mousedown touchstart dblclick contextmenu",Eo),o._leaflet_disable_click=!0,this}function Jt(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function Mn(o){return Jt(o),Eo(o),this}function aa(o){if(o.composedPath)return o.composedPath();for(var c=[],f=o.target;f;)c.push(f),f=f.parentNode;return c}function xs(o,c){if(!c)return new U(o.clientX,o.clientY);var f=Tn(c),k=f.boundingClientRect;return new U((o.clientX-k.left)/f.x-c.clientLeft,(o.clientY-k.top)/f.y-c.clientTop)}var vi=je.linux&&je.chrome?window.devicePixelRatio:je.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Na(o){return je.edge?o.wheelDeltaY/2:o.deltaY&&o.deltaMode===0?-o.deltaY/vi:o.deltaY&&o.deltaMode===1?-o.deltaY*20:o.deltaY&&o.deltaMode===2?-o.deltaY*60:o.deltaX||o.deltaZ?0:o.wheelDelta?(o.wheelDeltaY||o.wheelDelta)/2:o.detail&&Math.abs(o.detail)<32765?-o.detail*20:o.detail?o.detail/-32765*60:0}function Fa(o,c){var f=c.relatedTarget;if(!f)return!0;try{for(;f&&f!==o;)f=f.parentNode}catch{return!1}return f!==o}var Qi={__proto__:null,on:ct,off:It,stopPropagation:Eo,disableScrollPropagation:Ba,disableClickPropagation:ao,preventDefault:Jt,stop:Mn,getPropagationPath:aa,getMousePosition:xs,getWheelDelta:Na,isExternalTarget:Fa,addListener:ct,removeListener:It},Ua=te.extend({run:function(o,c,f,k){this.stop(),this._el=o,this._inProgress=!0,this._duration=f||.25,this._easeOutPower=1/Math.max(k||.5,.2),this._startPos=Ho(o),this._offset=c.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=R(this._animate,this),this._step()},_step:function(o){var c=+new Date-this._startTime,f=this._duration*1e3;c<f?this._runFrame(this._easeOut(c/f),o):(this._runFrame(1),this._complete())},_runFrame:function(o,c){var f=this._startPos.add(this._offset.multiplyBy(o));c&&f._round(),Kt(this._el,f),this.fire("step")},_complete:function(){G(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(o){return 1-Math.pow(1-o,this._easeOutPower)}}),_t=te.extend({options:{crs:K,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(o,c){c=I(this,c),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(o),this._initLayout(),this._onResize=l(this._onResize,this),this._initEvents(),c.maxBounds&&this.setMaxBounds(c.maxBounds),c.zoom!==void 0&&(this._zoom=this._limitZoom(c.zoom)),c.center&&c.zoom!==void 0&&this.setView(We(c.center),c.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=$o&&je.any3d&&!je.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ct(this._proxy,mn,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(o,c,f){if(c=c===void 0?this._zoom:this._limitZoom(c),o=this._limitCenter(We(o),c,this.options.maxBounds),f=f||{},this._stop(),this._loaded&&!f.reset&&f!==!0){f.animate!==void 0&&(f.zoom=s({animate:f.animate},f.zoom),f.pan=s({animate:f.animate,duration:f.duration},f.pan));var k=this._zoom!==c?this._tryAnimatedZoom&&this._tryAnimatedZoom(o,c,f.zoom):this._tryAnimatedPan(o,f.pan);if(k)return clearTimeout(this._sizeTimer),this}return this._resetView(o,c,f.pan&&f.pan.noMoveStart),this},setZoom:function(o,c){return this._loaded?this.setView(this.getCenter(),o,{zoom:c}):(this._zoom=o,this)},zoomIn:function(o,c){return o=o||(je.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+o,c)},zoomOut:function(o,c){return o=o||(je.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-o,c)},setZoomAround:function(o,c,f){var k=this.getZoomScale(c),$=this.getSize().divideBy(2),V=o instanceof U?o:this.latLngToContainerPoint(o),oe=V.subtract($).multiplyBy(1-1/k),we=this.containerPointToLatLng($.add(oe));return this.setView(we,c,{zoom:f})},_getBoundsCenterZoom:function(o,c){c=c||{},o=o.getBounds?o.getBounds():Ne(o);var f=re(c.paddingTopLeft||c.padding||[0,0]),k=re(c.paddingBottomRight||c.padding||[0,0]),$=this.getBoundsZoom(o,!1,f.add(k));if($=typeof c.maxZoom=="number"?Math.min(c.maxZoom,$):$,$===1/0)return{center:o.getCenter(),zoom:$};var V=k.subtract(f).divideBy(2),oe=this.project(o.getSouthWest(),$),we=this.project(o.getNorthEast(),$),Ee=this.unproject(oe.add(we).divideBy(2).add(V),$);return{center:Ee,zoom:$}},fitBounds:function(o,c){if(o=Ne(o),!o.isValid())throw new Error("Bounds are not valid.");var f=this._getBoundsCenterZoom(o,c);return this.setView(f.center,f.zoom,c)},fitWorld:function(o){return this.fitBounds([[-90,-180],[90,180]],o)},panTo:function(o,c){return this.setView(o,this._zoom,{pan:c})},panBy:function(o,c){if(o=re(o).round(),c=c||{},!o.x&&!o.y)return this.fire("moveend");if(c.animate!==!0&&!this.getSize().contains(o))return this._resetView(this.unproject(this.project(this.getCenter()).add(o)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ua,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),c.noMoveStart||this.fire("movestart"),c.animate!==!1){ft(this._mapPane,"leaflet-pan-anim");var f=this._getMapPanePos().subtract(o).round();this._panAnim.run(this._mapPane,f,c.duration||.25,c.easeLinearity)}else this._rawPanBy(o),this.fire("move").fire("moveend");return this},flyTo:function(o,c,f){if(f=f||{},f.animate===!1||!je.any3d)return this.setView(o,c,f);this._stop();var k=this.project(this.getCenter()),$=this.project(o),V=this.getSize(),oe=this._zoom;o=We(o),c=c===void 0?oe:c;var we=Math.max(V.x,V.y),Ee=we*this.getZoomScale(oe,c),Ve=$.distanceTo(k)||1,ot=1.42,ut=ot*ot;function wt(rn){var dr=rn?-1:1,Sm=rn?Ee:we,Im=Ee*Ee-we*we+dr*ut*ut*Ve*Ve,xm=2*Sm*ut*Ve,Dc=Im/xm,Dd=Math.sqrt(Dc*Dc+1)-Dc,$m=Dd<1e-9?-18:Math.log(Dd);return $m}function Zn(rn){return(Math.exp(rn)-Math.exp(-rn))/2}function yn(rn){return(Math.exp(rn)+Math.exp(-rn))/2}function Do(rn){return Zn(rn)/yn(rn)}var lo=wt(0);function $i(rn){return we*(yn(lo)/yn(lo+ot*rn))}function _m(rn){return we*(yn(lo)*Do(lo+ot*rn)-Zn(lo))/ut}function wm(rn){return 1-Math.pow(1-rn,1.5)}var Cm=Date.now(),Ed=(wt(1)-lo)/ot,Lm=f.duration?1e3*f.duration:1e3*Ed*.8;function Pd(){var rn=(Date.now()-Cm)/Lm,dr=wm(rn)*Ed;rn<=1?(this._flyToFrame=R(Pd,this),this._move(this.unproject(k.add($.subtract(k).multiplyBy(_m(dr)/Ve)),oe),this.getScaleZoom(we/$i(dr),oe),{flyTo:!0})):this._move(o,c)._moveEnd(!0)}return this._moveStart(!0,f.noMoveStart),Pd.call(this),this},flyToBounds:function(o,c){var f=this._getBoundsCenterZoom(o,c);return this.flyTo(f.center,f.zoom,c)},setMaxBounds:function(o){return o=Ne(o),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),o.isValid()?(this.options.maxBounds=o,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(o){var c=this.options.minZoom;return this.options.minZoom=o,this._loaded&&c!==o&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(o):this},setMaxZoom:function(o){var c=this.options.maxZoom;return this.options.maxZoom=o,this._loaded&&c!==o&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(o):this},panInsideBounds:function(o,c){this._enforcingBounds=!0;var f=this.getCenter(),k=this._limitCenter(f,this._zoom,Ne(o));return f.equals(k)||this.panTo(k,c),this._enforcingBounds=!1,this},panInside:function(o,c){c=c||{};var f=re(c.paddingTopLeft||c.padding||[0,0]),k=re(c.paddingBottomRight||c.padding||[0,0]),$=this.project(this.getCenter()),V=this.project(o),oe=this.getPixelBounds(),we=Re([oe.min.add(f),oe.max.subtract(k)]),Ee=we.getSize();if(!we.contains(V)){this._enforcingBounds=!0;var Ve=V.subtract(we.getCenter()),ot=we.extend(V).getSize().subtract(Ee);$.x+=Ve.x<0?-ot.x:ot.x,$.y+=Ve.y<0?-ot.y:ot.y,this.panTo(this.unproject($),c),this._enforcingBounds=!1}return this},invalidateSize:function(o){if(!this._loaded)return this;o=s({animate:!1,pan:!0},o===!0?{animate:!0}:o);var c=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var f=this.getSize(),k=c.divideBy(2).round(),$=f.divideBy(2).round(),V=k.subtract($);return!V.x&&!V.y?this:(o.animate&&o.pan?this.panBy(V):(o.pan&&this._rawPanBy(V),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(l(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:c,newSize:f}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(o){if(o=this._locateOptions=s({timeout:1e4,watch:!1},o),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var c=l(this._handleGeolocationResponse,this),f=l(this._handleGeolocationError,this);return o.watch?this._locationWatchId=navigator.geolocation.watchPosition(c,f,o):navigator.geolocation.getCurrentPosition(c,f,o),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(o){if(this._container._leaflet_id){var c=o.code,f=o.message||(c===1?"permission denied":c===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:c,message:"Geolocation error: "+f+"."})}},_handleGeolocationResponse:function(o){if(this._container._leaflet_id){var c=o.coords.latitude,f=o.coords.longitude,k=new Ke(c,f),$=k.toBounds(o.coords.accuracy*2),V=this._locateOptions;if(V.setView){var oe=this.getBoundsZoom($);this.setView(k,V.maxZoom?Math.min(oe,V.maxZoom):oe)}var we={latlng:k,bounds:$,timestamp:o.timestamp};for(var Ee in o.coords)typeof o.coords[Ee]=="number"&&(we[Ee]=o.coords[Ee]);this.fire("locationfound",we)}},addHandler:function(o,c){if(!c)return this;var f=this[o]=new c(this);return this._handlers.push(f),this.options[o]&&f.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Pt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(G(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var o;for(o in this._layers)this._layers[o].remove();for(o in this._panes)Pt(this._panes[o]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(o,c){var f="leaflet-pane"+(o?" leaflet-"+o.replace("Pane","")+"-pane":""),k=kt("div",f,c||this._mapPane);return o&&(this._panes[o]=k),k},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var o=this.getPixelBounds(),c=this.unproject(o.getBottomLeft()),f=this.unproject(o.getTopRight());return new Xe(c,f)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(o,c,f){o=Ne(o),f=re(f||[0,0]);var k=this.getZoom()||0,$=this.getMinZoom(),V=this.getMaxZoom(),oe=o.getNorthWest(),we=o.getSouthEast(),Ee=this.getSize().subtract(f),Ve=Re(this.project(we,k),this.project(oe,k)).getSize(),ot=je.any3d?this.options.zoomSnap:1,ut=Ee.x/Ve.x,wt=Ee.y/Ve.y,Zn=c?Math.max(ut,wt):Math.min(ut,wt);return k=this.getScaleZoom(Zn,k),ot&&(k=Math.round(k/(ot/100))*(ot/100),k=c?Math.ceil(k/ot)*ot:Math.floor(k/ot)*ot),Math.max($,Math.min(V,k))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new U(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(o,c){var f=this._getTopLeftPoint(o,c);return new ke(f,f.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(o){return this.options.crs.getProjectedBounds(o===void 0?this.getZoom():o)},getPane:function(o){return typeof o=="string"?this._panes[o]:o},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(o,c){var f=this.options.crs;return c=c===void 0?this._zoom:c,f.scale(o)/f.scale(c)},getScaleZoom:function(o,c){var f=this.options.crs;c=c===void 0?this._zoom:c;var k=f.zoom(o*f.scale(c));return isNaN(k)?1/0:k},project:function(o,c){return c=c===void 0?this._zoom:c,this.options.crs.latLngToPoint(We(o),c)},unproject:function(o,c){return c=c===void 0?this._zoom:c,this.options.crs.pointToLatLng(re(o),c)},layerPointToLatLng:function(o){var c=re(o).add(this.getPixelOrigin());return this.unproject(c)},latLngToLayerPoint:function(o){var c=this.project(We(o))._round();return c._subtract(this.getPixelOrigin())},wrapLatLng:function(o){return this.options.crs.wrapLatLng(We(o))},wrapLatLngBounds:function(o){return this.options.crs.wrapLatLngBounds(Ne(o))},distance:function(o,c){return this.options.crs.distance(We(o),We(c))},containerPointToLayerPoint:function(o){return re(o).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(o){return re(o).add(this._getMapPanePos())},containerPointToLatLng:function(o){var c=this.containerPointToLayerPoint(re(o));return this.layerPointToLatLng(c)},latLngToContainerPoint:function(o){return this.layerPointToContainerPoint(this.latLngToLayerPoint(We(o)))},mouseEventToContainerPoint:function(o){return xs(o,this._container)},mouseEventToLayerPoint:function(o){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(o))},mouseEventToLatLng:function(o){return this.layerPointToLatLng(this.mouseEventToLayerPoint(o))},_initContainer:function(o){var c=this._container=go(o);if(c){if(c._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ct(c,"scroll",this._onScroll,this),this._containerId=d(c)},_initLayout:function(){var o=this._container;this._fadeAnimated=this.options.fadeAnimation&&je.any3d,ft(o,"leaflet-container"+(je.touch?" leaflet-touch":"")+(je.retina?" leaflet-retina":"")+(je.ielt9?" leaflet-oldie":"")+(je.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var c=oo(o,"position");c!=="absolute"&&c!=="relative"&&c!=="fixed"&&c!=="sticky"&&(o.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var o=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Kt(this._mapPane,new U(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ft(o.markerPane,"leaflet-zoom-hide"),ft(o.shadowPane,"leaflet-zoom-hide"))},_resetView:function(o,c,f){Kt(this._mapPane,new U(0,0));var k=!this._loaded;this._loaded=!0,c=this._limitZoom(c),this.fire("viewprereset");var $=this._zoom!==c;this._moveStart($,f)._move(o,c)._moveEnd($),this.fire("viewreset"),k&&this.fire("load")},_moveStart:function(o,c){return o&&this.fire("zoomstart"),c||this.fire("movestart"),this},_move:function(o,c,f,k){c===void 0&&(c=this._zoom);var $=this._zoom!==c;return this._zoom=c,this._lastCenter=o,this._pixelOrigin=this._getNewPixelOrigin(o),k?f&&f.pinch&&this.fire("zoom",f):(($||f&&f.pinch)&&this.fire("zoom",f),this.fire("move",f)),this},_moveEnd:function(o){return o&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return G(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(o){Kt(this._mapPane,this._getMapPanePos().subtract(o))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(o){this._targets={},this._targets[d(this._container)]=this;var c=o?It:ct;c(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&c(window,"resize",this._onResize,this),je.any3d&&this.options.transform3DLimit&&(o?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){G(this._resizeRequest),this._resizeRequest=R(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var o=this._getMapPanePos();Math.max(Math.abs(o.x),Math.abs(o.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(o,c){for(var f=[],k,$=c==="mouseout"||c==="mouseover",V=o.target||o.srcElement,oe=!1;V;){if(k=this._targets[d(V)],k&&(c==="click"||c==="preclick")&&this._draggableMoved(k)){oe=!0;break}if(k&&k.listens(c,!0)&&($&&!Fa(V,o)||(f.push(k),$))||V===this._container)break;V=V.parentNode}return!f.length&&!oe&&!$&&this.listens(c,!0)&&(f=[this]),f},_isClickDisabled:function(o){for(;o&&o!==this._container;){if(o._leaflet_disable_click)return!0;o=o.parentNode}},_handleDOMEvent:function(o){var c=o.target||o.srcElement;if(!(!this._loaded||c._leaflet_disable_events||o.type==="click"&&this._isClickDisabled(c))){var f=o.type;f==="mousedown"&&na(c),this._fireDOMEvent(o,f)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(o,c,f){if(o.type==="click"){var k=s({},o);k.type="preclick",this._fireDOMEvent(k,k.type,f)}var $=this._findEventTargets(o,c);if(f){for(var V=[],oe=0;oe<f.length;oe++)f[oe].listens(c,!0)&&V.push(f[oe]);$=V.concat($)}if($.length){c==="contextmenu"&&Jt(o);var we=$[0],Ee={originalEvent:o};if(o.type!=="keypress"&&o.type!=="keydown"&&o.type!=="keyup"){var Ve=we.getLatLng&&(!we._radius||we._radius<=10);Ee.containerPoint=Ve?this.latLngToContainerPoint(we.getLatLng()):this.mouseEventToContainerPoint(o),Ee.layerPoint=this.containerPointToLayerPoint(Ee.containerPoint),Ee.latlng=Ve?we.getLatLng():this.layerPointToLatLng(Ee.layerPoint)}for(oe=0;oe<$.length;oe++)if($[oe].fire(c,Ee,!0),Ee.originalEvent._stopped||$[oe].options.bubblingMouseEvents===!1&&D(this._mouseEvents,c)!==-1)return}},_draggableMoved:function(o){return o=o.dragging&&o.dragging.enabled()?o:this,o.dragging&&o.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var o=0,c=this._handlers.length;o<c;o++)this._handlers[o].disable()},whenReady:function(o,c){return this._loaded?o.call(c||this,{target:this}):this.on("load",o,c),this},_getMapPanePos:function(){return Ho(this._mapPane)||new U(0,0)},_moved:function(){var o=this._getMapPanePos();return o&&!o.equals([0,0])},_getTopLeftPoint:function(o,c){var f=o&&c!==void 0?this._getNewPixelOrigin(o,c):this.getPixelOrigin();return f.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(o,c){var f=this.getSize()._divideBy(2);return this.project(o,c)._subtract(f)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(o,c,f){var k=this._getNewPixelOrigin(f,c);return this.project(o,c)._subtract(k)},_latLngBoundsToNewLayerBounds:function(o,c,f){var k=this._getNewPixelOrigin(f,c);return Re([this.project(o.getSouthWest(),c)._subtract(k),this.project(o.getNorthWest(),c)._subtract(k),this.project(o.getSouthEast(),c)._subtract(k),this.project(o.getNorthEast(),c)._subtract(k)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(o){return this.latLngToLayerPoint(o).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,c,f){if(!f)return o;var k=this.project(o,c),$=this.getSize().divideBy(2),V=new ke(k.subtract($),k.add($)),oe=this._getBoundsOffset(V,f,c);return Math.abs(oe.x)<=1&&Math.abs(oe.y)<=1?o:this.unproject(k.add(oe),c)},_limitOffset:function(o,c){if(!c)return o;var f=this.getPixelBounds(),k=new ke(f.min.add(o),f.max.add(o));return o.add(this._getBoundsOffset(k,c))},_getBoundsOffset:function(o,c,f){var k=Re(this.project(c.getNorthEast(),f),this.project(c.getSouthWest(),f)),$=k.min.subtract(o.min),V=k.max.subtract(o.max),oe=this._rebound($.x,-V.x),we=this._rebound($.y,-V.y);return new U(oe,we)},_rebound:function(o,c){return o+c>0?Math.round(o-c)/2:Math.max(0,Math.ceil(o))-Math.max(0,Math.floor(c))},_limitZoom:function(o){var c=this.getMinZoom(),f=this.getMaxZoom(),k=je.any3d?this.options.zoomSnap:1;return k&&(o=Math.round(o/k)*k),Math.max(c,Math.min(f,o))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Vt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(o,c){var f=this._getCenterOffset(o)._trunc();return(c&&c.animate)!==!0&&!this.getSize().contains(f)?!1:(this.panBy(f,c),!0)},_createAnimProxy:function(){var o=this._proxy=kt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(o),this.on("zoomanim",function(c){var f=no,k=this._proxy.style[f];Mo(this._proxy,this.project(c.center,c.zoom),this.getZoomScale(c.zoom,1)),k===this._proxy.style[f]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Pt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var o=this.getCenter(),c=this.getZoom();Mo(this._proxy,this.project(o,c),this.getZoomScale(c,1))},_catchTransitionEnd:function(o){this._animatingZoom&&o.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(o,c,f){if(this._animatingZoom)return!0;if(f=f||{},!this._zoomAnimated||f.animate===!1||this._nothingToAnimate()||Math.abs(c-this._zoom)>this.options.zoomAnimationThreshold)return!1;var k=this.getZoomScale(c),$=this._getCenterOffset(o)._divideBy(1-1/k);return f.animate!==!0&&!this.getSize().contains($)?!1:(R(function(){this._moveStart(!0,f.noMoveStart||!1)._animateZoom(o,c,!0)},this),!0)},_animateZoom:function(o,c,f,k){this._mapPane&&(f&&(this._animatingZoom=!0,this._animateToCenter=o,this._animateToZoom=c,ft(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:o,zoom:c,noUpdate:k}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(l(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Vt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function el(o,c){return new _t(o,c)}var Cn=ne.extend({options:{position:"topright"},initialize:function(o){I(this,o)},getPosition:function(){return this.options.position},setPosition:function(o){var c=this._map;return c&&c.removeControl(this),this.options.position=o,c&&c.addControl(this),this},getContainer:function(){return this._container},addTo:function(o){this.remove(),this._map=o;var c=this._container=this.onAdd(o),f=this.getPosition(),k=o._controlCorners[f];return ft(c,"leaflet-control"),f.indexOf("bottom")!==-1?k.insertBefore(c,k.firstChild):k.appendChild(c),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Pt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(o){this._map&&o&&o.screenX>0&&o.screenY>0&&this._map.getContainer().focus()}}),hs=function(o){return new Cn(o)};_t.include({addControl:function(o){return o.addTo(this),this},removeControl:function(o){return o.remove(),this},_initControlPos:function(){var o=this._controlCorners={},c="leaflet-",f=this._controlContainer=kt("div",c+"control-container",this._container);function k($,V){var oe=c+$+" "+c+V;o[$+V]=kt("div",oe,f)}k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right")},_clearControlPos:function(){for(var o in this._controlCorners)Pt(this._controlCorners[o]);Pt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var za=Cn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(o,c,f,k){return f<k?-1:k<f?1:0}},initialize:function(o,c,f){I(this,f),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var k in o)this._addLayer(o[k],k);for(k in c)this._addLayer(c[k],k,!0)},onAdd:function(o){this._initLayout(),this._update(),this._map=o,o.on("zoomend",this._checkDisabledLayers,this);for(var c=0;c<this._layers.length;c++)this._layers[c].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(o){return Cn.prototype.addTo.call(this,o),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(o,c){return this._addLayer(o,c),this._map?this._update():this},addOverlay:function(o,c){return this._addLayer(o,c,!0),this._map?this._update():this},removeLayer:function(o){o.off("add remove",this._onLayerChange,this);var c=this._getLayer(d(o));return c&&this._layers.splice(this._layers.indexOf(c),1),this._map?this._update():this},expand:function(){ft(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var o=this._map.getSize().y-(this._container.offsetTop+50);return o<this._section.clientHeight?(ft(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=o+"px"):Vt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Vt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var o="leaflet-control-layers",c=this._container=kt("div",o),f=this.options.collapsed;c.setAttribute("aria-haspopup",!0),ao(c),Ba(c);var k=this._section=kt("section",o+"-list");f&&(this._map.on("click",this.collapse,this),ct(c,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var $=this._layersLink=kt("a",o+"-toggle",c);$.href="#",$.title="Layers",$.setAttribute("role","button"),ct($,{keydown:function(V){V.keyCode===13&&this._expandSafely()},click:function(V){Jt(V),this._expandSafely()}},this),f||this.expand(),this._baseLayersList=kt("div",o+"-base",k),this._separator=kt("div",o+"-separator",k),this._overlaysList=kt("div",o+"-overlays",k),c.appendChild(k)},_getLayer:function(o){for(var c=0;c<this._layers.length;c++)if(this._layers[c]&&d(this._layers[c].layer)===o)return this._layers[c]},_addLayer:function(o,c,f){this._map&&o.on("add remove",this._onLayerChange,this),this._layers.push({layer:o,name:c,overlay:f}),this.options.sortLayers&&this._layers.sort(l(function(k,$){return this.options.sortFunction(k.layer,$.layer,k.name,$.name)},this)),this.options.autoZIndex&&o.setZIndex&&(this._lastZIndex++,o.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;To(this._baseLayersList),To(this._overlaysList),this._layerControlInputs=[];var o,c,f,k,$=0;for(f=0;f<this._layers.length;f++)k=this._layers[f],this._addItem(k),c=c||k.overlay,o=o||!k.overlay,$+=k.overlay?0:1;return this.options.hideSingleBase&&(o=o&&$>1,this._baseLayersList.style.display=o?"":"none"),this._separator.style.display=c&&o?"":"none",this},_onLayerChange:function(o){this._handlingClick||this._update();var c=this._getLayer(d(o.target)),f=c.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;f&&this._map.fire(f,c)},_createRadioElement:function(o,c){var f='<input type="radio" class="leaflet-control-layers-selector" name="'+o+'"'+(c?' checked="checked"':"")+"/>",k=document.createElement("div");return k.innerHTML=f,k.firstChild},_addItem:function(o){var c=document.createElement("label"),f=this._map.hasLayer(o.layer),k;o.overlay?(k=document.createElement("input"),k.type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=f):k=this._createRadioElement("leaflet-base-layers_"+d(this),f),this._layerControlInputs.push(k),k.layerId=d(o.layer),ct(k,"click",this._onInputClick,this);var $=document.createElement("span");$.innerHTML=" "+o.name;var V=document.createElement("span");c.appendChild(V),V.appendChild(k),V.appendChild($);var oe=o.overlay?this._overlaysList:this._baseLayersList;return oe.appendChild(c),this._checkDisabledLayers(),c},_onInputClick:function(){if(!this._preventClick){var o=this._layerControlInputs,c,f,k=[],$=[];this._handlingClick=!0;for(var V=o.length-1;V>=0;V--)c=o[V],f=this._getLayer(c.layerId).layer,c.checked?k.push(f):c.checked||$.push(f);for(V=0;V<$.length;V++)this._map.hasLayer($[V])&&this._map.removeLayer($[V]);for(V=0;V<k.length;V++)this._map.hasLayer(k[V])||this._map.addLayer(k[V]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var o=this._layerControlInputs,c,f,k=this._map.getZoom(),$=o.length-1;$>=0;$--)c=o[$],f=this._getLayer(c.layerId).layer,c.disabled=f.options.minZoom!==void 0&&k<f.options.minZoom||f.options.maxZoom!==void 0&&k>f.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var o=this._section;this._preventClick=!0,ct(o,"click",Jt),this.expand();var c=this;setTimeout(function(){It(o,"click",Jt),c._preventClick=!1})}}),tl=function(o,c,f){return new za(o,c,f)},$s=Cn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(o){var c="leaflet-control-zoom",f=kt("div",c+" leaflet-bar"),k=this.options;return this._zoomInButton=this._createButton(k.zoomInText,k.zoomInTitle,c+"-in",f,this._zoomIn),this._zoomOutButton=this._createButton(k.zoomOutText,k.zoomOutTitle,c+"-out",f,this._zoomOut),this._updateDisabled(),o.on("zoomend zoomlevelschange",this._updateDisabled,this),f},onRemove:function(o){o.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(o){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(o.shiftKey?3:1))},_zoomOut:function(o){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(o.shiftKey?3:1))},_createButton:function(o,c,f,k,$){var V=kt("a",f,k);return V.innerHTML=o,V.href="#",V.title=c,V.setAttribute("role","button"),V.setAttribute("aria-label",c),ao(V),ct(V,"click",Mn),ct(V,"click",$,this),ct(V,"click",this._refocusOnMap,this),V},_updateDisabled:function(){var o=this._map,c="leaflet-disabled";Vt(this._zoomInButton,c),Vt(this._zoomOutButton,c),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||o._zoom===o.getMinZoom())&&(ft(this._zoomOutButton,c),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||o._zoom===o.getMaxZoom())&&(ft(this._zoomInButton,c),this._zoomInButton.setAttribute("aria-disabled","true"))}});_t.mergeOptions({zoomControl:!0}),_t.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new $s,this.addControl(this.zoomControl))});var ia=function(o){return new $s(o)},mi=Cn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(o){var c="leaflet-control-scale",f=kt("div",c),k=this.options;return this._addScales(k,c+"-line",f),o.on(k.updateWhenIdle?"moveend":"move",this._update,this),o.whenReady(this._update,this),f},onRemove:function(o){o.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(o,c,f){o.metric&&(this._mScale=kt("div",c,f)),o.imperial&&(this._iScale=kt("div",c,f))},_update:function(){var o=this._map,c=o.getSize().y/2,f=o.distance(o.containerPointToLatLng([0,c]),o.containerPointToLatLng([this.options.maxWidth,c]));this._updateScales(f)},_updateScales:function(o){this.options.metric&&o&&this._updateMetric(o),this.options.imperial&&o&&this._updateImperial(o)},_updateMetric:function(o){var c=this._getRoundNum(o),f=c<1e3?c+" m":c/1e3+" km";this._updateScale(this._mScale,f,c/o)},_updateImperial:function(o){var c=o*3.2808399,f,k,$;c>5280?(f=c/5280,k=this._getRoundNum(f),this._updateScale(this._iScale,k+" mi",k/f)):($=this._getRoundNum(c),this._updateScale(this._iScale,$+" ft",$/c))},_updateScale:function(o,c,f){o.style.width=Math.round(this.options.maxWidth*f)+"px",o.innerHTML=c},_getRoundNum:function(o){var c=Math.pow(10,(Math.floor(o)+"").length-1),f=o/c;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,c*f}}),nl=function(o){return new mi(o)},ol='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',la=Cn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(je.inlineSvg?ol+" ":"")+"Leaflet</a>"},initialize:function(o){I(this,o),this._attributions={}},onAdd:function(o){o.attributionControl=this,this._container=kt("div","leaflet-control-attribution"),ao(this._container);for(var c in o._layers)o._layers[c].getAttribution&&this.addAttribution(o._layers[c].getAttribution());return this._update(),o.on("layeradd",this._addAttribution,this),this._container},onRemove:function(o){o.off("layeradd",this._addAttribution,this)},_addAttribution:function(o){o.layer.getAttribution&&(this.addAttribution(o.layer.getAttribution()),o.layer.once("remove",function(){this.removeAttribution(o.layer.getAttribution())},this))},setPrefix:function(o){return this.options.prefix=o,this._update(),this},addAttribution:function(o){return o?(this._attributions[o]||(this._attributions[o]=0),this._attributions[o]++,this._update(),this):this},removeAttribution:function(o){return o?(this._attributions[o]&&(this._attributions[o]--,this._update()),this):this},_update:function(){if(this._map){var o=[];for(var c in this._attributions)this._attributions[c]&&o.push(c);var f=[];this.options.prefix&&f.push(this.options.prefix),o.length&&f.push(o.join(", ")),this._container.innerHTML=f.join(' <span aria-hidden="true">|</span> ')}}});_t.mergeOptions({attributionControl:!0}),_t.addInitHook(function(){this.options.attributionControl&&new la().addTo(this)});var gi=function(o){return new la(o)};Cn.Layers=za,Cn.Zoom=$s,Cn.Scale=mi,Cn.Attribution=la,hs.layers=tl,hs.zoom=ia,hs.scale=nl,hs.attribution=gi;var Gn=ne.extend({initialize:function(o){this._map=o},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Gn.addTo=function(o,c){return o.addHandler(c,this),this};var Ha={Events:J},De=je.touch?"touchstart mousedown":"mousedown",Se=te.extend({options:{clickTolerance:3},initialize:function(o,c,f,k){I(this,k),this._element=o,this._dragStartTarget=c||o,this._preventOutline=f},enable:function(){this._enabled||(ct(this._dragStartTarget,De,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Se._dragging===this&&this.finishDrag(!0),It(this._dragStartTarget,De,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(o){if(this._enabled&&(this._moved=!1,!ea(this._element,"leaflet-zoom-anim"))){if(o.touches&&o.touches.length!==1){Se._dragging===this&&this.finishDrag();return}if(!(Se._dragging||o.shiftKey||o.which!==1&&o.button!==1&&!o.touches)&&(Se._dragging=this,this._preventOutline&&na(this._element),so(),Vo(),!this._moving)){this.fire("down");var c=o.touches?o.touches[0]:o,f=pi(this._element);this._startPoint=new U(c.clientX,c.clientY),this._startPos=Ho(this._element),this._parentScale=Tn(f);var k=o.type==="mousedown";ct(document,k?"mousemove":"touchmove",this._onMove,this),ct(document,k?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(o){if(this._enabled){if(o.touches&&o.touches.length>1){this._moved=!0;return}var c=o.touches&&o.touches.length===1?o.touches[0]:o,f=new U(c.clientX,c.clientY)._subtract(this._startPoint);!f.x&&!f.y||Math.abs(f.x)+Math.abs(f.y)<this.options.clickTolerance||(f.x/=this._parentScale.x,f.y/=this._parentScale.y,Jt(o),this._moved||(this.fire("dragstart"),this._moved=!0,ft(document.body,"leaflet-dragging"),this._lastTarget=o.target||o.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ft(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(f),this._moving=!0,this._lastEvent=o,this._updatePosition())}},_updatePosition:function(){var o={originalEvent:this._lastEvent};this.fire("predrag",o),Kt(this._element,this._newPos),this.fire("drag",o)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(o){Vt(document.body,"leaflet-dragging"),this._lastTarget&&(Vt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),It(document,"mousemove touchmove",this._onMove,this),It(document,"mouseup touchend touchcancel",this._onUp,this),Zt(),Is();var c=this._moved&&this._moving;this._moving=!1,Se._dragging=!1,c&&this.fire("dragend",{noInertia:o,distance:this._newPos.distanceTo(this._startPos)})}});function tt(o,c,f){var k,$=[1,4,2,8],V,oe,we,Ee,Ve,ot,ut,wt;for(V=0,ot=o.length;V<ot;V++)o[V]._code=ko(o[V],c);for(we=0;we<4;we++){for(ut=$[we],k=[],V=0,ot=o.length,oe=ot-1;V<ot;oe=V++)Ee=o[V],Ve=o[oe],Ee._code&ut?Ve._code&ut||(wt=En(Ve,Ee,ut,c,f),wt._code=ko(wt,c),k.push(wt)):(Ve._code&ut&&(wt=En(Ve,Ee,ut,c,f),wt._code=ko(wt,c),k.push(wt)),k.push(Ee));o=k}return o}function pt(o,c){var f,k,$,V,oe,we,Ee,Ve,ot;if(!o||o.length===0)throw new Error("latlngs not passed");io(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var ut=We([0,0]),wt=Ne(o),Zn=wt.getNorthWest().distanceTo(wt.getSouthWest())*wt.getNorthEast().distanceTo(wt.getNorthWest());Zn<1700&&(ut=Yt(o));var yn=o.length,Do=[];for(f=0;f<yn;f++){var lo=We(o[f]);Do.push(c.project(We([lo.lat-ut.lat,lo.lng-ut.lng])))}for(we=Ee=Ve=0,f=0,k=yn-1;f<yn;k=f++)$=Do[f],V=Do[k],oe=$.y*V.x-V.y*$.x,Ee+=($.x+V.x)*oe,Ve+=($.y+V.y)*oe,we+=oe*3;we===0?ot=Do[0]:ot=[Ee/we,Ve/we];var $i=c.unproject(re(ot));return We([$i.lat+ut.lat,$i.lng+ut.lng])}function Yt(o){for(var c=0,f=0,k=0,$=0;$<o.length;$++){var V=We(o[$]);c+=V.lat,f+=V.lng,k++}return We([c/k,f/k])}var xt={__proto__:null,clipPolygon:tt,polygonCenter:pt,centroid:Yt};function pn(o,c){if(!c||!o.length)return o.slice();var f=c*c;return o=sn(o,f),o=Ln(o,f),o}function An(o,c,f){return Math.sqrt(ra(o,c,f,!0))}function Ut(o,c,f){return ra(o,c,f)}function Ln(o,c){var f=o.length,k=typeof Uint8Array<"u"?Uint8Array:Array,$=new k(f);$[0]=$[f-1]=1,$t(o,$,c,0,f-1);var V,oe=[];for(V=0;V<f;V++)$[V]&&oe.push(o[V]);return oe}function $t(o,c,f,k,$){var V=0,oe,we,Ee;for(we=k+1;we<=$-1;we++)Ee=ra(o[we],o[k],o[$],!0),Ee>V&&(oe=we,V=Ee);V>f&&(c[oe]=1,$t(o,c,f,k,oe),$t(o,c,f,oe,$))}function sn(o,c){for(var f=[o[0]],k=1,$=0,V=o.length;k<V;k++)sl(o[k],o[$])>c&&(f.push(o[k]),$=k);return $<V-1&&f.push(o[V-1]),f}var jn;function Po(o,c,f,k,$){var V=k?jn:ko(o,f),oe=ko(c,f),we,Ee,Ve;for(jn=oe;;){if(!(V|oe))return[o,c];if(V&oe)return!1;we=V||oe,Ee=En(o,c,we,f,$),Ve=ko(Ee,f),we===V?(o=Ee,V=Ve):(c=Ee,oe=Ve)}}function En(o,c,f,k,$){var V=c.x-o.x,oe=c.y-o.y,we=k.min,Ee=k.max,Ve,ot;return f&8?(Ve=o.x+V*(Ee.y-o.y)/oe,ot=Ee.y):f&4?(Ve=o.x+V*(we.y-o.y)/oe,ot=we.y):f&2?(Ve=Ee.x,ot=o.y+oe*(Ee.x-o.x)/V):f&1&&(Ve=we.x,ot=o.y+oe*(we.x-o.x)/V),new U(Ve,ot,$)}function ko(o,c){var f=0;return o.x<c.min.x?f|=1:o.x>c.max.x&&(f|=2),o.y<c.min.y?f|=4:o.y>c.max.y&&(f|=8),f}function sl(o,c){var f=c.x-o.x,k=c.y-o.y;return f*f+k*k}function ra(o,c,f,k){var $=c.x,V=c.y,oe=f.x-$,we=f.y-V,Ee=oe*oe+we*we,Ve;return Ee>0&&(Ve=((o.x-$)*oe+(o.y-V)*we)/Ee,Ve>1?($=f.x,V=f.y):Ve>0&&($+=oe*Ve,V+=we*Ve)),oe=o.x-$,we=o.y-V,k?oe*oe+we*we:new U($,V)}function io(o){return!_(o[0])||typeof o[0][0]!="object"&&typeof o[0][0]<"u"}function nr(o){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),io(o)}function or(o,c){var f,k,$,V,oe,we,Ee,Ve;if(!o||o.length===0)throw new Error("latlngs not passed");io(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var ot=We([0,0]),ut=Ne(o),wt=ut.getNorthWest().distanceTo(ut.getSouthWest())*ut.getNorthEast().distanceTo(ut.getNorthWest());wt<1700&&(ot=Yt(o));var Zn=o.length,yn=[];for(f=0;f<Zn;f++){var Do=We(o[f]);yn.push(c.project(We([Do.lat-ot.lat,Do.lng-ot.lng])))}for(f=0,k=0;f<Zn-1;f++)k+=yn[f].distanceTo(yn[f+1])/2;if(k===0)Ve=yn[0];else for(f=0,V=0;f<Zn-1;f++)if(oe=yn[f],we=yn[f+1],$=oe.distanceTo(we),V+=$,V>k){Ee=(V-k)/$,Ve=[we.x-Ee*(we.x-oe.x),we.y-Ee*(we.y-oe.y)];break}var lo=c.unproject(re(Ve));return We([lo.lat+ot.lat,lo.lng+ot.lng])}var Ic={__proto__:null,simplify:pn,pointToSegmentDistance:An,closestPointOnSegment:Ut,clipSegment:Po,_getEdgeIntersection:En,_getBitCode:ko,_sqClosestPointOnSegment:ra,isFlat:io,_flat:nr,polylineCenter:or},al={project:function(o){return new U(o.lng,o.lat)},unproject:function(o){return new Ke(o.y,o.x)},bounds:new ke([-180,-90],[180,90])},il={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ke([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(o){var c=Math.PI/180,f=this.R,k=o.lat*c,$=this.R_MINOR/f,V=Math.sqrt(1-$*$),oe=V*Math.sin(k),we=Math.tan(Math.PI/4-k/2)/Math.pow((1-oe)/(1+oe),V/2);return k=-f*Math.log(Math.max(we,1e-10)),new U(o.lng*c*f,k)},unproject:function(o){for(var c=180/Math.PI,f=this.R,k=this.R_MINOR/f,$=Math.sqrt(1-k*k),V=Math.exp(-o.y/f),oe=Math.PI/2-2*Math.atan(V),we=0,Ee=.1,Ve;we<15&&Math.abs(Ee)>1e-7;we++)Ve=$*Math.sin(oe),Ve=Math.pow((1-Ve)/(1+Ve),$/2),Ee=Math.PI/2-2*Math.atan(V*Ve)-oe,oe+=Ee;return new Ke(oe*c,o.x*c/f)}},xc={__proto__:null,LonLat:al,Mercator:il,SphericalMercator:ve},$c=s({},ge,{code:"EPSG:3395",projection:il,transformation:(function(){var o=.5/(Math.PI*il.R);return F(o,.5,-o,.5)})()}),sr=s({},ge,{code:"EPSG:4326",projection:al,transformation:F(1/180,1,-1/180,.5)}),Tc=s({},Q,{projection:al,transformation:F(1,0,-1,0),scale:function(o){return Math.pow(2,o)},zoom:function(o){return Math.log(o)/Math.LN2},distance:function(o,c){var f=c.lng-o.lng,k=c.lat-o.lat;return Math.sqrt(f*f+k*k)},infinite:!0});Q.Earth=ge,Q.EPSG3395=$c,Q.EPSG3857=K,Q.EPSG900913=ae,Q.EPSG4326=sr,Q.Simple=Tc;var bo=te.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(o){return o.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(o){return o&&o.removeLayer(this),this},getPane:function(o){return this._map.getPane(o?this.options[o]||o:this.options.pane)},addInteractiveTarget:function(o){return this._map._targets[d(o)]=this,this},removeInteractiveTarget:function(o){return delete this._map._targets[d(o)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(o){var c=o.target;if(c.hasLayer(this)){if(this._map=c,this._zoomAnimated=c._zoomAnimated,this.getEvents){var f=this.getEvents();c.on(f,this),this.once("remove",function(){c.off(f,this)},this)}this.onAdd(c),this.fire("add"),c.fire("layeradd",{layer:this})}}});_t.include({addLayer:function(o){if(!o._layerAdd)throw new Error("The provided object is not a Layer.");var c=d(o);return this._layers[c]?this:(this._layers[c]=o,o._mapToAdd=this,o.beforeAdd&&o.beforeAdd(this),this.whenReady(o._layerAdd,o),this)},removeLayer:function(o){var c=d(o);return this._layers[c]?(this._loaded&&o.onRemove(this),delete this._layers[c],this._loaded&&(this.fire("layerremove",{layer:o}),o.fire("remove")),o._map=o._mapToAdd=null,this):this},hasLayer:function(o){return d(o)in this._layers},eachLayer:function(o,c){for(var f in this._layers)o.call(c,this._layers[f]);return this},_addLayers:function(o){o=o?_(o)?o:[o]:[];for(var c=0,f=o.length;c<f;c++)this.addLayer(o[c])},_addZoomLimit:function(o){(!isNaN(o.options.maxZoom)||!isNaN(o.options.minZoom))&&(this._zoomBoundLayers[d(o)]=o,this._updateZoomLevels())},_removeZoomLimit:function(o){var c=d(o);this._zoomBoundLayers[c]&&(delete this._zoomBoundLayers[c],this._updateZoomLevels())},_updateZoomLevels:function(){var o=1/0,c=-1/0,f=this._getZoomSpan();for(var k in this._zoomBoundLayers){var $=this._zoomBoundLayers[k].options;o=$.minZoom===void 0?o:Math.min(o,$.minZoom),c=$.maxZoom===void 0?c:Math.max(c,$.maxZoom)}this._layersMaxZoom=c===-1/0?void 0:c,this._layersMinZoom=o===1/0?void 0:o,f!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ca=bo.extend({initialize:function(o,c){I(this,c),this._layers={};var f,k;if(o)for(f=0,k=o.length;f<k;f++)this.addLayer(o[f])},addLayer:function(o){var c=this.getLayerId(o);return this._layers[c]=o,this._map&&this._map.addLayer(o),this},removeLayer:function(o){var c=o in this._layers?o:this.getLayerId(o);return this._map&&this._layers[c]&&this._map.removeLayer(this._layers[c]),delete this._layers[c],this},hasLayer:function(o){var c=typeof o=="number"?o:this.getLayerId(o);return c in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(o){var c=Array.prototype.slice.call(arguments,1),f,k;for(f in this._layers)k=this._layers[f],k[o]&&k[o].apply(k,c);return this},onAdd:function(o){this.eachLayer(o.addLayer,o)},onRemove:function(o){this.eachLayer(o.removeLayer,o)},eachLayer:function(o,c){for(var f in this._layers)o.call(c,this._layers[f]);return this},getLayer:function(o){return this._layers[o]},getLayers:function(){var o=[];return this.eachLayer(o.push,o),o},setZIndex:function(o){return this.invoke("setZIndex",o)},getLayerId:function(o){return d(o)}}),yi=function(o,c){return new ca(o,c)},jo=ca.extend({addLayer:function(o){return this.hasLayer(o)?this:(o.addEventParent(this),ca.prototype.addLayer.call(this,o),this.fire("layeradd",{layer:o}))},removeLayer:function(o){return this.hasLayer(o)?(o in this._layers&&(o=this._layers[o]),o.removeEventParent(this),ca.prototype.removeLayer.call(this,o),this.fire("layerremove",{layer:o})):this},setStyle:function(o){return this.invoke("setStyle",o)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var o=new Xe;for(var c in this._layers){var f=this._layers[c];o.extend(f.getBounds?f.getBounds():f.getLatLng())}return o}}),ki=function(o,c){return new jo(o,c)},ua=ne.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(o){I(this,o)},createIcon:function(o){return this._createIcon("icon",o)},createShadow:function(o){return this._createIcon("shadow",o)},_createIcon:function(o,c){var f=this._getIconUrl(o);if(!f){if(o==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var k=this._createImg(f,c&&c.tagName==="IMG"?c:null);return this._setIconStyles(k,o),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),k},_setIconStyles:function(o,c){var f=this.options,k=f[c+"Size"];typeof k=="number"&&(k=[k,k]);var $=re(k),V=re(c==="shadow"&&f.shadowAnchor||f.iconAnchor||$&&$.divideBy(2,!0));o.className="leaflet-marker-"+c+" "+(f.className||""),V&&(o.style.marginLeft=-V.x+"px",o.style.marginTop=-V.y+"px"),$&&(o.style.width=$.x+"px",o.style.height=$.y+"px")},_createImg:function(o,c){return c=c||document.createElement("img"),c.src=o,c},_getIconUrl:function(o){return je.retina&&this.options[o+"RetinaUrl"]||this.options[o+"Url"]}});function ar(o){return new ua(o)}var Ts=ua.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(o){return typeof Ts.imagePath!="string"&&(Ts.imagePath=this._detectIconPath()),(this.options.imagePath||Ts.imagePath)+ua.prototype._getIconUrl.call(this,o)},_stripUrl:function(o){var c=function(f,k,$){var V=k.exec(f);return V&&V[$]};return o=c(o,/^url\((['"])?(.+)\1\)$/,2),o&&c(o,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var o=kt("div","leaflet-default-icon-path",document.body),c=oo(o,"background-image")||oo(o,"backgroundImage");if(document.body.removeChild(o),c=this._stripUrl(c),c)return c;var f=document.querySelector('link[href$="leaflet.css"]');return f?f.href.substring(0,f.href.length-11-1):""}}),bi=Gn.extend({initialize:function(o){this._marker=o},addHooks:function(){var o=this._marker._icon;this._draggable||(this._draggable=new Se(o,o,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ft(o,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Vt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(o){var c=this._marker,f=c._map,k=this._marker.options.autoPanSpeed,$=this._marker.options.autoPanPadding,V=Ho(c._icon),oe=f.getPixelBounds(),we=f.getPixelOrigin(),Ee=Re(oe.min._subtract(we).add($),oe.max._subtract(we).subtract($));if(!Ee.contains(V)){var Ve=re((Math.max(Ee.max.x,V.x)-Ee.max.x)/(oe.max.x-Ee.max.x)-(Math.min(Ee.min.x,V.x)-Ee.min.x)/(oe.min.x-Ee.min.x),(Math.max(Ee.max.y,V.y)-Ee.max.y)/(oe.max.y-Ee.max.y)-(Math.min(Ee.min.y,V.y)-Ee.min.y)/(oe.min.y-Ee.min.y)).multiplyBy(k);f.panBy(Ve,{animate:!1}),this._draggable._newPos._add(Ve),this._draggable._startPos._add(Ve),Kt(c._icon,this._draggable._newPos),this._onDrag(o),this._panRequest=R(this._adjustPan.bind(this,o))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(o){this._marker.options.autoPan&&(G(this._panRequest),this._panRequest=R(this._adjustPan.bind(this,o)))},_onDrag:function(o){var c=this._marker,f=c._shadow,k=Ho(c._icon),$=c._map.layerPointToLatLng(k);f&&Kt(f,k),c._latlng=$,o.latlng=$,o.oldLatLng=this._oldLatLng,c.fire("move",o).fire("drag",o)},_onDragEnd:function(o){G(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",o)}}),_i=bo.extend({options:{icon:new Ts,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(o,c){I(this,c),this._latlng=We(o)},onAdd:function(o){this._zoomAnimated=this._zoomAnimated&&o.options.markerZoomAnimation,this._zoomAnimated&&o.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(o){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&o.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(o){var c=this._latlng;return this._latlng=We(o),this.update(),this.fire("move",{oldLatLng:c,latlng:this._latlng})},setZIndexOffset:function(o){return this.options.zIndexOffset=o,this.update()},getIcon:function(){return this.options.icon},setIcon:function(o){return this.options.icon=o,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var o=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(o)}return this},_initIcon:function(){var o=this.options,c="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),f=o.icon.createIcon(this._icon),k=!1;f!==this._icon&&(this._icon&&this._removeIcon(),k=!0,o.title&&(f.title=o.title),f.tagName==="IMG"&&(f.alt=o.alt||"")),ft(f,c),o.keyboard&&(f.tabIndex="0",f.setAttribute("role","button")),this._icon=f,o.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ct(f,"focus",this._panOnFocus,this);var $=o.icon.createShadow(this._shadow),V=!1;$!==this._shadow&&(this._removeShadow(),V=!0),$&&(ft($,c),$.alt=""),this._shadow=$,o.opacity<1&&this._updateOpacity(),k&&this.getPane().appendChild(this._icon),this._initInteraction(),$&&V&&this.getPane(o.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&It(this._icon,"focus",this._panOnFocus,this),Pt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Pt(this._shadow),this._shadow=null},_setPos:function(o){this._icon&&Kt(this._icon,o),this._shadow&&Kt(this._shadow,o),this._zIndex=o.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(o){this._icon&&(this._icon.style.zIndex=this._zIndex+o)},_animateZoom:function(o){var c=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center).round();this._setPos(c)},_initInteraction:function(){if(this.options.interactive&&(ft(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),bi)){var o=this.options.draggable;this.dragging&&(o=this.dragging.enabled(),this.dragging.disable()),this.dragging=new bi(this),o&&this.dragging.enable()}},setOpacity:function(o){return this.options.opacity=o,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var o=this.options.opacity;this._icon&&$n(this._icon,o),this._shadow&&$n(this._shadow,o)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var o=this._map;if(o){var c=this.options.icon.options,f=c.iconSize?re(c.iconSize):re(0,0),k=c.iconAnchor?re(c.iconAnchor):re(0,0);o.panInside(this._latlng,{paddingTopLeft:k,paddingBottomRight:f.subtract(k)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Mc(o,c){return new _i(o,c)}var fs=bo.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(o){this._renderer=o.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(o){return I(this,o),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&o&&Object.prototype.hasOwnProperty.call(o,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),wi=fs.extend({options:{fill:!0,radius:10},initialize:function(o,c){I(this,c),this._latlng=We(o),this._radius=this.options.radius},setLatLng:function(o){var c=this._latlng;return this._latlng=We(o),this.redraw(),this.fire("move",{oldLatLng:c,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(o){return this.options.radius=this._radius=o,this.redraw()},getRadius:function(){return this._radius},setStyle:function(o){var c=o&&o.radius||this._radius;return fs.prototype.setStyle.call(this,o),this.setRadius(c),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var o=this._radius,c=this._radiusY||o,f=this._clickTolerance(),k=[o+f,c+f];this._pxBounds=new ke(this._point.subtract(k),this._point.add(k))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(o){return o.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ac(o,c){return new wi(o,c)}var ll=wi.extend({initialize:function(o,c,f){if(typeof c=="number"&&(c=s({},f,{radius:c})),I(this,c),this._latlng=We(o),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(o){return this._mRadius=o,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var o=[this._radius,this._radiusY||this._radius];return new Xe(this._map.layerPointToLatLng(this._point.subtract(o)),this._map.layerPointToLatLng(this._point.add(o)))},setStyle:fs.prototype.setStyle,_project:function(){var o=this._latlng.lng,c=this._latlng.lat,f=this._map,k=f.options.crs;if(k.distance===ge.distance){var $=Math.PI/180,V=this._mRadius/ge.R/$,oe=f.project([c+V,o]),we=f.project([c-V,o]),Ee=oe.add(we).divideBy(2),Ve=f.unproject(Ee).lat,ot=Math.acos((Math.cos(V*$)-Math.sin(c*$)*Math.sin(Ve*$))/(Math.cos(c*$)*Math.cos(Ve*$)))/$;(isNaN(ot)||ot===0)&&(ot=V/Math.cos(Math.PI/180*c)),this._point=Ee.subtract(f.getPixelOrigin()),this._radius=isNaN(ot)?0:Ee.x-f.project([Ve,o-ot]).x,this._radiusY=Ee.y-oe.y}else{var ut=k.unproject(k.project(this._latlng).subtract([this._mRadius,0]));this._point=f.latLngToLayerPoint(this._latlng),this._radius=this._point.x-f.latLngToLayerPoint(ut).x}this._updateBounds()}});function Ec(o,c,f){return new ll(o,c,f)}var Zo=fs.extend({options:{smoothFactor:1,noClip:!1},initialize:function(o,c){I(this,c),this._setLatLngs(o)},getLatLngs:function(){return this._latlngs},setLatLngs:function(o){return this._setLatLngs(o),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(o){for(var c=1/0,f=null,k=ra,$,V,oe=0,we=this._parts.length;oe<we;oe++)for(var Ee=this._parts[oe],Ve=1,ot=Ee.length;Ve<ot;Ve++){$=Ee[Ve-1],V=Ee[Ve];var ut=k(o,$,V,!0);ut<c&&(c=ut,f=k(o,$,V))}return f&&(f.distance=Math.sqrt(c)),f},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return or(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(o,c){return c=c||this._defaultShape(),o=We(o),c.push(o),this._bounds.extend(o),this.redraw()},_setLatLngs:function(o){this._bounds=new Xe,this._latlngs=this._convertLatLngs(o)},_defaultShape:function(){return io(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(o){for(var c=[],f=io(o),k=0,$=o.length;k<$;k++)f?(c[k]=We(o[k]),this._bounds.extend(c[k])):c[k]=this._convertLatLngs(o[k]);return c},_project:function(){var o=new ke;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,o),this._bounds.isValid()&&o.isValid()&&(this._rawPxBounds=o,this._updateBounds())},_updateBounds:function(){var o=this._clickTolerance(),c=new U(o,o);this._rawPxBounds&&(this._pxBounds=new ke([this._rawPxBounds.min.subtract(c),this._rawPxBounds.max.add(c)]))},_projectLatlngs:function(o,c,f){var k=o[0]instanceof Ke,$=o.length,V,oe;if(k){for(oe=[],V=0;V<$;V++)oe[V]=this._map.latLngToLayerPoint(o[V]),f.extend(oe[V]);c.push(oe)}else for(V=0;V<$;V++)this._projectLatlngs(o[V],c,f)},_clipPoints:function(){var o=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}var c=this._parts,f,k,$,V,oe,we,Ee;for(f=0,$=0,V=this._rings.length;f<V;f++)for(Ee=this._rings[f],k=0,oe=Ee.length;k<oe-1;k++)we=Po(Ee[k],Ee[k+1],o,k,!0),we&&(c[$]=c[$]||[],c[$].push(we[0]),(we[1]!==Ee[k+1]||k===oe-2)&&(c[$].push(we[1]),$++))}},_simplifyPoints:function(){for(var o=this._parts,c=this.options.smoothFactor,f=0,k=o.length;f<k;f++)o[f]=pn(o[f],c)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(o,c){var f,k,$,V,oe,we,Ee=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(f=0,V=this._parts.length;f<V;f++)for(we=this._parts[f],k=0,oe=we.length,$=oe-1;k<oe;$=k++)if(!(!c&&k===0)&&An(o,we[$],we[k])<=Ee)return!0;return!1}});function Pc(o,c){return new Zo(o,c)}Zo._flat=nr;var da=Zo.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return pt(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(o){var c=Zo.prototype._convertLatLngs.call(this,o),f=c.length;return f>=2&&c[0]instanceof Ke&&c[0].equals(c[f-1])&&c.pop(),c},_setLatLngs:function(o){Zo.prototype._setLatLngs.call(this,o),io(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return io(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,c=this.options.weight,f=new U(c,c);if(o=new ke(o.min.subtract(f),o.max.add(f)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}for(var k=0,$=this._rings.length,V;k<$;k++)V=tt(this._rings[k],o,!0),V.length&&this._parts.push(V)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(o){var c=!1,f,k,$,V,oe,we,Ee,Ve;if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(V=0,Ee=this._parts.length;V<Ee;V++)for(f=this._parts[V],oe=0,Ve=f.length,we=Ve-1;oe<Ve;we=oe++)k=f[oe],$=f[we],k.y>o.y!=$.y>o.y&&o.x<($.x-k.x)*(o.y-k.y)/($.y-k.y)+k.x&&(c=!c);return c||Zo.prototype._containsPoint.call(this,o,!0)}});function ir(o,c){return new da(o,c)}var qo=jo.extend({initialize:function(o,c){I(this,c),this._layers={},o&&this.addData(o)},addData:function(o){var c=_(o)?o:o.features,f,k,$;if(c){for(f=0,k=c.length;f<k;f++)$=c[f],($.geometries||$.geometry||$.features||$.coordinates)&&this.addData($);return this}var V=this.options;if(V.filter&&!V.filter(o))return this;var oe=Va(o,V);return oe?(oe.feature=Si(o),oe.defaultOptions=oe.options,this.resetStyle(oe),V.onEachFeature&&V.onEachFeature(o,oe),this.addLayer(oe)):this},resetStyle:function(o){return o===void 0?this.eachLayer(this.resetStyle,this):(o.options=s({},o.defaultOptions),this._setLayerStyle(o,this.options.style),this)},setStyle:function(o){return this.eachLayer(function(c){this._setLayerStyle(c,o)},this)},_setLayerStyle:function(o,c){o.setStyle&&(typeof c=="function"&&(c=c(o.feature)),o.setStyle(c))}});function Va(o,c){var f=o.type==="Feature"?o.geometry:o,k=f?f.coordinates:null,$=[],V=c&&c.pointToLayer,oe=c&&c.coordsToLatLng||rl,we,Ee,Ve,ot;if(!k&&!f)return null;switch(f.type){case"Point":return we=oe(k),lr(V,o,we,c);case"MultiPoint":for(Ve=0,ot=k.length;Ve<ot;Ve++)we=oe(k[Ve]),$.push(lr(V,o,we,c));return new jo($);case"LineString":case"MultiLineString":return Ee=Ci(k,f.type==="LineString"?0:1,oe),new Zo(Ee,c);case"Polygon":case"MultiPolygon":return Ee=Ci(k,f.type==="Polygon"?1:2,oe),new da(Ee,c);case"GeometryCollection":for(Ve=0,ot=f.geometries.length;Ve<ot;Ve++){var ut=Va({geometry:f.geometries[Ve],type:"Feature",properties:o.properties},c);ut&&$.push(ut)}return new jo($);case"FeatureCollection":for(Ve=0,ot=f.features.length;Ve<ot;Ve++){var wt=Va(f.features[Ve],c);wt&&$.push(wt)}return new jo($);default:throw new Error("Invalid GeoJSON object.")}}function lr(o,c,f,k){return o?o(c,f):new _i(f,k&&k.markersInheritOptions&&k)}function rl(o){return new Ke(o[1],o[0],o[2])}function Ci(o,c,f){for(var k=[],$=0,V=o.length,oe;$<V;$++)oe=c?Ci(o[$],c-1,f):(f||rl)(o[$]),k.push(oe);return k}function Ga(o,c){return o=We(o),o.alt!==void 0?[y(o.lng,c),y(o.lat,c),y(o.alt,c)]:[y(o.lng,c),y(o.lat,c)]}function Li(o,c,f,k){for(var $=[],V=0,oe=o.length;V<oe;V++)$.push(c?Li(o[V],io(o[V])?0:c-1,f,k):Ga(o[V],k));return!c&&f&&$.length>0&&$.push($[0].slice()),$}function ha(o,c){return o.feature?s({},o.feature,{geometry:c}):Si(c)}function Si(o){return o.type==="Feature"||o.type==="FeatureCollection"?o:{type:"Feature",properties:{},geometry:o}}var Ii={toGeoJSON:function(o){return ha(this,{type:"Point",coordinates:Ga(this.getLatLng(),o)})}};_i.include(Ii),ll.include(Ii),wi.include(Ii),Zo.include({toGeoJSON:function(o){var c=!io(this._latlngs),f=Li(this._latlngs,c?1:0,!1,o);return ha(this,{type:(c?"Multi":"")+"LineString",coordinates:f})}}),da.include({toGeoJSON:function(o){var c=!io(this._latlngs),f=c&&!io(this._latlngs[0]),k=Li(this._latlngs,f?2:c?1:0,!0,o);return c||(k=[k]),ha(this,{type:(f?"Multi":"")+"Polygon",coordinates:k})}}),ca.include({toMultiPoint:function(o){var c=[];return this.eachLayer(function(f){c.push(f.toGeoJSON(o).geometry.coordinates)}),ha(this,{type:"MultiPoint",coordinates:c})},toGeoJSON:function(o){var c=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(c==="MultiPoint")return this.toMultiPoint(o);var f=c==="GeometryCollection",k=[];return this.eachLayer(function($){if($.toGeoJSON){var V=$.toGeoJSON(o);if(f)k.push(V.geometry);else{var oe=Si(V);oe.type==="FeatureCollection"?k.push.apply(k,oe.features):k.push(oe)}}}),f?ha(this,{geometries:k,type:"GeometryCollection"}):{type:"FeatureCollection",features:k}}});function rr(o,c){return new qo(o,c)}var ja=rr,Za=bo.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(o,c,f){this._url=o,this._bounds=Ne(c),I(this,f)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ft(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Pt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(o){return this.options.opacity=o,this._image&&this._updateOpacity(),this},setStyle:function(o){return o.opacity&&this.setOpacity(o.opacity),this},bringToFront:function(){return this._map&&zo(this._image),this},bringToBack:function(){return this._map&&yo(this._image),this},setUrl:function(o){return this._url=o,this._image&&(this._image.src=o),this},setBounds:function(o){return this._bounds=Ne(o),this._map&&this._reset(),this},getEvents:function(){var o={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var o=this._url.tagName==="IMG",c=this._image=o?this._url:kt("img");if(ft(c,"leaflet-image-layer"),this._zoomAnimated&&ft(c,"leaflet-zoom-animated"),this.options.className&&ft(c,this.options.className),c.onselectstart=g,c.onmousemove=g,c.onload=l(this.fire,this,"load"),c.onerror=l(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(c.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),o){this._url=c.src;return}c.src=this._url,c.alt=this.options.alt},_animateZoom:function(o){var c=this._map.getZoomScale(o.zoom),f=this._map._latLngBoundsToNewLayerBounds(this._bounds,o.zoom,o.center).min;Mo(this._image,f,c)},_reset:function(){var o=this._image,c=new ke(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),f=c.getSize();Kt(o,c.min),o.style.width=f.x+"px",o.style.height=f.y+"px"},_updateOpacity:function(){$n(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var o=this.options.errorOverlayUrl;o&&this._url!==o&&(this._url=o,this._image.src=o)},getCenter:function(){return this._bounds.getCenter()}}),cr=function(o,c,f){return new Za(o,c,f)},cl=Za.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var o=this._url.tagName==="VIDEO",c=this._image=o?this._url:kt("video");if(ft(c,"leaflet-image-layer"),this._zoomAnimated&&ft(c,"leaflet-zoom-animated"),this.options.className&&ft(c,this.options.className),c.onselectstart=g,c.onmousemove=g,c.onloadeddata=l(this.fire,this,"load"),o){for(var f=c.getElementsByTagName("source"),k=[],$=0;$<f.length;$++)k.push(f[$].src);this._url=f.length>0?k:[c.src];return}_(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(c.style,"objectFit")&&(c.style.objectFit="fill"),c.autoplay=!!this.options.autoplay,c.loop=!!this.options.loop,c.muted=!!this.options.muted,c.playsInline=!!this.options.playsInline;for(var V=0;V<this._url.length;V++){var oe=kt("source");oe.src=this._url[V],c.appendChild(oe)}}});function H(o,c,f){return new cl(o,c,f)}var se=Za.extend({_initImage:function(){var o=this._image=this._url;ft(o,"leaflet-image-layer"),this._zoomAnimated&&ft(o,"leaflet-zoom-animated"),this.options.className&&ft(o,this.options.className),o.onselectstart=g,o.onmousemove=g}});function me(o,c,f){return new se(o,c,f)}var _e=bo.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(o,c){o&&(o instanceof Ke||_(o))?(this._latlng=We(o),I(this,c)):(I(this,o),this._source=c),this.options.content&&(this._content=this.options.content)},openOn:function(o){return o=arguments.length?o:this._source._map,o.hasLayer(this)||o.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(o){return this._map?this.close():(arguments.length?this._source=o:o=this._source,this._prepareOpen(),this.openOn(o._map)),this},onAdd:function(o){this._zoomAnimated=o._zoomAnimated,this._container||this._initLayout(),o._fadeAnimated&&$n(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),o._fadeAnimated&&$n(this._container,1),this.bringToFront(),this.options.interactive&&(ft(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(o){o._fadeAnimated?($n(this._container,0),this._removeTimeout=setTimeout(l(Pt,void 0,this._container),200)):Pt(this._container),this.options.interactive&&(Vt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(o){return this._latlng=We(o),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(o){return this._content=o,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var o={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&zo(this._container),this},bringToBack:function(){return this._map&&yo(this._container),this},_prepareOpen:function(o){var c=this._source;if(!c._map)return!1;if(c instanceof jo){c=null;var f=this._source._layers;for(var k in f)if(f[k]._map){c=f[k];break}if(!c)return!1;this._source=c}if(!o)if(c.getCenter)o=c.getCenter();else if(c.getLatLng)o=c.getLatLng();else if(c.getBounds)o=c.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(o),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var o=this._contentNode,c=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof c=="string")o.innerHTML=c;else{for(;o.hasChildNodes();)o.removeChild(o.firstChild);o.appendChild(c)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var o=this._map.latLngToLayerPoint(this._latlng),c=re(this.options.offset),f=this._getAnchor();this._zoomAnimated?Kt(this._container,o.add(f)):c=c.add(o).add(f);var k=this._containerBottom=-c.y,$=this._containerLeft=-Math.round(this._containerWidth/2)+c.x;this._container.style.bottom=k+"px",this._container.style.left=$+"px"}},_getAnchor:function(){return[0,0]}});_t.include({_initOverlay:function(o,c,f,k){var $=c;return $ instanceof o||($=new o(k).setContent(c)),f&&$.setLatLng(f),$}}),bo.include({_initOverlay:function(o,c,f,k){var $=f;return $ instanceof o?(I($,k),$._source=this):($=c&&!k?c:new o(k,this),$.setContent(f)),$}});var at=_e.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(o){return o=arguments.length?o:this._source._map,!o.hasLayer(this)&&o._popup&&o._popup.options.autoClose&&o.removeLayer(o._popup),o._popup=this,_e.prototype.openOn.call(this,o)},onAdd:function(o){_e.prototype.onAdd.call(this,o),o.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof fs||this._source.on("preclick",Eo))},onRemove:function(o){_e.prototype.onRemove.call(this,o),o.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof fs||this._source.off("preclick",Eo))},getEvents:function(){var o=_e.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(o.preclick=this.close),this.options.keepInView&&(o.moveend=this._adjustPan),o},_initLayout:function(){var o="leaflet-popup",c=this._container=kt("div",o+" "+(this.options.className||"")+" leaflet-zoom-animated"),f=this._wrapper=kt("div",o+"-content-wrapper",c);if(this._contentNode=kt("div",o+"-content",f),ao(c),Ba(this._contentNode),ct(c,"contextmenu",Eo),this._tipContainer=kt("div",o+"-tip-container",c),this._tip=kt("div",o+"-tip",this._tipContainer),this.options.closeButton){var k=this._closeButton=kt("a",o+"-close-button",c);k.setAttribute("role","button"),k.setAttribute("aria-label","Close popup"),k.href="#close",k.innerHTML='<span aria-hidden="true">&#215;</span>',ct(k,"click",function($){Jt($),this.close()},this)}},_updateLayout:function(){var o=this._contentNode,c=o.style;c.width="",c.whiteSpace="nowrap";var f=o.offsetWidth;f=Math.min(f,this.options.maxWidth),f=Math.max(f,this.options.minWidth),c.width=f+1+"px",c.whiteSpace="",c.height="";var k=o.offsetHeight,$=this.options.maxHeight,V="leaflet-popup-scrolled";$&&k>$?(c.height=$+"px",ft(o,V)):Vt(o,V),this._containerWidth=this._container.offsetWidth},_animateZoom:function(o){var c=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center),f=this._getAnchor();Kt(this._container,c.add(f))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var o=this._map,c=parseInt(oo(this._container,"marginBottom"),10)||0,f=this._container.offsetHeight+c,k=this._containerWidth,$=new U(this._containerLeft,-f-this._containerBottom);$._add(Ho(this._container));var V=o.layerPointToContainerPoint($),oe=re(this.options.autoPanPadding),we=re(this.options.autoPanPaddingTopLeft||oe),Ee=re(this.options.autoPanPaddingBottomRight||oe),Ve=o.getSize(),ot=0,ut=0;V.x+k+Ee.x>Ve.x&&(ot=V.x+k-Ve.x+Ee.x),V.x-ot-we.x<0&&(ot=V.x-we.x),V.y+f+Ee.y>Ve.y&&(ut=V.y+f-Ve.y+Ee.y),V.y-ut-we.y<0&&(ut=V.y-we.y),(ot||ut)&&(this.options.keepInView&&(this._autopanning=!0),o.fire("autopanstart").panBy([ot,ut]))}},_getAnchor:function(){return re(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),bt=function(o,c){return new at(o,c)};_t.mergeOptions({closePopupOnClick:!0}),_t.include({openPopup:function(o,c,f){return this._initOverlay(at,o,c,f).openOn(this),this},closePopup:function(o){return o=arguments.length?o:this._popup,o&&o.close(),this}}),bo.include({bindPopup:function(o,c){return this._popup=this._initOverlay(at,this._popup,o,c),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(o){return this._popup&&(this instanceof jo||(this._popup._source=this),this._popup._prepareOpen(o||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(o){return this._popup&&this._popup.setContent(o),this},getPopup:function(){return this._popup},_openPopup:function(o){if(!(!this._popup||!this._map)){Mn(o);var c=o.layer||o.target;if(this._popup._source===c&&!(c instanceof fs)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(o.latlng);return}this._popup._source=c,this.openPopup(o.latlng)}},_movePopup:function(o){this._popup.setLatLng(o.latlng)},_onKeyPress:function(o){o.originalEvent.keyCode===13&&this._openPopup(o)}});var Mt=_e.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(o){_e.prototype.onAdd.call(this,o),this.setOpacity(this.options.opacity),o.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(o){_e.prototype.onRemove.call(this,o),o.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var o=_e.prototype.getEvents.call(this);return this.options.permanent||(o.preclick=this.close),o},_initLayout:function(){var o="leaflet-tooltip",c=o+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=kt("div",c),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+d(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(o){var c,f,k=this._map,$=this._container,V=k.latLngToContainerPoint(k.getCenter()),oe=k.layerPointToContainerPoint(o),we=this.options.direction,Ee=$.offsetWidth,Ve=$.offsetHeight,ot=re(this.options.offset),ut=this._getAnchor();we==="top"?(c=Ee/2,f=Ve):we==="bottom"?(c=Ee/2,f=0):we==="center"?(c=Ee/2,f=Ve/2):we==="right"?(c=0,f=Ve/2):we==="left"?(c=Ee,f=Ve/2):oe.x<V.x?(we="right",c=0,f=Ve/2):(we="left",c=Ee+(ot.x+ut.x)*2,f=Ve/2),o=o.subtract(re(c,f,!0)).add(ot).add(ut),Vt($,"leaflet-tooltip-right"),Vt($,"leaflet-tooltip-left"),Vt($,"leaflet-tooltip-top"),Vt($,"leaflet-tooltip-bottom"),ft($,"leaflet-tooltip-"+we),Kt($,o)},_updatePosition:function(){var o=this._map.latLngToLayerPoint(this._latlng);this._setPosition(o)},setOpacity:function(o){this.options.opacity=o,this._container&&$n(this._container,o)},_animateZoom:function(o){var c=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center);this._setPosition(c)},_getAnchor:function(){return re(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),gn=function(o,c){return new Mt(o,c)};_t.include({openTooltip:function(o,c,f){return this._initOverlay(Mt,o,c,f).openOn(this),this},closeTooltip:function(o){return o.close(),this}}),bo.include({bindTooltip:function(o,c){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Mt,this._tooltip,o,c),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(o){if(!(!o&&this._tooltipHandlersAdded)){var c=o?"off":"on",f={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?f.add=this._openTooltip:(f.mouseover=this._openTooltip,f.mouseout=this.closeTooltip,f.click=this._openTooltip,this._map?this._addFocusListeners():f.add=this._addFocusListeners),this._tooltip.options.sticky&&(f.mousemove=this._moveTooltip),this[c](f),this._tooltipHandlersAdded=!o}},openTooltip:function(o){return this._tooltip&&(this instanceof jo||(this._tooltip._source=this),this._tooltip._prepareOpen(o)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(o){return this._tooltip&&this._tooltip.setContent(o),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(o){var c=typeof o.getElement=="function"&&o.getElement();c&&(ct(c,"focus",function(){this._tooltip._source=o,this.openTooltip()},this),ct(c,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(o){var c=typeof o.getElement=="function"&&o.getElement();c&&c.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(o){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var c=this;this._map.once("moveend",function(){c._openOnceFlag=!1,c._openTooltip(o)});return}this._tooltip._source=o.layer||o.target,this.openTooltip(this._tooltip.options.sticky?o.latlng:void 0)}},_moveTooltip:function(o){var c=o.latlng,f,k;this._tooltip.options.sticky&&o.originalEvent&&(f=this._map.mouseEventToContainerPoint(o.originalEvent),k=this._map.containerPointToLayerPoint(f),c=this._map.layerPointToLatLng(k)),this._tooltip.setLatLng(c)}});var fa=ua.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(o){var c=o&&o.tagName==="DIV"?o:document.createElement("div"),f=this.options;if(f.html instanceof Element?(To(c),c.appendChild(f.html)):c.innerHTML=f.html!==!1?f.html:"",f.bgPos){var k=re(f.bgPos);c.style.backgroundPosition=-k.x+"px "+-k.y+"px"}return this._setIconStyles(c,"icon"),c},createShadow:function(){return null}});function xi(o){return new fa(o)}ua.Default=Ts;var Ms=bo.extend({options:{tileSize:256,opacity:1,updateWhenIdle:je.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(o){I(this,o)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(o){o._addZoomLimit(this)},onRemove:function(o){this._removeAllTiles(),Pt(this._container),o._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(zo(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yo(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(o){return this.options.opacity=o,this._updateOpacity(),this},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var o=this._clampZoom(this._map.getZoom());o!==this._tileZoom&&(this._tileZoom=o,this._updateLevels()),this._update()}return this},getEvents:function(){var o={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=h(this._onMoveEnd,this.options.updateInterval,this)),o.move=this._onMove),this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},createTile:function(){return document.createElement("div")},getTileSize:function(){var o=this.options.tileSize;return o instanceof U?o:new U(o,o)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(o){for(var c=this.getPane().children,f=-o(-1/0,1/0),k=0,$=c.length,V;k<$;k++)V=c[k].style.zIndex,c[k]!==this._container&&V&&(f=o(f,+V));isFinite(f)&&(this.options.zIndex=f+o(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!je.ielt9){$n(this._container,this.options.opacity);var o=+new Date,c=!1,f=!1;for(var k in this._tiles){var $=this._tiles[k];if(!(!$.current||!$.loaded)){var V=Math.min(1,(o-$.loaded)/200);$n($.el,V),V<1?c=!0:($.active?f=!0:this._onOpaqueTile($),$.active=!0)}}f&&!this._noPrune&&this._pruneTiles(),c&&(G(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this))}},_onOpaqueTile:g,_initContainer:function(){this._container||(this._container=kt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var o=this._tileZoom,c=this.options.maxZoom;if(o!==void 0){for(var f in this._levels)f=Number(f),this._levels[f].el.children.length||f===o?(this._levels[f].el.style.zIndex=c-Math.abs(o-f),this._onUpdateLevel(f)):(Pt(this._levels[f].el),this._removeTilesAtZoom(f),this._onRemoveLevel(f),delete this._levels[f]);var k=this._levels[o],$=this._map;return k||(k=this._levels[o]={},k.el=kt("div","leaflet-tile-container leaflet-zoom-animated",this._container),k.el.style.zIndex=c,k.origin=$.project($.unproject($.getPixelOrigin()),o).round(),k.zoom=o,this._setZoomTransform(k,$.getCenter(),$.getZoom()),g(k.el.offsetWidth),this._onCreateLevel(k)),this._level=k,k}},_onUpdateLevel:g,_onRemoveLevel:g,_onCreateLevel:g,_pruneTiles:function(){if(this._map){var o,c,f=this._map.getZoom();if(f>this.options.maxZoom||f<this.options.minZoom){this._removeAllTiles();return}for(o in this._tiles)c=this._tiles[o],c.retain=c.current;for(o in this._tiles)if(c=this._tiles[o],c.current&&!c.active){var k=c.coords;this._retainParent(k.x,k.y,k.z,k.z-5)||this._retainChildren(k.x,k.y,k.z,k.z+2)}for(o in this._tiles)this._tiles[o].retain||this._removeTile(o)}},_removeTilesAtZoom:function(o){for(var c in this._tiles)this._tiles[c].coords.z===o&&this._removeTile(c)},_removeAllTiles:function(){for(var o in this._tiles)this._removeTile(o)},_invalidateAll:function(){for(var o in this._levels)Pt(this._levels[o].el),this._onRemoveLevel(Number(o)),delete this._levels[o];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(o,c,f,k){var $=Math.floor(o/2),V=Math.floor(c/2),oe=f-1,we=new U(+$,+V);we.z=+oe;var Ee=this._tileCoordsToKey(we),Ve=this._tiles[Ee];return Ve&&Ve.active?(Ve.retain=!0,!0):(Ve&&Ve.loaded&&(Ve.retain=!0),oe>k?this._retainParent($,V,oe,k):!1)},_retainChildren:function(o,c,f,k){for(var $=2*o;$<2*o+2;$++)for(var V=2*c;V<2*c+2;V++){var oe=new U($,V);oe.z=f+1;var we=this._tileCoordsToKey(oe),Ee=this._tiles[we];if(Ee&&Ee.active){Ee.retain=!0;continue}else Ee&&Ee.loaded&&(Ee.retain=!0);f+1<k&&this._retainChildren($,V,f+1,k)}},_resetView:function(o){var c=o&&(o.pinch||o.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),c,c)},_animateZoom:function(o){this._setView(o.center,o.zoom,!0,o.noUpdate)},_clampZoom:function(o){var c=this.options;return c.minNativeZoom!==void 0&&o<c.minNativeZoom?c.minNativeZoom:c.maxNativeZoom!==void 0&&c.maxNativeZoom<o?c.maxNativeZoom:o},_setView:function(o,c,f,k){var $=Math.round(c);this.options.maxZoom!==void 0&&$>this.options.maxZoom||this.options.minZoom!==void 0&&$<this.options.minZoom?$=void 0:$=this._clampZoom($);var V=this.options.updateWhenZooming&&$!==this._tileZoom;(!k||V)&&(this._tileZoom=$,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),$!==void 0&&this._update(o),f||this._pruneTiles(),this._noPrune=!!f),this._setZoomTransforms(o,c)},_setZoomTransforms:function(o,c){for(var f in this._levels)this._setZoomTransform(this._levels[f],o,c)},_setZoomTransform:function(o,c,f){var k=this._map.getZoomScale(f,o.zoom),$=o.origin.multiplyBy(k).subtract(this._map._getNewPixelOrigin(c,f)).round();je.any3d?Mo(o.el,$,k):Kt(o.el,$)},_resetGrid:function(){var o=this._map,c=o.options.crs,f=this._tileSize=this.getTileSize(),k=this._tileZoom,$=this._map.getPixelWorldBounds(this._tileZoom);$&&(this._globalTileRange=this._pxBoundsToTileRange($)),this._wrapX=c.wrapLng&&!this.options.noWrap&&[Math.floor(o.project([0,c.wrapLng[0]],k).x/f.x),Math.ceil(o.project([0,c.wrapLng[1]],k).x/f.y)],this._wrapY=c.wrapLat&&!this.options.noWrap&&[Math.floor(o.project([c.wrapLat[0],0],k).y/f.x),Math.ceil(o.project([c.wrapLat[1],0],k).y/f.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(o){var c=this._map,f=c._animatingZoom?Math.max(c._animateToZoom,c.getZoom()):c.getZoom(),k=c.getZoomScale(f,this._tileZoom),$=c.project(o,this._tileZoom).floor(),V=c.getSize().divideBy(k*2);return new ke($.subtract(V),$.add(V))},_update:function(o){var c=this._map;if(c){var f=this._clampZoom(c.getZoom());if(o===void 0&&(o=c.getCenter()),this._tileZoom!==void 0){var k=this._getTiledPixelBounds(o),$=this._pxBoundsToTileRange(k),V=$.getCenter(),oe=[],we=this.options.keepBuffer,Ee=new ke($.getBottomLeft().subtract([we,-we]),$.getTopRight().add([we,-we]));if(!(isFinite($.min.x)&&isFinite($.min.y)&&isFinite($.max.x)&&isFinite($.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ve in this._tiles){var ot=this._tiles[Ve].coords;(ot.z!==this._tileZoom||!Ee.contains(new U(ot.x,ot.y)))&&(this._tiles[Ve].current=!1)}if(Math.abs(f-this._tileZoom)>1){this._setView(o,f);return}for(var ut=$.min.y;ut<=$.max.y;ut++)for(var wt=$.min.x;wt<=$.max.x;wt++){var Zn=new U(wt,ut);if(Zn.z=this._tileZoom,!!this._isValidTile(Zn)){var yn=this._tiles[this._tileCoordsToKey(Zn)];yn?yn.current=!0:oe.push(Zn)}}if(oe.sort(function(lo,$i){return lo.distanceTo(V)-$i.distanceTo(V)}),oe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Do=document.createDocumentFragment();for(wt=0;wt<oe.length;wt++)this._addTile(oe[wt],Do);this._level.el.appendChild(Do)}}}},_isValidTile:function(o){var c=this._map.options.crs;if(!c.infinite){var f=this._globalTileRange;if(!c.wrapLng&&(o.x<f.min.x||o.x>f.max.x)||!c.wrapLat&&(o.y<f.min.y||o.y>f.max.y))return!1}if(!this.options.bounds)return!0;var k=this._tileCoordsToBounds(o);return Ne(this.options.bounds).overlaps(k)},_keyToBounds:function(o){return this._tileCoordsToBounds(this._keyToTileCoords(o))},_tileCoordsToNwSe:function(o){var c=this._map,f=this.getTileSize(),k=o.scaleBy(f),$=k.add(f),V=c.unproject(k,o.z),oe=c.unproject($,o.z);return[V,oe]},_tileCoordsToBounds:function(o){var c=this._tileCoordsToNwSe(o),f=new Xe(c[0],c[1]);return this.options.noWrap||(f=this._map.wrapLatLngBounds(f)),f},_tileCoordsToKey:function(o){return o.x+":"+o.y+":"+o.z},_keyToTileCoords:function(o){var c=o.split(":"),f=new U(+c[0],+c[1]);return f.z=+c[2],f},_removeTile:function(o){var c=this._tiles[o];c&&(Pt(c.el),delete this._tiles[o],this.fire("tileunload",{tile:c.el,coords:this._keyToTileCoords(o)}))},_initTile:function(o){ft(o,"leaflet-tile");var c=this.getTileSize();o.style.width=c.x+"px",o.style.height=c.y+"px",o.onselectstart=g,o.onmousemove=g,je.ielt9&&this.options.opacity<1&&$n(o,this.options.opacity)},_addTile:function(o,c){var f=this._getTilePos(o),k=this._tileCoordsToKey(o),$=this.createTile(this._wrapCoords(o),l(this._tileReady,this,o));this._initTile($),this.createTile.length<2&&R(l(this._tileReady,this,o,null,$)),Kt($,f),this._tiles[k]={el:$,coords:o,current:!0},c.appendChild($),this.fire("tileloadstart",{tile:$,coords:o})},_tileReady:function(o,c,f){c&&this.fire("tileerror",{error:c,tile:f,coords:o});var k=this._tileCoordsToKey(o);f=this._tiles[k],f&&(f.loaded=+new Date,this._map._fadeAnimated?($n(f.el,0),G(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this)):(f.active=!0,this._pruneTiles()),c||(ft(f.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:f.el,coords:o})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),je.ielt9||!this._map._fadeAnimated?R(this._pruneTiles,this):setTimeout(l(this._pruneTiles,this),250)))},_getTilePos:function(o){return o.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(o){var c=new U(this._wrapX?p(o.x,this._wrapX):o.x,this._wrapY?p(o.y,this._wrapY):o.y);return c.z=o.z,c},_pxBoundsToTileRange:function(o){var c=this.getTileSize();return new ke(o.min.unscaleBy(c).floor(),o.max.unscaleBy(c).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var o in this._tiles)if(!this._tiles[o].loaded)return!1;return!0}});function pa(o){return new Ms(o)}var Sn=Ms.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(o,c){this._url=o,c=I(this,c),c.detectRetina&&je.retina&&c.maxZoom>0?(c.tileSize=Math.floor(c.tileSize/2),c.zoomReverse?(c.zoomOffset--,c.minZoom=Math.min(c.maxZoom,c.minZoom+1)):(c.zoomOffset++,c.maxZoom=Math.max(c.minZoom,c.maxZoom-1)),c.minZoom=Math.max(0,c.minZoom)):c.zoomReverse?c.minZoom=Math.min(c.maxZoom,c.minZoom):c.maxZoom=Math.max(c.minZoom,c.maxZoom),typeof c.subdomains=="string"&&(c.subdomains=c.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(o,c){return this._url===o&&c===void 0&&(c=!0),this._url=o,c||this.redraw(),this},createTile:function(o,c){var f=document.createElement("img");return ct(f,"load",l(this._tileOnLoad,this,c,f)),ct(f,"error",l(this._tileOnError,this,c,f)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(f.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(f.referrerPolicy=this.options.referrerPolicy),f.alt="",f.src=this.getTileUrl(o),f},getTileUrl:function(o){var c={r:je.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var f=this._globalTileRange.max.y-o.y;this.options.tms&&(c.y=f),c["-y"]=f}return S(this._url,s(c,this.options))},_tileOnLoad:function(o,c){je.ielt9?setTimeout(l(o,this,null,c),0):o(null,c)},_tileOnError:function(o,c,f){var k=this.options.errorTileUrl;k&&c.getAttribute("src")!==k&&(c.src=k),o(f,c)},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,c=this.options.maxZoom,f=this.options.zoomReverse,k=this.options.zoomOffset;return f&&(o=c-o),o+k},_getSubdomain:function(o){var c=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[c]},_abortLoading:function(){var o,c;for(o in this._tiles)if(this._tiles[o].coords.z!==this._tileZoom&&(c=this._tiles[o].el,c.onload=g,c.onerror=g,!c.complete)){c.src=E;var f=this._tiles[o].coords;Pt(c),delete this._tiles[o],this.fire("tileabort",{tile:c,coords:f})}},_removeTile:function(o){var c=this._tiles[o];if(c)return c.el.setAttribute("src",E),Ms.prototype._removeTile.call(this,o)},_tileReady:function(o,c,f){if(!(!this._map||f&&f.getAttribute("src")===E))return Ms.prototype._tileReady.call(this,o,c,f)}});function kd(o,c){return new Sn(o,c)}var bd=Sn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(o,c){this._url=o;var f=s({},this.defaultWmsParams);for(var k in c)k in this.options||(f[k]=c[k]);c=I(this,c);var $=c.detectRetina&&je.retina?2:1,V=this.getTileSize();f.width=V.x*$,f.height=V.y*$,this.wmsParams=f},onAdd:function(o){this._crs=this.options.crs||o.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var c=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[c]=this._crs.code,Sn.prototype.onAdd.call(this,o)},getTileUrl:function(o){var c=this._tileCoordsToNwSe(o),f=this._crs,k=Re(f.project(c[0]),f.project(c[1])),$=k.min,V=k.max,oe=(this._wmsVersion>=1.3&&this._crs===sr?[$.y,$.x,V.y,V.x]:[$.x,$.y,V.x,V.y]).join(","),we=Sn.prototype.getTileUrl.call(this,o);return we+M(this.wmsParams,we,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+oe},setParams:function(o,c){return s(this.wmsParams,o),c||this.redraw(),this}});function mm(o,c){return new bd(o,c)}Sn.WMS=bd,kd.wms=mm;var As=bo.extend({options:{padding:.1},initialize:function(o){I(this,o),d(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ft(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var o={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(o.zoomanim=this._onAnimZoom),o},_onAnimZoom:function(o){this._updateTransform(o.center,o.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(o,c){var f=this._map.getZoomScale(c,this._zoom),k=this._map.getSize().multiplyBy(.5+this.options.padding),$=this._map.project(this._center,c),V=k.multiplyBy(-f).add($).subtract(this._map._getNewPixelOrigin(o,c));je.any3d?Mo(this._container,V,f):Kt(this._container,V)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var o in this._layers)this._layers[o]._reset()},_onZoomEnd:function(){for(var o in this._layers)this._layers[o]._project()},_updatePaths:function(){for(var o in this._layers)this._layers[o]._update()},_update:function(){var o=this.options.padding,c=this._map.getSize(),f=this._map.containerPointToLayerPoint(c.multiplyBy(-o)).round();this._bounds=new ke(f,f.add(c.multiplyBy(1+o*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),_d=As.extend({options:{tolerance:0},getEvents:function(){var o=As.prototype.getEvents.call(this);return o.viewprereset=this._onViewPreReset,o},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){As.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var o=this._container=document.createElement("canvas");ct(o,"mousemove",this._onMouseMove,this),ct(o,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ct(o,"mouseout",this._handleMouseOut,this),o._leaflet_disable_events=!0,this._ctx=o.getContext("2d")},_destroyContainer:function(){G(this._redrawRequest),delete this._ctx,Pt(this._container),It(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var o;this._redrawBounds=null;for(var c in this._layers)o=this._layers[c],o._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){As.prototype._update.call(this);var o=this._bounds,c=this._container,f=o.getSize(),k=je.retina?2:1;Kt(c,o.min),c.width=k*f.x,c.height=k*f.y,c.style.width=f.x+"px",c.style.height=f.y+"px",je.retina&&this._ctx.scale(2,2),this._ctx.translate(-o.min.x,-o.min.y),this.fire("update")}},_reset:function(){As.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(o){this._updateDashArray(o),this._layers[d(o)]=o;var c=o._order={layer:o,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=c),this._drawLast=c,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(o){this._requestRedraw(o)},_removePath:function(o){var c=o._order,f=c.next,k=c.prev;f?f.prev=k:this._drawLast=k,k?k.next=f:this._drawFirst=f,delete o._order,delete this._layers[d(o)],this._requestRedraw(o)},_updatePath:function(o){this._extendRedrawBounds(o),o._project(),o._update(),this._requestRedraw(o)},_updateStyle:function(o){this._updateDashArray(o),this._requestRedraw(o)},_updateDashArray:function(o){if(typeof o.options.dashArray=="string"){var c=o.options.dashArray.split(/[, ]+/),f=[],k,$;for($=0;$<c.length;$++){if(k=Number(c[$]),isNaN(k))return;f.push(k)}o.options._dashArray=f}else o.options._dashArray=o.options.dashArray},_requestRedraw:function(o){this._map&&(this._extendRedrawBounds(o),this._redrawRequest=this._redrawRequest||R(this._redraw,this))},_extendRedrawBounds:function(o){if(o._pxBounds){var c=(o.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ke,this._redrawBounds.extend(o._pxBounds.min.subtract([c,c])),this._redrawBounds.extend(o._pxBounds.max.add([c,c]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var o=this._redrawBounds;if(o){var c=o.getSize();this._ctx.clearRect(o.min.x,o.min.y,c.x,c.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var o,c=this._redrawBounds;if(this._ctx.save(),c){var f=c.getSize();this._ctx.beginPath(),this._ctx.rect(c.min.x,c.min.y,f.x,f.y),this._ctx.clip()}this._drawing=!0;for(var k=this._drawFirst;k;k=k.next)o=k.layer,(!c||o._pxBounds&&o._pxBounds.intersects(c))&&o._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(o,c){if(this._drawing){var f,k,$,V,oe=o._parts,we=oe.length,Ee=this._ctx;if(we){for(Ee.beginPath(),f=0;f<we;f++){for(k=0,$=oe[f].length;k<$;k++)V=oe[f][k],Ee[k?"lineTo":"moveTo"](V.x,V.y);c&&Ee.closePath()}this._fillStroke(Ee,o)}}},_updateCircle:function(o){if(!(!this._drawing||o._empty())){var c=o._point,f=this._ctx,k=Math.max(Math.round(o._radius),1),$=(Math.max(Math.round(o._radiusY),1)||k)/k;$!==1&&(f.save(),f.scale(1,$)),f.beginPath(),f.arc(c.x,c.y/$,k,0,Math.PI*2,!1),$!==1&&f.restore(),this._fillStroke(f,o)}},_fillStroke:function(o,c){var f=c.options;f.fill&&(o.globalAlpha=f.fillOpacity,o.fillStyle=f.fillColor||f.color,o.fill(f.fillRule||"evenodd")),f.stroke&&f.weight!==0&&(o.setLineDash&&o.setLineDash(c.options&&c.options._dashArray||[]),o.globalAlpha=f.opacity,o.lineWidth=f.weight,o.strokeStyle=f.color,o.lineCap=f.lineCap,o.lineJoin=f.lineJoin,o.stroke())},_onClick:function(o){for(var c=this._map.mouseEventToLayerPoint(o),f,k,$=this._drawFirst;$;$=$.next)f=$.layer,f.options.interactive&&f._containsPoint(c)&&(!(o.type==="click"||o.type==="preclick")||!this._map._draggableMoved(f))&&(k=f);this._fireEvent(k?[k]:!1,o)},_onMouseMove:function(o){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var c=this._map.mouseEventToLayerPoint(o);this._handleMouseHover(o,c)}},_handleMouseOut:function(o){var c=this._hoveredLayer;c&&(Vt(this._container,"leaflet-interactive"),this._fireEvent([c],o,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(o,c){if(!this._mouseHoverThrottled){for(var f,k,$=this._drawFirst;$;$=$.next)f=$.layer,f.options.interactive&&f._containsPoint(c)&&(k=f);k!==this._hoveredLayer&&(this._handleMouseOut(o),k&&(ft(this._container,"leaflet-interactive"),this._fireEvent([k],o,"mouseover"),this._hoveredLayer=k)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,o),this._mouseHoverThrottled=!0,setTimeout(l(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(o,c,f){this._map._fireDOMEvent(c,f||c.type,o)},_bringToFront:function(o){var c=o._order;if(c){var f=c.next,k=c.prev;if(f)f.prev=k;else return;k?k.next=f:f&&(this._drawFirst=f),c.prev=this._drawLast,this._drawLast.next=c,c.next=null,this._drawLast=c,this._requestRedraw(o)}},_bringToBack:function(o){var c=o._order;if(c){var f=c.next,k=c.prev;if(k)k.next=f;else return;f?f.prev=k:k&&(this._drawLast=k),c.prev=null,c.next=this._drawFirst,this._drawFirst.prev=c,this._drawFirst=c,this._requestRedraw(o)}}});function wd(o){return je.canvas?new _d(o):null}var ul=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(o){return document.createElement("<lvml:"+o+' class="lvml">')}}catch{}return function(o){return document.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),gm={_initContainer:function(){this._container=kt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(As.prototype._update.call(this),this.fire("update"))},_initPath:function(o){var c=o._container=ul("shape");ft(c,"leaflet-vml-shape "+(this.options.className||"")),c.coordsize="1 1",o._path=ul("path"),c.appendChild(o._path),this._updateStyle(o),this._layers[d(o)]=o},_addPath:function(o){var c=o._container;this._container.appendChild(c),o.options.interactive&&o.addInteractiveTarget(c)},_removePath:function(o){var c=o._container;Pt(c),o.removeInteractiveTarget(c),delete this._layers[d(o)]},_updateStyle:function(o){var c=o._stroke,f=o._fill,k=o.options,$=o._container;$.stroked=!!k.stroke,$.filled=!!k.fill,k.stroke?(c||(c=o._stroke=ul("stroke")),$.appendChild(c),c.weight=k.weight+"px",c.color=k.color,c.opacity=k.opacity,k.dashArray?c.dashStyle=_(k.dashArray)?k.dashArray.join(" "):k.dashArray.replace(/( *, *)/g," "):c.dashStyle="",c.endcap=k.lineCap.replace("butt","flat"),c.joinstyle=k.lineJoin):c&&($.removeChild(c),o._stroke=null),k.fill?(f||(f=o._fill=ul("fill")),$.appendChild(f),f.color=k.fillColor||k.color,f.opacity=k.fillOpacity):f&&($.removeChild(f),o._fill=null)},_updateCircle:function(o){var c=o._point.round(),f=Math.round(o._radius),k=Math.round(o._radiusY||f);this._setPath(o,o._empty()?"M0 0":"AL "+c.x+","+c.y+" "+f+","+k+" 0,"+65535*360)},_setPath:function(o,c){o._path.v=c},_bringToFront:function(o){zo(o._container)},_bringToBack:function(o){yo(o._container)}},ur=je.vml?ul:$e,dl=As.extend({_initContainer:function(){this._container=ur("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ur("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Pt(this._container),It(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){As.prototype._update.call(this);var o=this._bounds,c=o.getSize(),f=this._container;(!this._svgSize||!this._svgSize.equals(c))&&(this._svgSize=c,f.setAttribute("width",c.x),f.setAttribute("height",c.y)),Kt(f,o.min),f.setAttribute("viewBox",[o.min.x,o.min.y,c.x,c.y].join(" ")),this.fire("update")}},_initPath:function(o){var c=o._path=ur("path");o.options.className&&ft(c,o.options.className),o.options.interactive&&ft(c,"leaflet-interactive"),this._updateStyle(o),this._layers[d(o)]=o},_addPath:function(o){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(o._path),o.addInteractiveTarget(o._path)},_removePath:function(o){Pt(o._path),o.removeInteractiveTarget(o._path),delete this._layers[d(o)]},_updatePath:function(o){o._project(),o._update()},_updateStyle:function(o){var c=o._path,f=o.options;c&&(f.stroke?(c.setAttribute("stroke",f.color),c.setAttribute("stroke-opacity",f.opacity),c.setAttribute("stroke-width",f.weight),c.setAttribute("stroke-linecap",f.lineCap),c.setAttribute("stroke-linejoin",f.lineJoin),f.dashArray?c.setAttribute("stroke-dasharray",f.dashArray):c.removeAttribute("stroke-dasharray"),f.dashOffset?c.setAttribute("stroke-dashoffset",f.dashOffset):c.removeAttribute("stroke-dashoffset")):c.setAttribute("stroke","none"),f.fill?(c.setAttribute("fill",f.fillColor||f.color),c.setAttribute("fill-opacity",f.fillOpacity),c.setAttribute("fill-rule",f.fillRule||"evenodd")):c.setAttribute("fill","none"))},_updatePoly:function(o,c){this._setPath(o,Be(o._parts,c))},_updateCircle:function(o){var c=o._point,f=Math.max(Math.round(o._radius),1),k=Math.max(Math.round(o._radiusY),1)||f,$="a"+f+","+k+" 0 1,0 ",V=o._empty()?"M0 0":"M"+(c.x-f)+","+c.y+$+f*2+",0 "+$+-f*2+",0 ";this._setPath(o,V)},_setPath:function(o,c){o._path.setAttribute("d",c)},_bringToFront:function(o){zo(o._path)},_bringToBack:function(o){yo(o._path)}});je.vml&&dl.include(gm);function Cd(o){return je.svg||je.vml?new dl(o):null}_t.include({getRenderer:function(o){var c=o.options.renderer||this._getPaneRenderer(o.options.pane)||this.options.renderer||this._renderer;return c||(c=this._renderer=this._createRenderer()),this.hasLayer(c)||this.addLayer(c),c},_getPaneRenderer:function(o){if(o==="overlayPane"||o===void 0)return!1;var c=this._paneRenderers[o];return c===void 0&&(c=this._createRenderer({pane:o}),this._paneRenderers[o]=c),c},_createRenderer:function(o){return this.options.preferCanvas&&wd(o)||Cd(o)}});var Ld=da.extend({initialize:function(o,c){da.prototype.initialize.call(this,this._boundsToLatLngs(o),c)},setBounds:function(o){return this.setLatLngs(this._boundsToLatLngs(o))},_boundsToLatLngs:function(o){return o=Ne(o),[o.getSouthWest(),o.getNorthWest(),o.getNorthEast(),o.getSouthEast()]}});function ym(o,c){return new Ld(o,c)}dl.create=ur,dl.pointsToPath=Be,qo.geometryToLayer=Va,qo.coordsToLatLng=rl,qo.coordsToLatLngs=Ci,qo.latLngToCoords=Ga,qo.latLngsToCoords=Li,qo.getFeature=ha,qo.asFeature=Si,_t.mergeOptions({boxZoom:!0});var Sd=Gn.extend({initialize:function(o){this._map=o,this._container=o._container,this._pane=o._panes.overlayPane,this._resetStateTimeout=0,o.on("unload",this._destroy,this)},addHooks:function(){ct(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){It(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Pt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(o){if(!o.shiftKey||o.which!==1&&o.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Vo(),so(),this._startPoint=this._map.mouseEventToContainerPoint(o),ct(document,{contextmenu:Mn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(o){this._moved||(this._moved=!0,this._box=kt("div","leaflet-zoom-box",this._container),ft(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(o);var c=new ke(this._point,this._startPoint),f=c.getSize();Kt(this._box,c.min),this._box.style.width=f.x+"px",this._box.style.height=f.y+"px"},_finish:function(){this._moved&&(Pt(this._box),Vt(this._container,"leaflet-crosshair")),Is(),Zt(),It(document,{contextmenu:Mn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(o){if(!(o.which!==1&&o.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(l(this._resetState,this),0);var c=new Xe(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(c).fire("boxzoomend",{boxZoomBounds:c})}},_onKeyDown:function(o){o.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});_t.addInitHook("addHandler","boxZoom",Sd),_t.mergeOptions({doubleClickZoom:!0});var Id=Gn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(o){var c=this._map,f=c.getZoom(),k=c.options.zoomDelta,$=o.originalEvent.shiftKey?f-k:f+k;c.options.doubleClickZoom==="center"?c.setZoom($):c.setZoomAround(o.containerPoint,$)}});_t.addInitHook("addHandler","doubleClickZoom",Id),_t.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var xd=Gn.extend({addHooks:function(){if(!this._draggable){var o=this._map;this._draggable=new Se(o._mapPane,o._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),o.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),o.on("zoomend",this._onZoomEnd,this),o.whenReady(this._onZoomEnd,this))}ft(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Vt(this._map._container,"leaflet-grab"),Vt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var o=this._map;if(o._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var c=Ne(this._map.options.maxBounds);this._offsetLimit=Re(this._map.latLngToContainerPoint(c.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(c.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;o.fire("movestart").fire("dragstart"),o.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(o){if(this._map.options.inertia){var c=this._lastTime=+new Date,f=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(f),this._times.push(c),this._prunePositions(c)}this._map.fire("move",o).fire("drag",o)},_prunePositions:function(o){for(;this._positions.length>1&&o-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var o=this._map.getSize().divideBy(2),c=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=c.subtract(o).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(o,c){return o-(o-c)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var o=this._draggable._newPos.subtract(this._draggable._startPos),c=this._offsetLimit;o.x<c.min.x&&(o.x=this._viscousLimit(o.x,c.min.x)),o.y<c.min.y&&(o.y=this._viscousLimit(o.y,c.min.y)),o.x>c.max.x&&(o.x=this._viscousLimit(o.x,c.max.x)),o.y>c.max.y&&(o.y=this._viscousLimit(o.y,c.max.y)),this._draggable._newPos=this._draggable._startPos.add(o)}},_onPreDragWrap:function(){var o=this._worldWidth,c=Math.round(o/2),f=this._initialWorldOffset,k=this._draggable._newPos.x,$=(k-c+f)%o+c-f,V=(k+c+f)%o-c-f,oe=Math.abs($+f)<Math.abs(V+f)?$:V;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=oe},_onDragEnd:function(o){var c=this._map,f=c.options,k=!f.inertia||o.noInertia||this._times.length<2;if(c.fire("dragend",o),k)c.fire("moveend");else{this._prunePositions(+new Date);var $=this._lastPos.subtract(this._positions[0]),V=(this._lastTime-this._times[0])/1e3,oe=f.easeLinearity,we=$.multiplyBy(oe/V),Ee=we.distanceTo([0,0]),Ve=Math.min(f.inertiaMaxSpeed,Ee),ot=we.multiplyBy(Ve/Ee),ut=Ve/(f.inertiaDeceleration*oe),wt=ot.multiplyBy(-ut/2).round();!wt.x&&!wt.y?c.fire("moveend"):(wt=c._limitOffset(wt,c.options.maxBounds),R(function(){c.panBy(wt,{duration:ut,easeLinearity:oe,noMoveStart:!0,animate:!0})}))}}});_t.addInitHook("addHandler","dragging",xd),_t.mergeOptions({keyboard:!0,keyboardPanDelta:80});var $d=Gn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(o){this._map=o,this._setPanDelta(o.options.keyboardPanDelta),this._setZoomDelta(o.options.zoomDelta)},addHooks:function(){var o=this._map._container;o.tabIndex<=0&&(o.tabIndex="0"),ct(o,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),It(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var o=document.body,c=document.documentElement,f=o.scrollTop||c.scrollTop,k=o.scrollLeft||c.scrollLeft;this._map._container.focus(),window.scrollTo(k,f)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(o){var c=this._panKeys={},f=this.keyCodes,k,$;for(k=0,$=f.left.length;k<$;k++)c[f.left[k]]=[-1*o,0];for(k=0,$=f.right.length;k<$;k++)c[f.right[k]]=[o,0];for(k=0,$=f.down.length;k<$;k++)c[f.down[k]]=[0,o];for(k=0,$=f.up.length;k<$;k++)c[f.up[k]]=[0,-1*o]},_setZoomDelta:function(o){var c=this._zoomKeys={},f=this.keyCodes,k,$;for(k=0,$=f.zoomIn.length;k<$;k++)c[f.zoomIn[k]]=o;for(k=0,$=f.zoomOut.length;k<$;k++)c[f.zoomOut[k]]=-o},_addHooks:function(){ct(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){It(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){var c=o.keyCode,f=this._map,k;if(c in this._panKeys){if(!f._panAnim||!f._panAnim._inProgress)if(k=this._panKeys[c],o.shiftKey&&(k=re(k).multiplyBy(3)),f.options.maxBounds&&(k=f._limitOffset(re(k),f.options.maxBounds)),f.options.worldCopyJump){var $=f.wrapLatLng(f.unproject(f.project(f.getCenter()).add(k)));f.panTo($)}else f.panBy(k)}else if(c in this._zoomKeys)f.setZoom(f.getZoom()+(o.shiftKey?3:1)*this._zoomKeys[c]);else if(c===27&&f._popup&&f._popup.options.closeOnEscapeKey)f.closePopup();else return;Mn(o)}}});_t.addInitHook("addHandler","keyboard",$d),_t.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Td=Gn.extend({addHooks:function(){ct(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){It(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(o){var c=Na(o),f=this._map.options.wheelDebounceTime;this._delta+=c,this._lastMousePos=this._map.mouseEventToContainerPoint(o),this._startTime||(this._startTime=+new Date);var k=Math.max(f-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(l(this._performZoom,this),k),Mn(o)},_performZoom:function(){var o=this._map,c=o.getZoom(),f=this._map.options.zoomSnap||0;o._stop();var k=this._delta/(this._map.options.wheelPxPerZoomLevel*4),$=4*Math.log(2/(1+Math.exp(-Math.abs(k))))/Math.LN2,V=f?Math.ceil($/f)*f:$,oe=o._limitZoom(c+(this._delta>0?V:-V))-c;this._delta=0,this._startTime=null,oe&&(o.options.scrollWheelZoom==="center"?o.setZoom(c+oe):o.setZoomAround(this._lastMousePos,c+oe))}});_t.addInitHook("addHandler","scrollWheelZoom",Td);var km=600;_t.mergeOptions({tapHold:je.touchNative&&je.safari&&je.mobile,tapTolerance:15});var Md=Gn.extend({addHooks:function(){ct(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){It(this._map._container,"touchstart",this._onDown,this)},_onDown:function(o){if(clearTimeout(this._holdTimeout),o.touches.length===1){var c=o.touches[0];this._startPos=this._newPos=new U(c.clientX,c.clientY),this._holdTimeout=setTimeout(l(function(){this._cancel(),this._isTapValid()&&(ct(document,"touchend",Jt),ct(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",c))},this),km),ct(document,"touchend touchcancel contextmenu",this._cancel,this),ct(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function o(){It(document,"touchend",Jt),It(document,"touchend touchcancel",o)},_cancel:function(){clearTimeout(this._holdTimeout),It(document,"touchend touchcancel contextmenu",this._cancel,this),It(document,"touchmove",this._onMove,this)},_onMove:function(o){var c=o.touches[0];this._newPos=new U(c.clientX,c.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(o,c){var f=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,screenX:c.screenX,screenY:c.screenY,clientX:c.clientX,clientY:c.clientY});f._simulated=!0,c.target.dispatchEvent(f)}});_t.addInitHook("addHandler","tapHold",Md),_t.mergeOptions({touchZoom:je.touch,bounceAtZoomLimits:!0});var Ad=Gn.extend({addHooks:function(){ft(this._map._container,"leaflet-touch-zoom"),ct(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Vt(this._map._container,"leaflet-touch-zoom"),It(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(o){var c=this._map;if(!(!o.touches||o.touches.length!==2||c._animatingZoom||this._zooming)){var f=c.mouseEventToContainerPoint(o.touches[0]),k=c.mouseEventToContainerPoint(o.touches[1]);this._centerPoint=c.getSize()._divideBy(2),this._startLatLng=c.containerPointToLatLng(this._centerPoint),c.options.touchZoom!=="center"&&(this._pinchStartLatLng=c.containerPointToLatLng(f.add(k)._divideBy(2))),this._startDist=f.distanceTo(k),this._startZoom=c.getZoom(),this._moved=!1,this._zooming=!0,c._stop(),ct(document,"touchmove",this._onTouchMove,this),ct(document,"touchend touchcancel",this._onTouchEnd,this),Jt(o)}},_onTouchMove:function(o){if(!(!o.touches||o.touches.length!==2||!this._zooming)){var c=this._map,f=c.mouseEventToContainerPoint(o.touches[0]),k=c.mouseEventToContainerPoint(o.touches[1]),$=f.distanceTo(k)/this._startDist;if(this._zoom=c.getScaleZoom($,this._startZoom),!c.options.bounceAtZoomLimits&&(this._zoom<c.getMinZoom()&&$<1||this._zoom>c.getMaxZoom()&&$>1)&&(this._zoom=c._limitZoom(this._zoom)),c.options.touchZoom==="center"){if(this._center=this._startLatLng,$===1)return}else{var V=f._add(k)._divideBy(2)._subtract(this._centerPoint);if($===1&&V.x===0&&V.y===0)return;this._center=c.unproject(c.project(this._pinchStartLatLng,this._zoom).subtract(V),this._zoom)}this._moved||(c._moveStart(!0,!1),this._moved=!0),G(this._animRequest);var oe=l(c._move,c,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=R(oe,this,!0),Jt(o)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,G(this._animRequest),It(document,"touchmove",this._onTouchMove,this),It(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});_t.addInitHook("addHandler","touchZoom",Ad),_t.BoxZoom=Sd,_t.DoubleClickZoom=Id,_t.Drag=xd,_t.Keyboard=$d,_t.ScrollWheelZoom=Td,_t.TapHold=Md,_t.TouchZoom=Ad,n.Bounds=ke,n.Browser=je,n.CRS=Q,n.Canvas=_d,n.Circle=ll,n.CircleMarker=wi,n.Class=ne,n.Control=Cn,n.DivIcon=fa,n.DivOverlay=_e,n.DomEvent=Qi,n.DomUtil=sa,n.Draggable=Se,n.Evented=te,n.FeatureGroup=jo,n.GeoJSON=qo,n.GridLayer=Ms,n.Handler=Gn,n.Icon=ua,n.ImageOverlay=Za,n.LatLng=Ke,n.LatLngBounds=Xe,n.Layer=bo,n.LayerGroup=ca,n.LineUtil=Ic,n.Map=_t,n.Marker=_i,n.Mixin=Ha,n.Path=fs,n.Point=U,n.PolyUtil=xt,n.Polygon=da,n.Polyline=Zo,n.Popup=at,n.PosAnimation=Ua,n.Projection=xc,n.Rectangle=Ld,n.Renderer=As,n.SVG=dl,n.SVGOverlay=se,n.TileLayer=Sn,n.Tooltip=Mt,n.Transformation=ue,n.Util=ee,n.VideoOverlay=cl,n.bind=l,n.bounds=Re,n.canvas=wd,n.circle=Ec,n.circleMarker=Ac,n.control=hs,n.divIcon=xi,n.extend=s,n.featureGroup=ki,n.geoJSON=rr,n.geoJson=ja,n.gridLayer=pa,n.icon=ar,n.imageOverlay=cr,n.latLng=We,n.latLngBounds=Ne,n.layerGroup=yi,n.map=el,n.marker=Mc,n.point=re,n.polygon=ir,n.polyline=Pc,n.popup=bt,n.rectangle=ym,n.setOptions=I,n.stamp=d,n.svg=Cd,n.svgOverlay=me,n.tileLayer=kd,n.tooltip=gn,n.transformation=F,n.version=a,n.videoOverlay=H;var bm=window.L;n.noConflict=function(){return window.L=bm,this},window.L=n}))})(kl,kl.exports)),kl.exports}var u_=c_();const Bt=l_(u_);(function(e,t,n){function a(s,i){for(;(s=s.parentElement)&&!s.classList.contains(i););return s}L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(s,i){this._map=s,this._container=s._container,this._overlayPane=s._panes.overlayPane,this._popupPane=s._panes.popupPane,i&&i.shapeOptions&&(i.shapeOptions=L.Util.extend({},this.options.shapeOptions,i.shapeOptions)),L.setOptions(this,i);var l=L.version.split(".");parseInt(l[0],10)===1&&parseInt(l[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var s=this._map;s&&(L.DomUtil.disableTextSelection(),s.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(s){L.setOptions(this,s)},_fireCreatedEvent:function(s){this._map.fire(L.Draw.Event.CREATED,{layer:s,layerType:this.type})},_cancelDrawing:function(s){s.keyCode===27&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(s,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,s,i)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var s=this._markers.pop(),i=this._poly,l=i.getLatLngs(),u=l.splice(-1,1)[0];this._poly.setLatLngs(l),this._markerGroup.removeLayer(s),i.getLatLngs().length<2&&this._map.removeLayer(i),this._vertexChanged(u,!1)}},addVertex:function(s){if(this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(s))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(s)),this._poly.addLatLng(s),this._poly.getLatLngs().length===2&&this._map.addLayer(this._poly),this._vertexChanged(s,!0)},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var s=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),i=this._poly.newLatLngIntersects(s[s.length-1]);if(!this.options.allowIntersection&&i||!this._shapeIsValid())return void this._showErrorTooltip();this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._markers!==null&&this._updateGuide()},_onMouseMove:function(s){var i=this._map.mouseEventToLayerPoint(s.originalEvent),l=this._map.layerPointToLatLng(i);this._currentLatLng=l,this._updateTooltip(l),this._updateGuide(i),this._mouseMarker.setLatLng(l),L.DomEvent.preventDefault(s.originalEvent)},_vertexChanged:function(s,i){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(s,i),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(s){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(s),this._clickHandled=!0,this._disableNewMarkers();var i=s.originalEvent,l=i.clientX,u=i.clientY;this._startPoint.call(this,l,u)}},_startPoint:function(s,i){this._mouseDownOrigin=L.point(s,i)},_onMouseUp:function(s){var i=s.originalEvent,l=i.clientX,u=i.clientY;this._endPoint.call(this,l,u,s),this._clickHandled=null},_endPoint:function(s,i,l){if(this._mouseDownOrigin){var u=L.point(s,i).distanceTo(this._mouseDownOrigin),d=this._calculateFinishDistance(l.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(l.latlng),this._finishShape()):d<10&&L.Browser.touch?this._finishShape():Math.abs(u)<9*(e.devicePixelRatio||1)&&this.addVertex(l.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(s){var i,l,u=s.originalEvent;!u.touches||!u.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(i=u.touches[0].clientX,l=u.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,i,l),this._endPoint.call(this,i,l,s),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(s){var i;if(this._markers.length>0){var l;if(this.type===L.Draw.Polyline.TYPE)l=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;l=this._markers[0]}var u=this._map.latLngToContainerPoint(l.getLatLng()),d=new L.Marker(s,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),h=this._map.latLngToContainerPoint(d.getLatLng());i=u.distanceTo(h)}else i=1/0;return i},_updateFinishHandler:function(){var s=this._markers.length;s>1&&this._markers[s-1].on("click",this._finishShape,this),s>2&&this._markers[s-2].off("click",this._finishShape,this)},_createMarker:function(s){var i=new L.Marker(s,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(i),i},_updateGuide:function(s){var i=this._markers?this._markers.length:0;i>0&&(s=s||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[i-1].getLatLng()),s))},_updateTooltip:function(s){var i=this._getTooltipText();s&&this._tooltip.updatePosition(s),this._errorShown||this._tooltip.updateContent(i)},_drawGuide:function(s,i){var l,u,d,h=Math.floor(Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2))),p=this.options.guidelineDistance,g=this.options.maxGuideLineLength,y=h>g?h-g:p;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));y<h;y+=this.options.guidelineDistance)l=y/h,u={x:Math.floor(s.x*(1-l)+l*i.x),y:Math.floor(s.y*(1-l)+l*i.y)},d=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),d.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(d,u)},_updateGuideColor:function(s){if(this._guidesContainer)for(var i=0,l=this._guidesContainer.childNodes.length;i<l;i++)this._guidesContainer.childNodes[i].style.backgroundColor=s},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var s,i,l=this.options.showLength;return this._markers.length===0?s={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(i=l?this._getMeasurementString():"",s=this._markers.length===1?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:i}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:i}),s},_updateRunningMeasure:function(s,i){var l,u,d=this._markers.length;this._markers.length===1?this._measurementRunningTotal=0:(l=d-(i?2:1),u=L.GeometryUtil.isVersion07x()?s.distanceTo(this._markers[l].getLatLng())*(this.options.factor||1):this._map.distance(s,this._markers[l].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=u*(i?1:-1))},_getMeasurementString:function(){var s,i=this._currentLatLng,l=this._markers[this._markers.length-1].getLatLng();return s=L.GeometryUtil.isVersion07x()?l&&i&&i.distanceTo?this._measurementRunningTotal+i.distanceTo(l)*(this.options.factor||1):this._measurementRunningTotal||0:l&&i?this._measurementRunningTotal+this._map.distance(i,l)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(s,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout((function(){this._disableMarkers=!1}).bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var s=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,s)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(s,i){L.Draw.Polyline.prototype.initialize.call(this,s,i),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var s=this._markers.length;s===1&&this._markers[0].on("click",this._finishShape,this),s>2&&(this._markers[s-1].on("dblclick",this._finishShape,this),s>3&&this._markers[s-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var s,i;return this._markers.length===0?s=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(s=L.drawLocal.draw.handlers.polygon.tooltip.cont,i=this._getMeasurementString()):(s=L.drawLocal.draw.handlers.polygon.tooltip.end,i=this._getMeasurementString()),{text:s,subtext:i}},_getMeasurementString:function(){var s=this._area,i="";return s||this.options.showLength?(this.options.showLength&&(i=L.Draw.Polyline.prototype._getMeasurementString.call(this)),s&&(i+="<br>"+L.GeometryUtil.readableArea(s,this.options.metric,this.options.precision)),i):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(s,i){var l;!this.options.allowIntersection&&this.options.showArea&&(l=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(l)),L.Draw.Polyline.prototype._vertexChanged.call(this,s,i)},_cleanUpShape:function(){var s=this._markers.length;s>0&&(this._markers[0].off("click",this._finishShape,this),s>2&&this._markers[s-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(s,i){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,s,i)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),t.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(t,"mouseup",this._onMouseUp,this),L.DomEvent.off(t,"touchend",this._onMouseUp,this),t.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(s){this._isDrawing=!0,this._startLatLng=s.latlng,L.DomEvent.on(t,"mouseup",this._onMouseUp,this).on(t,"touchend",this._onMouseUp,this).preventDefault(s.originalEvent)},_onMouseMove:function(s){var i=s.latlng;this._tooltip.updatePosition(i),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(i))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(s,i){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,s,i)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(s){if(!this._shape&&!this._isCurrentlyTwoClickDrawing)return void(this._isCurrentlyTwoClickDrawing=!0);this._isCurrentlyTwoClickDrawing&&!a(s.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this)},_drawShape:function(s){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,s)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,s),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var s=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,s)},_getTooltipText:function(){var s,i,l,u=L.Draw.SimpleShape.prototype._getTooltipText.call(this),d=this._shape,h=this.options.showArea;return d&&(s=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),i=L.GeometryUtil.geodesicArea(s),l=h?L.GeometryUtil.readableArea(i,this.options.metric):""),{text:u.text,subtext:l}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(s,i){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,s,i)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(s){var i=s.latlng;this._tooltip.updatePosition(i),this._mouseMarker.setLatLng(i),this._marker?(i=this._mouseMarker.getLatLng(),this._marker.setLatLng(i)):(this._marker=this._createMarker(i),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(s){return new L.Marker(s,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(s){this._onMouseMove(s),this._onClick()},_fireCreatedEvent:function(){var s=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,s)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(s,i){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,s,i)},_fireCreatedEvent:function(){var s=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,s)},_createMarker:function(s){return new L.CircleMarker(s,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(s,i){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,s,i)},_drawShape:function(s){if(L.GeometryUtil.isVersion07x())var i=this._startLatLng.distanceTo(s);else var i=this._map.distance(this._startLatLng,s);this._shape?this._shape.setRadius(i):(this._shape=new L.Circle(this._startLatLng,i,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var s=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,s)},_onMouseMove:function(s){var i,l=s.latlng,u=this.options.showRadius,d=this.options.metric;if(this._tooltip.updatePosition(l),this._isDrawing){this._drawShape(l),i=this._shape.getRadius().toFixed(1);var h="";u&&(h=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(i,d,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:h})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(s,i){this._marker=s,L.setOptions(this,i)},addHooks:function(){var s=this._marker;s.dragging.enable(),s.on("dragend",this._onDragEnd,s),this._toggleMarkerHighlight()},removeHooks:function(){var s=this._marker;s.dragging.disable(),s.off("dragend",this._onDragEnd,s),this._toggleMarkerHighlight()},_onDragEnd:function(s){var i=s.target;i.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:i})},_toggleMarkerHighlight:function(){var s=this._marker._icon;s&&(s.style.display="none",L.DomUtil.hasClass(s,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(s,"leaflet-edit-marker-selected"),this._offsetMarker(s,-4)):(L.DomUtil.addClass(s,"leaflet-edit-marker-selected"),this._offsetMarker(s,4)),s.style.display="")},_offsetMarker:function(s,i){var l=parseInt(s.style.marginTop,10)-i,u=parseInt(s.style.marginLeft,10)-i;s.style.marginTop=l+"px",s.style.marginLeft=u+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(s){this.latlngs=[s._latlngs],s._holes&&(this.latlngs=this.latlngs.concat(s._holes)),this._poly=s,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(s){for(var i=0;i<this._verticesHandlers.length;i++)s(this._verticesHandlers[i])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(s){s.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(s){s.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(s){s.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var s=0;s<this.latlngs.length;s++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[s],this._poly.options.poly))},_updateLatLngs:function(s){this.latlngs=[s.layer._latlngs],s.layer._holes&&(this.latlngs=this.latlngs.concat(s.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(s,i,l){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=s,l&&l.drawError&&(l.drawError=L.Util.extend({},this.options.drawError,l.drawError)),this._latlngs=i,L.setOptions(this,l)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var s=this._poly,i=s._path;s instanceof L.Polygon||(s.options.fill=!1,s.options.editing&&(s.options.editing.fill=!1)),i&&s.options.editing&&s.options.editing.className&&(s.options.original.className&&s.options.original.className.split(" ").forEach(function(l){L.DomUtil.removeClass(i,l)}),s.options.editing.className.split(" ").forEach(function(l){L.DomUtil.addClass(i,l)})),s.setStyle(s.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var s=this._poly,i=s._path;i&&s.options.editing&&s.options.editing.className&&(s.options.editing.className.split(" ").forEach(function(l){L.DomUtil.removeClass(i,l)}),s.options.original.className&&s.options.original.className.split(" ").forEach(function(l){L.DomUtil.addClass(i,l)})),s.setStyle(s.options.original),s._map&&(s._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var s,i,l,u,d=this._defaultShape();for(s=0,l=d.length;s<l;s++)u=this._createMarker(d[s],s),u.on("click",this._onMarkerClick,this),u.on("contextmenu",this._onContextMenu,this),this._markers.push(u);var h,p;for(s=0,i=l-1;s<l;i=s++)(s!==0||L.Polygon&&this._poly instanceof L.Polygon)&&(h=this._markers[i],p=this._markers[s],this._createMiddleMarker(h,p),this._updatePrevNext(h,p))},_createMarker:function(s,i){var l=new L.Marker.Touch(s,{draggable:!0,icon:this.options.icon});return l._origLatLng=s,l._index=i,l.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(l),l},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var s=this._defaultShape(),i=[].splice.apply(s,arguments);return this._poly._convertLatLngs(s,!0),this._poly.redraw(),i},_removeMarker:function(s){var i=s._index;this._markerGroup.removeLayer(s),this._markers.splice(i,1),this._spliceLatLngs(i,1),this._updateIndexes(i,-1),s.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(s){var i=s.target,l=this._poly,u=L.LatLngUtil.cloneLatLng(i._origLatLng);if(L.extend(i._origLatLng,i._latlng),l.options.poly){var d=l._map._editTooltip;if(!l.options.poly.allowIntersection&&l.intersects()){L.extend(i._origLatLng,u),i.setLatLng(u);var h=l.options.color;l.setStyle({color:this.options.drawError.color}),d&&d.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){l.setStyle({color:h}),d&&d.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}i._middleLeft&&i._middleLeft.setLatLng(this._getMiddleLatLng(i._prev,i)),i._middleRight&&i._middleRight.setLatLng(this._getMiddleLatLng(i,i._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var p=this._poly.getLatLngs();this._poly._convertLatLngs(p,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(s){var i=L.Polygon&&this._poly instanceof L.Polygon?4:3,l=s.target;this._defaultShape().length<i||(this._removeMarker(l),this._updatePrevNext(l._prev,l._next),l._middleLeft&&this._markerGroup.removeLayer(l._middleLeft),l._middleRight&&this._markerGroup.removeLayer(l._middleRight),l._prev&&l._next?this._createMiddleMarker(l._prev,l._next):l._prev?l._next||(l._prev._middleRight=null):l._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(s){var i=s.target;this._poly,this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:i,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(s){var i=this._map.mouseEventToLayerPoint(s.originalEvent.touches[0]),l=this._map.layerPointToLatLng(i),u=s.target;L.extend(u._origLatLng,l),u._middleLeft&&u._middleLeft.setLatLng(this._getMiddleLatLng(u._prev,u)),u._middleRight&&u._middleRight.setLatLng(this._getMiddleLatLng(u,u._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(s,i){this._markerGroup.eachLayer(function(l){l._index>s&&(l._index+=i)})},_createMiddleMarker:function(s,i){var l,u,d,h=this._getMiddleLatLng(s,i),p=this._createMarker(h);p.setOpacity(.6),s._middleRight=i._middleLeft=p,u=function(){p.off("touchmove",u,this);var g=i._index;p._index=g,p.off("click",l,this).on("click",this._onMarkerClick,this),h.lat=p.getLatLng().lat,h.lng=p.getLatLng().lng,this._spliceLatLngs(g,0,h),this._markers.splice(g,0,p),p.setOpacity(1),this._updateIndexes(g,1),i._index++,this._updatePrevNext(s,p),this._updatePrevNext(p,i),this._poly.fire("editstart")},d=function(){p.off("dragstart",u,this),p.off("dragend",d,this),p.off("touchmove",u,this),this._createMiddleMarker(s,p),this._createMiddleMarker(p,i)},l=function(){u.call(this),d.call(this),this._fireEdit()},p.on("click",l,this).on("dragstart",u,this).on("dragend",d,this).on("touchmove",u,this),this._markerGroup.addLayer(p)},_updatePrevNext:function(s,i){s&&(s._next=i),i&&(i._prev=s)},_getMiddleLatLng:function(s,i){var l=this._poly._map,u=l.project(s.getLatLng()),d=l.project(i.getLatLng());return l.unproject(u._add(d)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(s,i){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=s,L.Util.setOptions(this,i)},addHooks:function(){var s=this._shape;this._shape._map&&(this._map=this._shape._map,s.setStyle(s.options.editing),s._map&&(this._map=s._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var s=this._shape;if(s.setStyle(s.options.original),s._map){this._unbindMarker(this._moveMarker);for(var i=0,l=this._resizeMarkers.length;i<l;i++)this._unbindMarker(this._resizeMarkers[i]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(s,i){var l=new L.Marker.Touch(s,{draggable:!0,icon:i,zIndexOffset:10});return this._bindMarker(l),this._markerGroup.addLayer(l),l},_bindMarker:function(s){s.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(s){s.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(s){s.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(s){var i=s.target,l=i.getLatLng();i===this._moveMarker?this._move(l):this._resize(l),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(s){s.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(s){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,s),typeof this._getCorners=="function"){var i=this._getCorners(),l=s.target,u=l._cornerIndex;l.setOpacity(0),this._oppositeCorner=i[(u+2)%4],this._toggleCornerMarkers(0,u)}this._shape.fire("editstart")},_onTouchMove:function(s){var i=this._map.mouseEventToLayerPoint(s.originalEvent.touches[0]),l=this._map.layerPointToLatLng(i);return s.target===this._moveMarker?this._move(l):this._resize(l),this._shape.redraw(),!1},_onTouchEnd:function(s){s.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var s=this._shape.getBounds(),i=s.getCenter();this._moveMarker=this._createMarker(i,this.options.moveIcon)},_createResizeMarker:function(){var s=this._getCorners();this._resizeMarkers=[];for(var i=0,l=s.length;i<l;i++)this._resizeMarkers.push(this._createMarker(s[i],this.options.resizeIcon)),this._resizeMarkers[i]._cornerIndex=i},_onMarkerDragStart:function(s){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,s);var i=this._getCorners(),l=s.target,u=l._cornerIndex;this._oppositeCorner=i[(u+2)%4],this._toggleCornerMarkers(0,u)},_onMarkerDragEnd:function(s){var i,l,u=s.target;u===this._moveMarker&&(i=this._shape.getBounds(),l=i.getCenter(),u.setLatLng(l)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,s)},_move:function(s){for(var i,l=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),u=this._shape.getBounds(),d=u.getCenter(),h=[],p=0,g=l.length;p<g;p++)i=[l[p].lat-d.lat,l[p].lng-d.lng],h.push([s.lat+i[0],s.lng+i[1]]);this._shape.setLatLngs(h),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(s){var i;this._shape.setBounds(L.latLngBounds(s,this._oppositeCorner)),i=this._shape.getBounds(),this._moveMarker.setLatLng(i.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var s=this._shape.getBounds();return[s.getNorthWest(),s.getNorthEast(),s.getSouthEast(),s.getSouthWest()]},_toggleCornerMarkers:function(s){for(var i=0,l=this._resizeMarkers.length;i<l;i++)this._resizeMarkers[i].setOpacity(s)},_repositionCornerMarkers:function(){for(var s=this._getCorners(),i=0,l=this._resizeMarkers.length;i<l;i++)this._resizeMarkers[i].setLatLng(s[i])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var s=this._shape.getLatLng();this._moveMarker=this._createMarker(s,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(s){if(this._resizeMarkers.length){var i=this._getResizeMarkerPoint(s);this._resizeMarkers[0].setLatLng(i)}this._shape.setLatLng(s),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook(function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var s=this._shape.getLatLng(),i=this._getResizeMarkerPoint(s);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(i,this.options.resizeIcon))},_getResizeMarkerPoint:function(s){var i=this._shape._radius*Math.cos(Math.PI/4),l=this._map.project(s);return this._map.unproject([l.x+i,l.y-i])},_resize:function(s){var i=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=i.distanceTo(s):radius=this._map.distance(i,s),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(s){this._map=s,this._container=s._container,this._pane=s._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(s,i){var l={};if(s.touches!==void 0){if(!s.touches.length)return;l=s.touches[0]}else if(s.pointerType!=="touch"||(l=s,!this._filterClick(s)))return;var u=this._map.mouseEventToContainerPoint(l),d=this._map.mouseEventToLayerPoint(l),h=this._map.layerPointToLatLng(d);this._map.fire(i,{latlng:h,layerPoint:d,containerPoint:u,pageX:l.pageX,pageY:l.pageY,originalEvent:s})},_filterClick:function(s){var i=s.timeStamp||s.originalEvent.timeStamp,l=L.DomEvent._lastClick&&i-L.DomEvent._lastClick;return l&&l>100&&l<500||s.target._simulatedClick&&!s._simulated?(L.DomEvent.stop(s),!1):(L.DomEvent._lastClick=i,!0)},_onTouchStart:function(s){this._map._loaded&&this._touchEvent(s,"touchstart")},_onTouchEnd:function(s){this._map._loaded&&this._touchEvent(s,"touchend")},_onTouchCancel:function(s){if(this._map._loaded){var i="touchcancel";this._detectIE()&&(i="pointercancel"),this._touchEvent(s,i)}},_onTouchLeave:function(s){this._map._loaded&&this._touchEvent(s,"touchleave")},_onTouchMove:function(s){this._map._loaded&&this._touchEvent(s,"touchmove")},_detectIE:function(){var s=e.navigator.userAgent,i=s.indexOf("MSIE ");if(i>0)return parseInt(s.substring(i+5,s.indexOf(".",i)),10);if(s.indexOf("Trident/")>0){var l=s.indexOf("rv:");return parseInt(s.substring(l+3,s.indexOf(".",l)),10)}var u=s.indexOf("Edge/");return u>0&&parseInt(s.substring(u+5,s.indexOf(".",u)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var s=this._icon,i=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?i.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):i.concat(["touchcancel"]),L.DomUtil.addClass(s,"leaflet-clickable"),L.DomEvent.on(s,"click",this._onMouseClick,this),L.DomEvent.on(s,"keypress",this._onKeyPress,this);for(var l=0;l<i.length;l++)L.DomEvent.on(s,i[l],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var s=e.navigator.userAgent,i=s.indexOf("MSIE ");if(i>0)return parseInt(s.substring(i+5,s.indexOf(".",i)),10);if(s.indexOf("Trident/")>0){var l=s.indexOf("rv:");return parseInt(s.substring(l+3,s.indexOf(".",l)),10)}var u=s.indexOf("Edge/");return u>0&&parseInt(s.substring(u+5,s.indexOf(".",u)),10)}}),L.LatLngUtil={cloneLatLngs:function(s){for(var i=[],l=0,u=s.length;l<u;l++)Array.isArray(s[l])?i.push(L.LatLngUtil.cloneLatLngs(s[l])):i.push(this.cloneLatLng(s[l]));return i},cloneLatLng:function(s){return L.latLng(s.lat,s.lng)}},(function(){var s={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(i){var l,u,d=i.length,h=0,p=Math.PI/180;if(d>2){for(var g=0;g<d;g++)l=i[g],u=i[(g+1)%d],h+=(u.lng-l.lng)*p*(2+Math.sin(l.lat*p)+Math.sin(u.lat*p));h=6378137*h*6378137/2}return Math.abs(h)},formattedNumber:function(i,l){var u=parseFloat(i).toFixed(l),d=L.drawLocal.format&&L.drawLocal.format.numeric,h=d&&d.delimiters,p=h&&h.thousands,g=h&&h.decimal;if(p||g){var y=u.split(".");u=p?y[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+p):y[0],g=g||".",y.length>1&&(u=u+g+y[1])}return u},readableArea:function(i,l,p){var d,h,p=L.Util.extend({},s,p);return l?(h=["ha","m"],type=typeof l,type==="string"?h=[l]:type!=="boolean"&&(h=l),d=i>=1e6&&h.indexOf("km")!==-1?L.GeometryUtil.formattedNumber(1e-6*i,p.km)+" km":i>=1e4&&h.indexOf("ha")!==-1?L.GeometryUtil.formattedNumber(1e-4*i,p.ha)+" ha":L.GeometryUtil.formattedNumber(i,p.m)+" m"):(i/=.836127,d=i>=3097600?L.GeometryUtil.formattedNumber(i/3097600,p.mi)+" mi":i>=4840?L.GeometryUtil.formattedNumber(i/4840,p.ac)+" acres":L.GeometryUtil.formattedNumber(i,p.yd)+" yd"),d},readableDistance:function(i,l,u,d,g){var p,g=L.Util.extend({},s,g);switch(l?typeof l=="string"?l:"metric":u?"feet":d?"nauticalMile":"yards"){case"metric":p=i>1e3?L.GeometryUtil.formattedNumber(i/1e3,g.km)+" km":L.GeometryUtil.formattedNumber(i,g.m)+" m";break;case"feet":i*=3.28083,p=L.GeometryUtil.formattedNumber(i,g.ft)+" ft";break;case"nauticalMile":i*=.53996,p=L.GeometryUtil.formattedNumber(i/1e3,g.nm)+" nm";break;default:i*=1.09361,p=i>1760?L.GeometryUtil.formattedNumber(i/1760,g.mi)+" miles":L.GeometryUtil.formattedNumber(i,g.yd)+" yd"}return p},isVersion07x:function(){var i=L.version.split(".");return parseInt(i[0],10)===0&&parseInt(i[1],10)===7}})})(),L.Util.extend(L.LineUtil,{segmentsIntersect:function(s,i,l,u){return this._checkCounterclockwise(s,l,u)!==this._checkCounterclockwise(i,l,u)&&this._checkCounterclockwise(s,i,l)!==this._checkCounterclockwise(s,i,u)},_checkCounterclockwise:function(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}}),L.Polyline.include({intersects:function(){var s,i,l,u=this._getProjectedPoints(),d=u?u.length:0;if(this._tooFewPointsForIntersection())return!1;for(s=d-1;s>=3;s--)if(i=u[s-1],l=u[s],this._lineSegmentsIntersectsRange(i,l,s-2))return!0;return!1},newLatLngIntersects:function(s,i){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(s),i)},newPointIntersects:function(s,i){var l=this._getProjectedPoints(),u=l?l.length:0,d=l?l[u-1]:null,h=u-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(d,s,h,i?1:0)},_tooFewPointsForIntersection:function(s){var i=this._getProjectedPoints(),l=i?i.length:0;return l+=s||0,!i||l<=3},_lineSegmentsIntersectsRange:function(s,i,l,u){var d,h,p=this._getProjectedPoints();u=u||0;for(var g=l;g>u;g--)if(d=p[g-1],h=p[g],L.LineUtil.segmentsIntersect(s,i,d,h))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var s=[],i=this._defaultShape(),l=0;l<i.length;l++)s.push(this._map.latLngToLayerPoint(i[l]));return s}}),L.Polygon.include({intersects:function(){var s,i,l,u,d=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(s=d.length,i=d[0],l=d[s-1],u=s-2,this._lineSegmentsIntersectsRange(l,i,u,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(s){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,s);var i;this._toolbars={},L.DrawToolbar&&this.options.draw&&(i=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=i,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(i=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=i,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(s){var i,l=L.DomUtil.create("div","leaflet-draw"),u=!1;for(var d in this._toolbars)this._toolbars.hasOwnProperty(d)&&(i=this._toolbars[d].addToolbar(s))&&(u||(L.DomUtil.hasClass(i,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(i.childNodes[0],"leaflet-draw-toolbar-top"),u=!0),l.appendChild(i));return l},onRemove:function(){for(var s in this._toolbars)this._toolbars.hasOwnProperty(s)&&this._toolbars[s].removeToolbar()},setDrawingOptions:function(s){for(var i in this._toolbars)this._toolbars[i]instanceof L.DrawToolbar&&this._toolbars[i].setOptions(s)},_toolbarEnabled:function(s){var i=s.target;for(var l in this._toolbars)this._toolbars[l]!==i&&this._toolbars[l].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({initialize:function(s){L.setOptions(this,s),this._modes={},this._actionButtons=[],this._activeMode=null;var i=L.version.split(".");parseInt(i[0],10)===1&&parseInt(i[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return this._activeMode!==null},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(s){var i,l=L.DomUtil.create("div","leaflet-draw-section"),u=0,d=this._toolbarClass||"",h=this.getModeHandlers(s);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=s,i=0;i<h.length;i++)h[i].enabled&&this._initModeHandler(h[i].handler,this._toolbarContainer,u++,d,h[i].title);if(u)return this._lastButtonIndex=--u,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),l.appendChild(this._toolbarContainer),l.appendChild(this._actionsContainer),l},removeToolbar:function(){for(var s in this._modes)this._modes.hasOwnProperty(s)&&(this._disposeButton(this._modes[s].button,this._modes[s].handler.enable,this._modes[s].handler),this._modes[s].handler.disable(),this._modes[s].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var i=0,l=this._actionButtons.length;i<l;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(s,i,l,u,d){var h=s.type;this._modes[h]={},this._modes[h].handler=s,this._modes[h].button=this._createButton({type:h,title:d,className:u+"-"+h,container:i,callback:this._modes[h].handler.enable,context:this._modes[h].handler}),this._modes[h].buttonIndex=l,this._modes[h].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!e.MSStream},_createButton:function(s){var i=L.DomUtil.create("a",s.className||"",s.container),l=L.DomUtil.create("span","sr-only",s.container);i.href="#",i.appendChild(l),s.title&&(i.title=s.title,l.innerHTML=s.title),s.text&&(i.innerHTML=s.text,l.innerHTML=s.text);var u=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"mousedown",L.DomEvent.stopPropagation).on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"touchstart",L.DomEvent.stopPropagation).on(i,"click",L.DomEvent.preventDefault).on(i,u,s.callback,s.context),i},_disposeButton:function(s,i){var l=this._detectIOS()?"touchstart":"click";L.DomEvent.off(s,"click",L.DomEvent.stopPropagation).off(s,"mousedown",L.DomEvent.stopPropagation).off(s,"dblclick",L.DomEvent.stopPropagation).off(s,"touchstart",L.DomEvent.stopPropagation).off(s,"click",L.DomEvent.preventDefault).off(s,l,i)},_handlerActivated:function(s){this.disable(),this._activeMode=this._modes[s.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(s){var i,l,u,d,h=this._actionsContainer,p=this.getActions(s),g=p.length;for(l=0,u=this._actionButtons.length;l<u;l++)this._disposeButton(this._actionButtons[l].button,this._actionButtons[l].callback);for(this._actionButtons=[];h.firstChild;)h.removeChild(h.firstChild);for(var y=0;y<g;y++)"enabled"in p[y]&&!p[y].enabled||(i=L.DomUtil.create("li","",h),d=this._createButton({title:p[y].title,text:p[y].text,container:i,callback:p[y].callback,context:p[y].context}),this._actionButtons.push({button:d,callback:p[y].callback}))},_showActionsToolbar:function(){var s=this._activeMode.buttonIndex,i=this._lastButtonIndex,l=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=l+"px",s===0&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),s===i&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(s){this._map=s,this._popupPane=s._panes.popupPane,this._visible=!1,this._container=s.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(s){return this._container?(s.subtext=s.subtext||"",s.subtext.length!==0||this._singleLineLabel?s.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(s.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+s.subtext+"</span><br />":"")+"<span>"+s.text+"</span>",s.text||s.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(s){var i=this._map.latLngToLayerPoint(s),l=this._container;return this._container&&(this._visible&&(l.style.visibility="inherit"),L.DomUtil.setPosition(l,i)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(s){for(var i in this.options)this.options.hasOwnProperty(i)&&s[i]&&(s[i]=L.extend({},this.options[i],s[i]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,s)},getModeHandlers:function(s){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(s,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(s,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(s,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(s,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(s,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(s,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(s){return[{enabled:s.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:s.completeShape,context:s},{enabled:s.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:s.deleteLastVertex,context:s},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(s){L.setOptions(this,s);for(var i in this._modes)this._modes.hasOwnProperty(i)&&s.hasOwnProperty(i)&&this._modes[i].handler.setOptions(s[i])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(s){s.edit&&(s.edit.selectedPathOptions===void 0&&(s.edit.selectedPathOptions=this.options.edit.selectedPathOptions),s.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,s.edit.selectedPathOptions)),s.remove&&(s.remove=L.extend({},this.options.remove,s.remove)),s.poly&&(s.poly=L.extend({},this.options.poly,s.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,s),this._selectedFeatureCount=0},getModeHandlers:function(s){var i=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(s,{featureGroup:i,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(s,{featureGroup:i}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(s){var i=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return s.removeAllLayers&&i.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),i},addToolbar:function(s){var i=L.Toolbar.prototype.addToolbar.call(this,s);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),i},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var s,i=this.options.featureGroup,l=i.getLayers().length!==0;this.options.edit&&(s=this._modes[L.EditToolbar.Edit.TYPE].button,l?L.DomUtil.removeClass(s,"leaflet-disabled"):L.DomUtil.addClass(s,"leaflet-disabled"),s.setAttribute("title",l?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(s=this._modes[L.EditToolbar.Delete.TYPE].button,l?L.DomUtil.removeClass(s,"leaflet-disabled"):L.DomUtil.addClass(s,"leaflet-disabled"),s.setAttribute("title",l?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(s,i){if(L.Handler.prototype.initialize.call(this,s),L.setOptions(this,i),this._featureGroup=i.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var l=L.version.split(".");parseInt(l[0],10)===1&&parseInt(l[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var s=this._map;s&&(s.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),s._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(s){this._revertLayer(s)},this)},save:function(){var s=new L.LayerGroup;this._featureGroup.eachLayer(function(i){i.edited&&(s.addLayer(i),i.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:s})},_backupLayer:function(s){var i=L.Util.stamp(s);this._uneditedLayerProps[i]||(s instanceof L.Polyline||s instanceof L.Polygon||s instanceof L.Rectangle?this._uneditedLayerProps[i]={latlngs:L.LatLngUtil.cloneLatLngs(s.getLatLngs())}:s instanceof L.Circle?this._uneditedLayerProps[i]={latlng:L.LatLngUtil.cloneLatLng(s.getLatLng()),radius:s.getRadius()}:(s instanceof L.Marker||s instanceof L.CircleMarker)&&(this._uneditedLayerProps[i]={latlng:L.LatLngUtil.cloneLatLng(s.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(s){var i=L.Util.stamp(s);s.edited=!1,this._uneditedLayerProps.hasOwnProperty(i)&&(s instanceof L.Polyline||s instanceof L.Polygon||s instanceof L.Rectangle?s.setLatLngs(this._uneditedLayerProps[i].latlngs):s instanceof L.Circle?(s.setLatLng(this._uneditedLayerProps[i].latlng),s.setRadius(this._uneditedLayerProps[i].radius)):(s instanceof L.Marker||s instanceof L.CircleMarker)&&s.setLatLng(this._uneditedLayerProps[i].latlng),s.fire("revert-edited",{layer:s}))},_enableLayerEdit:function(s){var i,l,u=s.layer||s.target||s;this._backupLayer(u),this.options.poly&&(l=L.Util.extend({},this.options.poly),u.options.poly=l),this.options.selectedPathOptions&&(i=L.Util.extend({},this.options.selectedPathOptions),i.maintainColor&&(i.color=u.options.color,i.fillColor=u.options.fillColor),u.options.original=L.extend({},u.options),u.options.editing=i),u instanceof L.Marker?(u.editing&&u.editing.enable(),u.dragging.enable(),u.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):u.editing.enable()},_disableLayerEdit:function(s){var i=s.layer||s.target||s;i.edited=!1,i.editing&&i.editing.disable(),delete i.options.editing,delete i.options.original,this._selectedPathOptions&&(i instanceof L.Marker?this._toggleMarkerHighlight(i):(i.setStyle(i.options.previousOptions),delete i.options.previousOptions)),i instanceof L.Marker?(i.dragging.disable(),i.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):i.editing.disable()},_onMouseMove:function(s){this._tooltip.updatePosition(s.latlng)},_onMarkerDragEnd:function(s){var i=s.target;i.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:i})},_onTouchMove:function(s){var i=s.originalEvent.changedTouches[0],l=this._map.mouseEventToLayerPoint(i),u=this._map.layerPointToLatLng(l);s.target.setLatLng(u)},_hasAvailableLayers:function(){return this._featureGroup.getLayers().length!==0}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(s,i){if(L.Handler.prototype.initialize.call(this,s),L.Util.setOptions(this,i),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var l=L.version.split(".");parseInt(l[0],10)===1&&parseInt(l[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var s=this._map;s&&(s.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(s){this._deletableLayers.addLayer(s),s.fire("revert-deleted",{layer:s})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer(function(s){this._removeLayer({layer:s})},this),this.save()},_enableLayerDelete:function(s){(s.layer||s.target||s).on("click",this._removeLayer,this)},_disableLayerDelete:function(s){var i=s.layer||s.target||s;i.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(i)},_removeLayer:function(s){var i=s.layer||s.target||s;this._deletableLayers.removeLayer(i),this._deletedLayers.addLayer(i),i.fire("deleted")},_onMouseMove:function(s){this._tooltip.updatePosition(s.latlng)},_hasAvailableLayers:function(){return this._deletableLayers.getLayers().length!==0}})})(window,document);const nm=(e,t)=>e?e.length<=t?e:e.substring(0,t)+"...":"",hf=e=>e.length*6+12,ou=(e,t)=>!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom),d_=(e,t)=>{if(!e||t.length===0)return new Set;const n=[],a=e.getBounds();t.forEach(l=>{if(a.contains(l.getLatLng())){const u=e.latLngToContainerPoint(l.getLatLng()),d=l.locationData;d&&n.push({marker:l,pixelPos:u,location:d})}});const s=n.map(({marker:l,pixelPos:u,location:d})=>{const g=hf(d.name),y=d.description?hf(`${d.name}: ${nm(d.description,50)}`):g;return{marker:l,location:d,markerBox:{left:u.x-15,right:u.x+15,top:u.y-15,bottom:u.y+15},baseLabelBox:{left:u.x-g/2,right:u.x+g/2,top:u.y+15+2,bottom:u.y+15+2+20},descLabelBox:d.description?{left:u.x-y/2,right:u.x+y/2,top:u.y+15+2,bottom:u.y+15+2+20}:null}}),i=new Set;return s.forEach(({marker:l,location:u,markerBox:d,baseLabelBox:h,descLabelBox:p},g)=>{if(!u.description)return;let y=!1;for(let b=0;b<s.length;b++){if(g===b)continue;const C=s[b];if(ou(p,C.markerBox)||ou(p,C.baseLabelBox)){y=!0;break}if(C.descLabelBox&&i.has(C.location.id)&&ou(p,C.descLabelBox)){y=!0;break}}y||i.add(u.id)}),i},kr=[{value:"circle",label:"Circle"},{value:"square",label:"Square"},{value:"hexagon",label:"Hexagon"},{value:"pentagon",label:"Pentagon"},{value:"diamond",label:"Diamond"},{value:"star",label:"Star"},{value:"dot",label:"Dot"},{value:"none",label:"None"}],h_=[{value:"33",label:"Small (33%)"},{value:"66",label:"Medium (66%)"},{value:"100",label:"Normal (100%)"},{value:"150",label:"Large (150%)"}],Kr=[{value:"default",label:"Default",isShapeOnly:!1,category:"default"},{value:"dot",label:"Dot",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"circle",label:"Circle",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"square",label:"Square",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"triangle",label:"Triangle",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"diamond",label:"Diamond",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"star",label:"Star",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"hexagon",label:"Hexagon",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"pentagon",label:"Pentagon",isShapeOnly:!0,category:"shape",defaultColor:"#667eea"},{value:"car",label:"Car",isShapeOnly:!1,category:"content",defaultColor:"#EF4444"},{value:"bike",label:"Bike",isShapeOnly:!1,category:"content",defaultColor:"#EF4444"},{value:"water",label:"Water",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"food",label:"Food",isShapeOnly:!1,category:"content",defaultColor:"#F59E0B"},{value:"medical",label:"Medical",isShapeOnly:!1,category:"content",defaultColor:"#EF4444"},{value:"photo",label:"Photo",isShapeOnly:!1,category:"content",defaultColor:"#8B5CF6"},{value:"music",label:"Music",isShapeOnly:!1,category:"content",defaultColor:"#EC4899"},{value:"start",label:"Start",isShapeOnly:!1,category:"content",defaultColor:"#10B981"},{value:"finish",label:"Finish",isShapeOnly:!1,category:"content",defaultColor:"#1F2937"},{value:"toilet",label:"Toilet",isShapeOnly:!1,category:"content",defaultColor:"#6366F1"},{value:"shower",label:"Shower",isShapeOnly:!1,category:"content",defaultColor:"#06B6D4"},{value:"bus",label:"Bus",isShapeOnly:!1,category:"content",defaultColor:"#F97316"},{value:"info",label:"Information",isShapeOnly:!1,category:"content",defaultColor:"#0EA5E9"},{value:"merch",label:"Merchandise",isShapeOnly:!1,category:"content",defaultColor:"#A855F7"},{value:"cone",label:"Road closure",isShapeOnly:!1,category:"content",defaultColor:"#FF6B00"},{value:"traffic",label:"Traffic management",isShapeOnly:!1,category:"content",defaultColor:"#374151"},{value:"track",label:"Track",isShapeOnly:!1,category:"content",defaultColor:"#78716C"},{value:"tunnel",label:"Tunnel",isShapeOnly:!1,category:"content",defaultColor:"#57534E"},{value:"bridge",label:"Bridge",isShapeOnly:!1,category:"content",defaultColor:"#0284C7"},{value:"plane",label:"Plane",isShapeOnly:!1,category:"content",defaultColor:"#0EA5E9"},{value:"hill",label:"Hill",isShapeOnly:!1,category:"content",defaultColor:"#65A30D"},{value:"baggage",label:"Baggage",isShapeOnly:!1,category:"content",defaultColor:"#A855F7"},{value:"crown",label:"Crown",isShapeOnly:!1,category:"content",defaultColor:"#F59E0B"},{value:"crossing",label:"Crossing point",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"trees",label:"Trees",isShapeOnly:!1,category:"content",defaultColor:"#22C55E"},{value:"arrow-uturn-left",label:"Left u-turn",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-left",label:"Left turn",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-slight-left",label:"Slight left",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-straight",label:"Straight ahead",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-slight-right",label:"Slight right",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-right",label:"Right turn",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-uturn-right",label:"Right u-turn",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-fork-left",label:"Left fork",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-fork-right",label:"Right fork",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-keep-left",label:"Keep left",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"},{value:"arrow-keep-right",label:"Keep right",isShapeOnly:!1,category:"content",defaultColor:"#3B82F6"}];function ri(e){return Kr.find(t=>t.value===e)||Kr[0]}function f_(e){return ri(e).defaultColor||"#667eea"}function p_(e,t){return t||f_(e)}const Pu={dot:(e,t=32)=>{const n=(t/2-2)*.33;return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <circle cx="${t/2}" cy="${t/2}" r="${n}" fill="${e}" stroke="#fff" stroke-width="1.5"/>
    </svg>`},circle:(e,t=32)=>{const n=t/2-2;return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <circle cx="${t/2}" cy="${t/2}" r="${n}" fill="${e}" stroke="#fff" stroke-width="2"/>
    </svg>`},square:(e,t=32)=>`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <rect x="4" y="4" width="${t-8}" height="${t-8}" rx="4" fill="${e}" stroke="#fff" stroke-width="2"/>
    </svg>`,triangle:(e,t=32)=>{const n=t/2,a=4,s=t-4,i=4,l=t-4;return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <polygon points="${n},${a} ${l},${s} ${i},${s}" fill="${e}" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
    </svg>`},diamond:(e,t=32)=>{const n=t/2,a=t/2,s=t/2-4;return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <polygon points="${n},${a-s} ${n+s},${a} ${n},${a+s} ${n-s},${a}" fill="${e}" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
    </svg>`},star:(e,t=32)=>{const n=t/2,a=t/2,s=t/2-3,i=s*.4,l=[];for(let u=0;u<5;u++){const d=Math.PI/2*-1+u*2*Math.PI/5;l.push(`${n+s*Math.cos(d)},${a+s*Math.sin(d)}`);const h=d+Math.PI/5;l.push(`${n+i*Math.cos(h)},${a+i*Math.sin(h)}`)}return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <polygon points="${l.join(" ")}" fill="${e}" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
    </svg>`},hexagon:(e,t=32)=>{const n=t/2,a=t/2,s=t/2-4,i=[];for(let l=0;l<6;l++){const u=Math.PI/6+l*Math.PI/3;i.push(`${n+s*Math.cos(u)},${a+s*Math.sin(u)}`)}return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <polygon points="${i.join(" ")}" fill="${e}" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
    </svg>`},pentagon:(e,t=32)=>{const n=t/2,a=t/2,s=t/2-4,i=[];for(let l=0;l<5;l++){const u=Math.PI/2*-1+l*2*Math.PI/5;i.push(`${n+s*Math.cos(u)},${a+s*Math.sin(u)}`)}return`<svg width="${t}" height="${t}" viewBox="0 0 ${t} ${t}" xmlns="http://www.w3.org/2000/svg">
      <polygon points="${i.join(" ")}" fill="${e}" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
    </svg>`},car:(e,t=32)=>`<svg width="${t}" height="${t}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="${e}" stroke="#fff" stroke-width="2"/>
      <!-- Car body -->
      <rect x="6" y="13" width="20" height="8" rx="2" fill="#fff"/>
      <!-- Car roof/cabin -->
      <path d="M10 13 L12 9 L20 9 L22 13" fill="#fff" stroke="#fff" stroke-width="1"/>
      <!-- Windows -->
      <path d="M11 12 L12.5 9.5 L15 9.5 L15 12 Z" fill="${e}"/>
      <path d="M17 12 L17 9.5 L19.5 9.5 L21 12 Z" fill="${e}"/>
      <!-- Tires (always black) -->
      <circle cx="10" cy="21" r="2.5" fill="#1F2937" stroke="#fff" stroke-width="0.5"/>
      <circle cx="22" cy="21" r="2.5" fill="#1F2937" stroke="#fff" stroke-width="0.5"/>
      <!-- Wheel centers -->
      <circle cx="10" cy="21" r="1" fill="#9CA3AF"/>
      <circle cx="22" cy="21" r="1" fill="#9CA3AF"/>
    </svg>`,bike:(e,t=32)=>`<svg width="${t}" height="${t}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="${e}" stroke="#fff" stroke-width="2"/>
      <!-- Tires (same color as bike) -->
      <circle cx="9" cy="20" r="4" fill="none" stroke="#fff" stroke-width="2"/>
      <circle cx="23" cy="20" r="4" fill="none" stroke="#fff" stroke-width="2"/>
      <!-- Wheel centers -->
      <circle cx="9" cy="20" r="1" fill="#fff"/>
      <circle cx="23" cy="20" r="1" fill="#fff"/>
      <!-- Frame -->
      <path d="M9 20 L16 12 L23 20 M16 12 L16 20 L9 20" fill="none" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
      <!-- Handlebars -->
      <path d="M16 12 L18 10 M16 12 L14 10" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
      <!-- Seat -->
      <ellipse cx="12" cy="13" rx="2" ry="1" fill="#fff"/>
    </svg>`},ff={water:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <path d="M16 8 C16 8 10 14 10 18 C10 21.3 12.7 24 16 24 C19.3 24 22 21.3 22 18 C22 14 16 8 16 8Z" fill="#fff"/>
    </svg>`,food:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#F59E0B" stroke="#fff" stroke-width="2"/>
      <path d="M11 9v6c0 1.1.9 2 2 2h1v7h2v-7h1c1.1 0 2-.9 2-2V9h-2v5h-1V9h-2v5h-1V9h-2z" fill="#fff"/>
      <path d="M21 9v14h2V9h-2z" fill="#fff"/>
    </svg>`,medical:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#EF4444" stroke="#fff" stroke-width="2"/>
      <rect x="14" y="8" width="4" height="16" rx="1" fill="#fff"/>
      <rect x="8" y="14" width="16" height="4" rx="1" fill="#fff"/>
    </svg>`,photo:(e=32)=>{const t="#8B5CF6";return`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="${t}" stroke="#fff" stroke-width="2"/>
      <rect x="8" y="10" width="16" height="12" rx="2" fill="#fff"/>
      <circle cx="16" cy="16" r="3.5" fill="${t}"/>
      <circle cx="21" y="13" r="1" fill="${t}"/>
    </svg>`},music:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#EC4899" stroke="#fff" stroke-width="2"/>
      <path d="M12 22c1.66 0 3-1.34 3-3v-9h5v4h-3v5c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3c.35 0 .69.07 1 .18V10c0-.55.45-1 1-1h5c.55 0 1 .45 1 1v6h-5v5c0 2.76-2.24 5-5 5s-5-2.24-5-5 2.24-5 5-5c.7 0 1.37.15 2 .41" fill="#fff"/>
      <ellipse cx="12" cy="21" rx="2.5" ry="2" fill="#fff"/>
      <rect x="14" y="10" width="2" height="9" fill="#fff"/>
      <rect x="14" y="10" width="6" height="2" fill="#fff"/>
    </svg>`,start:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#10B981" stroke="#fff" stroke-width="2"/>
      <path d="M11 8v16l2-2V10l7 6-7 6v-4l-2 2v4l12-10-12-10v4z" fill="#fff"/>
    </svg>`,finish:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#1F2937" stroke="#fff" stroke-width="2"/>
      <rect x="10" y="8" width="4" height="4" fill="#fff"/>
      <rect x="14" y="12" width="4" height="4" fill="#fff"/>
      <rect x="18" y="8" width="4" height="4" fill="#fff"/>
      <rect x="10" y="16" width="4" height="4" fill="#fff"/>
      <rect x="18" y="16" width="4" height="4" fill="#fff"/>
      <rect x="14" y="20" width="4" height="4" fill="#fff"/>
    </svg>`,toilet:(e=32)=>{const t="#6366F1";return`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="${t}" stroke="#fff" stroke-width="2"/>
      <rect x="11" y="7" width="10" height="3" rx="1" fill="#fff"/>
      <ellipse cx="16" cy="15" rx="6" ry="5" fill="#fff"/>
      <ellipse cx="16" cy="15" rx="4" ry="3" fill="${t}"/>
      <path d="M12 19 Q16 24 20 19" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round"/>
    </svg>`},shower:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#06B6D4" stroke="#fff" stroke-width="2"/>
      <circle cx="16" cy="10" r="3" fill="#fff"/>
      <path d="M11 14h10l-1 4h-8l-1-4z" fill="#fff"/>
      <line x1="12" y1="19" x2="12" y2="23" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="14.5" y1="19" x2="14.5" y2="24" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="17.5" y1="19" x2="17.5" y2="24" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="20" y1="19" x2="20" y2="23" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
    </svg>`,bus:(e=32)=>{const t="#F97316";return`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="${t}" stroke="#fff" stroke-width="2"/>
      <rect x="9" y="9" width="14" height="12" rx="2" fill="#fff"/>
      <rect x="10" y="11" width="5" height="4" rx="0.5" fill="${t}"/>
      <rect x="17" y="11" width="5" height="4" rx="0.5" fill="${t}"/>
      <rect x="9" y="17" width="14" height="2" fill="#fff"/>
      <circle cx="12" cy="21" r="1.5" fill="#fff"/>
      <circle cx="20" cy="21" r="1.5" fill="#fff"/>
    </svg>`},info:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#0EA5E9" stroke="#fff" stroke-width="2"/>
      <circle cx="16" cy="10" r="2" fill="#fff"/>
      <rect x="14" y="14" width="4" height="10" rx="1" fill="#fff"/>
    </svg>`,merch:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#A855F7" stroke="#fff" stroke-width="2"/>
      <path d="M10 10 L13 10 L16 13 L19 10 L22 10 L22 14 L20 14 L20 24 L12 24 L12 14 L10 14 Z" fill="#fff"/>
      <path d="M13 10 L16 7 L19 10" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>`,cone:(e=32)=>{const t="#FF6B00";return`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="${t}" stroke="#fff" stroke-width="2"/>
      <path d="M16 6 L21 22 H11 L16 6Z" fill="#fff"/>
      <rect x="11" y="17" width="10" height="2" fill="${t}"/>
      <rect x="12" y="12" width="8" height="2" fill="${t}"/>
      <rect x="9" y="22" width="14" height="3" rx="1" fill="#fff"/>
    </svg>`},traffic:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#374151" stroke="#fff" stroke-width="2"/>
      <rect x="12" y="6" width="8" height="20" rx="2" fill="#fff"/>
      <circle cx="16" cy="10" r="2" fill="#EF4444"/>
      <circle cx="16" cy="16" r="2" fill="#F59E0B"/>
      <circle cx="16" cy="22" r="2" fill="#10B981"/>
    </svg>`,crown:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#F59E0B" stroke="#fff" stroke-width="2"/>
      <path d="M8 21 L8 14 L12 17 L16 11 L20 17 L24 14 L24 21 Z" fill="#fff"/>
      <rect x="8" y="21" width="16" height="3" rx="1" fill="#fff"/>
    </svg>`,crossing:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <!-- Crossing stripes -->
      <rect x="6" y="22" width="20" height="2" fill="#fff" opacity="0.5"/>
      <rect x="6" y="25" width="20" height="2" fill="#fff" opacity="0.5"/>
      <!-- Walking pedestrian -->
      <circle cx="16" cy="7" r="2.5" fill="#fff"/>
      <path d="M16 10 L16 16" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/>
      <path d="M13 13 L19 13" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
      <path d="M16 16 L13 22" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
      <path d="M16 16 L19 22" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
    </svg>`,trees:(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#22C55E" stroke="#fff" stroke-width="2"/>
      <!-- Left tree -->
      <path d="M10 22 L10 18 L7 18 L11 12 L8 12 L11 7 L14 12 L11 12 L15 18 L12 18 L12 22 Z" fill="#fff"/>
      <!-- Right tree -->
      <path d="M20 22 L20 18 L17 18 L21 12 L18 12 L21 7 L24 12 L21 12 L25 18 L22 18 L22 22 Z" fill="#fff"/>
    </svg>`,"arrow-uturn-left":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <!-- U-turn path: up on right, curve left, down on left -->
      <path d="M20 24 L20 11 C20 7 12 7 12 11 L12 18" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <!-- Arrow head pointing down on left side -->
      <path d="M7 15 L12 21 L17 15" fill="#fff" stroke="#fff" stroke-width="1" stroke-linejoin="round"/>
    </svg>`,"arrow-left":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <path d="M14 8 L6 16 L14 24 L14 19 L26 19 L26 13 L14 13 L14 8Z" fill="#fff"/>
    </svg>`,"arrow-slight-left":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <g transform="rotate(-30 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="#fff"/>
      </g>
    </svg>`,"arrow-straight":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="#fff"/>
    </svg>`,"arrow-slight-right":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <g transform="rotate(30 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="#fff"/>
      </g>
    </svg>`,"arrow-right":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <path d="M18 8 L26 16 L18 24 L18 19 L6 19 L6 13 L18 13 L18 8Z" fill="#fff"/>
    </svg>`,"arrow-uturn-right":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <!-- U-turn path: up on left, curve right, down on right -->
      <path d="M12 24 L12 11 C12 7 20 7 20 11 L20 18" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <!-- Arrow head pointing down on right side -->
      <path d="M15 15 L20 21 L25 15" fill="#fff" stroke="#fff" stroke-width="1" stroke-linejoin="round"/>
    </svg>`,"arrow-fork-left":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <!-- Main stem coming from bottom -->
      <rect x="14" y="18" width="4" height="8" fill="#fff"/>
      <!-- Left fork (correct way - with arrow) -->
      <path d="M16 18 L10 12" stroke="#fff" stroke-width="4" stroke-linecap="round"/>
      <path d="M10 12 L6 10 L8 16 Z" fill="#fff"/>
      <!-- Right fork (wrong way - with X) -->
      <path d="M16 18 L22 12" stroke="#fff" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
      <path d="M20 8 L24 12 M24 8 L20 12" stroke="#EF4444" stroke-width="2" stroke-linecap="round"/>
    </svg>`,"arrow-fork-right":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <!-- Main stem coming from bottom -->
      <rect x="14" y="18" width="4" height="8" fill="#fff"/>
      <!-- Left fork (wrong way - with X) -->
      <path d="M16 18 L10 12" stroke="#fff" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
      <path d="M8 8 L12 12 M12 8 L8 12" stroke="#EF4444" stroke-width="2" stroke-linecap="round"/>
      <!-- Right fork (correct way - with arrow) -->
      <path d="M16 18 L22 12" stroke="#fff" stroke-width="4" stroke-linecap="round"/>
      <path d="M22 12 L26 10 L24 16 Z" fill="#fff"/>
    </svg>`,"arrow-keep-left":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <g transform="rotate(-150 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="#fff"/>
      </g>
    </svg>`,"arrow-keep-right":(e=32)=>`<svg width="${e}" height="${e}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <circle cx="16" cy="16" r="14" fill="#3B82F6" stroke="#fff" stroke-width="2"/>
      <g transform="rotate(150 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="#fff"/>
      </g>
    </svg>`},Di={circle:({backgroundColor:e,borderColor:t})=>`<circle cx="16" cy="16" r="14" fill="${e}" stroke="${t==="none"?"none":t||"#fff"}" stroke-width="${t==="none"?0:2}"/>`,square:({backgroundColor:e,borderColor:t})=>`<rect x="4" y="4" width="24" height="24" rx="4" fill="${e}" stroke="${t==="none"?"none":t||"#fff"}" stroke-width="${t==="none"?0:2}"/>`,hexagon:({backgroundColor:e,borderColor:t})=>{const n=t==="none"?"none":t||"#fff",a=t==="none"?0:2,s=[];for(let i=0;i<6;i++){const l=Math.PI/6+i*Math.PI/3;s.push(`${16+12*Math.cos(l)},${16+12*Math.sin(l)}`)}return`<polygon points="${s.join(" ")}" fill="${e}" stroke="${n}" stroke-width="${a}" stroke-linejoin="round"/>`},pentagon:({backgroundColor:e,borderColor:t})=>{const n=t==="none"?"none":t||"#fff",a=t==="none"?0:2,s=[];for(let i=0;i<5;i++){const l=Math.PI/2*-1+i*2*Math.PI/5;s.push(`${16+12*Math.cos(l)},${16+12*Math.sin(l)}`)}return`<polygon points="${s.join(" ")}" fill="${e}" stroke="${n}" stroke-width="${a}" stroke-linejoin="round"/>`},diamond:({backgroundColor:e,borderColor:t})=>`<polygon points="16,4 28,16 16,28 4,16" fill="${e}" stroke="${t==="none"?"none":t||"#fff"}" stroke-width="${t==="none"?0:2}" stroke-linejoin="round"/>`,star:({backgroundColor:e,borderColor:t})=>{const n=t==="none"?"none":t||"#fff",a=t==="none"?0:2,s=13,i=s*.4,l=[];for(let u=0;u<5;u++){const d=Math.PI/2*-1+u*2*Math.PI/5;l.push(`${16+s*Math.cos(d)},${16+s*Math.sin(d)}`);const h=d+Math.PI/5;l.push(`${16+i*Math.cos(h)},${16+i*Math.sin(h)}`)}return`<polygon points="${l.join(" ")}" fill="${e}" stroke="${n}" stroke-width="${a}" stroke-linejoin="round"/>`},dot:({backgroundColor:e,borderColor:t})=>`<circle cx="16" cy="16" r="5" fill="${e}" stroke="${t==="none"?"none":t||"#fff"}" stroke-width="${t==="none"?0:1.5}"/>`,none:()=>""},pf={water:(e="#fff")=>`<path d="M16 8 C16 8 10 14 10 18 C10 21.3 12.7 24 16 24 C19.3 24 22 21.3 22 18 C22 14 16 8 16 8Z" fill="${e}"/>`,food:(e="#fff")=>`<path d="M11 9v6c0 1.1.9 2 2 2h1v7h2v-7h1c1.1 0 2-.9 2-2V9h-2v5h-1V9h-2v5h-1V9h-2z" fill="${e}"/>
      <path d="M21 9v14h2V9h-2z" fill="${e}"/>`,medical:(e="#fff")=>`<rect x="14" y="8" width="4" height="16" rx="1" fill="${e}"/>
      <rect x="8" y="14" width="16" height="4" rx="1" fill="${e}"/>`,photo:(e="#fff",t="#667eea")=>`<rect x="8" y="10" width="16" height="12" rx="2" fill="${e}"/>
      <circle cx="16" cy="16" r="3.5" fill="${t}"/>
      <circle cx="21" cy="13" r="1" fill="${t}"/>`,music:(e="#fff")=>`<ellipse cx="12" cy="21" rx="2.5" ry="2" fill="${e}"/>
      <rect x="14" y="10" width="2" height="9" fill="${e}"/>
      <rect x="14" y="10" width="6" height="2" fill="${e}"/>`,start:(e="#fff")=>`<path d="M11 8v16l2-2V10l7 6-7 6v-4l-2 2v4l12-10-12-10v4z" fill="${e}"/>`,finish:(e="#fff")=>`<rect x="10" y="8" width="4" height="4" fill="${e}"/>
      <rect x="14" y="12" width="4" height="4" fill="${e}"/>
      <rect x="18" y="8" width="4" height="4" fill="${e}"/>
      <rect x="10" y="16" width="4" height="4" fill="${e}"/>
      <rect x="18" y="16" width="4" height="4" fill="${e}"/>
      <rect x="14" y="20" width="4" height="4" fill="${e}"/>`,toilet:(e="#fff",t="#667eea")=>`<rect x="11" y="7" width="10" height="3" rx="1" fill="${e}"/>
      <ellipse cx="16" cy="15" rx="6" ry="5" fill="${e}"/>
      <ellipse cx="16" cy="15" rx="4" ry="3" fill="${t}"/>
      <path d="M12 19 Q16 24 20 19" stroke="${e}" stroke-width="2" fill="none" stroke-linecap="round"/>`,shower:(e="#fff")=>`<circle cx="16" cy="10" r="3" fill="${e}"/>
      <path d="M11 14h10l-1 4h-8l-1-4z" fill="${e}"/>
      <line x1="12" y1="19" x2="12" y2="23" stroke="${e}" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="14.5" y1="19" x2="14.5" y2="24" stroke="${e}" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="17.5" y1="19" x2="17.5" y2="24" stroke="${e}" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="20" y1="19" x2="20" y2="23" stroke="${e}" stroke-width="1.5" stroke-linecap="round"/>`,bus:(e="#fff",t="#667eea")=>`<rect x="9" y="9" width="14" height="12" rx="2" fill="${e}"/>
      <rect x="10" y="11" width="5" height="4" rx="0.5" fill="${t}"/>
      <rect x="17" y="11" width="5" height="4" rx="0.5" fill="${t}"/>
      <rect x="9" y="17" width="14" height="2" fill="${e}"/>
      <circle cx="12" cy="21" r="1.5" fill="${e}"/>
      <circle cx="20" cy="21" r="1.5" fill="${e}"/>`,info:(e="#fff")=>`<circle cx="16" cy="10" r="2" fill="${e}"/>
      <rect x="14" y="14" width="4" height="10" rx="1" fill="${e}"/>`,merch:(e="#fff")=>`<path d="M10 10 L13 10 L16 13 L19 10 L22 10 L22 14 L20 14 L20 24 L12 24 L12 14 L10 14 Z" fill="${e}"/>
      <path d="M13 10 L16 7 L19 10" stroke="${e}" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`,cone:(e="#fff",t="#667eea")=>`<path d="M16 6 L21 22 H11 L16 6Z" fill="${e}"/>
      <rect x="11" y="17" width="10" height="2" fill="${t}"/>
      <rect x="12" y="12" width="8" height="2" fill="${t}"/>
      <rect x="9" y="22" width="14" height="3" rx="1" fill="${e}"/>`,traffic:(e="#fff")=>`<rect x="12" y="6" width="8" height="20" rx="2" fill="${e}"/>
      <circle cx="16" cy="10" r="2" fill="#EF4444"/>
      <circle cx="16" cy="16" r="2" fill="#F59E0B"/>
      <circle cx="16" cy="22" r="2" fill="#10B981"/>`,car:(e="#fff",t="#667eea")=>`<rect x="6" y="13" width="20" height="8" rx="2" fill="${e}"/>
      <path d="M10 13 L12 9 L20 9 L22 13" fill="${e}" stroke="${e}" stroke-width="1"/>
      <path d="M11 12 L12.5 9.5 L15 9.5 L15 12 Z" fill="${t}"/>
      <path d="M17 12 L17 9.5 L19.5 9.5 L21 12 Z" fill="${t}"/>
      <circle cx="10" cy="21" r="2.5" fill="#1F2937" stroke="${e}" stroke-width="0.5"/>
      <circle cx="22" cy="21" r="2.5" fill="#1F2937" stroke="${e}" stroke-width="0.5"/>
      <circle cx="10" cy="21" r="1" fill="#9CA3AF"/>
      <circle cx="22" cy="21" r="1" fill="#9CA3AF"/>`,bike:(e="#fff")=>`<circle cx="9" cy="20" r="4" fill="none" stroke="${e}" stroke-width="2"/>
      <circle cx="23" cy="20" r="4" fill="none" stroke="${e}" stroke-width="2"/>
      <circle cx="9" cy="20" r="1" fill="${e}"/>
      <circle cx="23" cy="20" r="1" fill="${e}"/>
      <path d="M9 20 L16 12 L23 20 M16 12 L16 20 L9 20" fill="none" stroke="${e}" stroke-width="2" stroke-linejoin="round"/>
      <path d="M16 12 L18 10 M16 12 L14 10" fill="none" stroke="${e}" stroke-width="1.5" stroke-linecap="round"/>
      <ellipse cx="12" cy="13" rx="2" ry="1" fill="${e}"/>`,"arrow-uturn-left":(e="#fff")=>`<path d="M20 24 L20 11 C20 7 12 7 12 11 L12 18" fill="none" stroke="${e}" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M7 15 L12 21 L17 15" fill="${e}" stroke="${e}" stroke-width="1" stroke-linejoin="round"/>`,"arrow-left":(e="#fff")=>`<path d="M14 8 L6 16 L14 24 L14 19 L26 19 L26 13 L14 13 L14 8Z" fill="${e}"/>`,"arrow-slight-left":(e="#fff")=>`<g transform="rotate(-30 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="${e}"/>
      </g>`,"arrow-straight":(e="#fff")=>`<path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="${e}"/>`,"arrow-slight-right":(e="#fff")=>`<g transform="rotate(30 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="${e}"/>
      </g>`,"arrow-right":(e="#fff")=>`<path d="M18 8 L26 16 L18 24 L18 19 L6 19 L6 13 L18 13 L18 8Z" fill="${e}"/>`,"arrow-uturn-right":(e="#fff")=>`<path d="M12 24 L12 11 C12 7 20 7 20 11 L20 18" fill="none" stroke="${e}" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M15 15 L20 21 L25 15" fill="${e}" stroke="${e}" stroke-width="1" stroke-linejoin="round"/>`,"arrow-fork-left":(e="#fff")=>`<rect x="14" y="18" width="4" height="8" fill="${e}"/>
      <path d="M16 18 L10 12" stroke="${e}" stroke-width="4" stroke-linecap="round"/>
      <!-- Left arrowhead -->
      <path d="M10 12 L6 10 L8 16 Z" fill="${e}"/>
      <!-- Wrong way indicator on right -->
      <path d="M16 18 L22 12" stroke="${e}" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
      <path d="M20 8 L24 12 M24 8 L20 12" stroke="#EF4444" stroke-width="2" stroke-linecap="round"/>`,"arrow-fork-right":(e="#fff")=>`<rect x="14" y="18" width="4" height="8" fill="${e}"/>
      <!-- Wrong way indicator on left -->
      <path d="M16 18 L10 12" stroke="${e}" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
      <path d="M8 8 L12 12 M12 8 L8 12" stroke="#EF4444" stroke-width="2" stroke-linecap="round"/>
      <path d="M16 18 L22 12" stroke="${e}" stroke-width="4" stroke-linecap="round"/>
      <!-- Right arrowhead -->
      <path d="M22 12 L26 10 L24 16 Z" fill="${e}"/>`,"arrow-keep-left":(e="#fff")=>`<g transform="rotate(-150 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="${e}"/>
      </g>`,"arrow-keep-right":(e="#fff")=>`<g transform="rotate(150 16 16)">
        <path d="M16 6 L8 14 L13 14 L13 26 L19 26 L19 14 L24 14 L16 6Z" fill="${e}"/>
      </g>`,track:(e="#fff")=>`
      <rect x="10" y="7" width="2.5" height="18" fill="${e}"/>
      <rect x="19.5" y="7" width="2.5" height="18" fill="${e}"/>
      <rect x="8" y="9" width="16" height="2.5" rx="0.5" fill="${e}"/>
      <rect x="8" y="14.5" width="16" height="2.5" rx="0.5" fill="${e}"/>
      <rect x="8" y="20" width="16" height="2.5" rx="0.5" fill="${e}"/>`,tunnel:(e="#fff")=>`
      <path d="M7 25 L7 14 C7 8 11 5 16 5 C21 5 25 8 25 14 L25 25" fill="none" stroke="${e}" stroke-width="2.5"/>
      <path d="M11 25 L11 16 C11 12 13 10 16 10 C19 10 21 12 21 16 L21 25" fill="none" stroke="${e}" stroke-width="1.5" opacity="0.6"/>`,bridge:(e="#fff")=>`
      <rect x="5" y="18" width="22" height="2.5" rx="0.5" fill="${e}"/>
      <rect x="7" y="10" width="2" height="8" fill="${e}"/>
      <rect x="23" y="10" width="2" height="8" fill="${e}"/>
      <path d="M8 10 Q16 6 24 10" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="13" x2="12" y2="18" stroke="${e}" stroke-width="1.5"/>
      <line x1="16" y1="11.5" x2="16" y2="18" stroke="${e}" stroke-width="1.5"/>
      <line x1="20" y1="13" x2="20" y2="18" stroke="${e}" stroke-width="1.5"/>`,plane:(e="#fff")=>`
      <g fill="${e}">
        <!-- Fuselage body -->
        <path d="M27 16 L24 14 L8 14 Q4 16 8 18 L24 18 L27 16 Z"/>
        <!-- Nose cone -->
        <path d="M8 14 Q4 16 8 18 L8 14 Z"/>
        <!-- Tail fin -->
        <path d="M26 14 L26 9 L22 14 Z"/>
        <!-- Main wing -->
        <path d="M20 16 L16 10 L14 10 L16 16 L14 22 L16 22 L20 16 Z"/>
        <!-- Cockpit window -->
        <ellipse cx="10" cy="16" rx="1.5" ry="1" fill="none" stroke="${e}" stroke-width="0.5" opacity="0.6"/>
      </g>`,hill:(e="#fff")=>`
      <path d="M6 24 L13 12 L16 16 L20 10 L26 24 Z" fill="${e}"/>
      <path d="M20 10 L22 13 L18 13 Z" fill="${e}" opacity="0.6"/>`,baggage:(e="#fff")=>`
      <rect x="8" y="12" width="16" height="12" rx="2" fill="${e}"/>
      <rect x="12" y="8" width="8" height="4" rx="1" fill="none" stroke="${e}" stroke-width="2"/>
      <line x1="12" y1="16" x2="20" y2="16" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
      <line x1="12" y1="20" x2="20" y2="20" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>`,crown:(e="#fff")=>`
      <path d="M8 21 L8 14 L12 17 L16 11 L20 17 L24 14 L24 21 Z" fill="${e}"/>
      <rect x="8" y="21" width="16" height="3" rx="1" fill="${e}"/>`,crossing:(e="#fff")=>`
      <!-- Crossing stripes -->
      <rect x="6" y="22" width="20" height="2" fill="${e}" opacity="0.5"/>
      <rect x="6" y="25" width="20" height="2" fill="${e}" opacity="0.5"/>
      <!-- Walking pedestrian -->
      <circle cx="16" cy="7" r="2.5" fill="${e}"/>
      <path d="M16 10 L16 16" stroke="${e}" stroke-width="2.5" stroke-linecap="round"/>
      <path d="M13 13 L19 13" stroke="${e}" stroke-width="2" stroke-linecap="round"/>
      <path d="M16 16 L13 22" stroke="${e}" stroke-width="2" stroke-linecap="round"/>
      <path d="M16 16 L19 22" stroke="${e}" stroke-width="2" stroke-linecap="round"/>`,trees:(e="#fff")=>`
      <path d="M10 22 L10 18 L7 18 L11 12 L8 12 L11 7 L14 12 L11 12 L15 18 L12 18 L12 22 Z" fill="${e}"/>
      <path d="M20 22 L20 18 L17 18 L21 12 L18 12 L21 7 L24 12 L21 12 L25 18 L22 18 L22 22 Z" fill="${e}"/>`};function In({type:e,backgroundShape:t="circle",backgroundColor:n,borderColor:a,iconColor:s,size:i="100",outputSize:l=null}){if(!e||e==="default"){if(!(n||a||s||t&&t!=="circle"&&t!=="default"))return null;e=t&&t!=="default"?t:"circle"}const u=ri(e),d=parseInt(i,10)/100,h=l||Math.round(32*d);let p="";if(u.isShapeOnly){const g=n||u.defaultColor||"#667eea",y=a||"#fff";if(Di[e])p=Di[e]({backgroundColor:g,borderColor:y});else return Pu[e]?.(g,h)||null}else{const g=n||"#667eea",y=a||"#fff",b=s||"#fff",C=t||"circle";C!=="none"&&Di[C]&&(p+=Di[C]({backgroundColor:g,borderColor:y})),pf[e]&&(p+=pf[e](b,g))}return`<svg width="${h}" height="${h}" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    ${p}
  </svg>`}const v_={full:`<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
    <circle cx="7" cy="7" r="6" fill="#10B981" stroke="#fff" stroke-width="1.5"/>
    <path d="M4 7l2 2 4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
  </svg>`,partial:`<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
    <circle cx="7" cy="7" r="6" fill="#F59E0B" stroke="#fff" stroke-width="1.5"/>
    <rect x="6" y="3.5" width="2" height="4.5" rx="1" fill="#fff"/>
    <circle cx="7" cy="10" r="1" fill="#fff"/>
  </svg>`,missing:`<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
    <circle cx="7" cy="7" r="6" fill="#EF4444" stroke="#fff" stroke-width="1.5"/>
    <path d="M4.5 4.5l5 5M9.5 4.5l-5 5" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
  </svg>`};function m_(e,t){return e===0?"missing":e>=t?"full":"partial"}function Du(e,t){const n=m_(e,t);return v_[n]}function g_(e,t,n=32){if(e==="default")return null;if(ff[e])return ff[e](n);if(Pu[e]){const a=t||"#667eea";return Pu[e](a,n)}return null}const y_=["circle","square","hexagon","pentagon"];function k_(e){return y_.includes(e)}function b_(e,t,n,a,s=32,i=!0){const l=g_(e,t,s),u=Du(n,a);if(!l)return null;const d=i&&k_(e),h=p_(e,t),p=w_(h),g=om(h)?"0 1px 2px rgba(255,255,255,0.5)":"0 1px 2px rgba(0,0,0,0.5)",y=s>=36?"12px":"10px",b=d?`
    <div style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: ${p};
      font-weight: bold;
      font-size: ${y};
      text-shadow: ${g};
      pointer-events: none;
    ">${n}/${a}</div>
  `:"";return`
    <div style="position: relative; width: ${s}px; height: ${s}px;">
      ${l}
      ${b}
      <div style="position: absolute; bottom: -4px; right: -4px;">
        ${u}
      </div>
    </div>
  `}function __(e){const t=e.replace("#",""),n=parseInt(t.substr(0,2),16)/255,a=parseInt(t.substr(2,2),16)/255,s=parseInt(t.substr(4,2),16)/255,i=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),l=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4);return .2126*i+.7152*l+.0722*u}function om(e){return!e||e.length<6?!1:__(e)>.4}function w_(e){return om(e)?"#1F2937":"#FFFFFF"}const C_={class:"map-container-wrapper"},L_="#667eea",S_={__name:"MapView",props:{locations:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]},center:{type:Object,default:null},zoom:{type:Number,default:13},clickable:{type:Boolean,default:!1},areas:{type:Array,default:()=>[]},selectedAreaId:{type:String,default:null},drawingMode:{type:Boolean,default:!1},editingPolygon:{type:Array,default:null},userLocation:{type:Object,default:null},highlightLocationId:{type:String,default:null},highlightLocationIds:{type:Array,default:()=>[]},allLocationsForBounds:{type:Array,default:()=>[]},marshalMode:{type:Boolean,default:!1},simplifyNonHighlighted:{type:Boolean,default:!1},hideRecenterButton:{type:Boolean,default:!1}},emits:["location-click","map-click","area-click","polygon-complete","polygon-drawing","polygon-update","visibility-change"],setup(e,{expose:t,emit:n}){const a=e,s=n,i=T(null);let l=null;const u=T([]),d=T([]),h=T([]);let p=null,g=null;const y=T([]);let b=null,C=null,I=!1;const M=T(!1),x=()=>{if(l){const Ie=l.getCenter();return{lat:Ie.lat,lng:Ie.lng}}return null},S=()=>l?l.getZoom():null,_=()=>{if(u.value.length>0){h.value.push([...u.value]);const Ie=d.value.pop()||[];u.value=Ie,$e(),s("polygon-drawing",u.value)}},D=()=>{if(h.value.length>0){d.value.push([...u.value]);const Ie=h.value.pop();u.value=Ie,$e(),s("polygon-drawing",u.value)}},E=()=>u.value.length>0,Z=()=>h.value.length>0,A=()=>u.value.length,N=()=>{u.value.length>=3&&(s("polygon-complete",[...u.value]),B())},B=()=>{u.value=[],d.value=[],h.value=[],$e()},j=()=>{!l||!a.userLocation||(l.setView([a.userLocation.lat,a.userLocation.lng],l.getZoom(),{animate:!0,duration:.5}),M.value=!0)},R=(Ie,be,de=null)=>{if(!l||Ie==null||be==null)return;l.setView([Ie,be],de??l.getZoom(),{animate:!0,duration:.5});const fe=a.center&&Math.abs(a.center.lat-Ie)<1e-4&&Math.abs(a.center.lng-be)<1e-4;M.value=!fe},G=T(!0),ee=T(!0),ne=(Ie,be)=>{if(!l||Ie==null||be==null)return!0;const de=l.getBounds(),fe=Bt.latLng(Ie,be);return de.contains(fe)};t({getMapCenter:x,getMapZoom:S,undoPolygonPoint:_,redoPolygonPoint:D,canUndo:E,canRedo:Z,getPolygonPointCount:A,completePolygon:N,clearPolygonDrawing:B,recenterOnUserLocation:j,recenterOnLocation:R,isLocationInView:ne,userLocationInView:ee,highlightedLocationInView:G});const Ae=T([]);let J=null;const te=T(!0),U=T(!1),X=T(new Set),re=T([]);let ke=null,Re=null;const Xe=z(()=>a.hideRecenterButton||!a.highlightLocationId||!M.value?!1:!G.value),Ne=T({}),Ke=()=>{const Ie={};if(a.highlightLocationId){const be=a.locations.find(de=>de.id===a.highlightLocationId);if(be?.latitude&&be?.longitude){const de=ne(be.latitude,be.longitude);G.value=de,Ie[a.highlightLocationId]=de,Ne.value=Ie;return}}if(a.highlightLocationIds&&a.highlightLocationIds.length>0){let be=!0;for(const de of a.highlightLocationIds){const fe=a.locations.find(q=>q.id===de);if(fe?.latitude&&fe?.longitude){const q=ne(fe.latitude,fe.longitude);Ie[de]=q,q||(be=!1)}else Ie[de]=!0}G.value=be,Ne.value=Ie;return}if(!l){G.value=!0,Ne.value={};return}G.value=!0,Ne.value={}},We=()=>{if(!l||!a.userLocation){ee.value=!0;return}ee.value=ne(a.userLocation.lat,a.userLocation.lng)},Q=()=>{Ke(),We(),s("visibility-change",{userLocationInView:ee.value,highlightedLocationInView:G.value,highlightedLocationsVisibility:Ne.value})},ge=()=>{if(!l||!a.highlightLocationId)return;const Ie=a.locations.find(be=>be.id===a.highlightLocationId);!Ie||!Ie.latitude||!Ie.longitude||(l.setView([Ie.latitude,Ie.longitude],l.getZoom(),{animate:!0,duration:.5}),M.value=!1,G.value=!0)},Ce=(Ie,be,de,fe,q=!1)=>{const W=de?"36px":fe?"20px":"30px",ie=de?"#667eea":"white",Ue=q?"":Du(Ie,be);return`
    <div style="position: relative; width: ${W}; height: ${W};">
      <div style="
        background-color: ${L_};
        width: ${W};
        height: ${W};
        border-radius: 50%;
        border: 3px solid ${ie};
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      "></div>
      ${q?"":`<div style="position: absolute; bottom: -4px; right: -4px;">
        ${Ue}
      </div>`}
    </div>
  `},ve=()=>{if(!l)return;const Ie=d_(l,Ae.value),be=Array.from(X.value).sort().join(","),de=Array.from(Ie).sort().join(",");be!==de&&(X.value=Ie,xe())},ue=()=>{if(Re&&(Re.remove(),Re=null),!l||!a.userLocation)return;const Ie=Bt.divIcon({className:"user-location-marker",html:`
      <div style="
        position: relative;
        width: 20px;
        height: 20px;
      ">
        <div style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 20px;
          height: 20px;
          background-color: #4285f4;
          border: 3px solid white;
          border-radius: 50%;
          box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        "></div>
        <div style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 40px;
          height: 40px;
          background-color: rgba(66, 133, 244, 0.2);
          border-radius: 50%;
          animation: pulse 2s ease-out infinite;
        "></div>
      </div>
    `,iconSize:[40,40],iconAnchor:[20,20]});Re=Bt.marker([a.userLocation.lat,a.userLocation.lng],{icon:Ie}).addTo(l).bindPopup("Your location")},F=()=>{if(!i.value)return;let Ie=51.505,be=-.09,de=13;const fe=a.allLocationsForBounds.length>0?a.allLocationsForBounds:a.locations,q=(ie,Ue)=>ie!=null&&Ue!=null&&!(ie===0&&Ue===0),W=[];fe.length>0&&W.push(...fe.filter(ie=>q(ie.latitude,ie.longitude)).map(ie=>({lat:ie.latitude,lng:ie.longitude}))),a.route&&a.route.length>0&&W.push(...a.route.filter(ie=>q(ie.lat,ie.lng)).map(ie=>({lat:ie.lat,lng:ie.lng}))),a.center?(Ie=a.center.lat,be=a.center.lng,de=a.zoom??13):W.length>0&&(Ie=W.reduce((ie,Ue)=>ie+Ue.lat,0)/W.length,be=W.reduce((ie,Ue)=>ie+Ue.lng,0)/W.length,de=10),l=Bt.map(i.value).setView([Ie,be],de),Bt.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:" OpenStreetMap contributors",maxZoom:19}).addTo(l),a.clickable&&l.on("click",ie=>{a.drawingMode||s("map-click",{lat:ie.latlng.lat,lng:ie.latlng.lng})}),l.on("zoomstart",()=>{he=!0}),l.on("zoomend moveend",()=>{he=!1,Y?xe():ve(),Q()}),l.on("dragstart",()=>{M.value=!0}),xe(),K(),ae(),ue(),Le(),Oe(),l.whenReady(()=>{Q()})},K=()=>{if(J&&(J.remove(),J=null),!l||a.route.length===0)return;const Ie=a.route.map(be=>[be.lat,be.lng]);J=Bt.polyline(Ie,{color:"blue",weight:4,opacity:.7}).addTo(l)},ae=()=>{re.value.forEach(Ie=>Ie.remove()),re.value=[],!(!l||a.areas.length===0)&&a.areas.forEach(Ie=>{const be=typeof Ie.polygon=="string"?JSON.parse(Ie.polygon):Ie.polygon;if(!be||be.length===0)return;const de=be.map(ie=>[ie.lat,ie.lng]),fe=Ie.id===a.selectedAreaId,q=Ie.color||"#667eea",W=Bt.polygon(de,{color:q,fillColor:q,fillOpacity:fe?.4:.2,weight:fe?3:2,opacity:.8}).addTo(l);W.setStyle({pane:"overlayPane"}),a.drawingMode||(W.on("click",()=>s("area-click",Ie)),W.on("mouseover",()=>{W.setStyle({fillOpacity:.4})}),W.on("mouseout",()=>{W.setStyle({fillOpacity:fe?.4:.2})})),re.value.push(W)})},$e=()=>{if(l&&(p&&(p.remove(),p=null),g&&(g.remove(),g=null),u.value.length!==0&&(g=Bt.layerGroup().addTo(l),u.value.forEach((Ie,be)=>{const de=be===0,fe=be===u.value.length-1,q=Bt.divIcon({className:"polygon-point-marker",html:`<div style="
        width: ${de?"16px":"12px"};
        height: ${de?"16px":"12px"};
        background-color: ${de?"#667eea":fe?"#ff9800":"white"};
        border: 3px solid #667eea;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      "></div>`,iconSize:[de?16:12,de?16:12],iconAnchor:[de?8:6,de?8:6]});Bt.marker([Ie.lat,Ie.lng],{icon:q,interactive:!1}).addTo(g)}),u.value.length>=2))){const Ie=u.value.map(be=>[be.lat,be.lng]);u.value.length>=3&&Ie.push(Ie[0]),p=Bt.polyline(Ie,{color:"#667eea",weight:3,opacity:.8,dashArray:u.value.length<3?"10, 10":null}).addTo(l)}},Be=()=>{if(!l||(b&&(b.remove(),b=null),C&&(C.remove(),C=null),y.value.length===0))return;const Ie=y.value.map(de=>[de.lat,de.lng]);b=Bt.polygon(Ie,{color:"#667eea",fillColor:"#667eea",fillOpacity:.2,weight:3,opacity:.8,pane:"overlayPane"}).addTo(l),b.bringToFront(),C=Bt.layerGroup({pane:"markerPane"}).addTo(l);const be=de=>{y.value.length<=3||(y.value.splice(de,1),I=!0,s("polygon-update",[...y.value]),Be())};y.value.forEach((de,fe)=>{const q=y.value.length>3,W=Bt.divIcon({className:"polygon-edit-marker",html:`<div class="vertex-marker" style="
        position: relative;
        width: 16px;
        height: 16px;
        background-color: #667eea;
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        cursor: move;
      "></div>`,iconSize:[16,16],iconAnchor:[8,8]}),ie=Bt.marker([de.lat,de.lng],{icon:W,draggable:!0}).addTo(C);if(ie.on("drag",Ue=>{const et=Ue.target.getLatLng();y.value[fe]={lat:et.lat,lng:et.lng};const dt=y.value.map(yt=>[yt.lat,yt.lng]);b.setLatLngs(dt)}),ie.on("dragend",()=>{I=!0,s("polygon-update",[...y.value])}),ie.on("contextmenu",Ue=>{Bt.DomEvent.preventDefault(Ue),q&&be(fe)}),q){const Ue=document.createElement("div"),et=document.createElement("button");et.textContent="Delete point",et.style.cssText=`
        background: #dc3545;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
      `;const dt=yt=>{yt.preventDefault(),yt.stopPropagation(),ie.closePopup(),be(fe)};et.addEventListener("click",dt),et.addEventListener("touchend",dt),Ue.appendChild(et),ie.bindPopup(Ue,{closeButton:!1,className:"vertex-popup"})}})},Oe=(Ie=!0)=>{if(l){if(!a.editingPolygon||a.editingPolygon.length===0){b&&(b.remove(),b=null),C&&(C.remove(),C=null),y.value=[];return}if(y.value=a.editingPolygon.map(be=>({lat:be.lat,lng:be.lng})),Be(),Ie&&y.value.length>=3){const be=Bt.latLngBounds(y.value.map(de=>[de.lat,de.lng]));l.fitBounds(be,{padding:[50,50]})}}},Le=()=>{if(!l)return;if(ke||(ke=new Bt.FeatureGroup,l.addLayer(ke)),l._customDrawingHandlers&&(l.off("click",l._customDrawingHandlers.handleClick),l.getContainer().removeEventListener("touchstart",l._customDrawingHandlers.handleTouchStart),l.getContainer().removeEventListener("touchend",l._customDrawingHandlers.handleTouchEnd),l.getContainer().removeEventListener("touchmove",l._customDrawingHandlers.handleTouchMove),delete l._customDrawingHandlers),!a.drawingMode){B(),ke&&ke.clearLayers();return}let Ie=0,be=null,de=!1,fe=!1;const q=300,W=15,ie=mt=>{d.value.push([...u.value]),h.value=[],u.value.push({lat:mt.lat,lng:mt.lng}),$e(),s("polygon-drawing",u.value)},Ue=mt=>{mt.originalEvent&&mt.originalEvent.sourceCapabilities?.firesTouchEvents||ie(mt.latlng)},et=mt=>{if(mt.touches.length>1){fe=!0;return}fe=!1,Ie=Date.now(),be={x:mt.touches[0].clientX,y:mt.touches[0].clientY},de=!1},dt=mt=>{if(!be||fe)return;const St=mt.touches[0].clientX-be.x,Ct=mt.touches[0].clientY-be.y;Math.sqrt(St*St+Ct*Ct)>W&&(de=!0)},yt=mt=>{if(fe){fe=!1,be=null;return}if(Date.now()-Ie<q&&!de&&be){const Ct=mt.changedTouches[0],Rt=Bt.point(Ct.clientX-l.getContainer().getBoundingClientRect().left,Ct.clientY-l.getContainer().getBoundingClientRect().top),Ft=l.containerPointToLatLng(Rt);mt.preventDefault(),mt.stopPropagation(),ie(Ft)}be=null,de=!1};l.on("click",Ue),l.getContainer().addEventListener("touchstart",et,{passive:!0}),l.getContainer().addEventListener("touchmove",dt,{passive:!0}),l.getContainer().addEventListener("touchend",yt,{passive:!1}),l._customDrawingHandlers={handleClick:Ue,handleTouchStart:et,handleTouchMove:dt,handleTouchEnd:yt},$e()};let Y=!1,he=!1;const xe=()=>{if(l&&(l._animatingZoom||he)){Y=!0;return}if(Y=!1,Ae.value.forEach(de=>{de._map&&(de.off(),de.remove())}),Ae.value=[],!l)return;const Ie=i.value?.clientWidth||400,be=Math.floor(Ie*.75);if(a.locations.forEach(de=>{const fe=de.latitude??de.Latitude,q=de.longitude??de.Longitude;if(fe==null||q==null||fe===0&&q===0)return;const W=de.checkedInCount||0,ie=de.requiredMarshals||1,Ue=a.highlightLocationId===de.id||a.highlightLocationIds.includes(de.id),et=de.isDynamic||de.IsDynamic,dt=a.simplifyNonHighlighted&&!Ue&&!et,yt=de.resolvedStyleType||de.ResolvedStyleType,mt=de.resolvedStyleBackgroundColor||de.ResolvedStyleBackgroundColor||de.resolvedStyleColor||de.ResolvedStyleColor,St=de.resolvedStyleBorderColor||de.ResolvedStyleBorderColor,Ct=de.resolvedStyleIconColor||de.ResolvedStyleIconColor,Rt=de.resolvedStyleBackgroundShape||de.ResolvedStyleBackgroundShape,Ft=yt&&yt!=="default"||mt||St||Ct||Rt&&Rt!=="circle"&&Rt!=="default",ht=de.resolvedStyleMapRotation??de.ResolvedStyleMapRotation??de.styleMapRotation??de.StyleMapRotation??0,on=parseInt(ht,10)||0,dn=de.areaColor||"#999",Et=de.areaId&&!a.marshalMode,Qn=X.value.has(de.id)&&de.description?`${de.name}: ${nm(de.description,50)}`:de.name,zn=Ue?`
      <div style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        border: 3px solid #667eea;
        border-radius: 50%;
        animation: highlight-pulse 1.5s ease-out infinite;
      "></div>
    `:"",eo=Ue?"#667eea":dt?"#e0e0e0":"white",fo=Ue?"white":dt?"#888":"#333";let Ht;if(dt){const je="20px";Ht=`
        <div style="
          background-color: #999;
          width: ${je};
          height: ${je};
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        "></div>
      `}const ls=!a.marshalMode,to=Du(W,ie),So=ls?`<div style="
      position: absolute;
      bottom: -2px;
      right: -6px;
      background-color: white;
      border-radius: 8px;
      padding: 1px 4px;
      font-size: 9px;
      font-weight: bold;
      color: #333;
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    ">${W}/${ie}</div>`:"";if(!dt&&Ft){const je=Ue?40:32,Tt=de.resolvedStyleSize||de.ResolvedStyleSize||"100",Wt=In({type:de.resolvedStyleType||de.ResolvedStyleType,backgroundShape:de.resolvedStyleBackgroundShape||de.ResolvedStyleBackgroundShape||"circle",backgroundColor:de.resolvedStyleBackgroundColor||de.ResolvedStyleBackgroundColor||de.resolvedStyleColor||de.ResolvedStyleColor||"",borderColor:de.resolvedStyleBorderColor||de.ResolvedStyleBorderColor||"",iconColor:de.resolvedStyleIconColor||de.ResolvedStyleIconColor||"",size:Tt});Wt?Ht=Wt:Ht=b_(de.resolvedStyleType,de.resolvedStyleColor,W,ie,je,ls)||Ce(W,ie,Ue,a.marshalMode,!0)}else dt||(Ht=Ce(W,ie,Ue,a.marshalMode,!0));const le=on!==0?`transform: rotate(${on}deg);`:"",ce=Bt.divIcon({className:"custom-marker",html:`
        <div style="display: flex; flex-direction: column; align-items: center; position: relative;">
          ${zn}
          <div style="position: relative; display: flex; align-items: center; gap: 4px;">
            ${Et?`<div style="
              width: 8px;
              height: 8px;
              border-radius: 50%;
              background-color: ${dn};
              border: 2px solid white;
              box-shadow: 0 1px 2px rgba(0,0,0,0.3);
            "></div>`:""}
            <div style="position: relative; display: inline-block;">
              <div style="${le}">
                ${Ht}
              </div>
              ${dt||a.marshalMode?"":`<div style="position: absolute; top: -4px; right: -4px;">
                ${to}
              </div>`}
              ${dt?"":So}
            </div>
          </div>
          <div style="
            background-color: ${eo};
            padding: 2px 6px;
            border-radius: 3px;
            font-size: ${Ue?"12px":"11px"};
            font-weight: bold;
            color: ${fo};
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: ${be}px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-top: 2px;
          ">
            ${Qn}
          </div>
        </div>
      `,iconSize:[30,50],iconAnchor:[15,25]}),ye=a.marshalMode?`<b>${de.name}</b>${de.description?`<br>${de.description}`:""}`:`<b>${de.name}</b><br>${de.description||""}<br>Checked in: ${W}/${ie}`,st=Bt.marker([de.latitude,de.longitude],{icon:ce}).addTo(l).bindPopup(ye);st.on("click",()=>{s("location-click",de)}),st.locationData=de,Ae.value.push(st)}),l&&te.value&&!a.center&&!U.value){const de=[],fe=a.allLocationsForBounds.length>0?a.allLocationsForBounds:a.locations,q=(W,ie)=>W!=null&&ie!=null&&!(W===0&&ie===0);if(fe.length>0&&de.push(...fe.filter(W=>q(W.latitude,W.longitude)).map(W=>[W.latitude,W.longitude])),a.route.length>0&&de.push(...a.route.filter(W=>q(W.lat,W.lng)).map(W=>[W.lat,W.lng])),de.length>0){const W=Bt.latLngBounds(de);l.fitBounds(W,{padding:[50,50]}),te.value=!1,U.value=!0}}else a.center&&(te.value=!1);setTimeout(()=>{l&&!l._animatingZoom&&ve()},100)};return tn(()=>{U.value=!1,te.value=!0,F();let Ie,be=0,de=0;const fe=new ResizeObserver(q=>{if(l&&q.length>0){const{width:W,height:ie}=q[0].contentRect;(Math.abs(W-be)>10||Math.abs(ie-de)>10)&&(be=W,de=ie,clearTimeout(Ie),Ie=setTimeout(()=>{l.invalidateSize()},150))}});i.value&&fe.observe(i.value),bn(()=>{clearTimeout(Ie),fe.disconnect()})}),qe(()=>a.locations,Ie=>{if(xe(),l&&!U.value&&Ie.length>0&&!a.center){const be=Ie.map(W=>W.latitude),de=Ie.map(W=>W.longitude),fe=be.reduce((W,ie)=>W+ie,0)/be.length,q=de.reduce((W,ie)=>W+ie,0)/de.length;l.setView([fe,q],10),U.value=!0,te.value=!1}l&&setTimeout(()=>Q(),50)},{deep:!0}),qe(()=>a.route,Ie=>{if(K(),xe(),l&&!U.value&&Ie&&Ie.length>0&&!a.center){const be=Ie.map(W=>W.lat),de=Ie.map(W=>W.lng),fe=be.reduce((W,ie)=>W+ie,0)/be.length,q=de.reduce((W,ie)=>W+ie,0)/de.length;l.setView([fe,q],10),U.value=!0,te.value=!1}},{deep:!0}),qe(()=>a.center,(Ie,be)=>{l&&!M.value&&(!be||Math.abs(Ie.lat-be.lat)>1e-6||Math.abs(Ie.lng-be.lng)>1e-6)&&l.setView([Ie.lat,Ie.lng],a.zoom)}),qe(()=>a.areas,()=>{ae()},{deep:!0}),qe(()=>a.selectedAreaId,()=>{ae()}),qe(()=>a.drawingMode,()=>{Le()}),qe(()=>a.editingPolygon,()=>{if(I){I=!1;return}Oe()},{deep:!0}),qe(()=>a.userLocation,()=>{ue()},{deep:!0}),qe(()=>a.highlightLocationId,()=>{xe()}),qe(()=>a.highlightLocationIds,()=>{xe(),l&&setTimeout(()=>Q(),50)},{deep:!0}),qe(()=>a.marshalMode,()=>{xe()}),qe(()=>a.simplifyNonHighlighted,()=>{xe()}),qe(()=>a.clickable,Ie=>{l&&(l.off("click"),Ie&&l.on("click",be=>{a.drawingMode||s("map-click",{lat:be.latlng.lat,lng:be.latlng.lng})}))}),(Ie,be)=>(v(),m("div",C_,[r("div",{ref_key:"mapContainer",ref:i,class:"map-container"},null,512),Xe.value?(v(),m("button",{key:0,class:"recenter-btn",onClick:ge,title:"Recenter on checkpoint"},[...be[0]||(be[0]=[r("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[r("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})],-1),r("span",null,"Recenter",-1)])])):P("",!0)]))}},Ou=Ge(S_,[["__scopeId","data-v-909f9eb4"]]);function Ks(e,t){return e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})}const I_={class:"areas-selection"},x_={key:0,class:"areas-selection-header"},$_={class:"areas-list"},T_=["checked","onChange"],M_={__name:"AreasSelection",props:{areas:{type:Array,default:()=>[]},selectedAreaIds:{type:Array,default:()=>[]}},emits:["update:selectedAreaIds"],setup(e,{emit:t}){const n=e,a=t,s=z(()=>[...n.areas].sort((d,h)=>d.displayOrder!==h.displayOrder?d.displayOrder-h.displayOrder:Ks(d.name,h.name))),i=z(()=>n.areas.length>0&&n.selectedAreaIds.length===n.areas.length),l=d=>{const h=[...n.selectedAreaIds],p=h.indexOf(d);p>=0?h.splice(p,1):h.push(d),a("update:selectedAreaIds",h)},u=()=>{i.value?a("update:selectedAreaIds",[]):a("update:selectedAreaIds",n.areas.map(d=>d.id))};return(d,h)=>(v(),m("div",I_,[e.areas.length>1?(v(),m("div",x_,[r("button",{onClick:u,class:"toggle-all-btn"},w(i.value?"Deselect all":"Select all"),1)])):P("",!0),r("div",$_,[(v(!0),m(Te,null,Fe(s.value,p=>(v(),m("label",{class:"area-checkbox",key:p.id},[r("input",{type:"checkbox",checked:e.selectedAreaIds.includes(p.id),onChange:g=>l(p.id)},null,40,T_),r("span",{class:"area-color-dot",style:Qe({backgroundColor:p.color||"#667eea"})},null,4),Ye(" "+w(p.name),1)]))),128))])]))}},A_=Ge(M_,[["__scopeId","data-v-ba19009b"]]),E_={key:1,class:"toolbar-btn-wrapper filters-wrapper"},P_={key:1,class:"dropdown-content filters-dropdown"},D_={class:"filters-header"},O_={class:"filter-section"},R_={class:"filter-checkbox"},B_=["checked"],N_={key:0,class:"filter-checkbox"},F_=["checked"],U_={class:"filter-section"},z_={class:"filter-checkbox"},H_=["checked"],V_={class:"filter-checkbox"},G_=["checked"],j_={class:"filter-checkbox"},Z_=["checked"],q_={key:0,class:"filter-section"},W_=["onClick","title"],K_={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},J_={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Y_=["innerHTML"],X_={key:0,class:"dropdown-content action-dropdown"},Q_=["onClick"],ew={__name:"MapToolbar",props:{showFullscreen:{type:Boolean,default:!1},showFilters:{type:Boolean,default:!1},filters:{type:Object,default:()=>({showRoute:!0,showAreaOverlays:!0,showUncheckedIn:!0,showPartiallyCheckedIn:!0,showFullyCheckedIn:!0,showAreas:!0,selectedAreaIds:[]})},areas:{type:Array,default:()=>[]},actions:{type:Array,default:()=>[]},position:{type:String,default:"top-right",validator:e=>["top-right","top-left"].includes(e)}},emits:["fullscreen-click","filter-change","action-click"],setup(e,{expose:t,emit:n}){const{terms:a}=rt(),s=e,i=n,l=T(!1),u=T(null),d=z(()=>u.value!==null),h=()=>{l.value=!l.value,l.value&&(u.value=null)},p=(C,I)=>{i("filter-change",{...s.filters,[C]:I})},g=C=>{C.items&&C.items.length>0?u.value===C.id?u.value=null:(u.value=C.id,l.value=!1):i("action-click",{actionId:C.id})},y=(C,I)=>{u.value=null,i("action-click",{actionId:C,itemId:I})};return t({closeDropdowns:()=>{l.value=!1,u.value=null}}),(C,I)=>(v(),m("div",{class:pe(["map-toolbar",[`position-${e.position}`]])},[e.showFullscreen?(v(),m("button",{key:0,class:"toolbar-btn",onClick:I[0]||(I[0]=M=>C.$emit("fullscreen-click")),title:"Fullscreen"},[...I[9]||(I[9]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})],-1)])])):P("",!0),e.showFilters&&!d.value?(v(),m("div",E_,[l.value?(v(),m("div",{key:0,class:"mobile-backdrop",onClick:I[1]||(I[1]=M=>l.value=!1)})):P("",!0),r("button",{class:pe(["toolbar-btn",{active:l.value}]),onClick:h,title:"Show/hide options"},[...I[10]||(I[10]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r("circle",{cx:"12",cy:"12",r:"3"})],-1)])],2),l.value?(v(),m("div",P_,[r("div",D_,[I[12]||(I[12]=r("span",{class:"filters-title"},"Map filters",-1)),r("button",{class:"close-filters-btn",onClick:I[2]||(I[2]=M=>l.value=!1),title:"Close"},[...I[11]||(I[11]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[r("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),r("div",O_,[I[13]||(I[13]=r("h4",null,"Display",-1)),r("label",R_,[r("input",{type:"checkbox",checked:e.filters.showRoute,onChange:I[3]||(I[3]=M=>p("showRoute",M.target.checked))},null,40,B_),r("span",null,w(O(a).course)+" line",1)]),e.areas.length>0?(v(),m("label",N_,[r("input",{type:"checkbox",checked:e.filters.showAreaOverlays!==!1,onChange:I[4]||(I[4]=M=>p("showAreaOverlays",M.target.checked))},null,40,F_),r("span",null,w(O(a).area)+" overlays",1)])):P("",!0)]),r("div",U_,[r("h4",null,w(O(a).checkpoints),1),r("label",z_,[r("input",{type:"checkbox",checked:e.filters.showUncheckedIn,onChange:I[5]||(I[5]=M=>p("showUncheckedIn",M.target.checked))},null,40,H_),I[14]||(I[14]=r("span",{class:"status-indicator unchecked"},null,-1)),I[15]||(I[15]=r("span",null,"Unchecked-in",-1))]),r("label",V_,[r("input",{type:"checkbox",checked:e.filters.showPartiallyCheckedIn,onChange:I[6]||(I[6]=M=>p("showPartiallyCheckedIn",M.target.checked))},null,40,G_),I[16]||(I[16]=r("span",{class:"status-indicator partial"},null,-1)),I[17]||(I[17]=r("span",null,"Partially checked-in",-1))]),r("label",j_,[r("input",{type:"checkbox",checked:e.filters.showFullyCheckedIn,onChange:I[7]||(I[7]=M=>p("showFullyCheckedIn",M.target.checked))},null,40,Z_),I[18]||(I[18]=r("span",{class:"status-indicator full"},null,-1)),I[19]||(I[19]=r("span",null,"Fully checked-in",-1))])]),e.areas.length>0?(v(),m("div",q_,[r("h4",null,w(O(a).areas),1),Me(A_,{areas:e.areas,"selected-area-ids":e.filters.selectedAreaIds,"onUpdate:selectedAreaIds":I[8]||(I[8]=M=>p("selectedAreaIds",M))},null,8,["areas","selected-area-ids"])])):P("",!0)])):P("",!0)])):P("",!0),(v(!0),m(Te,null,Fe(e.actions,M=>(v(),m("div",{key:M.id,class:pe(["toolbar-btn-wrapper",{hidden:l.value}])},[r("button",{class:pe(["toolbar-btn",{active:u.value===M.id}]),onClick:x=>g(M),title:M.label||M.id},[M.icon==="plus"?(v(),m("svg",K_,[...I[20]||(I[20]=[r("line",{x1:"12",y1:"5",x2:"12",y2:"19"},null,-1),r("line",{x1:"5",y1:"12",x2:"19",y2:"12"},null,-1)])])):M.icon==="edit"?(v(),m("svg",J_,[...I[21]||(I[21]=[r("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"},null,-1),r("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"},null,-1)])])):M.icon==="custom"?(v(),m("span",{key:2,innerHTML:M.customIcon},null,8,Y_)):P("",!0)],10,W_),M.items&&u.value===M.id?(v(),m("div",X_,[(v(!0),m(Te,null,Fe(M.items,x=>(v(),m("button",{key:x.id,onClick:S=>y(M.id,x.id),class:"dropdown-item"},w(x.label),9,Q_))),128))])):P("",!0)],2))),128))],2))}},vf=Ge(ew,[["__scopeId","data-v-adedd545"]]),tw={key:0,class:"drawing-controls"},nw={class:"point-count"},ow={class:"undo-redo-buttons"},sw=["disabled"],aw=["disabled"],iw={__name:"MapDrawingControls",props:{pointCount:{type:Number,default:0},canUndo:{type:Boolean,default:!1},canRedo:{type:Boolean,default:!1},show:{type:Boolean,default:!0}},emits:["undo","redo"],setup(e,{emit:t}){const n=e,a=t,s=z(()=>n.show&&n.pointCount>0),i=l=>{if(!s.value)return;const d=navigator.platform.toUpperCase().indexOf("MAC")>=0?l.metaKey:l.ctrlKey;d&&l.key==="z"&&!l.shiftKey?(l.preventDefault(),n.canUndo&&a("undo")):d&&(l.key==="y"||l.key==="z"&&l.shiftKey)&&(l.preventDefault(),n.canRedo&&a("redo"))};return tn(()=>{document.addEventListener("keydown",i)}),bn(()=>{document.removeEventListener("keydown",i)}),(l,u)=>s.value?(v(),m("div",tw,[r("div",nw,w(e.pointCount)+" point"+w(e.pointCount!==1?"s":""),1),r("div",ow,[r("button",{onClick:u[0]||(u[0]=d=>l.$emit("undo")),class:"btn-drawing undo-btn",disabled:!e.canUndo,title:"Undo last point (Ctrl+Z)"},"  Undo ",8,sw),r("button",{onClick:u[1]||(u[1]=d=>l.$emit("redo")),class:"btn-drawing redo-btn",disabled:!e.canRedo,title:"Redo point (Ctrl+Y)"}," Redo  ",8,aw)])])):P("",!0)}},mf=Ge(iw,[["__scopeId","data-v-6cd009cb"]]),lw={class:"context-info"},rw={class:"action-buttons"},cw=["disabled"],uw={key:0,class:"fullscreen-map-banner"},dw={class:"fullscreen-map-container"},hw={key:1,class:"fullscreen-map-footer"},fw={__name:"MapFullscreenModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"view",validator:e=>["view","select-point","draw-polygon","edit-polygon"].includes(e)},title:{type:String,default:""},description:{type:String,default:""},canComplete:{type:Boolean,default:!1},headerStyle:{type:Object,default:()=>({})},headerTextColor:{type:String,default:""}},emits:["done","cancel","close"],setup(e,{emit:t}){const n=e,a=z(()=>n.headerTextColor?{color:n.headerTextColor}:{}),s=t,i=()=>{s("done")},l=()=>{s("cancel")},u=()=>{s("close")},d=h=>{h.key==="Escape"&&n.show&&(n.mode==="view"?u():l())};return qe(()=>n.show,h=>{h?(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"):(document.body.style.overflow="",document.documentElement.style.overflow="")},{immediate:!0}),tn(()=>{document.addEventListener("keydown",d)}),bn(()=>{document.removeEventListener("keydown",d),document.body.style.overflow="",document.documentElement.style.overflow=""}),(h,p)=>(v(),Ze(Rl,{to:"body"},[e.show?(v(),m("div",{key:0,class:"fullscreen-map-overlay",onTouchmove:p[0]||(p[0]=it(()=>{},["prevent","self"]))},[r("div",{class:pe(["fullscreen-map-header",{compact:e.mode==="view"}]),style:Qe(e.headerStyle)},[r("div",lw,[r("h3",{style:Qe({color:e.headerTextColor})},w(e.title),5),e.description?(v(),m("p",{key:0,style:Qe({color:e.headerTextColor,opacity:.85})},w(e.description),5)):P("",!0)]),r("div",rw,[ro(h.$slots,"actions",{},void 0),e.mode==="view"?(v(),m("button",{key:0,type:"button",onClick:it(u,["stop"]),class:"btn btn-close-x",style:Qe(a.value),title:"Close"},[...p[1]||(p[1]=[r("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"20",height:"20"},[r("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])],4)):(v(),m(Te,{key:1},[r("button",{type:"button",onClick:l,class:"btn btn-cancel"}," Cancel "),r("button",{type:"button",onClick:i,class:"btn btn-done",disabled:!e.canComplete}," Done ",8,cw)],64))])],6),h.$slots.banner?(v(),m("div",uw,[ro(h.$slots,"banner",{},void 0)])):P("",!0),r("div",dw,[ro(h.$slots,"default",{},void 0)]),h.$slots.footer?(v(),m("div",hw,[ro(h.$slots,"footer",{},void 0)])):P("",!0)],32)):P("",!0)]))}},pw=Ge(fw,[["__scopeId","data-v-f9e1ad6c"]]),vw={class:"map-wrapper"},mw={class:"fullscreen-map-wrapper"},gw={__name:"CommonMap",props:{locations:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},center:{type:Object,default:null},zoom:{type:Number,default:13},userLocation:{type:Object,default:null},highlightLocationId:{type:String,default:null},highlightLocationIds:{type:Array,default:()=>[]},allLocationsForBounds:{type:Array,default:()=>[]},selectedAreaId:{type:String,default:null},marshalMode:{type:Boolean,default:!1},simplifyNonHighlighted:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1},mode:{type:String,default:"view",validator:e=>["view","select-point","draw-polygon","edit-polygon"].includes(e)},editingPolygon:{type:Array,default:null},height:{type:String,default:"400px"},showFullscreen:{type:Boolean,default:!0},showFilters:{type:Boolean,default:!1},toolbarActions:{type:Array,default:()=>[]},toolbarPosition:{type:String,default:"top-right"},filters:{type:Object,default:()=>({showRoute:!0,showAreaOverlays:!0,showUncheckedIn:!0,showPartiallyCheckedIn:!0,showFullyCheckedIn:!0,showAreas:!0,selectedAreaIds:[]})},fullscreenTitle:{type:String,default:""},fullscreenDescription:{type:String,default:""},fullscreenHeaderStyle:{type:Object,default:()=>({})},fullscreenHeaderTextColor:{type:String,default:""},hideRecenterButton:{type:Boolean,default:!1}},emits:["location-click","map-click","area-click","visibility-change","point-selected","polygon-complete","polygon-drawing","polygon-update","fullscreen-change","filter-change","action-click","fullscreen-done","fullscreen-cancel"],setup(e,{expose:t,emit:n}){const a=e,s=n,i=T(null),l=T(null),u=T(null),d=T(null),h=T(!1),p=T(0),g=T(!1),y=T(!1),b=T({...a.filters});qe(()=>a.filters,J=>{b.value={...J}},{deep:!0}),qe(()=>a.areas,J=>{a.showFilters&&J.length>0&&(!b.value.selectedAreaIds||b.value.selectedAreaIds.length===0)&&(b.value.selectedAreaIds=J.map(te=>te.id))},{immediate:!0});const C=z(()=>a.showFilters?a.locations.filter(J=>{const te=J.checkedInCount||0,U=J.requiredMarshals||1,X=te===0,re=te>0&&te<U,ke=te>=U;if(X&&!b.value.showUncheckedIn||re&&!b.value.showPartiallyCheckedIn||ke&&!b.value.showFullyCheckedIn)return!1;const Re=J.areaIds||J.AreaIds||[];return!(a.areas.length>0&&Re.length>0&&(!b.value.selectedAreaIds||b.value.selectedAreaIds.length===0||!Re.some(Ne=>b.value.selectedAreaIds.includes(Ne))))}):a.locations),I=z(()=>a.showFilters?b.value.showRoute?a.route:[]:a.route),M=z(()=>a.showFilters?b.value.showAreaOverlays===!1?[]:b.value.selectedAreaIds&&b.value.selectedAreaIds.length>0?a.areas.filter(J=>b.value.selectedAreaIds.includes(J.id)):a.areas.length>0?[]:a.areas:a.areas),x=z(()=>a.mode==="select-point"?!0:a.mode==="draw-polygon"?p.value>=3:!0),S=()=>h.value?l.value:i.value,_=()=>{h.value=!0,s("fullscreen-change",!0)},D=()=>{h.value=!1,s("fullscreen-change",!1)},E=()=>{if(a.mode==="draw-polygon"){const J=S();J&&J.clearPolygonDrawing(),p.value=0,g.value=!1,y.value=!1}h.value=!1,s("fullscreen-cancel"),s("fullscreen-change",!1)},Z=()=>{if(a.mode==="draw-polygon"&&p.value>=3){const J=S();J&&J.completePolygon()}h.value=!1,s("fullscreen-done"),s("fullscreen-change",!1)},A=J=>{b.value=J,s("filter-change",J)},N=J=>{a.mode==="select-point"&&s("point-selected",J),s("map-click",J)},B=J=>{p.value=J?.length||0,G(),s("polygon-drawing",J)},j=J=>{s("polygon-complete",J),p.value=0,g.value=!1,y.value=!1},R=J=>{s("polygon-update",J)},G=()=>{const J=S();J&&(g.value=J.canUndo?J.canUndo():!1,y.value=J.canRedo?J.canRedo():!1)},ee=()=>{const J=S();J&&J.undoPolygonPoint&&(J.undoPolygonPoint(),G())},ne=()=>{const J=S();J&&J.redoPolygonPoint&&(J.redoPolygonPoint(),G())};return t({getMapCenter:()=>S()?.getMapCenter?.(),getMapZoom:()=>S()?.getMapZoom?.(),undoPolygonPoint:ee,redoPolygonPoint:ne,canUndo:()=>g.value,canRedo:()=>y.value,getPolygonPointCount:()=>p.value,completePolygon:()=>S()?.completePolygon?.(),clearPolygonDrawing:()=>{S()?.clearPolygonDrawing?.(),p.value=0,g.value=!1,y.value=!1},recenterOnUserLocation:()=>S()?.recenterOnUserLocation?.(),recenterOnLocation:(J,te,U)=>S()?.recenterOnLocation?.(J,te,U),isLocationInView:(J,te)=>S()?.isLocationInView?.(J,te)??!0,getUserLocationInView:()=>S()?.userLocationInView?.value??!0,getHighlightedLocationInView:()=>S()?.highlightedLocationInView?.value??!0,openFullscreen:()=>{h.value=!0,s("fullscreen-change",!0)},closeFullscreen:D,closeDropdowns:()=>{u.value&&u.value.closeDropdowns(),d.value&&d.value.closeDropdowns()}}),(J,te)=>(v(),m("div",{class:"common-map",style:Qe({height:e.height})},[r("div",vw,[Me(Ou,{ref_key:"mapViewRef",ref:i,locations:C.value,route:I.value,areas:M.value,center:e.center,zoom:e.zoom,clickable:e.clickable||e.mode==="select-point","drawing-mode":e.mode==="draw-polygon","editing-polygon":e.mode==="edit-polygon"?e.editingPolygon:null,"user-location":e.userLocation,"highlight-location-id":e.highlightLocationId,"highlight-location-ids":e.highlightLocationIds,"all-locations-for-bounds":e.allLocationsForBounds,"marshal-mode":e.marshalMode,"simplify-non-highlighted":e.simplifyNonHighlighted,"selected-area-id":e.selectedAreaId,"hide-recenter-button":e.hideRecenterButton,onLocationClick:te[0]||(te[0]=U=>J.$emit("location-click",U)),onMapClick:N,onAreaClick:te[1]||(te[1]=U=>J.$emit("area-click",U)),onPolygonComplete:j,onPolygonDrawing:B,onPolygonUpdate:R,onVisibilityChange:te[2]||(te[2]=U=>J.$emit("visibility-change",U))},null,8,["locations","route","areas","center","zoom","clickable","drawing-mode","editing-polygon","user-location","highlight-location-id","highlight-location-ids","all-locations-for-bounds","marshal-mode","simplify-non-highlighted","selected-area-id","hide-recenter-button"]),Me(vf,{ref_key:"toolbarRef",ref:u,"show-fullscreen":e.showFullscreen,"show-filters":e.showFilters,filters:b.value,areas:e.areas,actions:e.toolbarActions,position:e.toolbarPosition,onFullscreenClick:_,onFilterChange:A,onActionClick:te[3]||(te[3]=U=>J.$emit("action-click",U))},null,8,["show-fullscreen","show-filters","filters","areas","actions","position"]),Me(mf,{show:e.mode==="draw-polygon","point-count":p.value,"can-undo":g.value,"can-redo":y.value,onUndo:ee,onRedo:ne},null,8,["show","point-count","can-undo","can-redo"])]),Me(pw,{show:h.value,mode:e.mode,title:e.fullscreenTitle,description:e.fullscreenDescription,"can-complete":x.value,"header-style":e.fullscreenHeaderStyle,"header-text-color":e.fullscreenHeaderTextColor,onDone:Z,onCancel:E,onClose:D},Xu({default:He(()=>[r("div",mw,[Me(Ou,{ref_key:"fullscreenMapViewRef",ref:l,locations:C.value,route:I.value,areas:M.value,center:e.center,zoom:e.zoom,clickable:e.clickable||e.mode==="select-point","drawing-mode":e.mode==="draw-polygon","editing-polygon":e.mode==="edit-polygon"?e.editingPolygon:null,"user-location":e.userLocation,"highlight-location-id":e.highlightLocationId,"highlight-location-ids":e.highlightLocationIds,"all-locations-for-bounds":e.allLocationsForBounds,"marshal-mode":e.marshalMode,"simplify-non-highlighted":e.simplifyNonHighlighted,"selected-area-id":e.selectedAreaId,"hide-recenter-button":e.hideRecenterButton,onLocationClick:te[4]||(te[4]=U=>J.$emit("location-click",U)),onMapClick:N,onAreaClick:te[5]||(te[5]=U=>J.$emit("area-click",U)),onPolygonComplete:j,onPolygonDrawing:B,onPolygonUpdate:R,onVisibilityChange:te[6]||(te[6]=U=>J.$emit("visibility-change",U))},null,8,["locations","route","areas","center","zoom","clickable","drawing-mode","editing-polygon","user-location","highlight-location-id","highlight-location-ids","all-locations-for-bounds","marshal-mode","simplify-non-highlighted","selected-area-id","hide-recenter-button"]),Me(vf,{ref_key:"fullscreenToolbarRef",ref:d,"show-fullscreen":!1,"show-filters":e.showFilters,filters:b.value,areas:e.areas,actions:e.toolbarActions,position:e.toolbarPosition,onFilterChange:A,onActionClick:te[7]||(te[7]=U=>J.$emit("action-click",U))},null,8,["show-filters","filters","areas","actions","position"]),Me(mf,{show:e.mode==="draw-polygon","point-count":p.value,"can-undo":g.value,"can-redo":y.value,onUndo:ee,onRedo:ne},null,8,["show","point-count","can-undo","can-redo"])])]),_:2},[J.$slots["fullscreen-actions"]?{name:"actions",fn:He(()=>[ro(J.$slots,"fullscreen-actions",{},void 0,!0)]),key:"0"}:void 0,J.$slots["fullscreen-banner"]?{name:"banner",fn:He(()=>[ro(J.$slots,"fullscreen-banner",{},void 0,!0)]),key:"1"}:void 0,J.$slots["fullscreen-footer"]?{name:"footer",fn:He(()=>[ro(J.$slots,"fullscreen-footer",{},void 0,!0)]),key:"2"}:void 0]),1032,["show","mode","title","description","can-complete","header-style","header-text-color"])],4))}},fi=Ge(gw,[["__scopeId","data-v-4ba30c05"]]),yw={class:"course-areas-tab"},kw={__name:"CourseAreasTab",props:{checkpoints:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]},selectedAreaId:{type:String,default:null},drawingMode:{type:Boolean,default:!1}},emits:["map-click","location-click","area-click","import-checkpoints","upload-route","select-location","add-area","select-area","polygon-complete","cancel-drawing","add-checkpoint-from-map","add-many-checkpoints-from-map","add-area-from-map"],setup(e,{expose:t,emit:n}){const{terms:a,termsLower:s}=rt(),i=e,l=n,u=T(null),d=T(null),h=T(0),p=T({showRoute:!0,showUncheckedIn:!0,showPartiallyCheckedIn:!0,showFullyCheckedIn:!0,showAreas:!0,selectedAreaIds:[]}),g=z(()=>[{id:"add",icon:"plus",label:"Add",items:[{id:"checkpoint",label:a.value.checkpoint},{id:"many-checkpoints",label:`Many ${s.value.checkpoints}`},{id:"area",label:a.value.area},{id:"import",label:`Import ${s.value.checkpoints}...`},{id:"upload",label:`Upload ${s.value.course}...`}]}]),y=({actionId:S,itemId:_})=>{S==="add"&&(_==="checkpoint"?(l("add-checkpoint-from-map"),I()):_==="many-checkpoints"?(l("add-many-checkpoints-from-map"),I()):_==="area"?(l("add-area-from-map"),I()):_==="import"?l("import-checkpoints"):_==="upload"&&l("upload-route"))},b=S=>{p.value=S},C=S=>{h.value=S?.length||0},I=()=>{u.value&&u.value.scrollIntoView({behavior:"smooth",block:"start"})};return t({scrollMapIntoView:I,getMapCenter:()=>d.value?.getMapCenter()||null,getMapZoom:()=>d.value?.getMapZoom()||null}),qe(()=>i.areas,S=>{if(S.length>0){const _=new Set(p.value.selectedAreaIds);S.forEach(D=>{_.has(D.id)||p.value.selectedAreaIds.push(D.id)}),p.value.selectedAreaIds=p.value.selectedAreaIds.filter(D=>S.some(E=>E.id===D))}},{immediate:!0}),qe(()=>i.drawingMode,S=>{S||(h.value=0)}),(S,_)=>(v(),m("div",yw,[r("div",{class:"map-section",ref_key:"mapSection",ref:u},[Me(fi,{ref_key:"commonMapRef",ref:d,locations:e.checkpoints,route:e.route,areas:e.areas,"all-locations-for-bounds":e.checkpoints,"selected-area-id":e.selectedAreaId,clickable:!0,mode:e.drawingMode?"draw-polygon":"view",height:"100%","show-filters":"",filters:p.value,"toolbar-actions":g.value,"fullscreen-title":e.drawingMode?`Draw ${O(s).area} boundary`:O(a).course,"fullscreen-description":e.drawingMode?"Click on the map to draw the boundary":"",onMapClick:_[0]||(_[0]=D=>S.$emit("map-click",D)),onLocationClick:_[1]||(_[1]=D=>S.$emit("location-click",D)),onAreaClick:_[2]||(_[2]=D=>S.$emit("area-click",D)),onPolygonComplete:_[3]||(_[3]=D=>S.$emit("polygon-complete",D)),onPolygonDrawing:C,onFilterChange:b,onActionClick:y},null,8,["locations","route","areas","all-locations-for-bounds","selected-area-id","mode","filters","toolbar-actions","fullscreen-title","fullscreen-description"])],512)]))}},bw=Ge(kw,[["__scopeId","data-v-c0e54ae9"]]),_w=(e,t)=>{const n=String(e).trim(),a=String(t).trim(),s=parseFloat(n),i=parseFloat(a),l=!isNaN(s)&&String(s)===n,u=!isNaN(i)&&String(i)===a;return l&&u?s-i:n.localeCompare(a,void 0,{numeric:!0,sensitivity:"base"})},ww={__name:"StatusPill",props:{variant:{type:String,default:"neutral",validator:e=>["neutral","success","warning","danger","info","purple"].includes(e)},active:{type:Boolean,default:!1}},emits:["click"],setup(e){return(t,n)=>(v(),m("button",{class:pe(["status-pill",[e.variant,{active:e.active}]]),onClick:n[0]||(n[0]=a=>t.$emit("click"))},[ro(t.$slots,"default",{},void 0)],2))}},un=Ge(ww,[["__scopeId","data-v-a94deea5"]]),Cw={class:"check-in-toggle-container"},Lw=["disabled"],Sw={key:0,class:"toggle-spinner"},Iw={key:1,class:"toggle-icon"},xw={class:"toggle-label"},$w={key:0,class:"check-in-details"},Tw={key:0,class:"check-in-method"},Mw={__name:"CheckInToggleButton",props:{isCheckedIn:{type:Boolean,default:!1},checkInTime:{type:String,default:null},checkInMethod:{type:String,default:null},checkedInBy:{type:String,default:null},marshalName:{type:String,default:null},isLoading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},distance:{type:Number,default:null}},emits:["toggle","distance-click"],setup(e){const t=e,n=z(()=>t.distance===null||t.distance===void 0?null:t.distance<1e3?`${Math.round(t.distance)} m`:`${(t.distance/1e3).toFixed(2)} km`),a=z(()=>t.distance===null||t.distance===void 0?"":t.distance<=50?"distance-close":t.distance<=100?"distance-medium":"distance-far"),s=z(()=>t.isLoading?t.isCheckedIn?"Checking out...":"Checking in...":t.isCheckedIn?"Checked in":"Check in"),i=z(()=>{const{checkedInBy:u,checkInMethod:d,marshalName:h}=t;return u&&u!==h?u:d||""}),l=u=>u?new Date(u).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return(u,d)=>(v(),m("div",Cw,[r("button",{class:pe(["check-in-toggle",{"is-checked-in":e.isCheckedIn}]),disabled:e.disabled||e.isLoading,onClick:d[0]||(d[0]=h=>u.$emit("toggle"))},[e.isLoading?(v(),m("span",Sw)):e.isCheckedIn?(v(),m("span",Iw,"")):P("",!0),r("span",xw,w(s.value),1)],10,Lw),e.isCheckedIn&&e.checkInTime&&!e.isLoading?(v(),m("span",$w,[Ye(w(l(e.checkInTime))+" ",1),i.value?(v(),m("span",Tw,"("+w(i.value)+")",1)):P("",!0),n.value?(v(),m("span",{key:1,class:pe(["check-in-distance",a.value]),onClick:d[1]||(d[1]=it(h=>u.$emit("distance-click"),["stop"]))},w(n.value),3)):P("",!0)])):P("",!0)]))}},Jr=Ge(Mw,[["__scopeId","data-v-f08ae7ff"]]),Aw={class:"confirm-modal"},Ew={class:"confirm-actions"},Pw={__name:"ConfirmModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,required:!0},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},showCancel:{type:Boolean,default:!0},isDanger:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(e,{emit:t}){const n=t,a=()=>{n("confirm")},s=()=>{n("cancel")};return(i,l)=>e.show?(v(),m("div",{key:0,class:"modal-overlay",onClick:it(s,["self"])},[r("div",Aw,[r("h3",null,w(e.title),1),r("p",null,w(e.message),1),r("div",Ew,[e.showCancel?(v(),m("button",{key:0,onClick:s,class:"btn btn-secondary"},w(e.cancelText),1)):P("",!0),r("button",{onClick:a,class:pe(["btn",e.isDanger?"btn-danger":"btn-primary"])},w(e.confirmText),3)])])])):P("",!0)}},Aa=Ge(Pw,[["__scopeId","data-v-bead7a29"]]),Dw={class:"base-modal-header"},Ow={class:"base-modal-header-content"},Rw={key:0,class:"base-modal-title"},Bw={key:0,class:"base-modal-tab-header"},Nw={key:1,class:"base-modal-footer"},Fw={key:0,class:"base-modal-actions"},Uw={__name:"BaseModal",props:{show:{type:Boolean,required:!0},title:{type:String,default:""},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},variant:{type:String,default:"center",validator:e=>["center","sidebar"].includes(e)},zIndex:{type:Number,default:1e3},closeOnOverlay:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},confirmOnClose:{type:Boolean,default:!1},isDirty:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:t}){const n=()=>{const _=document.documentElement,D=getComputedStyle(_).getPropertyValue("--modal-resize-duration").trim();return D.endsWith("s")?parseFloat(D)*1e3:300},a=e,s=t,i=T(!1),l=T(!1),u=T(null),d=T(null);let h=null,p=!1,g=0;const y=()=>{if(!d.value||!u.value||p)return;const _=d.value.scrollHeight,D=g;if(D===_||g===0){g=_;return}p=!0,d.value.style.height=`${D}px`,d.value.style.overflow="hidden",d.value.offsetHeight,d.value.style.transition="height var(--modal-resize-duration, 0.3s) ease",d.value.style.height=`${_}px`;const E=n();setTimeout(()=>{d.value&&(d.value.style.height="",d.value.style.overflow="",d.value.style.transition=""),p=!1,g=_},E)},b=()=>{!u.value||typeof MutationObserver>"u"||(d.value&&(g=d.value.scrollHeight),h=new MutationObserver(()=>{an(()=>{y()})}),h.observe(u.value,{childList:!0,subtree:!0,attributes:!0,characterData:!0}))},C=()=>{h&&(h.disconnect(),h=null)};tn(()=>{an(()=>{a.show&&b()})}),bn(()=>{C()}),qe(()=>a.show,_=>{_?an(()=>{g=0,b()}):C()});const I=()=>{a.closeOnOverlay&&M()},M=()=>{a.confirmOnClose&&a.isDirty?i.value=!0:s("close")},x=()=>{i.value=!1,s("close")},S=()=>{i.value=!1};return(_,D)=>(v(),Ze(ts,{name:"modal",appear:""},{default:He(()=>[e.show?(v(),m("div",{key:0,class:"base-modal-overlay",style:Qe({zIndex:e.zIndex}),onClick:it(I,["self"])},[r("div",{class:pe(["base-modal",[`base-modal--${e.size}`,`base-modal--${e.variant}`]])},[r("div",Dw,[r("div",Ow,[ro(_.$slots,"header",{},()=>[e.title?(v(),m("h2",Rw,w(e.title),1)):P("",!0)],!0)]),e.showCloseButton?(v(),m("button",{key:0,onClick:M,class:"base-modal-close",type:"button","aria-label":"Close"},"  ")):P("",!0)]),_.$slots["tab-header"]?(v(),m("div",Bw,[ro(_.$slots,"tab-header",{},void 0,!0)])):P("",!0),r("div",{class:"base-modal-body",ref_key:"bodyRef",ref:u},[r("div",{class:"base-modal-body-content",ref_key:"contentRef",ref:d},[ro(_.$slots,"default",{},void 0,!0)],512)],512),_.$slots.footer||_.$slots.actions?(v(),m("div",Nw,[ro(_.$slots,"footer",{},()=>[_.$slots.actions?(v(),m("div",Fw,[ro(_.$slots,"actions",{},void 0,!0)])):P("",!0)],!0)])):P("",!0)],2),e.confirmOnClose&&!l.value?(v(),Ze(Aa,{key:0,show:i.value,title:"Unsaved changes",message:"You have unsaved changes. Are you sure you want to close?",onConfirm:x,onCancel:S},null,8,["show"])):P("",!0)],4)):P("",!0)]),_:3}))}},jt=Ge(Uw,[["__scopeId","data-v-141bdab1"]]),zw={class:"map-modal-content"},Hw={class:"location-info"},Vw={key:0,class:"info-row"},Gw={class:"info-value"},jw={key:1,class:"info-row"},Zw={class:"info-label"},qw={class:"info-value"},Ww={key:2,class:"info-row distance-row"},Kw={__name:"CheckInLocationMapModal",props:{show:{type:Boolean,default:!1},marshalName:{type:String,default:""},checkpointName:{type:String,default:""},checkInLocation:{type:Object,default:null},checkpointLocation:{type:Object,default:null},distance:{type:Number,default:null},zIndex:{type:Number,default:1100}},emits:["close"],setup(e){const{terms:t}=rt(),n=e,a=T(null);let s=null,i=null,l=null;const u=z(()=>t.value.checkpoint),d=z(()=>n.marshalName&&n.checkpointName?`${n.marshalName} - ${n.checkpointName}`:n.marshalName?n.marshalName:"Check-in location"),h=z(()=>n.distance===null?"":n.distance<1e3?`${Math.round(n.distance)} m`:`${(n.distance/1e3).toFixed(2)} km`),p=z(()=>n.distance===null?"":n.distance<=50?"distance-close":n.distance<=100?"distance-medium":"distance-far"),g=(I,M)=>I==null||M==null?"Unknown":`${I.toFixed(6)}, ${M.toFixed(6)}`,y=()=>{if(!a.value||s)return;let I=[51.505,-.09],M=15;n.checkInLocation&&(I=[n.checkInLocation.lat,n.checkInLocation.lng]),s=Bt.map(a.value).setView(I,M),Bt.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors",maxZoom:19}).addTo(s),b()},b=()=>{if(!s)return;i&&(i.remove(),i=null),l&&(l.remove(),l=null);const I=[];if(n.checkInLocation){const M=Bt.divIcon({className:"check-in-location-marker",html:`
        <div style="position: relative; width: 24px; height: 24px;">
          <div style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: #4285f4;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
          "></div>
          <div style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: rgba(66, 133, 244, 0.2);
            border-radius: 50%;
            animation: pulse 2s ease-out infinite;
          "></div>
        </div>
      `,iconSize:[40,40],iconAnchor:[20,20]});i=Bt.marker([n.checkInLocation.lat,n.checkInLocation.lng],{icon:M}).addTo(s).bindPopup(`<b>${n.marshalName||"Marshal"}</b><br>Check-in location`),I.push([n.checkInLocation.lat,n.checkInLocation.lng])}if(n.checkpointLocation&&n.checkpointLocation.lat&&n.checkpointLocation.lng){const M=Bt.divIcon({className:"checkpoint-location-marker",html:`
        <div style="display: flex; flex-direction: column; align-items: center;">
          <div style="
            width: 32px;
            height: 32px;
            background-color: #667eea;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
          ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
          </div>
          <div style="
            background-color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            margin-top: 2px;
          ">
            ${n.checkpointName||t.value.checkpoint}
          </div>
        </div>
      `,iconSize:[30,50],iconAnchor:[15,25]});l=Bt.marker([n.checkpointLocation.lat,n.checkpointLocation.lng],{icon:M}).addTo(s).bindPopup(`<b>${n.checkpointName||t.value.checkpoint}</b><br>${t.value.checkpoint} location`),I.push([n.checkpointLocation.lat,n.checkpointLocation.lng])}if(I.length===2){const M=Bt.latLngBounds(I);s.fitBounds(M,{padding:[50,50],maxZoom:17})}else I.length===1&&s.setView(I[0],16)},C=()=>{s&&(s.remove(),s=null,i=null,l=null)};return qe(()=>n.show,async I=>{I?(await an(),setTimeout(()=>{y()},100)):C()}),qe([()=>n.checkInLocation,()=>n.checkpointLocation],()=>{s&&b()},{deep:!0}),tn(()=>{n.show&&an(()=>{setTimeout(()=>{y()},100)})}),bn(()=>{C()}),(I,M)=>(v(),Ze(jt,{show:e.show,title:d.value,size:"medium","z-index":e.zIndex,onClose:M[0]||(M[0]=x=>I.$emit("close"))},{default:He(()=>[r("div",zw,[r("div",{class:"map-container",ref_key:"mapContainer",ref:a},null,512),r("div",Hw,[e.checkInLocation?(v(),m("div",Vw,[M[1]||(M[1]=r("span",{class:"info-label"},"Check-in location:",-1)),r("span",Gw,w(g(e.checkInLocation.lat,e.checkInLocation.lng)),1)])):P("",!0),e.checkpointLocation?(v(),m("div",jw,[r("span",Zw,w(u.value)+" location:",1),r("span",qw,w(g(e.checkpointLocation.lat,e.checkpointLocation.lng)),1)])):P("",!0),e.distance!==null?(v(),m("div",Ww,[M[2]||(M[2]=r("span",{class:"info-label"},"Distance:",-1)),r("span",{class:pe(["info-value distance-value",p.value])},w(h.value),3)])):P("",!0)])])]),_:1},8,["show","title","z-index"]))}},fd=Ge(Kw,[["__scopeId","data-v-011fa479"]]),Jw={class:"marshals-tab"},Yw={class:"tab-header"},Xw={class:"button-group"},Qw={key:0,class:"status-pills"},eC={class:"filters-section"},tC={class:"search-group"},nC={class:"marshals-grid"},oC={class:"marshals-table"},sC={key:0,class:"sort-indicator"},aC={key:0,class:"sort-indicator"},iC={key:0,class:"sort-indicator"},lC={key:0,class:"sort-indicator"},rC=["onClick"],cC=["rowspan"],uC={class:"checkpoint-cell"},dC={class:"checkpoint-name"},hC={key:0,class:"checkpoint-description"},fC=["rowspan"],pC={key:0,class:"last-active-text"},vC={key:1,class:"last-active-never"},mC=["onClick"],gC={class:"no-checkpoint-text"},yC={class:"hide-on-mobile last-active-cell"},kC={key:0,class:"last-active-text"},bC={key:1,class:"last-active-never"},_C={__name:"MarshalsTab",props:{marshals:{type:Array,required:!0},assignments:{type:Array,required:!0},locations:{type:Array,required:!0}},emits:["add-marshal","import-marshals","select-marshal","delete-marshal","toggle-check-in"],setup(e,{expose:t,emit:n}){const{terms:a}=rt(),s=e,i=n,l=T(null),u=T(!1),d=T(null),h=Q=>{l.value=Q},p=Q=>{d.value=Q,u.value=!0},g=()=>{u.value=!1,d.value=null},y=z(()=>d.value?Re(d.value.marshalId):""),b=z(()=>d.value?re(d.value.locationId):""),C=z(()=>{if(!d.value)return null;const{checkInLatitude:Q,checkInLongitude:ge}=d.value;return!Q||!ge?null:{lat:Q,lng:ge}}),I=z(()=>{if(!d.value)return null;const Q=X(d.value.locationId);return!Q?.latitude||!Q?.longitude?null:{lat:Q.latitude,lng:Q.longitude}}),M=z(()=>d.value?Xe(d.value):null),x=T(!1),S=T(null),_=Q=>{Q.isCheckedIn?(S.value=Q,x.value=!0):i("toggle-check-in",Q)},D=()=>{S.value&&i("toggle-check-in",S.value),x.value=!1,S.value=null},E=()=>{x.value=!1,S.value=null},Z=z(()=>S.value?`Are you sure you want to undo ${Re(S.value.marshalId)}'s check-in?`:"");t({setCheckingIn:h});const A=T("name"),N=T("asc"),B=T(""),j=T("all"),R=Q=>{j.value=Q},G=Q=>{A.value===Q?N.value=N.value==="asc"?"desc":"asc":(A.value=Q,N.value="asc")},ee=Q=>s.assignments.filter(ge=>ge.marshalId===Q),ne=z(()=>new Set(s.assignments.filter(Q=>Q.isCheckedIn).map(Q=>Q.marshalId))),Ae=z(()=>new Set(s.assignments.map(Q=>Q.marshalId))),J=z(()=>ne.value.size),te=z(()=>s.marshals.filter(Q=>!Ae.value.has(Q.id)).length),U=z(()=>s.marshals.filter(Q=>Ae.value.has(Q.id)&&!ne.value.has(Q.id)).length),X=Q=>s.locations.find(ge=>ge.id===Q),re=Q=>{const ge=X(Q);return ge?ge.name:"Unknown"},ke=Q=>{const ge=X(Q);return ge?ge.description:""},Re=Q=>{const ge=s.marshals.find(Ce=>Ce.id===Q);return ge?ge.name:""},Xe=Q=>{const{checkInLatitude:ge,checkInLongitude:Ce,locationId:ve}=Q,ue=X(ve);return!ge||!Ce||!ue?.latitude||!ue?.longitude?null:hi(ge,Ce,ue.latitude,ue.longitude)},Ne=Q=>{if(!Q)return"";const ge=new Date(Q),ve=new Date-ge,ue=Math.floor(ve/6e4),F=Math.floor(ue/60),K=Math.floor(F/24);return ue<1?"just now":ue<60?`${ue}m ago`:F<24?`${F}h ago`:K===1?"yesterday":K<7?`${K}d ago`:ge.toLocaleDateString()},Ke=z(()=>{let Q=s.marshals;if(j.value==="unassigned"?Q=Q.filter(ge=>!Ae.value.has(ge.id)):j.value==="checked-in"?Q=Q.filter(ge=>ne.value.has(ge.id)):j.value==="not-checked-in"&&(Q=Q.filter(ge=>Ae.value.has(ge.id)&&!ne.value.has(ge.id))),B.value.trim()){const ge=B.value.toLowerCase().trim().split(/\s+/);Q=Q.filter(Ce=>{const ue=ee(Ce.id).map(K=>{const ae=X(K.locationId);return ae?`${ae.name||""} ${ae.description||""}`:""}).join(" "),F=`${Ce.name} ${ue}`.toLowerCase();return ge.every(K=>F.includes(K))})}return Q}),We=z(()=>{const Q=[...Ke.value];return Q.sort((ge,Ce)=>{let ve=0;if(A.value==="name")ve=ge.name.localeCompare(Ce.name);else if(A.value==="checkpoint"){const ue=ee(ge.id),F=ee(Ce.id),K=ue.length>0?re(ue[0].locationId):"",ae=F.length>0?re(F[0].locationId):"";ve=_w(K,ae)}else if(A.value==="status"){const ue=ee(ge.id),F=ee(Ce.id),K=ue.length>0&&ue[0].isCheckedIn?1:0;ve=(F.length>0&&F[0].isCheckedIn?1:0)-K}else if(A.value==="lastActive"){const ue=ge.lastAccessedDate?new Date(ge.lastAccessedDate).getTime():0;ve=(Ce.lastAccessedDate?new Date(Ce.lastAccessedDate).getTime():0)-ue}return N.value==="asc"?ve:-ve}),Q});return(Q,ge)=>(v(),m("div",Jw,[r("div",Yw,[r("div",Xw,[r("button",{onClick:ge[0]||(ge[0]=Ce=>Q.$emit("add-marshal")),class:"btn btn-primary"}," Add "+w(O(a).person.toLowerCase()),1),r("button",{onClick:ge[1]||(ge[1]=Ce=>Q.$emit("import-marshals")),class:"btn btn-secondary"}," Import CSV ")]),e.marshals.length>0?(v(),m("div",Qw,[Me(un,{variant:"neutral",active:j.value==="all",onClick:ge[2]||(ge[2]=Ce=>R("all"))},{default:He(()=>[Ye(w(e.marshals.length)+" total ",1)]),_:1},8,["active"]),te.value>0&&te.value<e.marshals.length?(v(),Ze(un,{key:0,variant:"warning",active:j.value==="unassigned",onClick:ge[3]||(ge[3]=Ce=>R("unassigned"))},{default:He(()=>[Ye(w(te.value)+" unassigned ",1)]),_:1},8,["active"])):P("",!0),J.value>0&&J.value<e.marshals.length?(v(),Ze(un,{key:1,variant:"success",active:j.value==="checked-in",onClick:ge[4]||(ge[4]=Ce=>R("checked-in"))},{default:He(()=>[Ye(w(J.value)+" checked in ",1)]),_:1},8,["active"])):P("",!0),U.value>0&&U.value<e.marshals.length?(v(),Ze(un,{key:2,variant:"danger",active:j.value==="not-checked-in",onClick:ge[5]||(ge[5]=Ce=>R("not-checked-in"))},{default:He(()=>[Ye(w(U.value)+" not checked in ",1)]),_:1},8,["active"])):P("",!0)])):P("",!0)]),r("div",eC,[r("div",tC,[ze(r("input",{"onUpdate:modelValue":ge[6]||(ge[6]=Ce=>B.value=Ce),type:"text",class:"search-input",placeholder:"Search by name, checkpoint, or description..."},null,512),[[nt,B.value]])])]),r("div",nC,[r("table",oC,[r("thead",null,[r("tr",null,[r("th",{onClick:ge[7]||(ge[7]=Ce=>G("name")),class:"sortable"},[ge[12]||(ge[12]=Ye(" Name ",-1)),A.value==="name"?(v(),m("span",sC,w(N.value==="asc"?"":""),1)):P("",!0)]),r("th",{onClick:ge[8]||(ge[8]=Ce=>G("checkpoint")),class:"sortable"},[Ye(w(O(a).checkpoint)+" ",1),A.value==="checkpoint"?(v(),m("span",aC,w(N.value==="asc"?"":""),1)):P("",!0)]),r("th",{onClick:ge[9]||(ge[9]=Ce=>G("status")),class:"sortable"},[ge[13]||(ge[13]=Ye(" Status ",-1)),A.value==="status"?(v(),m("span",iC,w(N.value==="asc"?"":""),1)):P("",!0)]),r("th",{onClick:ge[10]||(ge[10]=Ce=>G("lastActive")),class:"sortable hide-on-mobile"},[ge[14]||(ge[14]=Ye(" Last active ",-1)),A.value==="lastActive"?(v(),m("span",lC,w(N.value==="asc"?"":""),1)):P("",!0)])])]),r("tbody",null,[(v(!0),m(Te,null,Fe(We.value,Ce=>(v(),m(Te,{key:Ce.id},[ee(Ce.id).length>0?(v(!0),m(Te,{key:0},Fe(ee(Ce.id),(ve,ue)=>(v(),m("tr",{key:`${Ce.id}-${ve.id}`,class:"marshal-row",onClick:F=>Q.$emit("select-marshal",Ce)},[ue===0?(v(),m("td",{key:0,rowspan:ee(Ce.id).length},w(Ce.name),9,cC)):P("",!0),r("td",uC,[r("div",dC,w(re(ve.locationId)),1),ke(ve.locationId)?(v(),m("div",hC,w(ke(ve.locationId)),1)):P("",!0)]),r("td",{onClick:ge[11]||(ge[11]=it(()=>{},["stop"])),class:"check-in-cell"},[Me(Jr,{"is-checked-in":ve.isCheckedIn,"check-in-time":ve.checkInTime,"check-in-method":ve.checkInMethod,"checked-in-by":ve.checkedInBy,"marshal-name":Re(ve.marshalId),"is-loading":l.value===ve.id,distance:Xe(ve),onToggle:F=>_(ve),onDistanceClick:F=>p(ve)},null,8,["is-checked-in","check-in-time","check-in-method","checked-in-by","marshal-name","is-loading","distance","onToggle","onDistanceClick"])]),ue===0?(v(),m("td",{key:1,rowspan:ee(Ce.id).length,class:"hide-on-mobile last-active-cell"},[Ce.lastAccessedDate?(v(),m("span",pC,w(Ne(Ce.lastAccessedDate)),1)):(v(),m("span",vC,"Never"))],8,fC)):P("",!0)],8,rC))),128)):(v(),m("tr",{key:1,class:"marshal-row",onClick:ve=>Q.$emit("select-marshal",Ce)},[r("td",null,w(Ce.name),1),r("td",gC,"No "+w(O(a).checkpoint.toLowerCase())+" assigned",1),ge[15]||(ge[15]=r("td",null,[r("span",{class:"hide-on-mobile"},"-"),r("span",{class:"status-icon show-on-mobile no-checkpoint-text"},"-")],-1)),r("td",yC,[Ce.lastAccessedDate?(v(),m("span",kC,w(Ne(Ce.lastAccessedDate)),1)):(v(),m("span",bC,"Never"))])],8,mC))],64))),128))])])]),Me(fd,{show:u.value,"marshal-name":y.value,"checkpoint-name":b.value,"check-in-location":C.value,"checkpoint-location":I.value,distance:M.value,onClose:g},null,8,["show","marshal-name","checkpoint-name","check-in-location","checkpoint-location","distance"]),Me(Aa,{show:x.value,title:"Confirm check-out",message:Z.value,"confirm-text":"Check out","is-danger":!0,onConfirm:D,onCancel:E},null,8,["show","message"])]))}},wC=Ge(_C,[["__scopeId","data-v-bdb66e38"]]),CC={class:"assignment-pills"},LC={__name:"ScopedAssignmentPills",props:{scopeConfigurations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},maxExpandedItems:{type:Number,default:5}},emits:["click"],setup(e){const{terms:t,termsLower:n}=rt(),a=e,s=h=>({Everyone:"Everyone",EveryoneInAreas:`Everyone in ${n.value.areas}`,EveryoneAtCheckpoints:`Everyone at ${n.value.checkpoints}`,SpecificPeople:`Specific ${n.value.people}`,EveryAreaLead:`Every ${n.value.area} lead`,OnePerCheckpoint:`One per ${n.value.checkpoint}`,OnePerArea:`One per ${n.value.area}`,OneLeadPerArea:`One lead per ${n.value.area}`,AreaLead:`${t.value.area} lead`})[h]||h,i=h=>({Everyone:"",EveryoneInAreas:"Everyone in",EveryoneAtCheckpoints:"Everyone at",SpecificPeople:"",EveryAreaLead:`${n.value.area} lead in`,OnePerCheckpoint:"One at",OnePerArea:"One in",OneLeadPerArea:"Lead in"})[h]||"",l=(h,p)=>p==="Area"?a.areas.find(y=>y.id===h)?.name||null:p==="Checkpoint"?a.locations.find(y=>y.id===h)?.name||null:p==="Marshal"&&a.marshals.find(y=>y.id===h)?.name||null,u=h=>{if(!h)return[];const p=s(h.scope),g=h.ids||[];if(h.itemType===null||g.length===0)return[p];if(g.includes("ALL_MARSHALS"))return["Everyone"];if(g.includes("ALL_AREAS"))return[`${p} (All ${n.value.areas})`];if(g.includes("ALL_CHECKPOINTS"))return[`${p} (All ${n.value.checkpoints})`];const y=g.filter(C=>l(C,h.itemType)!==null);if(y.length===0)return[];if(y.length>a.maxExpandedItems)return[`${p} (${y.length})`];const b=i(h.scope);return y.map(C=>{const I=l(C,h.itemType);return b?`${b} ${I}`:I})},d=z(()=>{if(!a.scopeConfigurations||a.scopeConfigurations.length===0)return[];const h=[];for(const p of a.scopeConfigurations)h.push(...u(p));return h});return(h,p)=>(v(),m("div",CC,[(v(!0),m(Te,null,Fe(d.value,(g,y)=>(v(),m("span",{key:y,class:"scope-badge",onClick:p[0]||(p[0]=b=>h.$emit("click"))},w(g),1))),128))]))}},Ql=Ge(LC,[["__scopeId","data-v-82c305e5"]]),SC={class:"checklists-tab"},IC={class:"checklists-tab-header"},xC={class:"button-group"},$C={class:"filters-section"},TC={class:"search-group"},MC=["placeholder"],AC={class:"checklist-items-list"},EC={key:0,class:"empty-state"},PC={class:"checklist-item-content"},DC=["onClick"],OC={__name:"ChecklistsTab",props:{checklistItems:{type:Array,required:!0},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},completionReport:{type:Object,default:null}},emits:["add-checklist-item","select-checklist-item"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=T(""),i=z(()=>{if(!s.value.trim())return a.checklistItems;const u=s.value.toLowerCase().trim().split(/\s+/);return a.checklistItems.filter(d=>{const h=(d.text||"").toLowerCase();return u.every(p=>h.includes(p))})}),l=z(()=>[...i.value].sort((u,d)=>u.displayOrder!==d.displayOrder?u.displayOrder-d.displayOrder:Ks(u.text,d.text)));return(u,d)=>(v(),m("div",SC,[r("div",IC,[r("div",xC,[r("button",{onClick:d[0]||(d[0]=h=>u.$emit("add-checklist-item")),class:"btn btn-primary"}," Add "+w(O(n).checklist),1)])]),r("div",$C,[r("div",TC,[ze(r("input",{"onUpdate:modelValue":d[1]||(d[1]=h=>s.value=h),type:"text",class:"search-input",placeholder:`Search ${O(n).checklists}...`},null,8,MC),[[nt,s.value]])])]),r("div",AC,[i.value.length===0?(v(),m("div",EC,[r("p",null,w(s.value?`No ${O(n).checklists} match your search.`:`No ${O(n).checklists} yet. Create one to get started!`),1)])):P("",!0),(v(!0),m(Te,null,Fe(l.value,h=>(v(),m("div",{key:h.itemId,class:"checklist-item-card"},[r("div",PC,[r("div",{class:"checklist-item-title",onClick:p=>u.$emit("select-checklist-item",h,"details")},[r("strong",null,w(h.text),1)],8,DC),Me(Ql,{class:"checklist-item-scopes","scope-configurations":h.scopeConfigurations,areas:e.areas,locations:e.locations,marshals:e.marshals,onClick:p=>u.$emit("select-checklist-item",h,"visibility")},null,8,["scope-configurations","areas","locations","marshals","onClick"])])]))),128))])]))}},RC=Ge(OC,[["__scopeId","data-v-4ea79496"]]),BC={class:"notes-tab"},NC={class:"tab-header"},FC={class:"button-group"},UC={class:"filters-section"},zC={class:"search-group"},HC={class:"notes-list"},VC={key:0,class:"empty-state"},GC=["onClick"],jC={class:"note-header"},ZC={class:"note-title-row"},qC={key:0,class:"pin-icon",title:"Pinned"},WC={key:1,class:"emergency-indicator",title:"Shown in emergency info"},KC={class:"note-meta"},JC={key:0,class:"category-badge"},YC={class:"created-info"},XC={key:0,class:"note-preview"},QC={__name:"NotesTab",props:{notes:{type:Array,required:!0},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]}},emits:["add-note","select-note"],setup(e,{emit:t}){const n=e,a=T(""),s=z(()=>{if(!a.value.trim())return n.notes;const d=a.value.toLowerCase().trim().split(/\s+/);return n.notes.filter(h=>{const p=`${h.title||""} ${h.content||""} ${h.priority||""}`.toLowerCase();return d.every(g=>p.includes(g))})}),i=z(()=>{const d={Urgent:0,High:1,Normal:2,Low:3};return[...s.value].sort((h,p)=>{if(h.isPinned!==p.isPinned)return h.isPinned?-1:1;const g=d[h.priority]??2,y=d[p.priority]??2;return g!==y?g-y:h.displayOrder!==p.displayOrder?h.displayOrder-p.displayOrder:Ks(h.title,p.title)})}),l=d=>{if(!d)return"";const h=150;return d.length<=h?d:d.substring(0,h)+"..."},u=d=>{if(!d)return"";const h=new Date(d),g=new Date-h,y=Math.floor(g/6e4),b=Math.floor(g/36e5),C=Math.floor(g/864e5);return y<1?"Just now":y<60?`${y}m ago`:b<24?`${b}h ago`:C<7?`${C}d ago`:h.toLocaleDateString()};return(d,h)=>(v(),m("div",BC,[r("div",NC,[r("div",FC,[r("button",{onClick:h[0]||(h[0]=p=>d.$emit("add-note")),class:"btn btn-primary"}," Add note ")])]),r("div",UC,[r("div",zC,[ze(r("input",{"onUpdate:modelValue":h[1]||(h[1]=p=>a.value=p),type:"text",class:"search-input",placeholder:"Search by title, content, or priority..."},null,512),[[nt,a.value]])])]),r("div",HC,[s.value.length===0?(v(),m("div",VC,[r("p",null,w(a.value?"No notes match your search.":"No notes yet. Create one to get started!"),1)])):P("",!0),(v(!0),m(Te,null,Fe(i.value,p=>(v(),m("div",{key:p.noteId,class:pe(["note-card",{pinned:p.isPinned}]),onClick:g=>d.$emit("select-note",p)},[r("div",jC,[r("div",ZC,[p.isPinned?(v(),m("span",qC,"")):P("",!0),r("span",{class:pe(["priority-indicator",p.priority?.toLowerCase()||"normal"])},null,2),r("strong",null,w(p.title),1),p.showInEmergencyInfo?(v(),m("span",WC,"")):P("",!0)]),r("div",KC,[p.category?(v(),m("span",JC,w(p.category),1)):P("",!0),r("span",YC,w(u(p.createdAt)),1)])]),p.content?(v(),m("div",XC,w(l(p.content)),1)):P("",!0),Me(Ql,{"scope-configurations":p.scopeConfigurations,areas:e.areas,locations:e.locations,marshals:e.marshals},null,8,["scope-configurations","areas","locations","marshals"])],10,GC))),128))])]))}},e2=Ge(QC,[["__scopeId","data-v-93bd2dc4"]]),t2={key:0,class:"empty-state"},n2={key:0,class:"empty-hint"},o2={__name:"CardsGrid",props:{isEmpty:{type:Boolean,default:!1},emptyMessage:{type:String,default:"No items."},emptyHint:{type:String,default:""},gridClass:{type:String,default:""}},setup(e){return(t,n)=>e.isEmpty?(v(),m("div",t2,[r("p",null,w(e.emptyMessage),1),e.emptyHint?(v(),m("p",n2,w(e.emptyHint),1)):P("",!0)])):(v(),m("div",{key:1,class:pe(["cards-grid",e.gridClass])},[ro(t.$slots,"default",{},void 0)],2))}},er=Ge(o2,[["__scopeId","data-v-a842b7b1"]]),s2={class:"contact-card-header"},a2={class:"contact-name-row"},i2={key:0,class:"pin-icon",title:"Pinned"},l2={key:1,class:"primary-badge",title:"Primary contact"},r2={class:"contact-name"},c2={key:0,class:"contact-role"},u2={key:0,class:"emergency-indicator",title:"Shown in emergency info"},d2={key:1,class:"no-scope-warning",title:"This contact has no visibility scope configured"},h2=["title"],f2={key:0,class:"contact-card-details"},p2={key:0,class:"contact-phone"},v2={key:1,class:"contact-email"},m2={key:1,class:"contact-card-notes"},g2={key:3,class:"contact-card-badge"},y2={key:4,class:"contact-card-badge"},k2={__name:"ContactCard",props:{contact:{type:Object,required:!0},isPending:{type:Boolean,default:!1},isMarkedForRemoval:{type:Boolean,default:!1},showRemoveButton:{type:Boolean,default:!1},removeTitle:{type:String,default:"Remove"},showNotes:{type:Boolean,default:!1},showScopes:{type:Boolean,default:!1},clickable:{type:Boolean,default:!0},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]}},emits:["click","remove","undo-remove"],setup(e,{emit:t}){const{terms:n}=rt(),a=e,s=t,i=z(()=>{const h=a.contact.scopeConfigurations;return!h||h.length===0}),l=()=>{a.clickable&&!a.isPending&&!a.isMarkedForRemoval&&s("click",a.contact)},u=h=>h?h==="AreaLead"?`${n.value.area} Lead`:h.replace(/([A-Z])/g," $1").replace(/^./,p=>p.toUpperCase()).trim():"",d=h=>{if(!h)return"";const p=100;return h.length<=p?h:h.substring(0,p)+"..."};return(h,p)=>(v(),m("div",{class:pe(["contact-card",{"is-pending":e.isPending,"is-marked-for-removal":e.isMarkedForRemoval,"is-primary":e.contact.isPrimary&&!e.isMarkedForRemoval,"is-pinned":e.contact.isPinned&&!e.isMarkedForRemoval&&!e.contact.isPrimary,"is-clickable":e.clickable&&!e.isMarkedForRemoval}]),onClick:l},[r("div",s2,[r("div",{class:pe(["contact-card-title",{clickable:e.clickable&&!e.isMarkedForRemoval}])},[r("div",a2,[e.contact.isPinned&&!e.isMarkedForRemoval?(v(),m("span",i2,"")):P("",!0),e.contact.isPrimary&&!e.isMarkedForRemoval?(v(),m("span",l2,"")):P("",!0),r("span",r2,w(e.contact.name),1)]),e.contact.role?(v(),m("span",c2,w(u(e.contact.role)),1)):P("",!0)],2),e.contact.showInEmergencyInfo&&!e.isMarkedForRemoval?(v(),m("span",u2,"")):P("",!0),i.value&&!e.isMarkedForRemoval&&!e.isPending?(v(),m("span",d2,"!")):P("",!0),e.showRemoveButton&&!e.isMarkedForRemoval?(v(),m("button",{key:2,type:"button",class:"contact-remove-btn",title:e.removeTitle,onClick:p[0]||(p[0]=it(g=>h.$emit("remove",e.contact.contactId),["stop"]))},"  ",8,h2)):P("",!0),e.isMarkedForRemoval?(v(),m("button",{key:3,type:"button",class:"contact-undo-btn",title:"Cancel removal",onClick:p[1]||(p[1]=it(g=>h.$emit("undo-remove",e.contact.contactId),["stop"]))}," Undo ")):P("",!0)]),e.contact.phone||e.contact.email?(v(),m("div",f2,[e.contact.phone?(v(),m("span",p2,w(e.contact.phone),1)):P("",!0),e.contact.email?(v(),m("span",v2,w(e.contact.email),1)):P("",!0)])):P("",!0),e.contact.notes&&e.showNotes?(v(),m("div",m2,w(d(e.contact.notes)),1)):P("",!0),e.showScopes&&e.contact.scopeConfigurations?.length>0&&!e.isMarkedForRemoval?(v(),Ze(Ql,{key:2,class:"contact-card-scopes","scope-configurations":e.contact.scopeConfigurations,areas:e.areas,locations:e.locations,marshals:e.marshals},null,8,["scope-configurations","areas","locations","marshals"])):P("",!0),e.isPending?(v(),m("div",g2,[...p[2]||(p[2]=[r("span",{class:"pending-indicator"},"Will be added on save",-1)])])):P("",!0),e.isMarkedForRemoval?(v(),m("div",y2,[...p[3]||(p[3]=[r("span",{class:"removal-indicator"},"Will be removed on save",-1)])])):P("",!0)],2))}},b2=Ge(k2,[["__scopeId","data-v-119c6276"]]),sm={__name:"ContactsGrid",props:{contacts:{type:Array,required:!0},showRemoveButton:{type:Boolean,default:!1},removeTitle:{type:[String,Function],default:"Remove"},showNotes:{type:Boolean,default:!1},showScopes:{type:Boolean,default:!1},emptyMessage:{type:String,default:"No contacts."},emptyHint:{type:String,default:""},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]}},emits:["select","remove","undo-remove"],setup(e){const t=e,n=s=>typeof t.removeTitle=="function"?t.removeTitle(s):t.removeTitle,a=s=>!s.isPending;return(s,i)=>(v(),Ze(er,{"is-empty":e.contacts.length===0,"empty-message":e.emptyMessage,"empty-hint":e.emptyHint},{default:He(()=>[(v(!0),m(Te,null,Fe(e.contacts,l=>(v(),Ze(b2,{key:l.contactId,contact:l,"is-pending":l.isPending,"is-marked-for-removal":l.isMarkedForRemoval,"show-remove-button":e.showRemoveButton,"remove-title":n(l),"show-notes":e.showNotes,"show-scopes":e.showScopes,clickable:a(l),areas:e.areas,locations:e.locations,marshals:e.marshals,onClick:u=>s.$emit("select",l),onRemove:i[0]||(i[0]=u=>s.$emit("remove",u)),onUndoRemove:i[1]||(i[1]=u=>s.$emit("undo-remove",u))},null,8,["contact","is-pending","is-marked-for-removal","show-remove-button","remove-title","show-notes","show-scopes","clickable","areas","locations","marshals","onClick"]))),128))]),_:1},8,["is-empty","empty-message","empty-hint"]))}},_2={class:"contacts-tab"},w2={class:"tab-header"},C2={class:"button-group"},L2={key:0,class:"status-pills"},S2={class:"filters-section"},I2={class:"search-group"},x2={__name:"ContactsTab",props:{contacts:{type:Array,required:!0},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},availableRoles:{type:Object,default:()=>({builtInRoles:[],customRoles:[]})}},emits:["add-contact","select-contact"],setup(e,{emit:t}){const n=e,a=T(""),s=T("all"),i=z(()=>n.contacts.filter(b=>!b.scopeConfigurations||b.scopeConfigurations.length===0).length),l=z(()=>n.contacts.filter(b=>b.scopeConfigurations&&b.scopeConfigurations.length>0).length),u=b=>{s.value=b},d=b=>b?b.toLowerCase().replace(/[.,\-_'"()]/g," ").replace(/\s+/g," ").trim():"",h=b=>b?b.replace(/([A-Z])/g," $1").replace(/^./,C=>C.toUpperCase()).trim():"",p=z(()=>{let b=n.contacts;if(s.value==="no-scope"?b=b.filter(C=>!C.scopeConfigurations||C.scopeConfigurations.length===0):s.value==="with-scope"&&(b=b.filter(C=>C.scopeConfigurations&&C.scopeConfigurations.length>0)),a.value.trim()){const I=d(a.value).split(" ").filter(M=>M.length>0);b=b.filter(M=>{const x=h(M.role),S=d(`${M.name||""} ${x} ${M.email||""} ${M.phone||""}`);return I.every(_=>S.includes(_))})}return b}),g=z(()=>[...p.value].sort((b,C)=>{if(b.isPinned!==C.isPinned)return b.isPinned?-1:1;const I=b.displayOrder||0,M=C.displayOrder||0;return I!==M?I-M:(b.name||"").localeCompare(C.name||"",void 0,{sensitivity:"base"})})),y=z(()=>{const b=a.value.trim();return s.value==="no-scope"?b?"No unassigned contacts match your search.":"All contacts are assigned.":s.value==="with-scope"?b?"No assigned contacts match your search.":"No contacts are assigned yet.":b?"No contacts match your search.":"No contacts yet. Create one to get started!"});return(b,C)=>(v(),m("div",_2,[r("div",w2,[r("div",C2,[r("button",{onClick:C[0]||(C[0]=I=>b.$emit("add-contact")),class:"btn btn-primary"}," Add contact ")]),e.contacts.length>0?(v(),m("div",L2,[Me(un,{variant:"neutral",active:s.value==="all",onClick:C[1]||(C[1]=I=>u("all"))},{default:He(()=>[Ye(w(e.contacts.length)+" total ",1)]),_:1},8,["active"]),l.value>0&&l.value<e.contacts.length?(v(),Ze(un,{key:0,variant:"success",active:s.value==="with-scope",onClick:C[2]||(C[2]=I=>u("with-scope"))},{default:He(()=>[Ye(w(l.value)+" assigned ",1)]),_:1},8,["active"])):P("",!0),i.value>0&&i.value<e.contacts.length?(v(),Ze(un,{key:1,variant:"danger",active:s.value==="no-scope",onClick:C[3]||(C[3]=I=>u("no-scope"))},{default:He(()=>[Ye(w(i.value)+" unassigned ",1)]),_:1},8,["active"])):P("",!0)])):P("",!0)]),r("div",S2,[r("div",I2,[ze(r("input",{"onUpdate:modelValue":C[4]||(C[4]=I=>a.value=I),type:"text",class:"search-input",placeholder:"Search by name, role, email, or phone..."},null,512),[[nt,a.value]])])]),Me(sm,{contacts:g.value,"show-notes":!0,"show-scopes":!0,"empty-message":y.value,areas:e.areas,locations:e.locations,marshals:e.marshals,onSelect:C[5]||(C[5]=I=>b.$emit("select-contact",I))},null,8,["contacts","empty-message","areas","locations","marshals"])]))}},$2=Ge(x2,[["__scopeId","data-v-0472ca99"]]),am=[{value:"UTC",label:"UTC"},{value:"America/New_York",label:"Eastern Time (ET)"},{value:"America/Chicago",label:"Central Time (CT)"},{value:"America/Denver",label:"Mountain Time (MT)"},{value:"America/Los_Angeles",label:"Pacific Time (PT)"},{value:"America/Anchorage",label:"Alaska Time (AKT)"},{value:"Pacific/Honolulu",label:"Hawaii Time (HT)"},{value:"Europe/London",label:"London (GMT/BST)"},{value:"Europe/Paris",label:"Paris (CET/CEST)"},{value:"Asia/Tokyo",label:"Tokyo (JST)"},{value:"Australia/Sydney",label:"Sydney (AEDT/AEST)"}],T2={class:"event-details-tab"},M2={class:"event-info-card"},A2={class:"form-group"},E2={class:"form-group"},P2={class:"form-row"},D2={class:"form-group"},O2={class:"form-group"},R2=["value"],B2={class:"form-actions"},N2=["disabled"],F2={__name:"EventDetailsTab",props:{eventData:{type:Object,required:!0},formDirty:{type:Boolean,default:!1}},emits:["submit","update:formDirty"],setup(e,{emit:t}){const n=e,a=t,s=T({...n.eventData});qe(()=>n.eventData,u=>{s.value={...u}},{deep:!0});const i=()=>{a("update:formDirty",!0)},l=()=>{a("submit",{...s.value})};return(u,d)=>(v(),m("div",T2,[r("div",M2,[r("form",{onSubmit:it(l,["prevent"]),class:"event-details-form"},[r("div",A2,[d[4]||(d[4]=r("label",null,"Event name",-1)),ze(r("input",{"onUpdate:modelValue":d[0]||(d[0]=h=>s.value.name=h),type:"text",required:"",class:"form-input",onInput:i},null,544),[[nt,s.value.name]])]),r("div",E2,[d[5]||(d[5]=r("label",null,"Description",-1)),ze(r("textarea",{"onUpdate:modelValue":d[1]||(d[1]=h=>s.value.description=h),rows:"3",class:"form-input",onInput:i},null,544),[[nt,s.value.description]])]),r("div",P2,[r("div",D2,[d[6]||(d[6]=r("label",null,"Event date & time",-1)),ze(r("input",{"onUpdate:modelValue":d[2]||(d[2]=h=>s.value.eventDate=h),type:"datetime-local",required:"",class:"form-input",onInput:i},null,544),[[nt,s.value.eventDate]])]),r("div",O2,[d[7]||(d[7]=r("label",null,"Time zone",-1)),ze(r("select",{"onUpdate:modelValue":d[3]||(d[3]=h=>s.value.timeZoneId=h),required:"",class:"form-input",onChange:i},[(v(!0),m(Te,null,Fe(O(am),h=>(v(),m("option",{key:h.value,value:h.value},w(h.label),9,R2))),128))],544),[[Fn,s.value.timeZoneId]])])]),r("div",B2,[r("button",{type:"submit",class:"btn btn-save",disabled:!e.formDirty}," Save ",8,N2)])],32)])]))}},U2=Ge(F2,[["__scopeId","data-v-2754c3cc"]]),z2={class:"admins-list"},H2={class:"admin-info"},V2={class:"admin-role"},G2=["onClick"],j2={__name:"AdminsList",props:{admins:{type:Array,required:!0}},emits:["add-admin","remove-admin"],setup(e){return(t,n)=>(v(),m("div",null,[r("button",{onClick:n[0]||(n[0]=a=>t.$emit("add-admin")),class:"btn btn-small btn-primary"}," Add administrator "),r("div",z2,[(v(!0),m(Te,null,Fe(e.admins,a=>(v(),m("div",{key:a.userEmail,class:"admin-item"},[r("div",H2,[r("strong",null,w(a.userEmail),1),r("span",V2,w(a.role),1)]),e.admins.length>1?(v(),m("button",{key:0,onClick:s=>t.$emit("remove-admin",a.userEmail),class:"btn btn-small btn-danger"}," Remove ",8,G2)):P("",!0)]))),128))])]))}},Z2=Ge(j2,[["__scopeId","data-v-e526860b"]]),Pn=[{name:"Charcoal",hex:"#2d3748"},{name:"Dark Gray",hex:"#4a5568"},{name:"Gray",hex:"#718096"},{name:"Red",hex:"#f56565"},{name:"Coral",hex:"#ff6b6b"},{name:"Rose",hex:"#fb7185"},{name:"Pink",hex:"#ed64a6"},{name:"Magenta",hex:"#d946ef"},{name:"Fuchsia",hex:"#e879f9"},{name:"Purple",hex:"#9f7aea"},{name:"Violet",hex:"#a78bfa"},{name:"Lavender",hex:"#b197fc"},{name:"Indigo",hex:"#5a67d8"},{name:"Navy",hex:"#4263eb"},{name:"Blue",hex:"#667eea"},{name:"Sky",hex:"#0ea5e9"},{name:"Cyan",hex:"#0bc5ea"},{name:"Aqua",hex:"#22d3ee"},{name:"Teal",hex:"#38b2ac"},{name:"Emerald",hex:"#10b981"},{name:"Green",hex:"#48bb78"},{name:"Mint",hex:"#51cf66"},{name:"Lime",hex:"#84cc16"},{name:"Olive",hex:"#a3b18a"},{name:"Yellow",hex:"#ecc94b"},{name:"Amber",hex:"#f59e0b"},{name:"Orange",hex:"#ed8936"},{name:"Peach",hex:"#ff922b"},{name:"Light Gray",hex:"#cbd5e0"},{name:"Silver",hex:"#e2e8f0"},{name:"Cream",hex:"#f7fafc"}],Tr="#667eea";function q2(e){const t=e.map(a=>a.color);return Pn.find(a=>!t.includes(a.hex))?.hex||Tr}const W2={class:"modal-content"},K2={class:"modal-body"},J2={class:"preview-section"},Y2={class:"map-preview"},X2=["innerHTML"],Q2={class:"options-grid"},eL={class:"option-button-content"},tL={class:"option-button-value icon-value"},nL=["innerHTML"],oL={class:"option-button-content"},sL={class:"option-button-value color-value"},aL=["disabled"],iL={class:"option-button-content"},lL={class:"option-button-value color-value"},rL={class:"option-button-content"},cL={class:"option-button-value icon-value"},uL=["innerHTML"],dL=["disabled"],hL={class:"option-button-content"},fL={class:"option-button-value color-value"},pL={class:"option-button-content"},vL={class:"option-button-value"},mL={class:"option-button-content"},gL={class:"option-button-value"},yL={key:0,class:"centered-popup"},kL={class:"popup-grid"},bL=["onClick"],_L=["innerHTML"],wL={key:0},CL={key:1,class:"centered-popup"},LL={class:"popup-grid"},SL=["title","onClick"],IL=["innerHTML"],xL={key:0},$L={key:0,class:"custom-color-icon",viewBox:"0 0 24 24",fill:"currentColor"},TL={key:1,class:"custom-check-mark"},ML={key:0,class:"custom-hex-input"},AL={class:"hex-input-row"},EL=["disabled"],PL={key:0,class:"hex-error"},DL={key:2,class:"centered-popup"},OL={class:"popup-grid"},RL=["title","onClick"],BL=["innerHTML"],NL={key:0},FL={key:0,class:"custom-color-icon",viewBox:"0 0 24 24",fill:"currentColor"},UL={key:1,class:"custom-check-mark"},zL={key:0,class:"custom-hex-input"},HL={class:"hex-input-row"},VL=["disabled"],GL={key:0,class:"hex-error"},jL={key:3,class:"centered-popup icon-popup"},ZL={class:"popup-grid"},qL=["onClick"],WL=["innerHTML"],KL={key:0},JL={key:4,class:"centered-popup"},YL={class:"popup-grid"},XL=["title","onClick"],QL=["innerHTML"],eS={key:0},tS={key:0,class:"custom-color-icon",viewBox:"0 0 24 24",fill:"currentColor"},nS={key:1,class:"custom-check-mark"},oS={key:0,class:"custom-hex-input"},sS={class:"hex-input-row"},aS=["disabled"],iS={key:0,class:"hex-error"},lS={key:5,class:"centered-popup"},rS={class:"size-grid"},cS=["onClick"],uS=["innerHTML"],dS={key:6,class:"centered-popup"},hS={class:"rotation-content"},fS={class:"rotation-preview-container"},pS=["innerHTML"],vS={class:"rotation-control"},mS={class:"rotation-slider-container"},gS=["value"],yS={class:"rotation-value"},kS={class:"rotation-presets"},bS="#667eea",_S={__name:"IconCustomizationModal",props:{isOpen:{type:Boolean,default:!1},iconType:{type:String,default:"none"},backgroundShape:{type:String,default:"circle"},backgroundColor:{type:String,default:""},borderColor:{type:String,default:""},iconColor:{type:String,default:""},size:{type:String,default:"100"},mapRotation:{type:[String,Number],default:""},level:{type:String,default:"checkpoint"},inheritedType:{type:String,default:""},inheritedBackgroundShape:{type:String,default:""},inheritedBackgroundColor:{type:String,default:""},inheritedBorderColor:{type:String,default:""},inheritedIconColor:{type:String,default:""},inheritedSize:{type:String,default:""},inheritedMapRotation:{type:[String,Number],default:""}},emits:["update:isOpen","apply","cancel"],setup(e,{emit:t}){const n=e,a=t,s=T(n.backgroundShape||"circle"),i=T(n.iconType||"none"),l=T(n.backgroundColor||""),u=T(n.borderColor||""),d=T(n.iconColor||""),h=T(n.size||"100"),p=T(n.mapRotation??""),g=T(null),y=T(!1),b=T(!1),C=T(!1),I=T(""),M=T(""),x=T(""),S=T(null),_=T(null),D=T(null),E=le=>le==="default"?n.inheritedBackgroundShape||"circle":le==="none"?"none":le||"circle",Z=le=>le==="default"||!le?U():le==="none"?"transparent":le,A=le=>le==="default"?n.inheritedBorderColor||"#ffffff":le==="none"||!le?"transparent":le,N=le=>{if(le==="default"){const ce=n.inheritedType;return ce&&ce!=="default"&&ri(ce).category==="content"?ce:"none"}return le==="none"||!le?"none":le},B=le=>le==="default"||!le?n.inheritedIconColor||"#ffffff":le==="none"?"transparent":le,j=le=>le==="default"?n.inheritedSize||"100":le||"100",R=le=>{if(le==="default"||le===""){const ce=n.inheritedMapRotation;return ce!==""&&ce!==void 0&&ce!==null&&parseInt(ce,10)||0}return parseInt(le,10)||0},G=z(()=>{const le=n.inheritedBackgroundShape||"circle",ce=kr.find(ye=>ye.value===le)?.label||"Circle";return[{value:"none",label:"None",showLabel:!0},{value:"default",label:`Default (${ce})`,showLabel:!0},...kr.filter(ye=>ye.value!=="none").map(ye=>({...ye,showLabel:!1}))]}),ee=z(()=>{const le=Kr.filter(st=>st.category==="content"),ce=[{value:"none",label:"None",category:"content",showLabel:!0}],ye=n.inheritedType;if(ye&&ye!=="default"){const st=ri(ye);st.category==="content"&&ce.push({value:"default",label:`Default (${st.label||ye})`,category:"content",showLabel:!0})}return ce.push(...le.map(st=>({...st,showLabel:!1}))),ce}),ne=z(()=>{const le={33:"Small",66:"Medium",100:"Normal",150:"Large"};return[{value:"default",label:`Default (${le[n.inheritedSize]||"Normal"})`},...h_.map(ye=>({value:ye.value,label:le[ye.value]||ye.label}))]}),Ae=z(()=>E(s.value)!=="none"),J=z(()=>N(i.value)!=="none"),te=z(()=>{const le=n.inheritedBackgroundColor;return le&&le!=="default"&&le.startsWith("#")?le:bS}),U=()=>te.value,X=z(()=>l.value&&l.value!=="default"?l.value:U()),re=z(()=>u.value==="none"?"transparent":u.value?u.value:n.inheritedBorderColor&&n.inheritedBorderColor!=="none"?n.inheritedBorderColor:"#ffffff"),ke=z(()=>d.value?d.value:n.inheritedIconColor?n.inheritedIconColor:"#ffffff"),Re=z(()=>{const le=te.value,ce=Pn.find(ye=>ye.hex.toLowerCase()===le.toLowerCase())?.name||"Custom";return[{hex:"none",name:"None",showLabel:!0},{hex:"default",name:`Default (${ce})`,showLabel:!0},...Pn.map(ye=>({hex:ye.hex,name:ye.name,showLabel:!1}))]}),Xe=z(()=>{const le=n.inheritedBorderColor||"#ffffff",ce=le==="#ffffff"?"White":Pn.find(ye=>ye.hex===le)?.name||"White";return[{hex:"none",name:"None",showLabel:!0},{hex:"default",name:`Default (${ce})`,showLabel:!0},{hex:"#ffffff",name:"White",showLabel:!1},{hex:"#000000",name:"Black",showLabel:!1},...Pn.filter(ye=>ye.hex!=="#ffffff").map(ye=>({hex:ye.hex,name:ye.name,showLabel:!1}))]}),Ne=z(()=>{const le=n.inheritedIconColor||"#ffffff",ce=le==="#ffffff"?"White":Pn.find(ye=>ye.hex===le)?.name||"White";return[{hex:"none",name:"None",showLabel:!0},{hex:"default",name:`Default (${ce})`,showLabel:!0},{hex:"#ffffff",name:"White",showLabel:!1},{hex:"#000000",name:"Black",showLabel:!1},...Pn.filter(ye=>ye.hex!=="#ffffff").map(ye=>({hex:ye.hex,name:ye.name,showLabel:!1}))]}),Ke=le=>le==="default"?!l.value||l.value==="default":l.value===le,We=le=>le==="#ffffff"?!d.value||d.value==="#ffffff":d.value===le,Q=z(()=>{const le=l.value;return!le||le==="default"||le==="none"?!1:!Pn.some(ce=>ce.hex.toLowerCase()===le.toLowerCase())}),ge=z(()=>{const le=u.value;return!le||le==="default"||le==="none"||le==="#ffffff"||le==="#000000"?!1:!Pn.some(ce=>ce.hex.toLowerCase()===le.toLowerCase())}),Ce=z(()=>{const le=d.value;return!le||le==="default"||le==="none"||le==="#ffffff"||le==="#000000"?!1:!Pn.some(ce=>ce.hex.toLowerCase()===le.toLowerCase())}),ve=z(()=>{if(!I.value)return!1;const le=I.value.replace(/^#/,"");return/^[0-9A-Fa-f]{6}$/.test(le)||/^[0-9A-Fa-f]{3}$/.test(le)}),ue=z(()=>{if(!M.value)return!1;const le=M.value.replace(/^#/,"");return/^[0-9A-Fa-f]{6}$/.test(le)||/^[0-9A-Fa-f]{3}$/.test(le)}),F=z(()=>{if(!x.value)return!1;const le=x.value.replace(/^#/,"");return/^[0-9A-Fa-f]{6}$/.test(le)||/^[0-9A-Fa-f]{3}$/.test(le)}),K=le=>{if(le==="none")return"None";if(le==="default"){const ye=n.inheritedBackgroundShape;return ye?`Default (${kr.find(je=>je.value===ye)?.label||"Circle"})`:"Default (Circle)"}const ce=kr.find(ye=>ye.value===le);return ce?ce.label:"Circle"},ae=le=>{if(le==="none")return"None";if(le==="default"){const ye=n.inheritedType;if(ye&&ye!=="default"){const st=ri(ye);if(st.category==="content")return`Default (${st.label||ye})`}return"Default"}const ce=Kr.find(ye=>ye.value===le);return ce?ce.label:"None"},$e=le=>{if(le==="none")return"None";if(!le||le==="default"){const ye=te.value;return`Default (${Pn.find(je=>je.hex.toLowerCase()===ye.toLowerCase())?.name||"Custom"})`}const ce=[...Pn].find(ye=>ye.hex.toLowerCase()===le.toLowerCase());return ce?ce.name:le},Be=le=>{if(le==="none")return"None";if(le==="default"){const ye=n.inheritedBorderColor;return ye&&ye!=="none"?`Default (${ye==="#ffffff"?"White":Pn.find(je=>je.hex===ye)?.name||"Custom"})`:"Default (White)"}if(!le||le==="#ffffff")return"White";const ce=[...Xe.value].find(ye=>ye.hex===le);return ce?ce.name:le},Oe=le=>{if(le==="none")return"None";if(le==="default"){const ye=n.inheritedIconColor;return ye?`Default (${ye==="#ffffff"?"White":Pn.find(je=>je.hex===ye)?.name||"Custom"})`:"Default (White)"}if(!le||le==="#ffffff")return"White";const ce=[...Ne.value].find(ye=>ye.hex===le);return ce?ce.name:le},Le=le=>{const ce={33:"Small",66:"Medium",100:"Normal",150:"Large"};if(le==="default"){const ye=n.inheritedSize;return`Default (${ce[ye]||"Normal"})`}return ce[le]||"Normal"},Y=le=>{if(le==="default"||le===""||le===void 0||le===null){const ce=n.inheritedMapRotation;return ce!==""&&ce!==void 0&&ce!==null?`Default (${ce})`:"Default (0)"}return`${le}`},he=le=>{if(le==="none")return`<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="16" height="16" rx="2" fill="none" stroke="#ccc" stroke-width="1.5" stroke-dasharray="3"/>
    </svg>`;const ce=E(le),ye=Z(l.value),st=A(u.value);return Di[ce]?`<svg width="20" height="20" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">${Di[ce]({backgroundColor:ye,borderColor:st==="transparent"?"none":st})}</svg>`:""},xe=le=>{const ce=N(le);return ce==="none"?`<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
      <rect x="1" y="1" width="16" height="16" rx="2" fill="none" stroke="#ccc" stroke-width="1.5" stroke-dasharray="3"/>
    </svg>`:In({type:ce,backgroundShape:"circle",backgroundColor:"#94a3b8",borderColor:"none",iconColor:"#fff",size:"75"})},Ie=le=>{const ce=E(le);if(ce==="none")return`<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="24" height="24" rx="4" fill="none" stroke="#ccc" stroke-width="2" stroke-dasharray="4"/>
    </svg>`;const ye=Z(l.value),st=A(u.value),je=N(i.value),Tt=B(d.value);return In({type:je!=="none"?je:ce,backgroundShape:ce,backgroundColor:ye,borderColor:st==="transparent"?"none":st,iconColor:Tt,size:"100",outputSize:28})},be=le=>{const ce=Z(le),ye=E(s.value),st=A(u.value),je=N(i.value),Tt=B(d.value);return ye==="none"?`<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="24" height="24" rx="4" fill="${ce==="transparent"?"#e2e8f0":ce}"/>
    </svg>`:In({type:je!=="none"?je:ye,backgroundShape:ye,backgroundColor:ce==="transparent"?"#e2e8f0":ce,borderColor:st==="transparent"?"none":st,iconColor:Tt,size:"100",outputSize:28})},de=le=>{const ce=A(le),ye=E(s.value),st=Z(l.value),je=N(i.value),Tt=B(d.value);return ye==="none"?`<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="24" height="24" rx="4" fill="#e2e8f0" stroke="${ce}" stroke-width="2"/>
    </svg>`:In({type:je!=="none"?je:ye,backgroundShape:ye,backgroundColor:st,borderColor:ce==="transparent"?"none":ce,iconColor:Tt,size:"100",outputSize:28})},fe=le=>{const ce=N(le),ye=E(s.value),st=Z(l.value),je=A(u.value),Tt=B(d.value);if(ce==="none"&&ye==="none")return`<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="24" height="24" rx="4" fill="#e2e8f0"/>
      <line x1="8" y1="8" x2="20" y2="20" stroke="#a0aec0" stroke-width="2" stroke-linecap="round"/>
    </svg>`;const Wt=ye!=="none"?ye:"circle";return In({type:ce!=="none"?ce:Wt,backgroundShape:Wt,backgroundColor:st,borderColor:je==="transparent"?"none":je,iconColor:Tt,size:"100",outputSize:42})},q=le=>{const ce=B(le),ye=E(s.value),st=Z(l.value),je=A(u.value),Tt=N(i.value);return Tt==="none"?`<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="24" height="24" rx="4" fill="${ce==="transparent"?"#e2e8f0":ce}"/>
    </svg>`:In({type:Tt,backgroundShape:ye!=="none"?ye:"circle",backgroundColor:st,borderColor:je==="transparent"?"none":je,iconColor:ce==="transparent"?"#e2e8f0":ce,size:"100",outputSize:28})},W=le=>{const ce=j(le),ye=E(s.value),st=Z(l.value),je=A(u.value),Tt=N(i.value),Wt=B(d.value);if(ye==="none"&&Tt==="none")return"";const Xt=ye!=="none"?ye:"circle";return In({type:Tt!=="none"?Tt:Xt,backgroundShape:Xt,backgroundColor:st,borderColor:je==="transparent"?"none":je,iconColor:Wt,size:ce})},ie=z(()=>{const le=E(s.value),ce=Z(l.value),ye=A(u.value),st=N(i.value),je=B(d.value),Tt=j(h.value);return le==="none"&&st==="none"?"":In(le==="none"&&st!=="none"?{type:st,backgroundShape:"none",backgroundColor:ce,borderColor:"none",iconColor:je,size:Tt}:{type:st!=="none"?st:le,backgroundShape:le,backgroundColor:ce,borderColor:ye==="transparent"?"none":ye,iconColor:je,size:Tt})}),Ue=le=>{g.value=g.value===le?null:le},et=()=>{g.value=null,y.value=!1,b.value=!1,C.value=!1},dt=le=>{s.value=le,et()},yt=le=>{l.value=le,et()},mt=le=>{u.value=le,et()},St=le=>{i.value=le,et()},Ct=le=>{d.value=le,et()},Rt=le=>{h.value=le,et()},Ft=le=>{p.value=le,et()},ht=()=>{y.value=!y.value,y.value&&(Q.value?I.value=l.value.replace(/^#/,""):I.value="",an(()=>S.value?.focus()))},on=()=>{b.value=!b.value,b.value&&(ge.value?M.value=u.value.replace(/^#/,""):M.value="",an(()=>_.value?.focus()))},dn=()=>{C.value=!C.value,C.value&&(Ce.value?x.value=d.value.replace(/^#/,""):x.value="",an(()=>D.value?.focus()))},Et=()=>{I.value=I.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()},Lt=()=>{M.value=M.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()},Qn=()=>{x.value=x.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()},zn=le=>le.length===3?le[0]+le[0]+le[1]+le[1]+le[2]+le[2]:le,eo=()=>{if(!ve.value)return;const le=zn(I.value);l.value="#"+le,y.value=!1,et()},fo=()=>{if(!ue.value)return;const le=zn(M.value);u.value="#"+le,b.value=!1,et()},Ht=()=>{if(!F.value)return;const le=zn(x.value);d.value="#"+le,C.value=!1,et()},ls=le=>{p.value=le};qe(()=>n.isOpen,le=>{if(le){const ce=n.backgroundShape&&n.backgroundShape!=="default"&&n.backgroundShape!=="circle",ye=n.iconType&&n.iconType!=="none"&&n.iconType!=="default",st=n.backgroundColor&&n.backgroundColor!=="",je=n.borderColor&&n.borderColor!=="",Tt=n.iconColor&&n.iconColor!=="",Wt=n.size&&n.size!==""&&n.size!=="100",Xt=n.mapRotation!==""&&n.mapRotation!==void 0&&n.mapRotation!==null&&n.mapRotation!==0;ce||ye||st||je||Tt||Wt||Xt?(s.value=n.backgroundShape||"default",i.value=n.iconType||"default",l.value=n.backgroundColor||"default",u.value=n.borderColor||"default",d.value=n.iconColor||"default",h.value=n.size||"default",p.value=n.mapRotation!==""&&n.mapRotation!==void 0&&n.mapRotation!==null?n.mapRotation:"default"):(s.value="default",i.value="default",l.value="default",u.value="default",d.value="default",h.value="default",p.value="default"),g.value=null}});const to=()=>{et(),a("update:isOpen",!1),a("cancel")},So=()=>{et();const le=st=>st==="default"?"":st;let ce="";i.value==="none"?ce="none":i.value&&i.value!=="default"&&(ce=i.value);let ye="";p.value!=="default"&&p.value!==""&&p.value!==void 0&&(ye=parseInt(p.value,10)||0),a("apply",{iconType:ce,backgroundShape:le(s.value),backgroundColor:le(l.value),borderColor:le(u.value),iconColor:le(d.value),size:le(h.value),mapRotation:ye}),a("update:isOpen",!1)};return(le,ce)=>e.isOpen?(v(),m("div",{key:0,class:"modal-overlay",onClick:it(to,["self"])},[r("div",W2,[r("div",{class:"modal-header"},[ce[18]||(ce[18]=r("h3",null,"Customise marker style",-1)),r("button",{class:"close-btn",onClick:to},"")]),r("div",K2,[r("div",J2,[r("div",Y2,[ce[19]||(ce[19]=r("div",{class:"map-background"},null,-1)),r("div",{class:"preview-icon",style:Qe({transform:`rotate(${R(p.value)}deg)`}),innerHTML:ie.value},null,12,X2)])]),r("div",Q2,[r("button",{type:"button",class:pe(["option-button",{active:g.value==="shape"}]),onClick:ce[0]||(ce[0]=ye=>Ue("shape"))},[r("div",eL,[ce[20]||(ce[20]=r("span",{class:"option-button-label"},"Shape",-1)),r("div",tL,[r("div",{class:"icon-preview-small",innerHTML:he(s.value)},null,8,nL),r("span",null,w(K(s.value)),1)])]),ce[21]||(ce[21]=r("span",{class:"option-button-arrow"},"",-1))],2),r("button",{type:"button",class:pe(["option-button",{active:g.value==="bgColor"}]),onClick:ce[1]||(ce[1]=ye=>Ue("bgColor"))},[r("div",oL,[ce[22]||(ce[22]=r("span",{class:"option-button-label"},"Background",-1)),r("div",sL,[r("span",{class:"color-swatch",style:Qe({backgroundColor:X.value})},null,4),r("span",null,w($e(l.value)),1)])]),ce[23]||(ce[23]=r("span",{class:"option-button-arrow"},"",-1))],2),r("button",{type:"button",class:pe(["option-button",{active:g.value==="borderColor",disabled:!Ae.value}]),disabled:!Ae.value,onClick:ce[2]||(ce[2]=ye=>Ue("borderColor"))},[r("div",iL,[ce[24]||(ce[24]=r("span",{class:"option-button-label"},"Border",-1)),r("div",lL,[r("span",{class:pe(["color-swatch",{"no-border":u.value==="none"}]),style:Qe(u.value!=="none"?{backgroundColor:re.value}:{})},null,6),r("span",null,w(Be(u.value)),1)])]),ce[25]||(ce[25]=r("span",{class:"option-button-arrow"},"",-1))],10,aL),r("button",{type:"button",class:pe(["option-button",{active:g.value==="icon"}]),onClick:ce[3]||(ce[3]=ye=>Ue("icon"))},[r("div",rL,[ce[26]||(ce[26]=r("span",{class:"option-button-label"},"Icon",-1)),r("div",cL,[r("div",{class:"icon-preview-small",innerHTML:xe(i.value)},null,8,uL),r("span",null,w(ae(i.value)),1)])]),ce[27]||(ce[27]=r("span",{class:"option-button-arrow"},"",-1))],2),r("button",{type:"button",class:pe(["option-button",{active:g.value==="iconColor",disabled:!J.value}]),disabled:!J.value,onClick:ce[4]||(ce[4]=ye=>Ue("iconColor"))},[r("div",hL,[ce[28]||(ce[28]=r("span",{class:"option-button-label"},"Colour",-1)),r("div",fL,[r("span",{class:"color-swatch",style:Qe({backgroundColor:ke.value})},null,4),r("span",null,w(Oe(d.value)),1)])]),ce[29]||(ce[29]=r("span",{class:"option-button-arrow"},"",-1))],10,dL),r("button",{type:"button",class:pe(["option-button",{active:g.value==="size"}]),onClick:ce[5]||(ce[5]=ye=>Ue("size"))},[r("div",pL,[ce[30]||(ce[30]=r("span",{class:"option-button-label"},"Size",-1)),r("span",vL,w(Le(h.value)),1)]),ce[31]||(ce[31]=r("span",{class:"option-button-arrow"},"",-1))],2),r("button",{type:"button",class:pe(["option-button option-button-full",{active:g.value==="mapRotation"}]),onClick:ce[6]||(ce[6]=ye=>Ue("mapRotation"))},[r("div",mL,[ce[32]||(ce[32]=r("span",{class:"option-button-label"},"Map rotation",-1)),r("span",gL,w(Y(p.value)),1)]),ce[33]||(ce[33]=r("span",{class:"option-button-arrow"},"",-1))],2)]),g.value==="shape"?(v(),m("div",yL,[r("div",{class:"popup-header"},[ce[34]||(ce[34]=r("span",null,"Select shape",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",kL,[(v(!0),m(Te,null,Fe(G.value,ye=>(v(),m("button",{key:ye.value,type:"button",class:pe(["popup-grid-item",{selected:s.value===ye.value}]),onClick:st=>dt(ye.value)},[r("div",{class:"popup-item-preview",innerHTML:Ie(ye.value)},null,8,_L),ye.showLabel?(v(),m("span",wL,w(ye.label),1)):P("",!0)],10,bL))),128))])])):P("",!0),g.value==="bgColor"?(v(),m("div",CL,[r("div",{class:"popup-header"},[ce[35]||(ce[35]=r("span",null,"Select background",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",LL,[(v(!0),m(Te,null,Fe(Re.value,ye=>(v(),m("button",{key:ye.hex,type:"button",class:pe(["popup-grid-item",{selected:Ke(ye.hex)}]),title:ye.name,onClick:st=>yt(ye.hex)},[r("div",{class:"popup-item-preview",innerHTML:be(ye.hex)},null,8,IL),ye.showLabel?(v(),m("span",xL,w(ye.name),1)):P("",!0)],10,SL))),128)),r("button",{type:"button",class:pe(["popup-grid-item custom-color-option",{selected:Q.value}]),style:Qe(Q.value?{"--custom-color":l.value}:{}),title:"Custom colour",onClick:ht},[r("div",{class:"popup-item-preview custom-color-preview",style:Qe(Q.value?{backgroundColor:l.value}:{})},[Q.value?P("",!0):(v(),m("svg",$L,[...ce[36]||(ce[36]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])])),Q.value?(v(),m("span",TL,"")):P("",!0)],4),ce[37]||(ce[37]=r("span",null,"Custom",-1))],6)]),y.value?(v(),m("div",ML,[ce[39]||(ce[39]=r("label",null,"Enter hex code",-1)),r("div",AL,[ce[38]||(ce[38]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"bgHexInput",ref:S,"onUpdate:modelValue":ce[7]||(ce[7]=ye=>I.value=ye),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:I.value&&!ve.value}]),onInput:Et,onKeydown:Yo(eo,["enter"])},null,34),[[nt,I.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:ve.value?"#"+I.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!ve.value,onClick:eo}," Apply ",8,EL)]),I.value&&!ve.value?(v(),m("span",PL," Invalid hex code ")):P("",!0)])):P("",!0)])):P("",!0),g.value==="borderColor"?(v(),m("div",DL,[r("div",{class:"popup-header"},[ce[40]||(ce[40]=r("span",null,"Select border",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",OL,[(v(!0),m(Te,null,Fe(Xe.value,ye=>(v(),m("button",{key:ye.hex,type:"button",class:pe(["popup-grid-item",{selected:u.value===ye.hex}]),title:ye.name,onClick:st=>mt(ye.hex)},[r("div",{class:"popup-item-preview",innerHTML:de(ye.hex)},null,8,BL),ye.showLabel?(v(),m("span",NL,w(ye.name),1)):P("",!0)],10,RL))),128)),r("button",{type:"button",class:pe(["popup-grid-item custom-color-option",{selected:ge.value}]),style:Qe(ge.value?{"--custom-color":u.value}:{}),title:"Custom colour",onClick:on},[r("div",{class:"popup-item-preview custom-color-preview",style:Qe(ge.value?{backgroundColor:u.value}:{})},[ge.value?P("",!0):(v(),m("svg",FL,[...ce[41]||(ce[41]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])])),ge.value?(v(),m("span",UL,"")):P("",!0)],4),ce[42]||(ce[42]=r("span",null,"Custom",-1))],6)]),b.value?(v(),m("div",zL,[ce[44]||(ce[44]=r("label",null,"Enter hex code",-1)),r("div",HL,[ce[43]||(ce[43]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"borderHexInput",ref:_,"onUpdate:modelValue":ce[8]||(ce[8]=ye=>M.value=ye),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:M.value&&!ue.value}]),onInput:Lt,onKeydown:Yo(fo,["enter"])},null,34),[[nt,M.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:ue.value?"#"+M.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!ue.value,onClick:fo}," Apply ",8,VL)]),M.value&&!ue.value?(v(),m("span",GL," Invalid hex code ")):P("",!0)])):P("",!0)])):P("",!0),g.value==="icon"?(v(),m("div",jL,[r("div",{class:"popup-header"},[ce[45]||(ce[45]=r("span",null,"Select icon",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",ZL,[(v(!0),m(Te,null,Fe(ee.value,ye=>(v(),m("button",{key:ye.value,type:"button",class:pe(["popup-grid-item",{selected:i.value===ye.value}]),onClick:st=>St(ye.value)},[r("div",{class:"popup-item-preview",innerHTML:fe(ye.value)},null,8,WL),ye.showLabel?(v(),m("span",KL,w(ye.label),1)):P("",!0)],10,qL))),128))])])):P("",!0),g.value==="iconColor"?(v(),m("div",JL,[r("div",{class:"popup-header"},[ce[46]||(ce[46]=r("span",null,"Select colour",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",YL,[(v(!0),m(Te,null,Fe(Ne.value,ye=>(v(),m("button",{key:ye.hex,type:"button",class:pe(["popup-grid-item",{selected:We(ye.hex)}]),title:ye.name,onClick:st=>Ct(ye.hex)},[r("div",{class:"popup-item-preview",innerHTML:q(ye.hex)},null,8,QL),ye.showLabel?(v(),m("span",eS,w(ye.name),1)):P("",!0)],10,XL))),128)),r("button",{type:"button",class:pe(["popup-grid-item custom-color-option",{selected:Ce.value}]),style:Qe(Ce.value?{"--custom-color":d.value}:{}),title:"Custom colour",onClick:dn},[r("div",{class:"popup-item-preview custom-color-preview",style:Qe(Ce.value?{backgroundColor:d.value}:{})},[Ce.value?P("",!0):(v(),m("svg",tS,[...ce[47]||(ce[47]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])])),Ce.value?(v(),m("span",nS,"")):P("",!0)],4),ce[48]||(ce[48]=r("span",null,"Custom",-1))],6)]),C.value?(v(),m("div",oS,[ce[50]||(ce[50]=r("label",null,"Enter hex code",-1)),r("div",sS,[ce[49]||(ce[49]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"iconHexInput",ref:D,"onUpdate:modelValue":ce[9]||(ce[9]=ye=>x.value=ye),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:x.value&&!F.value}]),onInput:Qn,onKeydown:Yo(Ht,["enter"])},null,34),[[nt,x.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:F.value?"#"+x.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!F.value,onClick:Ht}," Apply ",8,aS)]),x.value&&!F.value?(v(),m("span",iS," Invalid hex code ")):P("",!0)])):P("",!0)])):P("",!0),g.value==="size"?(v(),m("div",lS,[r("div",{class:"popup-header"},[ce[51]||(ce[51]=r("span",null,"Select size",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",rS,[(v(!0),m(Te,null,Fe(ne.value,ye=>(v(),m("button",{key:ye.value,type:"button",class:pe(["size-grid-item",{selected:h.value===ye.value}]),onClick:st=>Rt(ye.value)},[r("div",{class:"size-preview",innerHTML:W(ye.value)},null,8,uS),r("span",null,w(ye.label),1)],10,cS))),128))])])):P("",!0),g.value==="mapRotation"?(v(),m("div",dS,[r("div",{class:"popup-header"},[ce[52]||(ce[52]=r("span",null,"Set map rotation",-1)),r("button",{type:"button",class:"popup-close",onClick:et},"")]),r("div",hS,[r("div",fS,[r("div",{class:"rotation-preview-icon",style:Qe({transform:`rotate(${R(p.value)}deg)`}),innerHTML:ie.value},null,12,pS)]),ce[53]||(ce[53]=r("p",{class:"rotation-description"}," Rotate the marker on the map. This rotation is added to any map rotation. ",-1)),r("div",vS,[r("button",{type:"button",class:pe(["rotation-preset",{selected:p.value==="default"||p.value===""}]),onClick:ce[10]||(ce[10]=ye=>Ft("default"))}," Default ",2),r("div",mS,[r("input",{type:"range",min:"-180",max:"180",step:"5",class:"rotation-slider",value:p.value==="default"||p.value===""?0:p.value,onInput:ce[11]||(ce[11]=ye=>ls(parseInt(ye.target.value,10)))},null,40,gS),r("div",yS,w(p.value==="default"||p.value===""?"0":p.value)+" ",1)])]),r("div",kS,[r("button",{type:"button",class:pe(["rotation-preset-btn",{selected:p.value===-90}]),onClick:ce[12]||(ce[12]=ye=>Ft(-90))},"-90",2),r("button",{type:"button",class:pe(["rotation-preset-btn",{selected:p.value===-45}]),onClick:ce[13]||(ce[13]=ye=>Ft(-45))},"-45",2),r("button",{type:"button",class:pe(["rotation-preset-btn",{selected:p.value===0}]),onClick:ce[14]||(ce[14]=ye=>Ft(0))},"0",2),r("button",{type:"button",class:pe(["rotation-preset-btn",{selected:p.value===45}]),onClick:ce[15]||(ce[15]=ye=>Ft(45))},"+45",2),r("button",{type:"button",class:pe(["rotation-preset-btn",{selected:p.value===90}]),onClick:ce[16]||(ce[16]=ye=>Ft(90))},"+90",2),r("button",{type:"button",class:pe(["rotation-preset-btn",{selected:p.value===180}]),onClick:ce[17]||(ce[17]=ye=>Ft(180))},"180",2)])])])):P("",!0)]),r("div",{class:"modal-footer"},[r("button",{type:"button",class:"btn-cancel",onClick:to},"Cancel"),r("button",{type:"button",class:"btn-apply",onClick:So},"Apply")])])])):P("",!0)}},wS=Ge(_S,[["__scopeId","data-v-bbab1a46"]]),CS={class:"checkpoint-style-picker"},LS={class:"form-group"},SS={class:"style-options"},IS=["innerHTML"],xS={class:"option-label"},$S=["innerHTML"],TS="#667eea",MS={__name:"CheckpointStylePicker",props:{styleType:{type:String,default:"default"},styleColor:{type:String,default:""},styleBackgroundShape:{type:String,default:""},styleBackgroundColor:{type:String,default:""},styleBorderColor:{type:String,default:""},styleIconColor:{type:String,default:""},styleSize:{type:String,default:""},styleMapRotation:{type:[String,Number],default:""},iconLabel:{type:String,default:"Marker style"},showPreview:{type:Boolean,default:!0},inheritedStyleType:{type:String,default:"default"},inheritedStyleColor:{type:String,default:""},inheritedBackgroundShape:{type:String,default:""},inheritedBackgroundColor:{type:String,default:""},inheritedBorderColor:{type:String,default:""},inheritedIconColor:{type:String,default:""},inheritedSize:{type:String,default:""},inheritedMapRotation:{type:[String,Number],default:""},defaultLabel:{type:String,default:"Default"},level:{type:String,default:"checkpoint"}},emits:["update:styleType","update:styleColor","update:styleBackgroundShape","update:styleBackgroundColor","update:styleBorderColor","update:styleIconColor","update:styleSize","update:styleMapRotation","change"],setup(e,{emit:t}){const n=e,a=t,s=T(n.styleType),i=T(n.styleColor||""),l=T(n.styleBackgroundShape||"default"),u=T(n.styleBackgroundColor||""),d=T(n.styleBorderColor||""),h=T(n.styleIconColor||""),p=T(n.styleSize||"default"),g=T(n.styleMapRotation||""),y=R=>!R||R==="default"?!1:ri(R).category==="content",b=T(n.styleType&&n.styleType!=="default"&&n.styleType!=="custom"&&y(n.styleType)?n.styleType:"default"),C=T(!1),I=z(()=>!!(s.value&&s.value!=="default"||l.value&&l.value!=="default"&&l.value!=="circle"||u.value||d.value||h.value||p.value&&p.value!=="default"&&p.value!=="100")),M=R=>R&&R!==""&&R!=="default",x=R=>R&&R.startsWith("#"),S=z(()=>{const G=M(n.inheritedStyleType),ee=M(n.inheritedBackgroundShape),ne=x(n.inheritedBackgroundColor)||x(n.inheritedStyleColor),Ae=x(n.inheritedBorderColor),J=x(n.inheritedIconColor),te=M(n.inheritedSize);if(G||ee||ne||Ae||J||te){const X=G?n.inheritedStyleType:ee?n.inheritedBackgroundShape:"circle",re=(x(n.inheritedBackgroundColor)?n.inheritedBackgroundColor:null)||(x(n.inheritedStyleColor)?n.inheritedStyleColor:null)||TS;return In({type:X,backgroundShape:n.inheritedBackgroundShape||"circle",backgroundColor:re,borderColor:n.inheritedBorderColor||"#ffffff",iconColor:n.inheritedIconColor||"#ffffff",size:"75"})}return`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="defaultGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#10B981"/>
        <stop offset="50%" style="stop-color:#F59E0B"/>
        <stop offset="100%" style="stop-color:#EF4444"/>
      </linearGradient>
    </defs>
    <circle cx="${24/2}" cy="${24/2}" r="${24/2-2}" fill="url(#defaultGradient)" stroke="#fff" stroke-width="1.5"/>
  </svg>`}),_=z(()=>{const R=n.inheritedMapRotation;return R!==""&&R!==void 0&&R!==null&&R!==0?{transform:`rotate(${R}deg)`}:{}}),D=z(()=>{if(g.value!==""&&g.value!==void 0&&g.value!==null){const G=parseInt(g.value,10)||0;if(G!==0)return{transform:`rotate(${G}deg)`}}const R=n.inheritedMapRotation;return R!==""&&R!==void 0&&R!==null&&R!==0?{transform:`rotate(${R}deg)`}:{}}),E=z(()=>{if(I.value){const R=b.value&&b.value!=="none"&&b.value!=="default";let G=null;n.inheritedStyleType&&n.inheritedStyleType!=="default"&&n.inheritedStyleType!=="custom"&&ri(n.inheritedStyleType).category==="content"&&(G=n.inheritedStyleType);const ee=b.value==="default"&&G,ne=R||ee,Ae=R?b.value:ee?G:null,J=l.value&&l.value!=="default"?l.value:n.inheritedBackgroundShape||"circle",te=ne?Ae:J,U=u.value||n.inheritedBackgroundColor||n.inheritedStyleColor||"#667eea",X=d.value||n.inheritedBorderColor||"#ffffff",re=h.value||n.inheritedIconColor||"#ffffff";return In({type:te,backgroundShape:J,backgroundColor:U,borderColor:X,iconColor:re,size:"75"})}return`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <circle cx="12" cy="12" r="10" fill="#e2e8f0" stroke="#cbd5e0" stroke-width="1.5"/>
    <path d="M12 8v8M8 12h8" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/>
  </svg>`}),Z=()=>{s.value="default",b.value="default",a("update:styleType","default"),l.value="default",u.value="",i.value="",d.value="",h.value="",p.value="default",g.value="",a("update:styleBackgroundShape",""),a("update:styleBackgroundColor",""),a("update:styleColor",""),a("update:styleBorderColor",""),a("update:styleIconColor",""),a("update:styleSize",""),a("update:styleMapRotation",""),j()},A=()=>{C.value=!0},N=R=>{R.iconType==="none"?b.value="none":R.iconType?b.value=R.iconType:b.value="default",l.value=R.backgroundShape||"default",u.value=R.backgroundColor||"",d.value=R.borderColor||"",h.value=R.iconColor||"",p.value=R.size||"default",g.value=R.mapRotation??"";const G=R.iconType==="none"||R.iconType&&R.iconType!==""||R.backgroundShape||R.backgroundColor||R.borderColor||R.iconColor||R.size||R.mapRotation!==""&&R.mapRotation!==0;R.iconType&&R.iconType!=="none"?s.value=R.iconType:G?s.value="custom":s.value="default",a("update:styleType",s.value),a("update:styleBackgroundShape",R.backgroundShape),a("update:styleBackgroundColor",R.backgroundColor),a("update:styleBorderColor",R.borderColor),a("update:styleIconColor",R.iconColor),a("update:styleSize",R.size),a("update:styleMapRotation",R.mapRotation??""),j()},B=()=>{},j=()=>{a("change",{styleType:s.value,styleColor:u.value||i.value,styleBackgroundShape:l.value,styleBackgroundColor:u.value,styleBorderColor:d.value,styleIconColor:h.value,styleSize:p.value,styleMapRotation:g.value})};return qe(()=>n.styleType,R=>{s.value=R,R&&R!=="default"&&R!=="custom"&&y(R)?b.value=R:b.value="default"}),qe(()=>n.styleColor,R=>{i.value=R||""}),qe(()=>n.styleBackgroundShape,R=>{l.value=R||"default"}),qe(()=>n.styleBackgroundColor,R=>{u.value=R||""}),qe(()=>n.styleBorderColor,R=>{d.value=R||""}),qe(()=>n.styleIconColor,R=>{h.value=R||""}),qe(()=>n.styleSize,R=>{p.value=R||"default"}),qe(()=>n.styleMapRotation,R=>{g.value=R??""}),(R,G)=>(v(),m("div",CS,[r("div",LS,[r("label",null,w(e.iconLabel),1),r("div",SS,[r("button",{type:"button",class:pe(["style-option-button",{selected:!I.value}]),onClick:Z},[r("div",{class:"option-preview",style:Qe(_.value),innerHTML:S.value},null,12,IS),r("span",xS,w(e.defaultLabel),1)],2),r("button",{type:"button",class:pe(["style-option-button",{selected:I.value}]),onClick:A},[r("div",{class:"option-preview",style:Qe(D.value),innerHTML:E.value},null,12,$S),G[1]||(G[1]=r("span",{class:"option-label"},"Custom",-1))],2)])]),Me(wS,{isOpen:C.value,"onUpdate:isOpen":G[0]||(G[0]=ee=>C.value=ee),"icon-type":b.value,"background-shape":l.value,"background-color":u.value,"border-color":d.value,"icon-color":h.value,size:p.value,"map-rotation":g.value,level:e.level,"inherited-type":e.inheritedStyleType,"inherited-background-shape":e.inheritedBackgroundShape,"inherited-background-color":e.inheritedBackgroundColor||e.inheritedStyleColor,"inherited-border-color":e.inheritedBorderColor,"inherited-icon-color":e.inheritedIconColor,"inherited-size":e.inheritedSize,"inherited-map-rotation":e.inheritedMapRotation,onApply:N,onCancel:B},null,8,["isOpen","icon-type","background-shape","background-color","border-color","icon-color","size","map-rotation","level","inherited-type","inherited-background-shape","inherited-background-color","inherited-border-color","inherited-icon-color","inherited-size","inherited-map-rotation"])]))}},pd=Ge(MS,[["__scopeId","data-v-c066da64"]]),AS={class:"logo-uploader"},ES={key:0,class:"logo-preview"},PS=["src"],DS=["disabled"],OS={key:0,class:"upload-progress"},RS={key:1,class:"upload-prompt"},BS={key:2,class:"error-message"},gf=5*1024*1024,NS={__name:"LogoUploader",props:{modelValue:{type:String,default:""},eventId:{type:String,required:!0},adminEmail:{type:String,required:!0},staged:{type:Boolean,default:!1}},emits:["update:modelValue","staged-change"],setup(e,{expose:t,emit:n}){const a=J=>J?J.startsWith("/api")?Ca+J.substring(4):J:"",s=e;function i(){const J={},te=localStorage.getItem("adminEmail");te&&(J["X-Admin-Email"]=te);const U=localStorage.getItem("sessionToken");return U&&(J.Authorization=`Bearer ${U}`),J}const l=n;function u(){l("staged-change",{hasPendingChanges:b.value!==null||I.value,isPendingDelete:I.value,displayUrl:C.value||(I.value?"":s.modelValue)||""})}const d=T(null),h=T(!1),p=T(!1),g=T(""),y=T(Date.now()),b=T(null),C=T(""),I=T(!1),M=z(()=>{if(s.staged){if(C.value)return!0;if(I.value)return!1}return!!s.modelValue}),x=z(()=>{if(s.staged&&I.value)return"";if(s.staged&&C.value)return C.value;if(!s.modelValue)return"";const J=a(s.modelValue),te=J.includes("?")?"&":"?";return`${J}${te}_t=${y.value}`});function S(){C.value&&(URL.revokeObjectURL(C.value),C.value="")}bn(()=>{S()});const _=["image/png","image/jpeg","image/svg+xml","image/gif","image/webp"];function D(){h.value||d.value?.click()}function E(J){const te=J.target.files?.[0];te&&A(te),d.value&&(d.value.value="")}function Z(J){p.value=!1;const te=J.dataTransfer?.files?.[0];te&&A(te)}async function A(J){if(g.value="",!_.includes(J.type)){g.value="Invalid file type. Please use PNG, JPEG, SVG, GIF, or WebP.";return}if(J.size>gf){g.value=`File too large. Maximum size is ${gf/(1024*1024)}MB.`;return}if(s.staged){S(),b.value=J,C.value=URL.createObjectURL(J),I.value=!1,u();return}h.value=!0;try{const te=await fetch(`${Ca}/events/${s.eventId}/logo`,{method:"POST",headers:{"Content-Type":J.type,...i()},body:J});if(!te.ok){const X=await te.text().catch(()=>"");let re=`Upload failed (${te.status})`;try{re=JSON.parse(X).message||re}catch{X&&(re=X)}throw new Error(re)}const U=await te.json();y.value=Date.now(),l("update:modelValue",U.logoUrl)}catch(te){console.error("Logo upload error:",te),te.name==="TypeError"&&te.message==="Failed to fetch"?g.value="Network error. Check your connection or try a smaller file.":te.message?.includes("401")||te.message?.includes("403")?g.value="Not authorized. Please refresh the page and try again.":g.value=te.message||"Failed to upload logo. Please try again."}finally{h.value=!1}}async function N(){if(g.value="",s.staged){b.value?(S(),b.value=null):s.modelValue&&(I.value=!0),u();return}h.value=!0;try{const J=await fetch(`${Ca}/events/${s.eventId}/logo`,{method:"DELETE",headers:i()});if(!J.ok){const te=await J.json().catch(()=>({}));throw new Error(te.message||"Delete failed")}l("update:modelValue","")}catch(J){console.error("Logo delete error:",J),g.value=J.message||"Failed to remove logo. Please try again."}finally{h.value=!1}}async function B(){if(!b.value)return{success:!0,logoUrl:I.value?"":s.modelValue};h.value=!0,g.value="";try{const J=await fetch(`${Ca}/events/${s.eventId}/logo`,{method:"POST",headers:{"Content-Type":b.value.type,...i()},body:b.value});if(!J.ok){const U=await J.text().catch(()=>"");let X=`Upload failed (${J.status})`;try{X=JSON.parse(U).message||X}catch{U&&(X=U)}throw new Error(X)}const te=await J.json();return y.value=Date.now(),S(),b.value=null,I.value=!1,{success:!0,logoUrl:te.logoUrl}}catch(J){return console.error("Logo upload error:",J),g.value=J.message||"Failed to upload logo. Please try again.",{success:!1,error:J.message}}finally{h.value=!1}}async function j(){if(!I.value)return{success:!0};h.value=!0,g.value="";try{const J=await fetch(`${Ca}/events/${s.eventId}/logo`,{method:"DELETE",headers:i()});if(!J.ok){const te=await J.json().catch(()=>({}));throw new Error(te.message||"Delete failed")}return I.value=!1,{success:!0}}catch(J){return console.error("Logo delete error:",J),g.value=J.message||"Failed to remove logo. Please try again.",{success:!1,error:J.message}}finally{h.value=!1}}function R(){return b.value!==null||I.value}function G(){return b.value}function ee(){return I.value}function ne(){return C.value?C.value:I.value?"":a(s.modelValue)||""}function Ae(){S(),b.value=null,I.value=!1}return t({uploadStagedFile:B,deleteStagedLogo:j,hasPendingChanges:R,getStagedFile:G,isPendingDelete:ee,getDisplayUrl:ne,resetStagedState:Ae}),(J,te)=>(v(),m("div",AS,[te[4]||(te[4]=r("label",{class:"uploader-label"},"Event Logo",-1)),M.value?(v(),m("div",ES,[r("img",{src:x.value,alt:"Event logo",class:"logo-image"},null,8,PS),r("button",{type:"button",class:"remove-btn",onClick:N,disabled:h.value}," Remove ",8,DS)])):(v(),m("div",{key:1,class:pe(["upload-area",{"drag-over":p.value,uploading:h.value}]),onDragover:te[0]||(te[0]=it(U=>p.value=!0,["prevent"])),onDragleave:te[1]||(te[1]=it(U=>p.value=!1,["prevent"])),onDrop:it(Z,["prevent"]),onClick:D},[r("input",{ref_key:"fileInput",ref:d,type:"file",accept:"image/png,image/jpeg,image/svg+xml,image/gif,image/webp",class:"file-input",onChange:E},null,544),h.value?(v(),m("div",OS,[...te[2]||(te[2]=[r("div",{class:"spinner"},null,-1),r("span",null,"Uploading...",-1)])])):(v(),m("div",RS,[...te[3]||(te[3]=[r("div",{class:"upload-icon"},"+",-1),r("span",{class:"upload-text"},"Click or drag to upload logo",-1),r("span",{class:"upload-hint"},"PNG, JPEG, SVG, GIF, WebP (max 5MB)",-1)])]))],34)),g.value?(v(),m("div",BS,w(g.value),1)):P("",!0)]))}},FS=Ge(NS,[["__scopeId","data-v-bfb1b332"]]),im=[{name:"Default",headerGradientStart:"#667eea",headerGradientEnd:"#764ba2",accentColor:"#667eea",pageGradientStart:"#667eea",pageGradientEnd:"#764ba2"},{name:"Wasp",headerGradientStart:"#333333",headerGradientEnd:"#333333",accentColor:"#FFD700",pageGradientStart:"#FFD700",pageGradientEnd:"#333333"},{name:"Ocean",headerGradientStart:"#0077be",headerGradientEnd:"#00a8e8",accentColor:"#0077be",pageGradientStart:"#0077be",pageGradientEnd:"#00a8e8"},{name:"Forest",headerGradientStart:"#228b22",headerGradientEnd:"#32cd32",accentColor:"#228b22",pageGradientStart:"#228b22",pageGradientEnd:"#32cd32"},{name:"Sunset",headerGradientStart:"#ff6b35",headerGradientEnd:"#f7931e",accentColor:"#ff6b35",pageGradientStart:"#ff6b35",pageGradientEnd:"#f7931e"},{name:"Berry",headerGradientStart:"#8e2de2",headerGradientEnd:"#4a00e0",accentColor:"#8e2de2",pageGradientStart:"#8e2de2",pageGradientEnd:"#4a00e0"},{name:"Coral",headerGradientStart:"#ff758c",headerGradientEnd:"#ff7eb3",accentColor:"#ff758c",pageGradientStart:"#ff758c",pageGradientEnd:"#ff7eb3"},{name:"Steel",headerGradientStart:"#485563",headerGradientEnd:"#29323c",accentColor:"#485563",pageGradientStart:"#485563",pageGradientEnd:"#29323c"},{name:"Mint",headerGradientStart:"#11998e",headerGradientEnd:"#38ef7d",accentColor:"#11998e",pageGradientStart:"#11998e",pageGradientEnd:"#38ef7d"},{name:"Cherry",headerGradientStart:"#eb3349",headerGradientEnd:"#f45c43",accentColor:"#eb3349",pageGradientStart:"#eb3349",pageGradientEnd:"#f45c43"},{name:"Midnight",headerGradientStart:"#232526",headerGradientEnd:"#414345",accentColor:"#5c5c5c",pageGradientStart:"#232526",pageGradientEnd:"#414345"},{name:"Lavender",headerGradientStart:"#a18cd1",headerGradientEnd:"#fbc2eb",accentColor:"#a18cd1",pageGradientStart:"#a18cd1",pageGradientEnd:"#fbc2eb"},{name:"Gold",headerGradientStart:"#f7971e",headerGradientEnd:"#ffd200",accentColor:"#f7971e",pageGradientStart:"#f7971e",pageGradientEnd:"#ffd200"}];function US(){return{...im[0]}}function zS(e,t){return{...e,headerGradientStart:t.headerGradientStart,headerGradientEnd:t.headerGradientEnd,accentColor:t.accentColor,pageGradientStart:t.pageGradientStart,pageGradientEnd:t.pageGradientEnd,logoUrl:e.logoUrl||"",logoPosition:e.logoPosition||""}}function Ru(e){const t=e.replace("#",""),n=parseInt(t.slice(0,2),16)/255,a=parseInt(t.slice(2,4),16)/255,s=parseInt(t.slice(4,6),16)/255,i=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),l=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4);return .2126*i+.7152*l+.0722*u}function Bu(e){return!e||e===""?"#ffffff":Ru(e)>.179?"#333333":"#ffffff"}function lm(e,t){const n=e||cn.headerGradientStart,a=t||cn.headerGradientEnd,s=Ru(n),i=Ru(a);return(s+i)/2>.35?"#333333":"#ffffff"}const cn={headerGradientStart:"#667eea",headerGradientEnd:"#764ba2",accentColor:"#667eea",pageGradientStart:"#667eea",pageGradientEnd:"#764ba2"},HS={class:"marshal-mockup-container"},VS={class:"presets-section"},GS={class:"presets-row"},jS=["title","onClick"],ZS={class:"preset-name"},qS={class:"mockup-frame"},WS={key:0,class:"logo-cover-bg"},KS=["src"],JS=["src"],YS={class:"header-center"},XS={class:"event-name"},QS={class:"mockup-buttons"},eI=["src"],tI={class:"mockup-body"},nI={class:"mockup-card"},oI={class:"card-content"},sI={class:"editor-header"},aI={class:"editor-content"},iI={class:"color-grid-inline"},lI={class:"color-field"},rI={class:"color-swatches"},cI=["title","onClick"],uI={key:0,class:"check"},dI={class:"custom-color-wrapper"},hI={class:"hex-popup-header"},fI={class:"hex-input-row"},pI=["disabled"],vI={key:0,class:"hex-error"},mI={class:"gradient-toggle"},gI={key:0,class:"color-field"},yI={class:"color-swatches"},kI=["title","onClick"],bI={key:0,class:"check"},_I={class:"custom-color-wrapper"},wI={class:"hex-popup-header"},CI={class:"hex-input-row"},LI=["disabled"],SI={key:0,class:"hex-error"},II={key:1,class:"logo-position-section"},xI={class:"position-buttons"},$I={class:"color-swatches"},TI=["title","onClick"],MI={key:0,class:"check"},AI={class:"custom-color-wrapper"},EI={class:"hex-popup-header"},PI={class:"hex-input-row"},DI=["disabled"],OI={key:0,class:"hex-error"},RI={class:"color-grid-inline"},BI={class:"color-field"},NI={class:"color-swatches"},FI=["title","onClick"],UI={key:0,class:"check"},zI={class:"custom-color-wrapper"},HI={class:"hex-popup-header"},VI={class:"hex-input-row"},GI=["disabled"],jI={key:0,class:"hex-error"},ZI={class:"gradient-toggle"},qI={key:0,class:"color-field"},WI={class:"color-swatches"},KI=["title","onClick"],JI={key:0,class:"check"},YI={class:"custom-color-wrapper"},XI={class:"hex-popup-header"},QI={class:"hex-input-row"},ex=["disabled"],tx={key:0,class:"hex-error"},nx={class:"editor-footer"},ox={__name:"MarshalModeMockup",props:{branding:{type:Object,required:!0},eventName:{type:String,default:""},eventDate:{type:String,default:""},eventId:{type:String,required:!0},adminEmail:{type:String,required:!0}},emits:["update:branding","logo-staged-change"],setup(e,{expose:t,emit:n}){const a=Le=>Le?Le.startsWith("/api")?Ca+Le.substring(4):Le:"",s=Pn,i=e,l=n,u=T(null),d=im,h=T(!1),p=T(!1),g=T(null),y=T(!1),b=T(""),C=Le=>{typeof Le=="object"&&Le!==null?(y.value=Le.isPendingDelete,b.value=Le.displayUrl||"",l("logo-staged-change",Le.hasPendingChanges)):(g.value&&(y.value=g.value.isPendingDelete(),b.value=g.value.getDisplayUrl()||""),l("logo-staged-change",!!Le))},I=T(null),M=T(""),x=T(null),S=T(null),_=T({left:"50%",right:"auto",transform:"translateX(-50%)"}),D=Le=>Le?!s.some(Y=>Y.hex.toLowerCase()===Le.toLowerCase()):!1,E=Le=>!Le||!D(Le)?"#666666":Bu(Le),Z=Le=>!Le||!D(Le)?"#e0e0e0":Le,A=z(()=>{if(!M.value)return!1;const Le=M.value.replace(/^#/,"");return/^[0-9A-Fa-f]{6}$/.test(Le)||/^[0-9A-Fa-f]{3}$/.test(Le)}),N=(Le,Y)=>{if(I.value===Le)I.value=null;else{I.value=Le;let he="";switch(Le){case"headerStart":he=i.branding.headerGradientStart;break;case"headerEnd":he=i.branding.headerGradientEnd;break;case"pageStart":he=i.branding.pageGradientStart;break;case"pageEnd":he=i.branding.pageGradientEnd;break;case"accent":he=i.branding.accentColor;break}if(he&&D(he)?M.value=he.replace(/^#/,""):M.value="",Y&&S.value){const xe=Y.currentTarget,Ie=S.value,be=xe.getBoundingClientRect(),de=Ie.getBoundingClientRect(),fe=220,q=12,W=be.left+be.width/2-de.left,ie=de.width,Ue=W-fe/2;W+fe/2>ie-q?_.value={left:"auto",right:"0",transform:"none"}:Ue<q?_.value={left:"0",right:"auto",transform:"none"}:_.value={left:"50%",right:"auto",transform:"translateX(-50%)"}}an(()=>x.value?.focus())}},B=()=>{M.value=M.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()},j=()=>{if(!A.value||!I.value)return;let Le=M.value;Le.length===3&&(Le=Le[0]+Le[0]+Le[1]+Le[1]+Le[2]+Le[2]);const Y="#"+Le;switch(I.value){case"headerStart":ge("start",Y);break;case"headerEnd":Q("headerGradientEnd",Y);break;case"pageStart":Ce("start",Y);break;case"pageEnd":Q("pageGradientEnd",Y);break;case"accent":Q("accentColor",Y);break}I.value=null};qe(u,Le=>{if(I.value=null,M.value="",Le==="header"){const Y=i.branding.headerGradientStart||cn.headerGradientStart,he=i.branding.headerGradientEnd||cn.headerGradientEnd;h.value=Y!==he}else if(Le==="page"){const Y=i.branding.pageGradientStart||cn.pageGradientStart,he=i.branding.pageGradientEnd||cn.pageGradientEnd;p.value=Y!==he}});const R={header:"Header colour",logo:"Event logo",accent:"Accent colour",page:"Page background"},G=z(()=>i.branding.headerGradientStart||cn.headerGradientStart),ee=z(()=>i.branding.headerGradientEnd||cn.headerGradientEnd),ne=z(()=>i.branding.accentColor||cn.accentColor),Ae=z(()=>i.branding.pageGradientStart||cn.pageGradientStart),J=z(()=>i.branding.pageGradientEnd||cn.pageGradientEnd),te=z(()=>i.branding.logoPosition||"left"),U=T(Date.now());qe(()=>i.branding.logoUrl,()=>{U.value=Date.now(),y.value=!1,b.value=""});const X=z(()=>y.value?!1:!!(b.value||i.branding.logoUrl)),re=z(()=>{if(y.value)return"";if(b.value){if(b.value.startsWith("blob:"))return b.value;const he=a(b.value),xe=he.includes("?")?"&":"?";return`${he}${xe}_t=${U.value}`}if(!i.branding.logoUrl)return"";const Le=a(i.branding.logoUrl),Y=Le.includes("?")?"&":"?";return`${Le}${Y}_t=${U.value}`}),ke=z(()=>({background:`linear-gradient(135deg, ${G.value} 0%, ${ee.value} 100%)`})),Re=z(()=>lm(G.value,ee.value)),Xe=z(()=>({background:ne.value,color:Bu(ne.value)})),Ne=z(()=>({background:`linear-gradient(135deg, ${Ae.value} 0%, ${J.value} 100%)`}));function Ke(Le){u.value=u.value===Le?null:Le}function We(Le){!X.value&&Le&&Q("logoPosition",Le),Ke("logo")}function Q(Le,Y){l("update:branding",{...i.branding,[Le]:Y})}function ge(Le,Y){h.value?Q("headerGradientStart",Y):l("update:branding",{...i.branding,headerGradientStart:Y,headerGradientEnd:Y})}function Ce(Le,Y){p.value?Q("pageGradientStart",Y):l("update:branding",{...i.branding,pageGradientStart:Y,pageGradientEnd:Y})}function ve(){if(!h.value){const Le=i.branding.headerGradientStart||cn.headerGradientStart;Q("headerGradientEnd",Le)}}function ue(){if(!p.value){const Le=i.branding.pageGradientStart||cn.pageGradientStart;Q("pageGradientEnd",Le)}}function F(Le){l("update:branding",zS(i.branding,Le)),u.value=null}async function K(){return g.value?await g.value.uploadStagedFile():{success:!0,logoUrl:i.branding.logoUrl}}async function ae(){return g.value?await g.value.deleteStagedLogo():{success:!0}}function $e(){return g.value?.hasPendingChanges()||!1}function Be(){return g.value?.isPendingDelete()||!1}function Oe(){g.value&&g.value.resetStagedState(),y.value=!1,b.value=""}return t({uploadStagedLogo:K,deleteStagedLogo:ae,hasLogoChanges:$e,isLogoPendingDelete:Be,resetLogo:Oe}),(Le,Y)=>(v(),m("div",HS,[r("div",VS,[Y[32]||(Y[32]=r("span",{class:"presets-label"},"Quick themes:",-1)),r("div",GS,[(v(!0),m(Te,null,Fe(O(d),he=>(v(),m("button",{key:he.name,type:"button",class:"preset-btn",title:he.name,onClick:xe=>F(he)},[r("span",{class:"preset-preview",style:Qe({background:`linear-gradient(135deg, ${he.pageGradientStart} 0%, ${he.pageGradientEnd} 100%)`})},null,4),r("span",ZS,w(he.name),1)],8,jS))),128))])]),r("div",qS,[r("div",{class:pe(["mockup-page",{"region-active":u.value==="page"}]),style:Qe(Ne.value),onClick:Y[7]||(Y[7]=he=>Ke("page"))},[r("div",{class:pe(["mockup-header",[{"region-active":u.value==="header"},X.value?`logo-${te.value}`:"logo-none"]]),style:Qe(ke.value),onClick:Y[5]||(Y[5]=it(he=>Ke("header"),["stop"]))},[X.value&&te.value==="cover"?(v(),m("div",WS,[r("img",{src:re.value,alt:"Logo",class:"logo-cover-img"},null,8,KS)])):P("",!0),X.value&&te.value==="cover"?(v(),m("button",{key:1,type:"button",class:pe(["logo-cover-edit-btn",{"region-active":u.value==="logo"}]),onClick:Y[0]||(Y[0]=it(he=>Ke("logo"),["stop"])),title:"Edit logo"},[...Y[33]||(Y[33]=[r("span",null,"",-1)])],2)):P("",!0),X.value&&te.value==="left"?(v(),m("div",{key:2,class:pe(["mockup-logo logo-left",{"region-active":u.value==="logo"}]),onClick:Y[1]||(Y[1]=it(he=>Ke("logo"),["stop"]))},[r("img",{src:re.value,alt:"Logo",class:"logo-img"},null,8,JS)],2)):P("",!0),X.value?P("",!0):(v(),m("div",{key:3,class:pe(["logo-add-area logo-add-left",{"region-active":u.value==="logo"}]),onClick:Y[2]||(Y[2]=it(he=>We("left"),["stop"]))},[...Y[34]||(Y[34]=[r("span",{class:"logo-add-text"},"+ Logo",-1)])],2)),r("div",YS,[r("div",{class:"mockup-title",style:Qe({color:Re.value})},[r("span",XS,w(e.eventName||"Event Name"),1)],4),r("div",{class:"mockup-date",style:Qe({color:Re.value})},w(e.eventDate||"Event Date"),5),r("div",QS,[Y[35]||(Y[35]=r("span",{class:"btn-emergency"},"Emergency",-1)),r("span",{class:"btn-logout",style:Qe({color:Re.value})},"Logout",4)])]),X.value&&te.value==="right"?(v(),m("div",{key:4,class:pe(["mockup-logo logo-right",{"region-active":u.value==="logo"}]),onClick:Y[3]||(Y[3]=it(he=>Ke("logo"),["stop"]))},[r("img",{src:re.value,alt:"Logo",class:"logo-img"},null,8,eI)],2)):P("",!0),X.value?P("",!0):(v(),m("div",{key:5,class:pe(["logo-add-area logo-add-right",{"region-active":u.value==="logo"}]),onClick:Y[4]||(Y[4]=it(he=>We("right"),["stop"]))},[...Y[36]||(Y[36]=[r("span",{class:"logo-add-text"},"+ Logo",-1)])],2))],6),r("div",tI,[r("div",nI,[Y[37]||(Y[37]=r("div",{class:"card-header"},"Your checkpoints (2)",-1)),r("div",oI,[r("div",{class:pe(["mockup-checkin-btn",{"region-active":u.value==="accent"}]),style:Qe(Xe.value),onClick:Y[6]||(Y[6]=it(he=>Ke("accent"),["stop"]))}," GPS Check-In ",6)])])])],6)]),ze(r("div",{class:"editor-overlay",onClick:Y[31]||(Y[31]=it(he=>u.value=null,["self"]))},[r("div",{ref_key:"editorModalRef",ref:S,class:"editor-modal"},[r("div",sI,[r("span",null,w(R[u.value]),1),r("button",{type:"button",class:"editor-close",onClick:Y[8]||(Y[8]=he=>u.value=null)},"")]),r("div",aI,[u.value==="header"?(v(),m(Te,{key:0},[Y[46]||(Y[46]=r("p",{class:"editor-description"},"Choose the colour for the header.",-1)),r("div",iI,[r("div",lI,[r("label",null,w(h.value?"Start colour":"Colour"),1),r("div",rI,[(v(!0),m(Te,null,Fe(O(s),he=>(v(),m("button",{key:"hs-"+he.hex,type:"button",class:pe(["color-swatch-btn",{selected:e.branding.headerGradientStart===he.hex}]),style:Qe({backgroundColor:he.hex}),title:he.name,onClick:xe=>ge("start",he.hex)},[e.branding.headerGradientStart===he.hex?(v(),m("span",uI,"")):P("",!0)],14,cI))),128)),r("div",dI,[r("button",{type:"button",class:pe(["color-swatch-btn custom-color-btn",{selected:D(e.branding.headerGradientStart)}]),style:Qe({backgroundColor:Z(e.branding.headerGradientStart)}),title:"Custom colour",onClick:Y[9]||(Y[9]=he=>N("headerStart",he))},[(v(),m("svg",{class:"custom-icon",style:Qe({color:E(e.branding.headerGradientStart)}),viewBox:"0 0 24 24",fill:"currentColor"},[...Y[38]||(Y[38]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])],4))],6),I.value==="headerStart"?(v(),m("div",{key:0,class:"custom-hex-popup",style:Qe(_.value)},[r("div",hI,[Y[39]||(Y[39]=r("span",null,"Custom colour",-1)),r("button",{type:"button",class:"hex-popup-close",onClick:Y[10]||(Y[10]=he=>I.value=null)},"")]),r("div",fI,[Y[40]||(Y[40]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"hexInputRef",ref:x,"onUpdate:modelValue":Y[11]||(Y[11]=he=>M.value=he),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:M.value&&!A.value}]),onInput:B,onKeydown:Yo(j,["enter"])},null,34),[[nt,M.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:A.value?"#"+M.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!A.value,onClick:j}," Apply ",8,pI)]),M.value&&!A.value?(v(),m("span",vI,"Invalid hex code")):P("",!0)],4)):P("",!0)])]),r("label",mI,[ze(r("input",{type:"checkbox","onUpdate:modelValue":Y[12]||(Y[12]=he=>h.value=he),onChange:ve},null,544),[[Ws,h.value]]),Y[41]||(Y[41]=r("span",null,"Use gradient",-1))])]),h.value?(v(),m("div",gI,[Y[45]||(Y[45]=r("label",null,"End colour",-1)),r("div",yI,[(v(!0),m(Te,null,Fe(O(s),he=>(v(),m("button",{key:"he-"+he.hex,type:"button",class:pe(["color-swatch-btn",{selected:e.branding.headerGradientEnd===he.hex}]),style:Qe({backgroundColor:he.hex}),title:he.name,onClick:xe=>Q("headerGradientEnd",he.hex)},[e.branding.headerGradientEnd===he.hex?(v(),m("span",bI,"")):P("",!0)],14,kI))),128)),r("div",_I,[r("button",{type:"button",class:pe(["color-swatch-btn custom-color-btn",{selected:D(e.branding.headerGradientEnd)}]),style:Qe({backgroundColor:Z(e.branding.headerGradientEnd)}),title:"Custom colour",onClick:Y[13]||(Y[13]=he=>N("headerEnd",he))},[(v(),m("svg",{class:"custom-icon",style:Qe({color:E(e.branding.headerGradientEnd)}),viewBox:"0 0 24 24",fill:"currentColor"},[...Y[42]||(Y[42]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])],4))],6),I.value==="headerEnd"?(v(),m("div",{key:0,class:"custom-hex-popup",style:Qe(_.value)},[r("div",wI,[Y[43]||(Y[43]=r("span",null,"Custom colour",-1)),r("button",{type:"button",class:"hex-popup-close",onClick:Y[14]||(Y[14]=he=>I.value=null)},"")]),r("div",CI,[Y[44]||(Y[44]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"hexInputRef",ref:x,"onUpdate:modelValue":Y[15]||(Y[15]=he=>M.value=he),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:M.value&&!A.value}]),onInput:B,onKeydown:Yo(j,["enter"])},null,34),[[nt,M.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:A.value?"#"+M.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!A.value,onClick:j}," Apply ",8,LI)]),M.value&&!A.value?(v(),m("span",SI,"Invalid hex code")):P("",!0)],4)):P("",!0)])])])):P("",!0)])],64)):P("",!0),u.value==="logo"?(v(),m("div",II,[Y[47]||(Y[47]=r("label",{class:"editor-label"},"Position",-1)),r("div",xI,[r("button",{type:"button",class:pe(["position-btn",{selected:te.value==="left"}]),onClick:Y[16]||(Y[16]=he=>Q("logoPosition","left"))}," Left ",2),r("button",{type:"button",class:pe(["position-btn",{selected:te.value==="cover"}]),onClick:Y[17]||(Y[17]=he=>Q("logoPosition","cover"))}," Cover ",2),r("button",{type:"button",class:pe(["position-btn",{selected:te.value==="right"}]),onClick:Y[18]||(Y[18]=he=>Q("logoPosition","right"))}," Right ",2)])])):P("",!0),ze(Me(FS,{ref_key:"logoUploaderRef",ref:g,"model-value":e.branding.logoUrl,"event-id":e.eventId,"admin-email":e.adminEmail,staged:"","onUpdate:modelValue":Y[19]||(Y[19]=he=>Q("logoUrl",he)),onStagedChange:C},null,8,["model-value","event-id","admin-email"]),[[ws,u.value==="logo"]]),u.value==="accent"?(v(),m(Te,{key:2},[Y[51]||(Y[51]=r("p",{class:"editor-description"},"Choose the accent colour for buttons.",-1)),r("div",$I,[(v(!0),m(Te,null,Fe(O(s),he=>(v(),m("button",{key:"ac-"+he.hex,type:"button",class:pe(["color-swatch-btn",{selected:e.branding.accentColor===he.hex}]),style:Qe({backgroundColor:he.hex}),title:he.name,onClick:xe=>Q("accentColor",he.hex)},[e.branding.accentColor===he.hex?(v(),m("span",MI,"")):P("",!0)],14,TI))),128)),r("div",AI,[r("button",{type:"button",class:pe(["color-swatch-btn custom-color-btn",{selected:D(e.branding.accentColor)}]),style:Qe({backgroundColor:Z(e.branding.accentColor)}),title:"Custom colour",onClick:Y[20]||(Y[20]=he=>N("accent",he))},[(v(),m("svg",{class:"custom-icon",style:Qe({color:E(e.branding.accentColor)}),viewBox:"0 0 24 24",fill:"currentColor"},[...Y[48]||(Y[48]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])],4))],6),I.value==="accent"?(v(),m("div",{key:0,class:"custom-hex-popup",style:Qe(_.value)},[r("div",EI,[Y[49]||(Y[49]=r("span",null,"Custom colour",-1)),r("button",{type:"button",class:"hex-popup-close",onClick:Y[21]||(Y[21]=he=>I.value=null)},"")]),r("div",PI,[Y[50]||(Y[50]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"hexInputRef",ref:x,"onUpdate:modelValue":Y[22]||(Y[22]=he=>M.value=he),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:M.value&&!A.value}]),onInput:B,onKeydown:Yo(j,["enter"])},null,34),[[nt,M.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:A.value?"#"+M.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!A.value,onClick:j}," Apply ",8,DI)]),M.value&&!A.value?(v(),m("span",OI,"Invalid hex code")):P("",!0)],4)):P("",!0)])])],64)):P("",!0),u.value==="page"?(v(),m(Te,{key:3},[Y[60]||(Y[60]=r("p",{class:"editor-description"},"Choose the colour for the page background.",-1)),r("div",RI,[r("div",BI,[r("label",null,w(p.value?"Start colour":"Colour"),1),r("div",NI,[(v(!0),m(Te,null,Fe(O(s),he=>(v(),m("button",{key:"ps-"+he.hex,type:"button",class:pe(["color-swatch-btn",{selected:e.branding.pageGradientStart===he.hex}]),style:Qe({backgroundColor:he.hex}),title:he.name,onClick:xe=>Ce("start",he.hex)},[e.branding.pageGradientStart===he.hex?(v(),m("span",UI,"")):P("",!0)],14,FI))),128)),r("div",zI,[r("button",{type:"button",class:pe(["color-swatch-btn custom-color-btn",{selected:D(e.branding.pageGradientStart)}]),style:Qe({backgroundColor:Z(e.branding.pageGradientStart)}),title:"Custom colour",onClick:Y[23]||(Y[23]=he=>N("pageStart",he))},[(v(),m("svg",{class:"custom-icon",style:Qe({color:E(e.branding.pageGradientStart)}),viewBox:"0 0 24 24",fill:"currentColor"},[...Y[52]||(Y[52]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])],4))],6),I.value==="pageStart"?(v(),m("div",{key:0,class:"custom-hex-popup",style:Qe(_.value)},[r("div",HI,[Y[53]||(Y[53]=r("span",null,"Custom colour",-1)),r("button",{type:"button",class:"hex-popup-close",onClick:Y[24]||(Y[24]=he=>I.value=null)},"")]),r("div",VI,[Y[54]||(Y[54]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"hexInputRef",ref:x,"onUpdate:modelValue":Y[25]||(Y[25]=he=>M.value=he),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:M.value&&!A.value}]),onInput:B,onKeydown:Yo(j,["enter"])},null,34),[[nt,M.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:A.value?"#"+M.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!A.value,onClick:j}," Apply ",8,GI)]),M.value&&!A.value?(v(),m("span",jI,"Invalid hex code")):P("",!0)],4)):P("",!0)])]),r("label",ZI,[ze(r("input",{type:"checkbox","onUpdate:modelValue":Y[26]||(Y[26]=he=>p.value=he),onChange:ue},null,544),[[Ws,p.value]]),Y[55]||(Y[55]=r("span",null,"Use gradient",-1))])]),p.value?(v(),m("div",qI,[Y[59]||(Y[59]=r("label",null,"End colour",-1)),r("div",WI,[(v(!0),m(Te,null,Fe(O(s),he=>(v(),m("button",{key:"pe-"+he.hex,type:"button",class:pe(["color-swatch-btn",{selected:e.branding.pageGradientEnd===he.hex}]),style:Qe({backgroundColor:he.hex}),title:he.name,onClick:xe=>Q("pageGradientEnd",he.hex)},[e.branding.pageGradientEnd===he.hex?(v(),m("span",JI,"")):P("",!0)],14,KI))),128)),r("div",YI,[r("button",{type:"button",class:pe(["color-swatch-btn custom-color-btn",{selected:D(e.branding.pageGradientEnd)}]),style:Qe({backgroundColor:Z(e.branding.pageGradientEnd)}),title:"Custom colour",onClick:Y[27]||(Y[27]=he=>N("pageEnd",he))},[(v(),m("svg",{class:"custom-icon",style:Qe({color:E(e.branding.pageGradientEnd)}),viewBox:"0 0 24 24",fill:"currentColor"},[...Y[56]||(Y[56]=[r("path",{d:"M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"},null,-1)])],4))],6),I.value==="pageEnd"?(v(),m("div",{key:0,class:"custom-hex-popup",style:Qe(_.value)},[r("div",XI,[Y[57]||(Y[57]=r("span",null,"Custom colour",-1)),r("button",{type:"button",class:"hex-popup-close",onClick:Y[28]||(Y[28]=he=>I.value=null)},"")]),r("div",QI,[Y[58]||(Y[58]=r("span",{class:"hex-prefix"},"#",-1)),ze(r("input",{ref_key:"hexInputRef",ref:x,"onUpdate:modelValue":Y[29]||(Y[29]=he=>M.value=he),type:"text",maxlength:"6",placeholder:"000000",class:pe(["hex-input",{invalid:M.value&&!A.value}]),onInput:B,onKeydown:Yo(j,["enter"])},null,34),[[nt,M.value]]),r("div",{class:"hex-preview",style:Qe({backgroundColor:A.value?"#"+M.value:"#ccc"})},null,4),r("button",{type:"button",class:"hex-apply-btn",disabled:!A.value,onClick:j}," Apply ",8,ex)]),M.value&&!A.value?(v(),m("span",tx,"Invalid hex code")):P("",!0)],4)):P("",!0)])])])):P("",!0)])],64)):P("",!0)]),r("div",nx,[r("button",{type:"button",class:"btn-done",onClick:Y[30]||(Y[30]=he=>u.value=null)},"Done")])],512)],512),[[ws,u.value]]),Y[61]||(Y[61]=r("p",{class:"instructions"}," Click on different parts of the preview to customise them. The emergency button stays red for safety. ",-1))]))}},sx=Ge(ox,[["__scopeId","data-v-01af4f2d"]]),ax={class:"settings-tab"},ix={class:"accordion"},lx={class:"accordion-section"},rx={class:"accordion-title"},cx={class:"accordion-icon"},ux={key:0,class:"accordion-content"},dx={class:"accordion-section"},hx={class:"accordion-icon"},fx={key:0,class:"accordion-content"},px={class:"terminology-grid"},vx={class:"term-group"},mx=["value"],gx={class:"term-group"},yx=["value"],kx={class:"term-group"},bx=["value"],_x={class:"term-group"},wx=["value"],Cx={class:"term-group"},Lx=["value"],Sx={class:"form-actions"},Ix=["disabled"],xx={class:"accordion-section"},$x={class:"accordion-title"},Tx={class:"accordion-icon"},Mx={key:0,class:"accordion-content"},Ax={class:"section-description"},Ex={class:"form-actions"},Px=["disabled"],Dx={class:"accordion-section"},Ox={class:"accordion-title"},Rx={class:"accordion-icon"},Bx={key:0,class:"accordion-content"},Nx={class:"section-description"},Fx={class:"form-actions"},Ux=["disabled"],zx=["disabled"],yf="admin_settings_accordion",Hx={__name:"SettingsTab",props:{eventData:{type:Object,required:!0},admins:{type:Array,default:()=>[]},formDirty:{type:Boolean,default:!1},eventId:{type:String,default:""}},emits:["submit","add-admin","remove-admin","update:formDirty"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=Xl(),i=z(()=>s.adminEmail||""),l=e,u=t,d=T({...l.eventData}),h=T(null),p=T(!1),g=()=>l.eventId?`${yf}_${l.eventId}`:yf,y=T(null);tn(()=>{const A=localStorage.getItem(g());A&&(y.value=A)});const b=z(()=>{const A=d.value.peopleTerm||"Marshals";return zs.checkpoint.map(N=>({value:N,label:Au(N,A)}))}),C=A=>{const N=y.value===A?null:A;y.value=N,N?localStorage.setItem(g(),N):localStorage.removeItem(g())};qe(()=>l.eventData,A=>{d.value={...A},S.value=!1},{deep:!0});const I=()=>{u("update:formDirty",!0)},M=(A,N)=>{d.value[A]=N,I()},x=z(()=>({headerGradientStart:d.value.brandingHeaderGradientStart||"",headerGradientEnd:d.value.brandingHeaderGradientEnd||"",logoUrl:d.value.brandingLogoUrl||"",logoPosition:d.value.brandingLogoPosition||"",accentColor:d.value.brandingAccentColor||"",pageGradientStart:d.value.brandingPageGradientStart||"",pageGradientEnd:d.value.brandingPageGradientEnd||""})),S=T(!1),_=A=>{S.value=A},D=A=>{d.value.brandingHeaderGradientStart=A.headerGradientStart,d.value.brandingHeaderGradientEnd=A.headerGradientEnd,d.value.brandingLogoUrl=A.logoUrl,d.value.brandingLogoPosition=A.logoPosition,d.value.brandingAccentColor=A.accentColor,d.value.brandingPageGradientStart=A.pageGradientStart,d.value.brandingPageGradientEnd=A.pageGradientEnd,I()},E=()=>{US(),d.value.brandingHeaderGradientStart="",d.value.brandingHeaderGradientEnd="",d.value.brandingLogoUrl="",d.value.brandingLogoPosition="",d.value.brandingAccentColor="",d.value.brandingPageGradientStart="",d.value.brandingPageGradientEnd="",S.value=!1,h.value?.resetLogo(),I()},Z=async()=>{if(!p.value){p.value=!0;try{if(S.value&&h.value){if(h.value.isLogoPendingDelete()){const N=await h.value.deleteStagedLogo();if(!N.success){console.error("Failed to delete logo:",N.error);return}d.value.brandingLogoUrl=""}else{const N=await h.value.uploadStagedLogo();if(!N.success){console.error("Failed to upload logo:",N.error);return}N.logoUrl&&!N.logoUrl.startsWith("blob:")&&(d.value.brandingLogoUrl=N.logoUrl)}S.value=!1}u("submit",{...d.value})}finally{p.value=!1}}};return(A,N)=>(v(),m("div",ax,[r("div",ix,[r("div",lx,[r("button",{class:pe(["accordion-header",{active:y.value==="admins"}]),onClick:N[0]||(N[0]=B=>C("admins"))},[r("span",rx,"Administrators ("+w(e.admins.length)+")",1),r("span",cx,w(y.value==="admins"?"-":"+"),1)],2),y.value==="admins"?(v(),m("div",ux,[Me(Z2,{admins:e.admins,onAddAdmin:N[1]||(N[1]=B=>A.$emit("add-admin")),onRemoveAdmin:N[2]||(N[2]=B=>A.$emit("remove-admin",B))},null,8,["admins"])])):P("",!0)]),r("div",dx,[r("button",{class:pe(["accordion-header",{active:y.value==="terminology"}]),onClick:N[3]||(N[3]=B=>C("terminology"))},[N[19]||(N[19]=r("span",{class:"accordion-title"},"Terminology",-1)),r("span",hx,w(y.value==="terminology"?"-":"+"),1)],2),y.value==="terminology"?(v(),m("div",fx,[N[20]||(N[20]=r("p",{class:"section-description"}," Customise how things are named throughout the application. ",-1)),r("div",px,[r("div",vx,[r("label",null,w(O(n).people)+" are called",1),ze(r("select",{"onUpdate:modelValue":N[4]||(N[4]=B=>d.value.peopleTerm=B),class:"form-input",onChange:I},[(v(!0),m(Te,null,Fe(O(zs).people,B=>(v(),m("option",{key:B,value:B},w(B),9,mx))),128))],544),[[Fn,d.value.peopleTerm]])]),r("div",gx,[r("label",null,w(O(n).checkpoints)+" are called",1),ze(r("select",{"onUpdate:modelValue":N[5]||(N[5]=B=>d.value.checkpointTerm=B),class:"form-input",onChange:I},[(v(!0),m(Te,null,Fe(b.value,B=>(v(),m("option",{key:B.value,value:B.value},w(B.label),9,yx))),128))],544),[[Fn,d.value.checkpointTerm]])]),r("div",kx,[r("label",null,w(O(n).areas)+" are called",1),ze(r("select",{"onUpdate:modelValue":N[6]||(N[6]=B=>d.value.areaTerm=B),class:"form-input",onChange:I},[(v(!0),m(Te,null,Fe(O(zs).area,B=>(v(),m("option",{key:B,value:B},w(B),9,bx))),128))],544),[[Fn,d.value.areaTerm]])]),r("div",_x,[r("label",null,w(O(n).checklists)+" are called",1),ze(r("select",{"onUpdate:modelValue":N[7]||(N[7]=B=>d.value.checklistTerm=B),class:"form-input",onChange:I},[(v(!0),m(Te,null,Fe(O(zs).checklist,B=>(v(),m("option",{key:B,value:B},w(B),9,wx))),128))],544),[[Fn,d.value.checklistTerm]])]),r("div",Cx,[r("label",null,w(O(n).course)+" is called",1),ze(r("select",{"onUpdate:modelValue":N[8]||(N[8]=B=>d.value.courseTerm=B),class:"form-input",onChange:I},[(v(!0),m(Te,null,Fe(O(zs).course,B=>(v(),m("option",{key:B,value:B},w(B),9,Lx))),128))],544),[[Fn,d.value.courseTerm]])])]),r("div",Sx,[r("button",{onClick:Z,class:"btn btn-primary",disabled:!e.formDirty}," Save ",8,Ix)])])):P("",!0)]),r("div",xx,[r("button",{class:pe(["accordion-header",{active:y.value==="appearance"}]),onClick:N[9]||(N[9]=B=>C("appearance"))},[r("span",$x,w(O(n).checkpoint)+" appearance",1),r("span",Tx,w(y.value==="appearance"?"-":"+"),1)],2),y.value==="appearance"?(v(),m("div",Mx,[r("p",Ax," Set the default marker style for all "+w(O(a).checkpoints)+" in this event. Individual "+w(O(a).areas)+" and "+w(O(a).checkpoints)+" can override this setting. ",1),Me(pd,{"style-type":d.value.defaultCheckpointStyleType||"default","style-color":d.value.defaultCheckpointStyleColor||"","style-background-shape":d.value.defaultCheckpointStyleBackgroundShape||"","style-background-color":d.value.defaultCheckpointStyleBackgroundColor||"","style-border-color":d.value.defaultCheckpointStyleBorderColor||"","style-icon-color":d.value.defaultCheckpointStyleIconColor||"","style-size":d.value.defaultCheckpointStyleSize||"","style-map-rotation":d.value.defaultCheckpointStyleMapRotation??"","icon-label":"Default marker style",level:"event","show-preview":!0,"onUpdate:styleType":N[10]||(N[10]=B=>M("defaultCheckpointStyleType",B)),"onUpdate:styleColor":N[11]||(N[11]=B=>M("defaultCheckpointStyleColor",B)),"onUpdate:styleBackgroundShape":N[12]||(N[12]=B=>M("defaultCheckpointStyleBackgroundShape",B)),"onUpdate:styleBackgroundColor":N[13]||(N[13]=B=>M("defaultCheckpointStyleBackgroundColor",B)),"onUpdate:styleBorderColor":N[14]||(N[14]=B=>M("defaultCheckpointStyleBorderColor",B)),"onUpdate:styleIconColor":N[15]||(N[15]=B=>M("defaultCheckpointStyleIconColor",B)),"onUpdate:styleSize":N[16]||(N[16]=B=>M("defaultCheckpointStyleSize",B)),"onUpdate:styleMapRotation":N[17]||(N[17]=B=>M("defaultCheckpointStyleMapRotation",B))},null,8,["style-type","style-color","style-background-shape","style-background-color","style-border-color","style-icon-color","style-size","style-map-rotation"]),r("div",Ex,[r("button",{onClick:Z,class:"btn btn-primary",disabled:!e.formDirty}," Save ",8,Px)])])):P("",!0)]),r("div",Dx,[r("button",{class:pe(["accordion-header",{active:y.value==="branding"}]),onClick:N[18]||(N[18]=B=>C("branding"))},[r("span",Ox,w(O(n).person)+" branding",1),r("span",Rx,w(y.value==="branding"?"-":"+"),1)],2),y.value==="branding"?(v(),m("div",Bx,[r("p",Nx," Customise the appearance of the "+w(O(a).person)+" view to match your organisation's branding. ",1),Me(sx,{ref_key:"brandingMockupRef",ref:h,branding:x.value,"event-name":d.value.name,"event-date":O(em)(d.value.eventDate),"event-id":e.eventId,"admin-email":i.value,"onUpdate:branding":D,onLogoStagedChange:_},null,8,["branding","event-name","event-date","event-id","admin-email"]),r("div",Fx,[r("button",{onClick:E,class:"btn btn-secondary",disabled:p.value}," Reset to default ",8,Ux),r("button",{onClick:Z,class:"btn btn-primary",disabled:!e.formDirty&&!S.value||p.value},w(p.value?"Saving...":"Save"),9,zx)])])):P("",!0)])])]))}},Vx=Ge(Hx,[["__scopeId","data-v-bb7e241a"]]),Gx={class:"incident-header"},jx={class:"incident-title-row"},Zx={class:"incident-title"},qx={class:"incident-badges"},Wx={key:0,class:"incident-description"},Kx={class:"incident-context"},Jx={key:0,class:"context-item"},Yx={key:1,class:"context-item"},Xx={key:2,class:"context-item"},Qx={class:"incident-footer"},e$={class:"reporter-info"},t$={class:"time-info"},n$={__name:"IncidentCard",props:{incident:{type:Object,required:!0}},emits:["select"],setup(e){const t=e,n=z(()=>{if(t.incident.title)return t.incident.title;const u=t.incident.description||"";return u.length<=60?u:u.substring(0,57).trim()+"..."}),a=u=>({low:"Low",medium:"Medium",high:"High",critical:"Critical"})[u]||u,s=u=>({open:"Open",acknowledged:"Acknowledged",in_progress:"In Progress",resolved:"Resolved",closed:"Closed"})[u]||u,i=(u,d=120)=>!u||u.length<=d?u:u.substring(0,d).trim()+"...",l=u=>{if(!u)return"";const d=new Date(u),p=new Date-d,g=Math.floor(p/6e4),y=Math.floor(p/36e5),b=Math.floor(p/864e5);return g<1?"just now":g<60?`${g}m ago`:y<24?`${y}h ago`:b<7?`${b}d ago`:d.toLocaleDateString()};return(u,d)=>(v(),m("div",{class:pe(["incident-card",[`severity-${e.incident.severity}`,`status-${e.incident.status}`]]),onClick:d[0]||(d[0]=h=>u.$emit("select",e.incident))},[r("div",Gx,[r("div",jx,[r("span",{class:pe(["severity-indicator",e.incident.severity])},null,2),r("strong",Zx,w(n.value),1)]),r("div",qx,[r("span",{class:pe(["severity-badge",e.incident.severity])},w(a(e.incident.severity)),3),r("span",{class:pe(["status-badge",e.incident.status])},w(s(e.incident.status)),3)])]),e.incident.title&&e.incident.description?(v(),m("div",Wx,w(i(e.incident.description)),1)):P("",!0),r("div",Kx,[e.incident.context?.checkpoint?(v(),m("div",Jx,[d[1]||(d[1]=r("span",{class:"context-icon"},"",-1)),r("span",null,w(e.incident.context.checkpoint.name),1)])):e.incident.latitude&&e.incident.longitude?(v(),m("div",Yx,[...d[2]||(d[2]=[r("span",{class:"context-icon"},"",-1),r("span",null,"GPS Location",-1)])])):P("",!0),e.incident.area?(v(),m("div",Xx,[d[3]||(d[3]=r("span",{class:"context-icon"},"",-1)),r("span",null,w(e.incident.area.areaName),1)])):P("",!0)]),r("div",Qx,[r("span",e$," Reported by "+w(e.incident.reportedBy?.name||"Unknown"),1),r("span",t$,w(l(e.incident.incidentTime||e.incident.createdAt)),1)])],2))}},tr=Ge(n$,[["__scopeId","data-v-690fd385"]]),o$={class:"incidents-tab"},s$={class:"tab-header"},a$={class:"button-group"},i$={key:0,class:"status-pills"},l$={class:"filters-section"},r$={class:"search-group"},c$={class:"incidents-list"},u$={key:0,class:"loading-state"},d$={key:1,class:"empty-state"},h$={__name:"IncidentsTab",props:{incidents:{type:Array,required:!0},areas:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["select-incident","report-incident"],setup(e,{emit:t}){const n=e,a=T(""),s=T("all"),i=y=>{s.value=y},l=z(()=>n.incidents.filter(y=>y.status==="open").length),u=z(()=>n.incidents.filter(y=>y.status==="in_progress"||y.status==="acknowledged").length),d=z(()=>n.incidents.filter(y=>y.status==="resolved").length),h=z(()=>n.incidents.filter(y=>y.status==="closed").length),p=z(()=>{let y=n.incidents;if(s.value==="open"?y=y.filter(b=>b.status==="open"):s.value==="in-progress"?y=y.filter(b=>b.status==="in_progress"||b.status==="acknowledged"):s.value==="resolved"?y=y.filter(b=>b.status==="resolved"):s.value==="closed"&&(y=y.filter(b=>b.status==="closed")),a.value.trim()){const b=a.value.toLowerCase().trim().split(/\s+/);y=y.filter(C=>{const I=`${C.context?.checkpoint?.name||""} ${C.context?.checkpoint?.description||""}`,M=C.area?.areaName||"",x=[C.reportedBy?.name||"",...(C.context?.peopleAtCheckpoint||[]).map(D=>D.name||"")].join(" "),S=(C.updates||[]).map(D=>D.note||"").join(" "),_=`${C.title||""} ${C.description||""} ${I} ${M} ${x} ${S}`.toLowerCase();return b.every(D=>_.includes(D))})}return y}),g=z(()=>[...p.value].sort((y,b)=>new Date(b.incidentTime||b.createdAt)-new Date(y.incidentTime||y.createdAt)));return(y,b)=>(v(),m("div",o$,[r("div",s$,[r("div",a$,[r("button",{onClick:b[0]||(b[0]=C=>y.$emit("report-incident")),class:"btn btn-primary"}," Report incident ")]),e.incidents.length>0?(v(),m("div",i$,[Me(un,{variant:"neutral",active:s.value==="all",onClick:b[1]||(b[1]=C=>i("all"))},{default:He(()=>[Ye(w(e.incidents.length)+" total ",1)]),_:1},8,["active"]),l.value>0&&l.value<e.incidents.length?(v(),Ze(un,{key:0,variant:"info",active:s.value==="open",onClick:b[2]||(b[2]=C=>i("open"))},{default:He(()=>[Ye(w(l.value)+" open ",1)]),_:1},8,["active"])):P("",!0),u.value>0&&u.value<e.incidents.length?(v(),Ze(un,{key:1,variant:"purple",active:s.value==="in-progress",onClick:b[3]||(b[3]=C=>i("in-progress"))},{default:He(()=>[Ye(w(u.value)+" in progress ",1)]),_:1},8,["active"])):P("",!0),d.value>0&&d.value<e.incidents.length?(v(),Ze(un,{key:2,variant:"success",active:s.value==="resolved",onClick:b[4]||(b[4]=C=>i("resolved"))},{default:He(()=>[Ye(w(d.value)+" resolved ",1)]),_:1},8,["active"])):P("",!0),h.value>0&&h.value<e.incidents.length?(v(),Ze(un,{key:3,variant:"neutral",active:s.value==="closed",onClick:b[5]||(b[5]=C=>i("closed"))},{default:He(()=>[Ye(w(h.value)+" closed ",1)]),_:1},8,["active"])):P("",!0)])):P("",!0)]),r("div",l$,[r("div",r$,[ze(r("input",{"onUpdate:modelValue":b[6]||(b[6]=C=>a.value=C),type:"text",class:"search-input",placeholder:"Search by title, description, location, area, or person..."},null,512),[[nt,a.value]])])]),r("div",c$,[e.loading?(v(),m("div",u$," Loading incidents... ")):p.value.length===0?(v(),m("div",d$,[r("p",null,w(a.value||s.value!=="all"?"No incidents match your search or filter.":"No incidents reported yet."),1)])):P("",!0),(v(!0),m(Te,null,Fe(g.value,C=>(v(),Ze(tr,{key:C.incidentId,incident:C,onSelect:I=>y.$emit("select-incident",C)},null,8,["incident","onSelect"]))),128))])]))}},f$=Ge(h$,[["__scopeId","data-v-f24c84f4"]]),p$={class:"checkpoint-card-header"},v$={class:"checkpoint-name-row"},m$=["innerHTML"],g$={class:"checkpoint-name"},y$={key:0,class:"checkpoint-description"},k$={key:0,class:"checkpoint-card-areas"},b$={class:"checkpoint-card-stats"},_$={key:1,class:"checkpoint-card-marshals"},w$={__name:"CheckpointCard",props:{checkpoint:{type:Object,required:!0},areas:{type:Array,default:()=>[]},clickable:{type:Boolean,default:!0}},emits:["click"],setup(e,{emit:t}){const n=e,a=t,s=z(()=>n.checkpoint.areaIds||n.checkpoint.AreaIds||[]),i=M=>{const x=n.areas.find(S=>S.id===M);return x?x.name:null},l=M=>{const x=n.areas.find(S=>S.id===M);return x?x.color:"#999"},u=z(()=>{const M=n.checkpoint,x=M.resolvedStyleBackgroundColor||M.ResolvedStyleBackgroundColor||M.resolvedStyleColor||M.ResolvedStyleColor;return x||(s.value.length>0?l(s.value[0]):"#667eea")}),d=z(()=>{const M=n.checkpoint,x=(M.assignments||[]).length;return M.requiredMarshals===0?null:x>=M.requiredMarshals?"full":x>0?"partial":"none"}),h=z(()=>[...n.checkpoint.assignments||[]].sort((x,S)=>(x.marshalName||"").localeCompare(S.marshalName||"",void 0,{sensitivity:"base"}))),p=z(()=>(n.checkpoint.assignments||[]).length),g=z(()=>(n.checkpoint.assignments||[]).filter(M=>M.isCheckedIn).length),y=z(()=>d.value?`staffing-${d.value}`:""),b=z(()=>{const M=p.value,x=g.value;return M===0?"":x===0?"checkin-none":x>=M?"checkin-full":"checkin-partial"}),C=z(()=>{const M=n.checkpoint,x=M.resolvedStyleType||M.ResolvedStyleType,S=M.resolvedStyleBackgroundColor||M.ResolvedStyleBackgroundColor||M.resolvedStyleColor||M.ResolvedStyleColor,_=M.resolvedStyleBorderColor||M.ResolvedStyleBorderColor,D=M.resolvedStyleIconColor||M.ResolvedStyleIconColor,E=M.resolvedStyleBackgroundShape||M.ResolvedStyleBackgroundShape;return x&&x!=="default"||S||_||D||E&&E!=="circle"?In({type:x||"circle",backgroundShape:E||"circle",backgroundColor:S||"#667eea",borderColor:_||"#ffffff",iconColor:D||"#ffffff",size:"75",outputSize:24}):`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <circle cx="12" cy="12" r="10" fill="#667eea" stroke="#fff" stroke-width="2"/>
  </svg>`}),I=()=>{n.clickable&&a("click",n.checkpoint)};return(M,x)=>(v(),m("div",{class:pe(["checkpoint-card",{"is-clickable":e.clickable,"staffed-full":d.value==="full","staffed-partial":d.value==="partial","staffed-none":d.value==="none"}]),style:Qe({borderLeftColor:u.value}),onClick:I},[r("div",p$,[r("div",{class:pe(["checkpoint-card-title",{clickable:e.clickable}])},[r("span",v$,[r("span",{class:"checkpoint-icon",innerHTML:C.value},null,8,m$),r("span",g$,w(e.checkpoint.name),1),e.checkpoint.description?(v(),m("span",y$,"  "+w(e.checkpoint.description),1)):P("",!0)])],2)]),s.value.length>0?(v(),m("div",k$,[(v(!0),m(Te,null,Fe(s.value,S=>(v(),m("span",{key:S,class:"area-badge",style:Qe({backgroundColor:l(S)})},w(i(S)),5))),128))])):P("",!0),r("div",b$,[r("span",{class:pe(["stat-badge staffing-badge",y.value])},w(p.value)+"/"+w(e.checkpoint.requiredMarshals)+" staffed ",3),p.value>0?(v(),m("span",{key:0,class:pe(["stat-badge",b.value])},w(g.value)+"/"+w(p.value)+" checked in ",3)):P("",!0)]),h.value.length>0?(v(),m("div",_$,[(v(!0),m(Te,null,Fe(h.value,S=>(v(),m("span",{key:S.id,class:pe(["marshal-badge",{"checked-in":S.isCheckedIn}])},w(S.marshalName),3))),128))])):P("",!0)],6))}},C$=Ge(w$,[["__scopeId","data-v-7ae260df"]]),rm={__name:"CheckpointsGrid",props:{checkpoints:{type:Array,required:!0},areas:{type:Array,default:()=>[]},emptyMessage:{type:String,default:"No checkpoints."},emptyHint:{type:String,default:""}},emits:["select"],setup(e){return(t,n)=>(v(),Ze(er,{"is-empty":e.checkpoints.length===0,"empty-message":e.emptyMessage,"empty-hint":e.emptyHint},{default:He(()=>[(v(!0),m(Te,null,Fe(e.checkpoints,a=>(v(),Ze(C$,{key:a.id,checkpoint:a,areas:e.areas,clickable:!0,onClick:n[0]||(n[0]=s=>t.$emit("select",s))},null,8,["checkpoint","areas"]))),128))]),_:1},8,["is-empty","empty-message","empty-hint"]))}},L$={class:"checkpoints-tab"},S$={class:"tab-header"},I$={class:"button-group"},x$={key:0,class:"status-pills"},$$={class:"filters-section"},T$={class:"search-group"},M$=["placeholder"],A$={__name:"CheckpointsList",props:{locations:{type:Array,required:!0},areas:{type:Array,default:()=>[]}},emits:["add-checkpoint-manually","import-checkpoints","select-location"],setup(e){const{termsLower:t}=rt(),n=e,a=T(""),s=T("all"),i=S=>{s.value=S},l=S=>(S.assignments||[]).length,u=S=>(S.assignments||[]).filter(_=>_.isCheckedIn).length,d=z(()=>n.locations.filter(S=>l(S)>=S.requiredMarshals&&S.requiredMarshals>0).length),h=z(()=>n.locations.filter(S=>l(S)>0&&l(S)<S.requiredMarshals).length),p=z(()=>n.locations.filter(S=>l(S)===0&&S.requiredMarshals>0).length),g=z(()=>n.locations.filter(S=>{const _=l(S),D=u(S);return _>0&&D>=_}).length),y=z(()=>n.locations.filter(S=>{const _=l(S),D=u(S);return _>0&&D>0&&D<_}).length),b=z(()=>n.locations.filter(S=>{const _=l(S),D=u(S);return _>0&&D===0}).length),C=S=>{const _=n.areas.find(D=>D.id===S);return _?_.name:null},I=z(()=>{let S=n.locations;if(s.value==="full"?S=S.filter(_=>l(_)>=_.requiredMarshals&&_.requiredMarshals>0):s.value==="partial"?S=S.filter(_=>l(_)>0&&l(_)<_.requiredMarshals):s.value==="missing"?S=S.filter(_=>l(_)===0&&_.requiredMarshals>0):s.value==="checkin-full"?S=S.filter(_=>{const D=l(_),E=u(_);return D>0&&E>=D}):s.value==="checkin-partial"?S=S.filter(_=>{const D=l(_),E=u(_);return D>0&&E>0&&E<D}):s.value==="checkin-none"&&(S=S.filter(_=>{const D=l(_),E=u(_);return D>0&&E===0})),a.value.trim()){const _=a.value.toLowerCase().trim().split(/\s+/);S=S.filter(D=>{const Z=(D.areaIds||D.AreaIds||[]).map(B=>C(B)||"").join(" "),A=(D.assignments||[]).map(B=>B.marshalName||"").join(" "),N=`${D.name||""} ${D.description||""} ${Z} ${A}`.toLowerCase();return _.every(B=>N.includes(B))})}return S}),M=z(()=>[...I.value].sort((S,_)=>Ks(S.name,_.name))),x=z(()=>{const S=a.value.trim();return s.value==="full"?S?`No fully staffed ${t.value.checkpoints} match your search.`:`No ${t.value.checkpoints} are fully staffed.`:s.value==="partial"?S?`No partially staffed ${t.value.checkpoints} match your search.`:`No ${t.value.checkpoints} are partially staffed.`:s.value==="missing"?S?`No unstaffed ${t.value.checkpoints} match your search.`:`No ${t.value.checkpoints} are unstaffed.`:s.value==="checkin-full"?S?`No fully checked in ${t.value.checkpoints} match your search.`:`No ${t.value.checkpoints} are fully checked in.`:s.value==="checkin-partial"?S?`No partially checked in ${t.value.checkpoints} match your search.`:`No ${t.value.checkpoints} are partially checked in.`:s.value==="checkin-none"?S?`No ${t.value.checkpoints} without check-ins match your search.`:`No ${t.value.checkpoints} are without check-ins.`:S?`No ${t.value.checkpoints} match your search.`:`No ${t.value.checkpoints} yet. Add one to get started!`});return(S,_)=>(v(),m("div",L$,[r("div",S$,[r("div",I$,[r("button",{onClick:_[0]||(_[0]=D=>S.$emit("add-checkpoint-manually")),class:"btn btn-primary"}," Add "+w(O(t).checkpoint),1),r("button",{onClick:_[1]||(_[1]=D=>S.$emit("import-checkpoints")),class:"btn btn-secondary"}," Import CSV ")]),e.locations.length>0?(v(),m("div",x$,[Me(un,{variant:"neutral",active:s.value==="all",onClick:_[2]||(_[2]=D=>i("all"))},{default:He(()=>[Ye(w(e.locations.length)+" total ",1)]),_:1},8,["active"]),d.value>0&&d.value<e.locations.length?(v(),Ze(un,{key:0,variant:"success",active:s.value==="full",onClick:_[3]||(_[3]=D=>i("full"))},{default:He(()=>[Ye(w(d.value)+" fully staffed ",1)]),_:1},8,["active"])):P("",!0),h.value>0&&h.value<e.locations.length?(v(),Ze(un,{key:1,variant:"warning",active:s.value==="partial",onClick:_[4]||(_[4]=D=>i("partial"))},{default:He(()=>[Ye(w(h.value)+" partially staffed ",1)]),_:1},8,["active"])):P("",!0),p.value>0&&p.value<e.locations.length?(v(),Ze(un,{key:2,variant:"danger",active:s.value==="missing",onClick:_[5]||(_[5]=D=>i("missing"))},{default:He(()=>[Ye(w(p.value)+" unstaffed ",1)]),_:1},8,["active"])):P("",!0),g.value>0&&g.value<e.locations.length?(v(),Ze(un,{key:3,variant:"success",active:s.value==="checkin-full",onClick:_[6]||(_[6]=D=>i("checkin-full"))},{default:He(()=>[Ye(w(g.value)+" fully checked in ",1)]),_:1},8,["active"])):P("",!0),y.value>0&&y.value<e.locations.length?(v(),Ze(un,{key:4,variant:"warning",active:s.value==="checkin-partial",onClick:_[7]||(_[7]=D=>i("checkin-partial"))},{default:He(()=>[Ye(w(y.value)+" partially checked in ",1)]),_:1},8,["active"])):P("",!0),b.value>0&&b.value<e.locations.length?(v(),Ze(un,{key:5,variant:"danger",active:s.value==="checkin-none",onClick:_[8]||(_[8]=D=>i("checkin-none"))},{default:He(()=>[Ye(w(b.value)+" not checked in ",1)]),_:1},8,["active"])):P("",!0)])):P("",!0)]),r("div",$$,[r("div",T$,[ze(r("input",{"onUpdate:modelValue":_[9]||(_[9]=D=>a.value=D),type:"text",class:"search-input",placeholder:`Search by name, description, ${O(t).area}, or ${O(t).person}...`},null,8,M$),[[nt,a.value]])])]),Me(rm,{checkpoints:M.value,areas:e.areas,"empty-message":x.value,onSelect:_[10]||(_[10]=D=>S.$emit("select-location",D))},null,8,["checkpoints","areas","empty-message"])]))}},E$=Ge(A$,[["__scopeId","data-v-846aa906"]]),P$={class:"area-card-header"},D$={class:"area-name-row"},O$={class:"area-name"},R$={key:0,class:"default-badge"},B$={key:0,class:"area-description"},N$={class:"area-card-stats"},F$={class:"stat-badge"},U$={class:"stat-badge"},z$={__name:"AreaCard",props:{area:{type:Object,required:!0},checkpoints:{type:Array,default:()=>[]},contacts:{type:Array,default:()=>[]},eventPeopleTerm:{type:String,default:"Marshals"},eventCheckpointTerm:{type:String,default:"Checkpoints"},clickable:{type:Boolean,default:!0}},emits:["click"],setup(e,{emit:t}){const n=e,a=t,s=z(()=>n.area.checkpointCount!==void 0?n.area.checkpointCount:n.checkpoints.filter(p=>(p.areaIds||p.AreaIds||[]).includes(n.area.id)||p.areaId===n.area.id).length),i=z(()=>n.contacts.filter(p=>p.scopeConfigurations?p.scopeConfigurations.some(g=>g.scope==="EveryoneInAreas"&&g.itemType==="Area"?g.ids?.includes("ALL_AREAS")?!0:g.ids?.includes(n.area.id):!1):!1).length),l=z(()=>n.area.peopleTerm||n.eventPeopleTerm||"Marshals"),u=z(()=>{const p=n.area.checkpointTerm||n.eventCheckpointTerm||"Checkpoints";return s.value===1?ti("checkpoint",p,l.value):Yv("checkpoint",p,l.value)}),d=z(()=>`${s.value} ${u.value.toLowerCase()}`),h=()=>{n.clickable&&a("click",n.area)};return(p,g)=>(v(),m("div",{class:pe(["area-card",{"is-clickable":e.clickable,"is-default":e.area.isDefault}]),style:Qe({borderLeftColor:e.area.color||"#667eea"}),onClick:h},[r("div",P$,[r("div",{class:pe(["area-card-title",{clickable:e.clickable}])},[r("div",D$,[r("span",O$,w(e.area.name),1),e.area.isDefault?(v(),m("span",R$,"Default")):P("",!0)]),e.area.description?(v(),m("span",B$,w(e.area.description),1)):P("",!0)],2)]),r("div",N$,[r("span",F$,w(d.value),1),r("span",U$,w(i.value)+" contact"+w(i.value===1?"":"s"),1)])],6))}},H$=Ge(z$,[["__scopeId","data-v-8ac20bf2"]]),V$={__name:"AreasGrid",props:{areas:{type:Array,required:!0},checkpoints:{type:Array,default:()=>[]},contacts:{type:Array,default:()=>[]},eventPeopleTerm:{type:String,default:"Marshals"},eventCheckpointTerm:{type:String,default:"Checkpoints"},emptyMessage:{type:String,default:"No areas."},emptyHint:{type:String,default:""}},emits:["select"],setup(e){return(t,n)=>(v(),Ze(er,{"is-empty":e.areas.length===0,"empty-message":e.emptyMessage,"empty-hint":e.emptyHint},{default:He(()=>[(v(!0),m(Te,null,Fe(e.areas,a=>(v(),Ze(H$,{key:a.id,area:a,checkpoints:e.checkpoints,contacts:e.contacts,"event-people-term":e.eventPeopleTerm,"event-checkpoint-term":e.eventCheckpointTerm,clickable:!0,onClick:n[0]||(n[0]=s=>t.$emit("select",s))},null,8,["area","checkpoints","contacts","event-people-term","event-checkpoint-term"]))),128))]),_:1},8,["is-empty","empty-message","empty-hint"]))}},G$={class:"areas-tab"},j$={class:"tab-header"},Z$={class:"button-group"},q$={key:0,class:"status-pills"},W$={class:"filters-section"},K$={class:"search-group"},J$=["placeholder"],Y$={__name:"AreasList",props:{areas:{type:Array,required:!0},checkpoints:{type:Array,default:()=>[]},contacts:{type:Array,default:()=>[]},eventPeopleTerm:{type:String,default:"Marshals"},eventCheckpointTerm:{type:String,default:"Checkpoints"}},emits:["add-area","select-area"],setup(e){const{termsLower:t}=rt(),n=e,a=T(""),s=d=>n.checkpoints.filter(h=>(h.areaIds||h.AreaIds||[]).includes(d)||h.areaId===d),i=z(()=>{if(!a.value.trim())return n.areas;const d=a.value.toLowerCase().trim().split(/\s+/);return n.areas.filter(h=>{const g=s(h.id).map(b=>`${b.name||""} ${b.description||""}`).join(" "),y=`${h.name||""} ${h.description||""} ${g}`.toLowerCase();return d.every(b=>y.includes(b))})}),l=z(()=>[...i.value].sort((d,h)=>d.displayOrder!==h.displayOrder?d.displayOrder-h.displayOrder:Ks(d.name,h.name))),u=z(()=>a.value.trim()?`No ${t.value.areas} match your search.`:`No ${t.value.areas} yet. Click "Add ${t.value.area}" to create one.`);return(d,h)=>(v(),m("div",G$,[r("div",j$,[r("div",Z$,[r("button",{onClick:h[0]||(h[0]=p=>d.$emit("add-area")),class:"btn btn-primary"}," Add "+w(O(t).area),1)]),e.areas.length>0?(v(),m("div",q$,[Me(un,{variant:"neutral",active:!1},{default:He(()=>[Ye(w(e.areas.length)+" "+w(e.areas.length===1?O(t).area:O(t).areas),1)]),_:1})])):P("",!0)]),r("div",W$,[r("div",K$,[ze(r("input",{"onUpdate:modelValue":h[1]||(h[1]=p=>a.value=p),type:"text",class:"search-input",placeholder:`Search by ${O(t).area} name or ${O(t).checkpoint} name...`},null,8,J$),[[nt,a.value]])])]),Me(V$,{areas:l.value,checkpoints:e.checkpoints,contacts:e.contacts,"event-people-term":e.eventPeopleTerm,"event-checkpoint-term":e.eventCheckpointTerm,"empty-message":u.value,onSelect:h[2]||(h[2]=p=>d.$emit("select-area",p))},null,8,["areas","checkpoints","contacts","event-people-term","event-checkpoint-term","empty-message"])]))}},X$=Ge(Y$,[["__scopeId","data-v-203f9606"]]),Q$={course:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="19" r="3"/><path d="M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"/><circle cx="18" cy="5" r="3"/></svg>',checkpoint:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>',area:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>',marshal:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',checklist:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>',notes:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="8" y1="13" x2="16" y2="13"/><line x1="8" y1="17" x2="16" y2="17"/></svg>',incidents:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',details:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><path d="M9 16h6"/></svg>',location:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></svg>',map:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>',contacts:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>',people:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polygon points="22 8 19.5 10 20.5 13 18 11.5 15.5 13 16.5 10 14 8 17 8 18 5 19 8 22 8" fill="currentColor"/></svg>',eventContacts:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 8V6a2 2 0 0 0-2-2h-2"/><path d="M22 12v2a2 2 0 0 1-2 2h-2"/></svg>',event:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>',appearance:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r="0.5" fill="currentColor"/><circle cx="17.5" cy="10.5" r="0.5" fill="currentColor"/><circle cx="8.5" cy="7.5" r="0.5" fill="currentColor"/><circle cx="6.5" cy="12.5" r="0.5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>',logout:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>'},Xn=e=>Q$[e]||"",eT={class:"responsive-tabs"},tT=["onClick"],nT=["innerHTML"],oT=["innerHTML"],sT={class:"hamburger-label"},aT=["onClick"],iT=["innerHTML"],lT={__name:"ResponsiveTabHeader",props:{tabs:{type:Array,required:!0},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=t,s=T(null),i=T(null),l=T(null),u=T(!1),d=T({}),h=T(!1),p=z(()=>n.tabs.find(x=>x.value===n.modelValue)),g=z(()=>p.value?p.value.label:"Menu"),y=()=>{if(u.value=!u.value,u.value&&i.value){const x=i.value.getBoundingClientRect();d.value={top:`${x.bottom+4}px`}}},b=x=>{a("update:modelValue",x),u.value=!1},C=x=>{if(!s.value)return;const S=s.value.contains(x.target);u.value&&!S&&(u.value=!1)},I=()=>{if(!l.value)return;const x=l.value,S=h.value;S&&(x.style.visibility="visible",x.style.position="static");const _=x.scrollWidth>x.clientWidth;S&&(x.style.visibility="",x.style.position=""),h.value=_};let M=null;return tn(()=>{document.addEventListener("click",C),an(()=>{I()}),an(()=>{const x=l.value?.parentElement;x&&(M=new ResizeObserver(()=>{I()}),M.observe(x))})}),bn(()=>{document.removeEventListener("click",C),M&&M.disconnect()}),qe(()=>n.tabs,()=>{an(()=>{I()})},{deep:!0}),(x,S)=>(v(),m("div",eT,[r("div",{ref_key:"visibleTabsRef",ref:l,class:pe(["visible-tabs",{"is-hidden":h.value}])},[(v(!0),m(Te,null,Fe(e.tabs,_=>(v(),m("button",{key:_.value,class:pe(["tab-button",{active:e.modelValue===_.value}]),onClick:D=>x.$emit("update:modelValue",_.value),type:"button"},[_.icon?(v(),m("span",{key:0,class:"tab-icon",innerHTML:O(Xn)(_.icon)},null,8,nT)):P("",!0),Ye(" "+w(_.label),1)],10,tT))),128))],2),r("div",{class:pe(["hamburger-only",{"is-visible":h.value}])},[r("div",{class:"hamburger-menu",ref_key:"hamburgerMenu",ref:s},[r("button",{ref_key:"hamburgerButton",ref:i,class:pe(["hamburger-button",{active:u.value}]),onClick:it(y,["stop"]),type:"button"},[S[1]||(S[1]=r("span",{class:"hamburger-icon"},"",-1)),p.value?.icon?(v(),m("span",{key:0,class:"tab-icon",innerHTML:O(Xn)(p.value.icon)},null,8,oT)):P("",!0),r("span",sT,w(g.value),1)],2),u.value?(v(),m("div",{key:0,class:"hamburger-dropdown",style:Qe(d.value),onClick:S[0]||(S[0]=it(()=>{},["stop"]))},[(v(!0),m(Te,null,Fe(e.tabs,_=>(v(),m("button",{key:_.value,class:pe(["dropdown-item",{active:e.modelValue===_.value}]),onClick:it(D=>b(_.value),["stop"]),type:"button"},[_.icon?(v(),m("span",{key:0,class:"tab-icon",innerHTML:O(Xn)(_.icon)},null,8,iT)):P("",!0),Ye(" "+w(_.label),1)],10,aT))),128))],4)):P("",!0)],512)],2)]))}},rT=Ge(lT,[["__scopeId","data-v-2467c6fc"]]),cT={class:"instruction"},uT={class:"share-link-container"},dT=["value"],hT={__name:"ShareLinkModal",props:{show:{type:Boolean,default:!1},link:{type:String,required:!0},isDirty:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=t,i=T(!1),l=T(null),u=()=>{l.value&&(l.value.select(),document.execCommand("copy"),i.value=!0,setTimeout(()=>{i.value=!1},2e3))},d=()=>{s("close")};return(h,p)=>(v(),Ze(jt,{show:e.show,title:`${O(n).person} check-in link`,size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:d},{actions:He(()=>[r("button",{onClick:d,class:"btn btn-secondary"},"Close")]),default:He(()=>[r("p",cT,"Share this link with "+w(O(a).peoplePlural)+" so they can check in:",1),r("div",uT,[r("input",{value:e.link,readonly:"",class:"form-input",ref_key:"linkInput",ref:l},null,8,dT),r("button",{onClick:u,class:"btn btn-primary"},w(i.value?"Copied!":"Copy"),1)])]),_:1},8,["show","title","is-dirty"]))}},fT=Ge(hT,[["__scopeId","data-v-b037c39b"]]),pT={class:"success-content"},vT={class:"success-message"},mT={class:"link-section"},gT={class:"help-text"},yT={key:0,class:"loading-text"},kT={key:1,class:"magic-link-container"},bT=["value"],_T={class:"magic-link-actions"},wT=["disabled"],CT={key:0,class:"success-text"},LT={key:1,class:"error-text"},ST={key:2,class:"error-text"},IT={__name:"MarshalCreatedModal",props:{show:{type:Boolean,default:!1},eventId:{type:String,required:!0},marshalId:{type:String,default:null},marshalName:{type:String,default:""}},emits:["close"],setup(e,{emit:t}){const{terms:n}=rt(),a=e,s=t,i=T(""),l=T(!1),u=T(!1),d=T(""),h=T(!1),p=T(!1),g=T(!1),y=T(""),b=async()=>{if(!(!a.eventId||!a.marshalId)){u.value=!0,d.value="";try{const x=await _s.getMagicLink(a.eventId,a.marshalId);i.value=x.data.magicLink,l.value=x.data.hasEmail}catch(x){console.error("Failed to fetch magic link:",x),d.value="Failed to load login link"}finally{u.value=!1}}},C=async()=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(i.value);else{const x=document.createElement("textarea");x.value=i.value,x.style.position="fixed",x.style.left="-9999px",document.body.appendChild(x),x.select(),document.execCommand("copy"),document.body.removeChild(x)}h.value=!0,setTimeout(()=>{h.value=!1},2e3)}catch(x){console.error("Failed to copy:",x)}},I=async()=>{if(!(!a.eventId||!a.marshalId)){p.value=!0,g.value=!1,y.value="";try{await _s.sendMagicLink(a.eventId,a.marshalId),g.value=!0,setTimeout(()=>{g.value=!1},3e3)}catch(x){console.error("Failed to send email:",x),y.value=x.response?.data?.message||"Failed to send email"}finally{p.value=!1}}},M=()=>{s("close")};return qe(()=>a.show,x=>{x&&a.marshalId?b():(i.value="",l.value=!1,d.value="",h.value=!1,g.value=!1,y.value="")},{immediate:!0}),(x,S)=>(v(),Ze(jt,{show:e.show,title:`${O(n).person} created`,size:"medium","confirm-on-close":!1,"is-dirty":!1,onClose:M},{actions:He(()=>[r("button",{onClick:M,class:"btn btn-primary"},"Done")]),default:He(()=>[r("div",pT,[S[2]||(S[2]=r("div",{class:"success-icon"},"",-1)),r("p",vT,[r("strong",null,w(e.marshalName),1),S[1]||(S[1]=Ye(" has been added successfully. ",-1))])]),r("div",mT,[S[3]||(S[3]=r("label",null,"Login link",-1)),r("p",gT," Share this unique link with "+w(e.marshalName)+" so they can access their dashboard and check in. ",1),u.value?(v(),m("div",yT,"Loading link...")):i.value?(v(),m("div",kT,[r("input",{type:"text",value:i.value,readonly:"",class:"form-input magic-link-input",onFocus:S[0]||(S[0]=_=>_.target.select())},null,40,bT),r("div",_T,[r("button",{type:"button",class:"btn btn-secondary",onClick:C},w(h.value?"Copied!":"Copy link"),1),l.value?(v(),m("button",{key:0,type:"button",class:"btn btn-primary",disabled:p.value,onClick:I},w(p.value?"Sending...":"Send via email"),9,wT)):P("",!0)]),g.value?(v(),m("p",CT,"Email sent successfully!")):P("",!0),y.value?(v(),m("p",LT,w(y.value),1)):P("",!0)])):d.value?(v(),m("div",ST,w(d.value),1)):P("",!0)])]),_:1},8,["show","title"]))}},xT=Ge(IT,[["__scopeId","data-v-e99677e9"]]),$T={class:"form-group"},TT={__name:"AddAdminModal",props:{show:{type:Boolean,default:!1},isDirty:{type:Boolean,default:!1}},emits:["close","submit","update:isDirty"],setup(e,{emit:t}){const n=e,a=t,s=T("");qe(()=>n.show,d=>{d||(s.value="")});const i=()=>{a("update:isDirty",!0)},l=()=>{a("submit",s.value)},u=()=>{a("close")};return(d,h)=>(v(),Ze(jt,{show:e.show,title:"Add event administrator",size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:u},{actions:He(()=>[r("button",{type:"button",onClick:u,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:l,class:"btn btn-primary"}," Add administrator ")]),default:He(()=>[h[2]||(h[2]=r("p",{class:"instruction"},"Enter the email address of the administrator to add",-1)),r("form",{onSubmit:it(l,["prevent"])},[r("div",$T,[h[1]||(h[1]=r("label",null,"Email address",-1)),ze(r("input",{"onUpdate:modelValue":h[0]||(h[0]=p=>s.value=p),type:"email",required:"",class:"form-input",placeholder:"admin@example.com",onInput:i},null,544),[[nt,s.value]])])],32)]),_:1},8,["show","is-dirty"]))}},MT=Ge(TT,[["__scopeId","data-v-a82da194"]]),AT={class:"form-group"},ET={key:0,class:"error"},PT=["disabled"],DT={__name:"UploadRouteModal",props:{show:{type:Boolean,default:!1},uploading:{type:Boolean,default:!1},error:{type:String,default:null},isDirty:{type:Boolean,default:!1}},emits:["close","submit","update:isDirty"],setup(e,{emit:t}){const n=e,a=t,s=T(null);qe(()=>n.show,d=>{d||(s.value=null)});const i=d=>{s.value=d.target.files[0],a("update:isDirty",!0)},l=()=>{s.value&&a("submit",s.value)},u=()=>{a("close")};return(d,h)=>(v(),Ze(jt,{show:e.show,title:"Upload GPX route",size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:u},{actions:He(()=>[r("button",{type:"button",onClick:u,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:l,class:"btn btn-primary",disabled:e.uploading},w(e.uploading?"Uploading...":"Upload route"),9,PT)]),default:He(()=>[h[1]||(h[1]=r("p",{class:"instruction"},"Upload a GPX file to display the event route on the map",-1)),r("form",{onSubmit:it(l,["prevent"])},[r("div",AT,[h[0]||(h[0]=r("label",null,"GPX file",-1)),r("input",{type:"file",accept:".gpx",onChange:i,required:"",class:"form-input"},null,32)]),e.error?(v(),m("div",ET,w(e.error),1)):P("",!0)],32)]),_:1},8,["show","is-dirty"]))}},OT=Ge(DT,[["__scopeId","data-v-317975db"]]),RT={class:"instruction"},BT={class:"form-group"},NT={class:"form-group"},FT={class:"checkbox-label"},UT={key:0,class:"error"},zT={key:1,class:"import-result"},HT={key:0,class:"import-errors"},VT=["disabled"],GT={__name:"ImportLocationsModal",props:{show:{type:Boolean,default:!1},importing:{type:Boolean,default:!1},error:{type:String,default:null},result:{type:Object,default:null},isDirty:{type:Boolean,default:!1}},emits:["close","submit","update:isDirty"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=e,i=t,l=T(null),u=T(!1);qe(()=>s.show,y=>{y||(l.value=null,u.value=!1)});const d=y=>{l.value=y.target.files[0],i("update:isDirty",!0)},h=()=>{i("update:isDirty",!0)},p=()=>{l.value&&i("submit",{file:l.value,deleteExisting:u.value})},g=()=>{i("close")};return(y,b)=>(v(),Ze(jt,{show:e.show,title:`Import ${O(a).checkpoints} from CSV`,size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:g},{actions:He(()=>[r("button",{type:"button",onClick:g,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:p,class:"btn btn-primary",disabled:e.importing},w(e.importing?"Importing...":`Import ${O(a).checkpoints}`),9,VT)]),default:He(()=>[r("p",RT,"Upload a CSV file with columns: Label, Lat/Latitude, Long/Longitude, What3Words (optional), "+w(O(n).people)+" (optional)",1),b[3]||(b[3]=r("div",{class:"csv-example"},[r("strong",null,"Example CSV format:"),r("pre",null,`Label,Latitude,Longitude,What3Words,Marshals
Checkpoint 1,51.505,-0.09,filled.count.soap,"John Doe, Jane Smith"
Checkpoint 2,51.510,-0.10,index.home.raft,Bob Wilson`)],-1)),r("form",{onSubmit:it(p,["prevent"])},[r("div",BT,[b[1]||(b[1]=r("label",null,"CSV file",-1)),r("input",{type:"file",accept:".csv",onChange:d,required:"",class:"form-input"},null,32)]),r("div",NT,[r("label",FT,[ze(r("input",{type:"checkbox","onUpdate:modelValue":b[0]||(b[0]=C=>u.value=C),onChange:h},null,544),[[Ws,u.value]]),Ye(" Delete existing "+w(O(a).checkpoints)+" before import ",1)])]),e.error?(v(),m("div",UT,w(e.error),1)):P("",!0),e.result?(v(),m("div",zT,[r("p",null,"Created "+w(e.result.locationsCreated)+" "+w(O(a).checkpoints)+" and "+w(e.result.assignmentsCreated)+" assignments",1),e.result.errors&&e.result.errors.length>0?(v(),m("div",HT,[b[2]||(b[2]=r("strong",null,"Errors:",-1)),r("ul",null,[(v(!0),m(Te,null,Fe(e.result.errors,(C,I)=>(v(),m("li",{key:I},w(C),1))),128))])])):P("",!0)])):P("",!0)],32)]),_:1},8,["show","title","is-dirty"]))}},jT=Ge(GT,[["__scopeId","data-v-75c79d31"]]),ZT={class:"instruction"},qT={class:"form-group"},WT={key:0,class:"error"},KT={key:1,class:"import-result"},JT={key:0,class:"import-errors"},YT=["disabled"],XT={__name:"ImportMarshalsModal",props:{show:{type:Boolean,default:!1},importing:{type:Boolean,default:!1},error:{type:String,default:null},result:{type:Object,default:null},isDirty:{type:Boolean,default:!1}},emits:["close","submit","update:isDirty"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=e,i=t,l=T(null);qe(()=>s.show,p=>{p||(l.value=null)});const u=p=>{l.value=p.target.files[0],i("update:isDirty",!0)},d=()=>{l.value&&i("submit",l.value)},h=()=>{i("close")};return(p,g)=>(v(),Ze(jt,{show:e.show,title:`Import ${O(a).people} from CSV`,size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:h},{actions:He(()=>[r("button",{type:"button",onClick:h,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:d,class:"btn btn-primary",disabled:e.importing},w(e.importing?"Importing...":`Import ${O(a).people}`),9,YT)]),default:He(()=>[r("p",ZT,"Upload a CSV file with columns: Name, Email (optional), Phone (optional), "+w(O(n).checkpoint)+" (optional)",1),g[2]||(g[2]=r("div",{class:"csv-example"},[r("strong",null,"Example CSV format:"),r("pre",null,`Name,Email,Phone,Checkpoint
John Doe,john@example.com,555-1234,Checkpoint 1
Jane Smith,jane@example.com,555-5678,Checkpoint 2`)],-1)),r("form",{onSubmit:it(d,["prevent"])},[r("div",qT,[g[0]||(g[0]=r("label",null,"CSV file",-1)),r("input",{type:"file",accept:".csv",onChange:u,required:"",class:"form-input"},null,32)]),e.error?(v(),m("div",WT,w(e.error),1)):P("",!0),e.result?(v(),m("div",KT,[r("p",null,"Imported "+w(e.result.marshalsCreated)+" "+w(O(a).people)+" and "+w(e.result.assignmentsCreated)+" assignments",1),e.result.errors&&e.result.errors.length>0?(v(),m("div",JT,[g[1]||(g[1]=r("strong",null,"Errors:",-1)),r("ul",null,[(v(!0),m(Te,null,Fe(e.result.errors,(y,b)=>(v(),m("li",{key:b},w(y),1))),128))])])):P("",!0)])):P("",!0)],32)]),_:1},8,["show","title","is-dirty"]))}},QT=Ge(XT,[["__scopeId","data-v-be89bf1f"]]),eM=["onClick"],tM=["innerHTML"],nM={class:"hamburger-nav"},oM=["disabled"],sM=["innerHTML"],aM={class:"current-tab-label"},iM=["disabled"],lM={key:0,class:"hamburger-menu"},rM=["onClick"],cM=["innerHTML"],uM=400,dM={__name:"TabHeader",props:{tabs:{type:Array,required:!0},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=t,s=T(null),i=T(null),l=T(null),u=T(!1),d=T(!1),h=z(()=>{const E=n.tabs.find(Z=>Z.value===n.modelValue);return E?E.label:""}),p=z(()=>n.tabs.find(Z=>Z.value===n.modelValue)?.icon||null),g=z(()=>n.tabs.findIndex(E=>E.value===n.modelValue)),y=z(()=>g.value>0),b=z(()=>g.value<n.tabs.length-1),C=()=>{y.value&&a("update:modelValue",n.tabs[g.value-1].value)},I=()=>{b.value&&a("update:modelValue",n.tabs[g.value+1].value)},M=()=>{if(!s.value)return;const E=s.value.clientWidth;if(E<uM){u.value=!0;return}if(i.value&&!u.value){i.value.scrollWidth>E&&(u.value=!0);return}const Z=n.tabs.some(B=>B.icon)?110:90,A=n.tabs.length*Z,N=(n.tabs.length-1)*8;A+N<=E&&(u.value=!1,an(()=>{i.value&&i.value.scrollWidth>E&&(u.value=!0)}))},x=()=>{d.value=!d.value},S=E=>{a("update:modelValue",E),d.value=!1},_=E=>{l.value&&!l.value.contains(E.target)&&(d.value=!1)};let D=null;return tn(()=>{an(()=>{M(),s.value&&typeof ResizeObserver<"u"&&(D=new ResizeObserver(()=>{M()}),D.observe(s.value)),document.addEventListener("click",_)})}),bn(()=>{D&&D.disconnect(),document.removeEventListener("click",_)}),qe(()=>n.tabs,()=>{an(()=>{M()})},{deep:!0}),(E,Z)=>(v(),m("div",{class:"tabs-container",ref_key:"containerRef",ref:s},[u.value?(v(),m("div",{key:1,class:"hamburger-container",ref_key:"hamburgerRef",ref:l},[r("div",nM,[r("button",{class:pe(["nav-arrow",{invisible:!y.value}]),onClick:C,type:"button","aria-label":"Previous tab",disabled:!y.value},"  ",10,oM),r("button",{class:"hamburger-button",onClick:x,type:"button","aria-label":"Tab menu"},[p.value?(v(),m("span",{key:0,class:"current-tab-icon",innerHTML:O(Xn)(p.value)},null,8,sM)):P("",!0),r("span",aM,w(h.value),1),Z[0]||(Z[0]=r("span",{class:"hamburger-chevron"},"",-1))]),r("button",{class:pe(["nav-arrow",{invisible:!b.value}]),onClick:I,type:"button","aria-label":"Next tab",disabled:!b.value},"  ",10,iM)]),d.value?(v(),m("div",lM,[(v(!0),m(Te,null,Fe(e.tabs,A=>(v(),m("button",{key:A.value,class:pe(["menu-item",{active:e.modelValue===A.value}]),onClick:N=>S(A.value),type:"button"},[A.icon?(v(),m("span",{key:0,class:"tab-icon",innerHTML:O(Xn)(A.icon)},null,8,cM)):P("",!0),Ye(" "+w(A.label),1)],10,rM))),128))])):P("",!0)],512)):(v(),m("div",{key:0,class:"tabs",ref_key:"tabsRef",ref:i},[(v(!0),m(Te,null,Fe(e.tabs,A=>(v(),m("button",{key:A.value,class:pe(["tab-button",{active:e.modelValue===A.value}]),onClick:N=>E.$emit("update:modelValue",A.value),type:"button"},[A.icon?(v(),m("span",{key:0,class:"tab-icon",innerHTML:O(Xn)(A.icon)},null,8,tM)):P("",!0),Ye(" "+w(A.label),1)],10,eM))),128))],512))],512))}},Yi=Ge(dM,[["__scopeId","data-v-736c5d0a"]]),hM={class:"tab-content"},fM={class:"form-group"},pM=["value"],vM={class:"form-group"},mM=["value"],gM={class:"form-group"},yM={class:"area-display"},kM={key:0,class:"no-area"},bM={class:"form-help"},_M={class:"form-group checkbox-group"},wM={class:"checkbox-label"},CM=["checked"],LM={class:"form-help"},SM={key:0,class:"custom-times-section"},IM={class:"form-group"},xM=["value"],$M={class:"form-help"},TM={class:"form-group"},MM=["value"],AM={class:"form-help"},EM={__name:"LocationDetailsTab",props:{form:{type:Object,required:!0},areas:{type:Array,default:()=>[]},eventDate:{type:String,default:""},areaTermSingular:{type:String,default:"Area"},areaTermPlural:{type:String,default:"Areas"},checkpointTermSingular:{type:String,default:"checkpoint"},peopleTermPlural:{type:String,default:"marshals"}},emits:["update:form","input","save"],setup(e,{emit:t}){const n=e,a=t,s=z(()=>(n.form.areaIds||n.form.AreaIds||[]).map(d=>n.areas.find(h=>h.id===d)).filter(d=>d!==void 0)),i=(u,d)=>{a("update:form",{...n.form,[u]:d}),a("input")},l=u=>{const d={...n.form,useCustomTimes:u};if(!u)d.startTime="",d.endTime="";else if(!d.startTime&&!d.endTime&&n.eventDate){const h=Gl(n.eventDate);d.startTime=h,d.endTime=h}a("update:form",d),a("input")};return(u,d)=>(v(),m("div",hM,[r("form",{onSubmit:d[5]||(d[5]=it(h=>u.$emit("save"),["prevent"]))},[r("div",fM,[d[6]||(d[6]=r("label",null,"Name",-1)),r("input",{value:e.form.name,onInput:d[0]||(d[0]=h=>i("name",h.target.value)),type:"text",required:"",class:"form-input"},null,40,pM)]),r("div",vM,[d[7]||(d[7]=r("label",null,"Description (optional)",-1)),r("input",{value:e.form.description,onInput:d[1]||(d[1]=h=>i("description",h.target.value)),type:"text",class:"form-input"},null,40,mM)]),r("div",gM,[r("label",null,w(e.areaTermSingular)+" (auto-assigned by location)",1),r("div",yM,[s.value.length===0?(v(),m("span",kM," Not in any "+w(e.areaTermSingular.toLowerCase())+" polygon ",1)):P("",!0),(v(!0),m(Te,null,Fe(s.value,h=>(v(),m("span",{key:h.id,class:"area-badge",style:Qe({backgroundColor:h.color||"var(--brand-primary)"})},w(h.name),5))),128))]),r("small",bM,w(e.areaTermPlural)+" are automatically assigned based on "+w(e.checkpointTermSingular.toLowerCase())+" location within "+w(e.areaTermSingular.toLowerCase())+" boundaries ",1)]),r("div",_M,[r("label",wM,[r("input",{checked:e.form.useCustomTimes,onChange:d[2]||(d[2]=h=>l(h.target.checked)),type:"checkbox"},null,40,CM),r("span",null,"Use custom date/time for this "+w(e.checkpointTermSingular.toLowerCase()),1)]),r("small",LM," By default, "+w(e.peopleTermPlural.toLowerCase())+" are expected during the event date/time. Enable this to set a specific time range. ",1)]),e.form.useCustomTimes?(v(),m("div",SM,[r("div",IM,[d[8]||(d[8]=r("label",null,"Start date & time (optional)",-1)),r("input",{value:e.form.startTime,onInput:d[3]||(d[3]=h=>i("startTime",h.target.value)),type:"datetime-local",class:"form-input"},null,40,xM),r("small",$M," When "+w(e.peopleTermPlural.toLowerCase())+" should arrive at this "+w(e.checkpointTermSingular.toLowerCase()),1)]),r("div",TM,[d[9]||(d[9]=r("label",null,"End date & time (optional)",-1)),r("input",{value:e.form.endTime,onInput:d[4]||(d[4]=h=>i("endTime",h.target.value)),type:"datetime-local",class:"form-input"},null,40,MM),r("small",AM," When "+w(e.peopleTermPlural.toLowerCase())+" can leave this "+w(e.checkpointTermSingular.toLowerCase()),1)])])):P("",!0)],32)]))}},PM=Ge(EM,[["__scopeId","data-v-aa628901"]]),DM={class:"scope-configuration-editor"},OM={class:"editor-header"},RM={class:"scope-types-list"},BM=["onClick"],NM={class:"scope-type-label"},FM={class:"scope-type-pill"},UM={class:"expand-label"},zM={class:"expand-icon"},HM={class:"modal-content"},VM={class:"modal-header"},GM={class:"modal-body"},jM={class:"scope-help"},ZM={key:0,class:"form-group"},qM={class:"checkbox-label special-option"},WM=["checked"],KM={key:0,class:"specific-selection"},JM=["placeholder"],YM={class:"checkbox-group scrollable"},XM=["checked","onChange"],QM={key:1,class:"form-group"},eA={class:"checkbox-label special-option"},tA=["checked"],nA={key:0,class:"specific-selection"},oA={class:"checkbox-group scrollable"},sA=["checked","onChange"],aA={key:2,class:"form-group"},iA={class:"checkbox-label special-option"},lA=["checked"],rA={key:0,class:"specific-selection"},cA=["placeholder"],uA={class:"checkbox-group scrollable"},dA={key:0,class:"checkbox-label this-checkpoint-option"},hA=["checked"],fA={class:"checkpoint-info"},pA={class:"checkpoint-name"},vA=["checked","onChange"],mA={class:"checkpoint-info"},gA={class:"checkpoint-name"},yA={key:0,class:"checkpoint-description"},kA={__name:"ScopeConfigurationEditor",props:{modelValue:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1},excludeScopes:{type:Array,default:()=>[]},headerText:{type:String,default:""},intent:{type:String,default:"completion",validator:e=>["completion","location-update"].includes(e)},currentCheckpointId:{type:String,default:null}},emits:["update:modelValue","user-changed"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=z(()=>[{scope:"SpecificPeople",label:`Specific ${n.value.people}`},{scope:"EveryoneAtCheckpoints",label:`Every ${n.value.person} at specified ${n.value.checkpoints}`},{scope:"OnePerCheckpoint",label:`One ${n.value.person} at each specified ${n.value.checkpoint}`},{scope:"OnePerArea",label:`One ${n.value.person} in specified ${n.value.areas}`},{scope:"EveryoneInAreas",label:`Everyone in specified ${n.value.areas}`},{scope:"EveryAreaLead",label:`Every ${n.value.area} lead at specified ${n.value.areas}`},{scope:"OneLeadPerArea",label:`One lead per specified ${n.value.area}`}]),l=T({SpecificPeople:{enabled:!0,ids:["ALL_MARSHALS"]},EveryoneInAreas:{enabled:!1,ids:[]},EveryoneAtCheckpoints:{enabled:!1,ids:[]},OnePerCheckpoint:{enabled:!1,ids:[]},OnePerArea:{enabled:!1,ids:[]},EveryAreaLead:{enabled:!1,ids:[]},OneLeadPerArea:{enabled:!1,ids:[]}}),u=T(null),d=T(""),h=T(""),p=T(!a.isEditing);let g=!0,y=!1;const b=z(()=>i.value.filter(ve=>!a.excludeScopes.includes(ve.scope))),C=z(()=>p.value?b.value:b.value.filter(ve=>j(ve.scope))),I=z(()=>b.value.filter(ue=>j(ue.scope)).length<b.value.length),M=z(()=>{const ve=b.value.filter(ue=>j(ue.scope)).length;return b.value.length-ve}),x=z(()=>!a.currentCheckpointId&&a.intent==="location-update");qe(()=>a.modelValue,ve=>{if(ve){if(y){y=!1;return}g=!0,Object.keys(l.value).forEach(ue=>{l.value[ue]={enabled:!1,ids:[]}}),ve.forEach(ue=>{ue.scope==="Everyone"?l.value.SpecificPeople={enabled:!0,ids:["ALL_MARSHALS"]}:ue.scope==="AreaLead"?l.value.EveryAreaLead={enabled:!0,ids:[...ue.ids]}:l.value[ue.scope]&&(l.value[ue.scope]={enabled:!0,ids:[...ue.ids]})}),g=!1}},{immediate:!0});const S=()=>{const ve=[];return Object.keys(l.value).forEach(ue=>{const F=l.value[ue];if(F.enabled){const K={scope:ue,itemType:_(ue),ids:[...F.ids]};ve.push(K)}}),ve};qe(l,()=>{if(g)return;if(Object.keys(l.value).some(F=>F!=="SpecificPeople"&&l.value[F].enabled)&&l.value.SpecificPeople?.ids.includes("ALL_MARSHALS")){const F=l.value.SpecificPeople.ids.indexOf("ALL_MARSHALS");l.value.SpecificPeople.ids.splice(F,1),l.value.SpecificPeople.ids.length===0&&(l.value.SpecificPeople.enabled=!1)}y=!0;const ue=S();s("update:modelValue",ue),s("user-changed")},{deep:!0});const _=ve=>D(ve)?"Area":E(ve)?"Checkpoint":Z(ve)?"Marshal":null,D=ve=>ve==="EveryoneInAreas"||ve==="OnePerArea"||ve==="EveryAreaLead"||ve==="OneLeadPerArea",E=ve=>ve==="EveryoneAtCheckpoints"||ve==="OnePerCheckpoint",Z=ve=>ve==="SpecificPeople",A=ve=>{const ue=i.value.find(F=>F.scope===ve);return ue?ue.label:ve},N=z(()=>a.headerText?a.headerText:a.intent==="location-update"?"Who can update this location?":`Who can see and complete this ${n.value.checklist}?`),B=ve=>a.intent==="location-update"?{SpecificPeople:`Select "Everyone" or choose specific ${n.value.people} who can update the location`,EveryoneAtCheckpoints:`Every ${n.value.person} at the selected ${n.value.checkpoints} can update the location`,OnePerCheckpoint:`Any ${n.value.person} at each selected ${n.value.checkpoint} can update the location`,OnePerArea:`Any ${n.value.person} in each selected ${n.value.area} can update the location`,EveryoneInAreas:`Every ${n.value.person} in the selected ${n.value.areas} can update the location`,EveryAreaLead:`Every ${n.value.area} lead at the selected ${n.value.areas} can update the location`,OneLeadPerArea:`Any ${n.value.area} lead at the selected ${n.value.areas} can update the location`}[ve]||"":{SpecificPeople:`Select "Everyone at the event" or choose specific ${n.value.people} who must complete this (personal completion)`,EveryoneAtCheckpoints:`Every ${n.value.person} at the selected ${n.value.checkpoints} must complete this (personal completion)`,OnePerCheckpoint:`One completion needed at each selected ${n.value.checkpoint} (shared completion)`,OnePerArea:`One completion needed in each selected ${n.value.area} (shared completion)`,EveryoneInAreas:`Every ${n.value.person} in the selected ${n.value.areas} must complete this (personal completion)`,EveryAreaLead:`Every ${n.value.area} lead at the selected ${n.value.areas} must complete this individually (personal completion)`,OneLeadPerArea:`One completion per ${n.value.area}, only ${n.value.area} leads can complete (shared among leads)`}[ve]||"",j=ve=>l.value[ve]?.enabled||!1,R=ve=>{const ue=l.value[ve];if(!ue||!ue.enabled)return"No";const F=ue.ids||[];if(D(ve)){if(F.includes("ALL_AREAS"))return`All ${n.value.areas}`;const K=F.length;return K>0?`${K} ${K!==1?n.value.areas:n.value.area}`:`Select ${n.value.areas}...`}if(E(ve)){if(F.includes("ALL_CHECKPOINTS"))return`All ${n.value.checkpoints}`;if(F.length===1&&F[0]==="THIS_CHECKPOINT")return`This ${n.value.checkpoint}`;const K=F.length;return K>0?`${K} ${K!==1?n.value.checkpoints:n.value.checkpoint}`:`Select ${n.value.checkpoints}...`}if(Z(ve)){if(F.includes("ALL_MARSHALS"))return"Everyone";const K=F.length;return K>0?`${K} ${K!==1?n.value.people:n.value.person}`:`Select ${n.value.people}...`}return"Configured"},G=ve=>{u.value=ve,d.value="",h.value=""},ee=()=>{u.value=null},ne=()=>{u.value&&(l.value[u.value]={enabled:!1,ids:[]}),ee()},Ae=()=>u.value&&l.value[u.value]?.ids.includes("ALL_MARSHALS"),J=()=>{if(!u.value)return;const ve=l.value[u.value];Ae()?(ve.ids=[],ve.enabled=!1):(ve.ids=["ALL_MARSHALS"],ve.enabled=!0)},te=ve=>u.value&&l.value[u.value]?.ids.includes(ve),U=ve=>{if(!u.value)return;const ue=l.value[u.value],F=ue.ids.indexOf(ve);F>=0?(ue.ids.splice(F,1),ue.ids.length===0&&(ue.enabled=!1)):(ue.ids.push(ve),ue.enabled=!0)},X=()=>{let ve=a.marshals;if(h.value){const F=h.value.toLowerCase();ve=ve.filter(K=>K.name.toLowerCase().includes(F)||K.email&&K.email.toLowerCase().includes(F))}const ue=u.value?l.value[u.value]?.ids||[]:[];return[...ve].sort((F,K)=>{const ae=ue.includes(F.id),$e=ue.includes(K.id);return ae&&!$e?-1:!ae&&$e?1:F.name.localeCompare(K.name,void 0,{sensitivity:"base"})})},re=()=>u.value&&l.value[u.value]?.ids.includes("ALL_AREAS"),ke=()=>{if(!u.value)return;const ve=l.value[u.value];re()?(ve.ids=[],ve.enabled=!1):(ve.ids=["ALL_AREAS"],ve.enabled=!0)},Re=ve=>u.value&&l.value[u.value]?.ids.includes(ve),Xe=()=>{const ve=u.value?l.value[u.value]?.ids||[]:[];return[...a.areas].sort((ue,F)=>{const K=ve.includes(ue.id),ae=ve.includes(F.id);return K&&!ae?-1:!K&&ae?1:ue.name.localeCompare(F.name,void 0,{sensitivity:"base"})})},Ne=ve=>{if(!u.value)return;const ue=l.value[u.value],F=ue.ids.indexOf(ve);F>=0?(ue.ids.splice(F,1),ue.ids.length===0&&(ue.enabled=!1)):(ue.ids.push(ve),ue.enabled=!0)},Ke=()=>u.value&&l.value[u.value]?.ids.includes("ALL_CHECKPOINTS"),We=()=>{if(!u.value)return;const ve=l.value[u.value];Ke()?(ve.ids=[],ve.enabled=!1):(ve.ids=["ALL_CHECKPOINTS"],ve.enabled=!0)},Q=ve=>u.value&&l.value[u.value]?.ids.includes(ve),ge=ve=>{if(!u.value)return;const ue=l.value[u.value],F=ue.ids.indexOf(ve);F>=0?(ue.ids.splice(F,1),ue.ids.length===0&&(ue.enabled=!1)):(ue.ids.push(ve),ue.enabled=!0)},Ce=()=>{let ve=a.locations;if(d.value){const F=d.value.toLowerCase();ve=ve.filter(K=>K.name.toLowerCase().includes(F)||K.description&&K.description.toLowerCase().includes(F))}const ue=u.value?l.value[u.value]?.ids||[]:[];return[...ve].sort((F,K)=>{const ae=ue.includes(F.id),$e=ue.includes(K.id);return ae&&!$e?-1:!ae&&$e?1:Ks(F.name,K.name)})};return(ve,ue)=>(v(),m("div",DM,[r("div",OM,[r("h4",null,w(N.value),1)]),r("div",RM,[(v(!0),m(Te,null,Fe(C.value,F=>(v(),m("div",{key:F.scope,class:pe(["scope-type-row",{active:j(F.scope)}]),onClick:K=>G(F.scope)},[r("div",NM,w(F.label),1),r("div",FM,w(R(F.scope)),1)],10,BM))),128)),I.value?(v(),m("div",{key:0,class:"expand-row",onClick:ue[0]||(ue[0]=F=>p.value=!p.value)},[r("div",UM,w(p.value?"Show less":`Show ${M.value} more option${M.value!==1?"s":""}...`),1),r("div",zM,w(p.value?"":""),1)])):P("",!0)]),u.value?(v(),m("div",{key:0,class:"scope-config-modal",onClick:it(ee,["self"])},[r("div",HM,[r("div",VM,[r("h5",null,w(A(u.value)),1),r("button",{onClick:ee,class:"btn-close",type:"button"},"")]),r("div",GM,[r("p",jM,w(B(u.value)),1),Z(u.value)?(v(),m("div",ZM,[r("label",qM,[r("input",{type:"checkbox",checked:Ae(),onChange:J},null,40,WM),r("span",null,[ue[4]||(ue[4]=r("strong",null,"Everyone at the event",-1)),Ye(" (all current and future "+w(O(n).people)+")",1)])]),Ae()?P("",!0):(v(),m("div",KM,[ze(r("input",{"onUpdate:modelValue":ue[1]||(ue[1]=F=>h.value=F),type:"text",placeholder:`Search ${O(n).people}...`,class:"search-input"},null,8,JM),[[nt,h.value]]),r("div",YM,[(v(!0),m(Te,null,Fe(X(),F=>(v(),m("label",{key:F.id,class:"checkbox-label"},[r("input",{type:"checkbox",checked:te(F.id),onChange:K=>U(F.id)},null,40,XM),r("span",null,w(F.name),1)]))),128))])]))])):P("",!0),D(u.value)?(v(),m("div",QM,[r("label",eA,[r("input",{type:"checkbox",checked:re(),onChange:ke},null,40,tA),r("span",null,[r("strong",null,"All "+w(O(n).areas),1),Ye(" (includes future "+w(O(n).areas)+")",1)])]),re()?P("",!0):(v(),m("div",nA,[r("div",oA,[(v(!0),m(Te,null,Fe(Xe(),F=>(v(),m("label",{key:F.id,class:"checkbox-label"},[r("input",{type:"checkbox",checked:Re(F.id),onChange:K=>Ne(F.id)},null,40,sA),r("span",{class:"area-color-dot",style:Qe({backgroundColor:F.color||"#667eea"})},null,4),r("span",null,w(F.name),1)]))),128))])]))])):P("",!0),E(u.value)?(v(),m("div",aA,[r("label",iA,[r("input",{type:"checkbox",checked:Ke(),onChange:We},null,40,lA),r("span",null,[r("strong",null,"All "+w(O(n).checkpoints),1),Ye(" (includes future "+w(O(n).checkpoints)+")",1)])]),Ke()?P("",!0):(v(),m("div",rA,[ze(r("input",{"onUpdate:modelValue":ue[2]||(ue[2]=F=>d.value=F),type:"text",placeholder:`Search ${O(n).checkpoints}...`,class:"search-input"},null,8,cA),[[nt,d.value]]),r("div",uA,[x.value?(v(),m("label",dA,[r("input",{type:"checkbox",checked:Q("THIS_CHECKPOINT"),onChange:ue[3]||(ue[3]=F=>ge("THIS_CHECKPOINT"))},null,40,hA),r("div",fA,[r("span",pA,[r("strong",null,"This "+w(O(n).checkpoint),1)])])])):P("",!0),(v(!0),m(Te,null,Fe(Ce(),F=>(v(),m("label",{key:F.id,class:"checkbox-label"},[r("input",{type:"checkbox",checked:Q(F.id),onChange:K=>ge(F.id)},null,40,vA),r("div",mA,[r("span",gA,w(F.name),1),F.description?(v(),m("span",yA," - "+w(F.description),1)):P("",!0)])]))),128))])]))])):P("",!0)]),r("div",{class:"modal-footer"},[r("button",{onClick:ne,class:"btn btn-secondary",type:"button"},"Deselect all"),r("button",{onClick:ee,class:"btn btn-primary",type:"button"},"Done")])])])):P("",!0)]))}},Cc=Ge(kA,[["__scopeId","data-v-d465703e"]]),bA={class:"tab-content"},_A={class:"form-group"},wA=["value"],CA={key:0,class:"form-error"},LA={class:"form-row"},SA={class:"form-group"},IA=["disabled"],xA={class:"form-group"},$A=["disabled"],TA={class:"form-group"},MA={class:"accordion-item"},AA={class:"accordion-preview"},EA={class:"accordion-arrow"},PA={key:0,class:"accordion-content"},DA={class:"section-description"},OA={class:"dynamic-checkbox"},RA=["checked"],BA={key:0,class:"dynamic-settings"},NA={__name:"LocationCoordinatesTab",props:{form:{type:Object,required:!0},isMoving:{type:Boolean,default:!1},checkpointTermSingular:{type:String,default:"Checkpoint"},peopleTermPlural:{type:String,default:"Marshals"},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1}},emits:["update:form","input","save","move-location"],setup(e,{emit:t}){const n=e,a=t,s=T(!1),i=T(""),l=T(""),u=b=>b==null||b===""||isNaN(b)?"":Number(b).toFixed(6);qe(()=>n.form.longitude,b=>{i.value=u(b)},{immediate:!0}),qe(()=>n.form.latitude,b=>{l.value=u(b)},{immediate:!0});const d=b=>{const C=b==="longitude"?i:l,I=parseFloat(C.value);isNaN(I)?C.value.trim()===""&&(a("update:form",{...n.form,[b]:0}),a("input"),C.value=u(0)):(a("update:form",{...n.form,[b]:I}),a("input"),C.value=u(I))},h=(b,C)=>{a("update:form",{...n.form,[b]:C}),a("input")},p=b=>{if(b){const I=[{scope:"EveryoneAtCheckpoints",itemType:"Checkpoint",ids:[n.form.id||"THIS_CHECKPOINT"]}];a("update:form",{...n.form,isDynamic:!0,latitude:0,longitude:0,locationUpdateScopeConfigurations:I})}else a("update:form",{...n.form,isDynamic:!1});a("input")},g=b=>{a("update:form",{...n.form,locationUpdateScopeConfigurations:b}),a("input")},y=b=>{if(!b)return!0;const C=b.includes(".")?b.split("."):b.split("/");if(C.length!==3)return!1;const I=/^[a-z]{1,20}$/;return C.every(M=>I.test(M))};return(b,C)=>(v(),m("div",bA,[r("form",{onSubmit:C[6]||(C[6]=it(I=>b.$emit("save"),["prevent"]))},[r("div",_A,[C[10]||(C[10]=r("label",null,"What3Words (optional)",-1)),r("input",{value:e.form.what3Words,onInput:C[0]||(C[0]=I=>h("what3Words",I.target.value)),type:"text",class:"form-input",placeholder:"e.g. filled.count.soap or filled/count/soap"},null,40,wA),e.form.what3Words&&!y(e.form.what3Words)?(v(),m("small",CA," Invalid format. Must be word.word.word or word/word/word (lowercase letters only, 1-20 characters each) ")):P("",!0)]),e.form.isDynamic?P("",!0):(v(),m(Te,{key:0},[r("div",LA,[r("div",SA,[C[11]||(C[11]=r("label",null,"Longitude",-1)),ze(r("input",{"onUpdate:modelValue":C[1]||(C[1]=I=>i.value=I),onBlur:C[2]||(C[2]=I=>d("longitude")),type:"text",inputmode:"decimal",class:"form-input",disabled:e.isMoving,placeholder:"e.g., -0.091234"},null,40,IA),[[nt,i.value]])]),r("div",xA,[C[12]||(C[12]=r("label",null,"Latitude",-1)),ze(r("input",{"onUpdate:modelValue":C[3]||(C[3]=I=>l.value=I),onBlur:C[4]||(C[4]=I=>d("latitude")),type:"text",inputmode:"decimal",class:"form-input",disabled:e.isMoving,placeholder:"e.g., 51.505123"},null,40,$A),[[nt,l.value]])])]),r("div",TA,[r("button",{type:"button",onClick:C[5]||(C[5]=I=>b.$emit("move-location")),class:pe(["btn btn-secondary btn-with-icon",{"btn-primary":e.isMoving}])},[C[13]||(C[13]=r("svg",{class:"btn-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),Ye(" "+w(e.isMoving?"Click on map to set new location...":`Move ${e.checkpointTermSingular.toLowerCase()}...`),1)],2)])],64))],32),r("div",MA,[r("button",{type:"button",class:pe(["accordion-header",{expanded:s.value}]),onClick:C[7]||(C[7]=I=>s.value=!s.value)},[C[14]||(C[14]=Nr('<div class="accordion-icon" data-v-bd432637><svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-v-bd432637><path d="M12 2L15 8L22 9L17 14L18 21L12 18L6 21L7 14L2 9L9 8L12 2Z" fill="#F59E0B" opacity="0.3" data-v-bd432637></path><path d="M12 6L13.5 9L17 9.5L14.5 12L15 15.5L12 14L9 15.5L9.5 12L7 9.5L10.5 9L12 6Z" fill="#F59E0B" data-v-bd432637></path><circle cx="12" cy="11" r="2" fill="white" data-v-bd432637></circle></svg></div><span class="accordion-title" data-v-bd432637>Dynamic location</span>',2)),r("span",AA,w(e.form.isDynamic?"Enabled":"Disabled"),1),r("span",EA,w(s.value?"":""),1)],2),s.value?(v(),m("div",PA,[r("p",DA," Enable this for lead cars, sweep vehicles, or other moving "+w(e.checkpointTermSingular.toLowerCase())+"s whose location can be updated by designated "+w(e.peopleTermPlural.toLowerCase())+" during the event. ",1),r("label",OA,[r("input",{type:"checkbox",checked:e.form.isDynamic,onChange:C[8]||(C[8]=I=>p(I.target.checked))},null,40,RA),r("span",null,"This "+w(e.checkpointTermSingular.toLowerCase())+" can move",1)]),e.form.isDynamic?(v(),m("div",BA,[Me(Cc,{"model-value":e.form.locationUpdateScopeConfigurations,areas:e.areas,locations:e.locations,marshals:e.marshals,"is-editing":e.isEditing,"header-text":`Who can update this ${e.checkpointTermSingular.toLowerCase()}'s location?`,"exclude-scopes":["OnePerCheckpoint","OneLeadPerArea","OnePerArea"],intent:"location-update","current-checkpoint-id":e.form.id,"onUpdate:modelValue":g,onUserChanged:C[9]||(C[9]=I=>b.$emit("input"))},null,8,["model-value","areas","locations","marshals","is-editing","header-text","current-checkpoint-id"])])):P("",!0)])):P("",!0)])]))}},FA=Ge(NA,[["__scopeId","data-v-bd432637"]]);function cm(e){const t=T(new Map),n=p=>t.value.has(p.id)?t.value.get(p.id):p.isCheckedIn;return{pendingCheckInChanges:t,getEffectiveCheckInStatus:n,handleToggleCheckIn:p=>{const y=!n(p);y===p.isCheckedIn?t.value.delete(p.id):t.value.set(p.id,y),e&&e()},getStatusIcon:p=>n(p)?"":"",getStatusColor:p=>n(p)?"#28a745":"#dc3545",getStatusText:p=>n(p)?"Checked in":"Not checked in",formatTime:p=>p?new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",clearPendingChanges:()=>{t.value.clear()},getPendingChanges:()=>Array.from(t.value.entries()).map(([p,g])=>({assignmentId:p,shouldBeCheckedIn:g}))}}const UA={class:"card-main"},zA={class:"card-title"},HA={class:"marshal-name"},VA={key:0,class:"card-check-in"},GA={class:"toggle-icon"},jA={class:"toggle-label"},ZA={key:0,class:"check-in-time"},qA={key:0,class:"check-in-method"},WA={key:1,class:"unsaved-indicator"},KA={key:1,class:"card-status-readonly"},JA={class:"status-icon"},YA={key:0,class:"check-in-time"},XA={key:0,class:"check-in-method"},QA={key:2,class:"card-badge"},eE={key:3,class:"card-badge"},tE={__name:"MarshalAssignmentCard",props:{assignment:{type:Object,required:!0},effectiveCheckInStatus:{type:Boolean,default:!1},hasUnsavedChanges:{type:Boolean,default:!1},isMarkedForRemoval:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},location:{type:Object,default:null}},emits:["click","toggle-check-in","remove","undo-remove","distance-click"],setup(e,{emit:t}){const n=e,a=t,s=()=>{a("distance-click",n.assignment)},i=y=>y?new Date(y).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",l=z(()=>{const{checkedInBy:y,checkInMethod:b,marshalName:C}=n.assignment;return y&&y!==C?y:b||""}),u=z(()=>!n.assignment.isPending&&!n.isMarkedForRemoval&&!n.readOnly),d=z(()=>{const{checkInLatitude:y,checkInLongitude:b}=n.assignment,C=n.location;return!y||!b||!C?.latitude||!C?.longitude?null:hi(y,b,C.latitude,C.longitude)}),h=z(()=>d.value===null?null:i_(d.value)),p=z(()=>d.value===null?"":d.value<=50?"distance-close":d.value<=100?"distance-medium":"distance-far"),g=()=>{u.value&&a("click",n.assignment)};return(y,b)=>(v(),m("div",{class:pe(["marshal-assignment-card",{"is-checked-in":e.effectiveCheckInStatus&&!e.isMarkedForRemoval,"is-pending":e.assignment.isPending,"is-marked-for-removal":e.isMarkedForRemoval,"is-clickable":u.value}]),onClick:g},[r("div",UA,[r("div",zA,[r("span",HA,w(e.assignment.marshalName),1)]),!e.assignment.isPending&&!e.isMarkedForRemoval&&!e.readOnly?(v(),m("div",VA,[r("button",{class:pe(["check-in-toggle",{"is-checked-in":e.effectiveCheckInStatus}]),onClick:b[0]||(b[0]=it(C=>y.$emit("toggle-check-in",e.assignment),["stop"]))},[r("span",GA,w(e.effectiveCheckInStatus?"":""),1),r("span",jA,w(e.effectiveCheckInStatus?"Checked in":"Check in"),1)],2),e.effectiveCheckInStatus&&e.assignment.checkInTime&&!e.hasUnsavedChanges?(v(),m("span",ZA,[Ye(w(i(e.assignment.checkInTime))+" ",1),l.value?(v(),m("span",qA,"("+w(l.value)+")",1)):P("",!0),h.value?(v(),m("span",{key:1,class:pe(["check-in-distance",p.value]),onClick:it(s,["stop"])},w(h.value),3)):P("",!0)])):e.hasUnsavedChanges?(v(),m("span",WA," Unsaved ")):P("",!0)])):P("",!0),!e.assignment.isPending&&!e.isMarkedForRemoval&&e.readOnly?(v(),m("div",KA,[r("span",{class:pe(["status-badge",e.effectiveCheckInStatus?"status-checked-in":"status-not-checked-in"])},[r("span",JA,w(e.effectiveCheckInStatus?"":""),1),Ye(" "+w(e.effectiveCheckInStatus?"Checked in":"Not checked in"),1)],2),e.effectiveCheckInStatus&&e.assignment.checkInTime?(v(),m("span",YA,[Ye(w(i(e.assignment.checkInTime))+" ",1),l.value?(v(),m("span",XA,"("+w(l.value)+")",1)):P("",!0),h.value?(v(),m("span",{key:1,class:pe(["check-in-distance",p.value]),onClick:it(s,["stop"])},w(h.value),3)):P("",!0)])):P("",!0)])):P("",!0),e.assignment.isPending?(v(),m("div",QA,[...b[3]||(b[3]=[r("span",{class:"pending-indicator"},"Will be assigned on save",-1)])])):P("",!0),e.isMarkedForRemoval?(v(),m("div",eE,[...b[4]||(b[4]=[r("span",{class:"removal-indicator"},"Will be removed on save",-1)])])):P("",!0)]),!e.readOnly&&!e.isMarkedForRemoval?(v(),m("button",{key:0,type:"button",class:"remove-btn",title:"Remove assignment",onClick:b[1]||(b[1]=it(C=>y.$emit("remove",e.assignment),["stop"]))},"  ")):P("",!0),e.isMarkedForRemoval?(v(),m("button",{key:1,type:"button",class:"undo-btn",title:"Cancel removal",onClick:b[2]||(b[2]=it(C=>y.$emit("undo-remove",e.assignment),["stop"]))}," Undo ")):P("",!0)],2))}},nE=Ge(tE,[["__scopeId","data-v-85a18d73"]]),oE={class:"tab-content"},sE={key:0,class:"read-only-notice"},aE={key:1,class:"form-group"},iE=["value"],lE={class:"section-title"},rE={key:2,class:"assign-section"},cE={__name:"LocationAssignmentsTab",props:{form:{type:Object,required:!0},assignments:{type:Array,default:()=>[]},peopleTerm:{type:String,default:"Marshals"},personTerm:{type:String,default:"Marshal"},checkpointTerm:{type:String,default:"Checkpoint"},readOnly:{type:Boolean,default:!1}},emits:["update:form","input","remove-assignment","open-assign-modal","select-marshal","distance-click"],setup(e,{expose:t,emit:n}){const a=e,s=z(()=>a.peopleTerm.toLowerCase()),i=z(()=>a.personTerm.toLowerCase()),l=z(()=>a.checkpointTerm.toLowerCase()),u=n,{pendingCheckInChanges:d,getEffectiveCheckInStatus:h,handleToggleCheckIn:p}=cm(()=>u("input")),g=T(new Set),y=z(()=>a.assignments?.length||0),b=z(()=>a.assignments?[...a.assignments].sort((B,j)=>(B.marshalName||"").localeCompare(j.marshalName||"",void 0,{sensitivity:"base"})):[]),C=B=>g.value.has(B),I=B=>{B.isPending||u("select-marshal",B)},M=T(!1),x=T(null),S=B=>{h(B)?(x.value=B,M.value=!0):p(B)},_=()=>{x.value&&p(x.value),M.value=!1,x.value=null},D=()=>{M.value=!1,x.value=null},E=z(()=>x.value?`Are you sure you want to undo ${x.value.marshalName||"this marshal"}'s check-in?`:""),Z=B=>{B.isPending?u("remove-assignment",B):(g.value.add(B.id),u("input"))},A=B=>{g.value.delete(B.id),u("input")},N=(B,j)=>{u("update:form",{...a.form,[B]:Number(j)}),u("input")};return t({pendingCheckInChanges:d,clearPendingChanges:()=>{d.value.clear(),g.value.clear()},getPendingChanges:()=>Array.from(d.value.entries()).map(([B,j])=>({assignmentId:B,shouldBeCheckedIn:j})),getMarkedForRemoval:()=>Array.from(g.value)}),(B,j)=>(v(),m("div",oE,[e.readOnly?(v(),m("div",sE," Viewing from "+w(i.value)+" - "+w(s.value)+" cannot be modified here. ",1)):P("",!0),e.readOnly?P("",!0):(v(),m("div",aE,[r("label",null,"Required "+w(s.value),1),r("input",{value:e.form.requiredMarshals,onInput:j[0]||(j[0]=R=>N("requiredMarshals",R.target.value)),type:"number",min:"1",required:"",class:"form-input"},null,40,iE)])),r("h3",lE,"Assigned "+w(s.value)+" ("+w(y.value)+")",1),Me(er,{"is-empty":e.assignments.length===0,"empty-message":`No ${s.value} assigned yet.`,"empty-hint":`Use the button below to assign ${s.value} to this ${l.value}.`},{default:He(()=>[(v(!0),m(Te,null,Fe(b.value,R=>(v(),Ze(nE,{key:R.id,assignment:R,"effective-check-in-status":O(h)(R),"has-unsaved-changes":O(d).has(R.id),"is-marked-for-removal":C(R.id),"read-only":e.readOnly,location:e.form,onClick:I,onToggleCheckIn:S,onRemove:Z,onUndoRemove:A,onDistanceClick:j[1]||(j[1]=G=>B.$emit("distance-click",G))},null,8,["assignment","effective-check-in-status","has-unsaved-changes","is-marked-for-removal","read-only","location"]))),128))]),_:1},8,["is-empty","empty-message","empty-hint"]),e.readOnly?P("",!0):(v(),m("div",rE,[r("button",{type:"button",class:"btn btn-primary assign-btn",onClick:j[2]||(j[2]=R=>B.$emit("open-assign-modal"))}," + Assign "+w(i.value)+"... ",1)])),Me(Aa,{show:M.value,title:"Confirm check-out",message:E.value,"confirm-text":"Check out","is-danger":!0,onConfirm:_,onCancel:D},null,8,["show","message"])]))}},uE=Ge(cE,[["__scopeId","data-v-7124720e"]]),dE={class:"grouped-tasks-list"},hE={key:0,class:"empty-state"},fE={key:1,class:"task-groups"},pE=["onClick"],vE={class:"task-header-content"},mE={class:"task-checkbox-area"},gE={class:"task-info"},yE={class:"task-name"},kE={class:"task-summary"},bE={key:0,class:"modified-badge"},_E={class:"task-scope"},wE=["title"],CE={class:"expand-arrow"},LE={key:0,class:"task-group-details"},SE={class:"detail-checkbox"},IE=["checked","disabled","onChange"],xE={class:"detail-content"},$E={class:"detail-context"},TE={key:0,class:"detail-completion"},ME={key:0,class:"pending-text"},AE={class:"completion-text"},EE={class:"completion-time"},PE={key:1,class:"detail-uncomplete"},DE={key:2,class:"detail-disabled"},OE={__name:"GroupedTasksList",props:{items:{type:Array,required:!0},locations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]}},emits:["toggle-complete"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=e,i=T(new Set),l=z(()=>{const C=new Map;for(const I of s.items){C.has(I.itemId)||C.set(I.itemId,{itemId:I.itemId,text:I.text,items:[],totalCount:0,completedCount:0,allCompleted:!1,hasModified:!1});const M=C.get(I.itemId);M.items.push(I),M.totalCount++,I.localIsCompleted&&M.completedCount++,I.isModified&&(M.hasModified=!0)}for(const I of C.values())I.allCompleted=I.completedCount===I.totalCount,I.items.sort((M,x)=>{const S=y(M),_=y(x);return S.localeCompare(_,void 0,{numeric:!0,sensitivity:"base"})});return Array.from(C.values()).sort((I,M)=>I.text.localeCompare(M.text,void 0,{sensitivity:"base"}))}),u=C=>{i.value.has(C)?i.value.delete(C):i.value.add(C),i.value=new Set(i.value)},d=C=>C.hasModified?"status-modified":C.allCompleted?"status-completed":C.completedCount>0?"status-partial":"status-pending",h=C=>C.allCompleted?"":C.completedCount>0?"":"",p=C=>({Everyone:"Everyone",SpecificPeople:"Assigned individually",EveryoneInAreas:`Per ${a.value.area}`,EveryoneAtCheckpoints:`Per ${a.value.checkpoint}`,OnePerCheckpoint:`One per ${a.value.checkpoint}`,OnePerArea:`One per ${a.value.area}`,EveryAreaLead:`${n.value.area} leads`,OneLeadPerArea:`One lead per ${a.value.area}`})[C.matchedScope]||C.matchedScope,g=C=>({Everyone:"This task is for everyone at the event",SpecificPeople:"This task is specifically assigned to certain people",EveryoneInAreas:`This task is for everyone in certain ${a.value.areas}`,EveryoneAtCheckpoints:`This task is for everyone at certain ${a.value.checkpoints}`,OnePerCheckpoint:`One person at the ${a.value.checkpoint} needs to complete this`,OnePerArea:`One person in the ${a.value.area} needs to complete this`,EveryAreaLead:`This task is for ${a.value.area} leads only`,OneLeadPerArea:`One ${a.value.area} lead needs to complete this`})[C.matchedScope]||"",y=C=>{if(!C.completionContextType||!C.completionContextId)return"Everyone";if(C.completionContextType==="Checkpoint"){const I=s.locations.find(M=>M.id===C.completionContextId);return I?I.description?`${I.name} - ${I.description}`:I.name:`${n.value.checkpoint} (unknown)`}if(C.completionContextType==="Area"){const I=s.areas.find(M=>M.id===C.completionContextId);return I?I.name:`${n.value.area} (unknown)`}if(C.completionContextType==="Personal"){if(C.contextOwnerName)return C.contextOwnerName;if(C.completionContextId&&s.marshals.length>0){const I=s.marshals.find(M=>M.id===C.completionContextId||M.marshalId===C.completionContextId);if(I)return I.name||I.marshalName}return"Assigned individually"}return C.completionContextType},b=C=>C?new Date(C).toLocaleString():"";return(C,I)=>(v(),m("div",dE,[l.value.length===0?(v(),m("div",hE,[...I[0]||(I[0]=[r("p",null,"No tasks available.",-1)])])):(v(),m("div",fE,[(v(!0),m(Te,null,Fe(l.value,M=>(v(),m("div",{key:M.itemId,class:pe(["task-group",{"all-completed":M.allCompleted,"has-modified":M.hasModified}])},[r("button",{type:"button",class:"task-group-header",onClick:x=>u(M.itemId)},[r("div",vE,[r("div",mE,[r("span",{class:pe(["task-status-icon",d(M)])},w(h(M)),3)]),r("div",gE,[r("div",yE,w(M.text),1),r("div",kE,[r("span",{class:pe(["completion-count",{"all-done":M.allCompleted}])},w(M.completedCount)+"/"+w(M.totalCount)+" completed ",3),M.hasModified?(v(),m("span",bE," Modified ")):P("",!0)])]),r("div",_E,[M.items[0]?.scopeConfigurations?.length?(v(),Ze(Ql,{key:0,"scope-configurations":M.items[0].scopeConfigurations,areas:e.areas,locations:e.locations,marshals:e.marshals,"max-expanded-items":3},null,8,["scope-configurations","areas","locations","marshals"])):(v(),m("span",{key:1,class:"scope-pill",title:g(M.items[0])},w(p(M.items[0])),9,wE))])]),r("span",CE,w(i.value.has(M.itemId)?"":""),1)],8,pE),i.value.has(M.itemId)?(v(),m("div",LE,[(v(!0),m(Te,null,Fe(M.items,x=>(v(),m("div",{key:`${x.itemId}-${x.completionContextId}`,class:pe(["task-detail-item",{"item-completed":x.localIsCompleted,"item-modified":x.isModified}])},[r("div",SE,[r("input",{type:"checkbox",checked:x.localIsCompleted,disabled:!x.canBeCompletedByMe&&!x.localIsCompleted,onChange:S=>C.$emit("toggle-complete",x)},null,40,IE)]),r("div",xE,[r("div",$E,w(y(x)),1),x.localIsCompleted?(v(),m("div",TE,[x.isModified&&!x.isCompleted?(v(),m("span",ME," Will be marked as completed ")):(v(),m(Te,{key:1},[r("span",AE,w(x.completedByActorName||"Unknown"),1),r("span",EE,w(b(x.completedAt)),1)],64))])):x.isModified&&x.isCompleted?(v(),m("div",PE,[...I[1]||(I[1]=[r("span",{class:"pending-text"},"Will be marked as incomplete",-1)])])):x.canBeCompletedByMe?P("",!0):(v(),m("div",DE," Already completed by someone else "))])],2))),128))])):P("",!0)],2))),128))]))]))}},vd=Ge(OE,[["__scopeId","data-v-90fc486c"]]),RE={class:"checkpoint-checklist-view"},BE={key:0,class:"loading-state"},NE={key:1,class:"error-state"},FE={key:2,class:"empty-state"},UE={class:"help-text"},zE={key:3,class:"empty-state"},HE={__name:"CheckpointChecklistView",props:{eventId:{type:String,required:!0},locationId:{type:String,default:null},areaId:{type:String,default:null},locations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},assignments:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,{expose:t,emit:n}){const{termsLower:a}=rt(),s=e,i=n,l=T([]),u=T(!1),d=T(null),h=T(new Map),p=z(()=>s.assignments.length===0),g=z(()=>l.value.map(M=>{const x=h.value.get(`${M.itemId}|||${M.completionContextId}`),S=x!==void 0?x.complete:M.isCompleted,_=x!==void 0&&x.complete!==M.isCompleted;return{...M,localIsCompleted:S,isModified:_}})),y=async()=>{if(!(!s.eventId||!s.locationId&&!s.areaId)){u.value=!0,d.value=null;try{const M=s.locationId?await Nt.getCheckpointChecklist(s.eventId,s.locationId):await Nt.getAreaChecklist(s.eventId,s.areaId);if(l.value=M.data||[],s.modelValue&&s.modelValue.length>0){const x=new Map;s.modelValue.forEach(S=>{x.set(`${S.itemId}|||${S.contextId}`,{complete:S.complete,contextType:S.contextType,contextId:S.contextId})}),h.value=x}}catch(M){console.error("Failed to load checklist:",M),d.value=M.response?.data?.message||"Failed to load checklist"}finally{u.value=!1}}},b=M=>{const x=M.contextOwnerMarshalId||(s.assignments.length>0?s.assignments[0].marshalId:null);if(!x)return;const S=`${M.itemId}|||${M.completionContextId}`,_=h.value.get(S),D=_!==void 0?_.complete:M.isCompleted;h.value.set(S,{complete:!D,contextType:M.completionContextType,contextId:M.completionContextId,marshalId:x}),C()},C=()=>{const M=[];for(const[x,S]of h.value.entries()){const[_,D]=x.split("|||"),E=l.value.find(Z=>Z.itemId===_&&Z.completionContextId===D);E&&S.complete!==E.isCompleted&&M.push({itemId:_,complete:S.complete,contextType:S.contextType,contextId:S.contextId,marshalId:S.marshalId})}i("update:modelValue",M),i("change",M)};return t({resetLocalState:()=>{if(h.value=new Map,s.modelValue&&s.modelValue.length>0){const M=new Map;s.modelValue.forEach(x=>{M.set(`${x.itemId}|||${x.contextId}`,{complete:x.complete,contextType:x.contextType,contextId:x.contextId,marshalId:x.marshalId})}),h.value=M}},loadChecklist:y}),qe(()=>[s.eventId,s.locationId,s.areaId],()=>{y()},{immediate:!0}),(M,x)=>(v(),m("div",RE,[u.value?(v(),m("div",BE," Loading checklist... ")):d.value?(v(),m("div",NE,[r("p",null,w(d.value),1),r("button",{onClick:y,class:"btn btn-secondary btn-small"}," Retry ")])):p.value?(v(),m("div",FE,[r("p",null,"No "+w(O(a).peoplePlural)+" assigned to this "+w(O(a).checkpoint)+" yet.",1),r("p",UE,"Assign "+w(O(a).peoplePlural)+" to enable "+w(O(a).checklist)+" completion.",1)])):l.value.length===0?(v(),m("div",zE,[r("p",null,"No checklist items for this "+w(O(a).checkpoint)+".",1)])):(v(),Ze(vd,{key:4,items:g.value,locations:e.locations,areas:e.areas,marshals:e.marshals,onToggleComplete:b},null,8,["items","locations","areas","marshals"]))]))}},um=Ge(HE,[["__scopeId","data-v-d5d67805"]]),VE={class:"notes-view"},GE={key:0,class:"loading-state"},jE={key:1,class:"error-state"},ZE={key:2,class:"empty-state"},qE={key:3,class:"notes-list"},WE={class:"note-header"},KE={class:"note-title-row"},JE={key:0,class:"pin-icon",title:"Pinned"},YE={class:"note-title"},XE={class:"note-meta"},QE={key:0,class:"category-badge"},e4={key:0,class:"note-content"},t4={class:"note-footer"},n4={class:"created-info"},o4={key:1,class:"scope-info"},s4={__name:"NotesView",props:{eventId:{type:String,required:!0},locationId:{type:String,default:null},areaId:{type:String,default:null},marshalId:{type:String,default:null},allNotes:{type:Array,default:null},locations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},assignments:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},showScope:{type:Boolean,default:!0}},setup(e,{expose:t}){const n=e,a=T([]),s=T(!1),i=T(null),l=z(()=>n.marshalId?"No notes for this marshal.":n.areaId?"No notes for this area.":n.locationId?"No notes for this checkpoint.":"No notes available."),u=z(()=>n.areaId?n.locations.filter(x=>x.areaIds&&x.areaIds.includes(n.areaId)):[]),d=z(()=>u.value.map(x=>x.id)),h=z(()=>{if(!n.areaId)return[];const x=new Set;return n.assignments.filter(S=>d.value.includes(S.locationId)).forEach(S=>x.add(S.marshalId)),Array.from(x)}),p=x=>n.assignments.filter(S=>S.marshalId===x).map(S=>S.locationId),g=x=>{const S=p(x),_=new Set;for(const D of S){const E=n.locations.find(Z=>Z.id===D);E?.areaIds&&E.areaIds.forEach(Z=>_.add(Z))}return Array.from(_)},y=(x,S)=>{if(!x.scopeConfigurations)return null;for(const _ of x.scopeConfigurations){if(_.itemType==="Area"){if(S.type==="area"&&(_.ids.includes(S.areaId)||_.ids.includes("ALL_AREAS")))return{matched:!0,scope:_.scope==="EveryAreaLead"?"Area leads":"Area"};if(S.type==="checkpoint"){const E=n.locations.find(Z=>Z.id===S.locationId)?.areaIds||[];if(_.ids.includes("ALL_AREAS")||E.some(Z=>_.ids.includes(Z)))return{matched:!0,scope:_.scope==="EveryAreaLead"?"Area leads":"Area"}}}if(_.itemType==="Checkpoint"){if(S.type==="checkpoint"&&(_.ids.includes(S.locationId)||_.ids.includes("ALL_CHECKPOINTS")))return{matched:!0,scope:"Checkpoint"};if(S.type==="area"&&S.checkpointIds.some(E=>_.ids.includes(E)||_.ids.includes("ALL_CHECKPOINTS")))return{matched:!0,scope:"Checkpoint in area"}}if(_.itemType==="Marshal"){if(S.type==="marshal"&&(_.ids.includes(S.marshalId)||_.ids.includes("ALL_MARSHALS")))return{matched:!0,scope:"Marshal"};if(S.type==="checkpoint"){const D=n.assignments.filter(Z=>Z.locationId===S.locationId).map(Z=>Z.marshalId);if(_.ids.includes("ALL_MARSHALS")||D.some(Z=>_.ids.includes(Z)))return{matched:!0,scope:"Marshal at checkpoint"}}if(S.type==="area"&&(_.ids.includes("ALL_MARSHALS")||S.marshalIds.some(E=>_.ids.includes(E))))return{matched:!0,scope:"Marshal in area"}}if(S.type==="marshal"&&S.checkpointIds&&S.areaIds){if(_.itemType==="Checkpoint"&&(_.ids.includes("ALL_CHECKPOINTS")||S.checkpointIds.some(E=>_.ids.includes(E))))return{matched:!0,scope:"Assigned checkpoint"};if(_.itemType==="Area"&&(_.ids.includes("ALL_AREAS")||S.areaIds.some(E=>_.ids.includes(E))))return{matched:!0,scope:_.scope==="EveryAreaLead"?"Area lead":"Area"}}}return null},b=z(()=>{const x=n.allNotes||a.value;if(!x||x.length===0)return[];if(n.areaId&&n.allNotes){const S={type:"area",areaId:n.areaId,checkpointIds:d.value,marshalIds:h.value},_=[],D=new Set;for(const E of x){if(D.has(E.noteId))continue;const Z=y(E,S);Z&&(D.add(E.noteId),_.push({...E,matchedScope:Z.scope}))}return _}if(n.locationId&&n.allNotes){const S={type:"checkpoint",locationId:n.locationId},_=[],D=new Set;for(const E of x){if(D.has(E.noteId))continue;const Z=y(E,S);Z&&(D.add(E.noteId),_.push({...E,matchedScope:Z.scope}))}return _}if(n.marshalId&&n.allNotes){const S=p(n.marshalId),_=g(n.marshalId),D={type:"marshal",marshalId:n.marshalId,checkpointIds:S,areaIds:_},E=[],Z=new Set;for(const A of x){if(Z.has(A.noteId))continue;const N=y(A,D);N&&(Z.add(A.noteId),E.push({...A,matchedScope:N.scope}))}return E}return x}),C=z(()=>{const x={Emergency:0,Urgent:1,High:2,Normal:3,Low:4};return[...b.value].sort((S,_)=>{if(S.isPinned!==_.isPinned)return S.isPinned?-1:1;const D=x[S.priority]??2,E=x[_.priority]??2;return D!==E?D-E:S.displayOrder!==_.displayOrder?S.displayOrder-_.displayOrder:new Date(_.createdAt)-new Date(S.createdAt)})}),I=async()=>{if(n.allNotes===null&&n.eventId){s.value=!0,i.value=null;try{let x;n.marshalId?x=await gs.getMarshalNotes(n.eventId,n.marshalId):x=await gs.getByEvent(n.eventId),a.value=x.data||[]}catch(x){console.error("Failed to load notes:",x),i.value=x.response?.data?.message||"Failed to load notes"}finally{s.value=!1}}};qe(()=>[n.eventId,n.locationId,n.areaId,n.marshalId],()=>{n.allNotes===null&&I()},{immediate:!0});const M=x=>{if(!x)return"";const S=new Date(x),D=new Date-S,E=Math.floor(D/6e4),Z=Math.floor(D/36e5),A=Math.floor(D/864e5);return E<1?"just now":E<60?`${E}m ago`:Z<24?`${Z}h ago`:A<7?`${A}d ago`:S.toLocaleDateString()};return t({loadNotes:I}),(x,S)=>(v(),m("div",VE,[s.value?(v(),m("div",GE," Loading notes... ")):i.value?(v(),m("div",jE,[r("p",null,w(i.value),1),r("button",{onClick:I,class:"btn btn-secondary btn-small"}," Retry ")])):b.value.length===0?(v(),m("div",ZE,[r("p",null,w(l.value),1)])):(v(),m("div",qE,[(v(!0),m(Te,null,Fe(C.value,_=>(v(),m("div",{key:_.noteId,class:pe(["note-item",{pinned:_.isPinned}])},[r("div",WE,[r("div",KE,[_.isPinned?(v(),m("span",JE,"")):P("",!0),r("span",{class:pe(["priority-indicator",(_.priority||"Normal").toLowerCase()])},null,2),r("strong",YE,w(_.title),1)]),r("div",XE,[_.category?(v(),m("span",QE,w(_.category),1)):P("",!0),r("span",{class:pe(["priority-badge",(_.priority||"Normal").toLowerCase()])},w(_.priority||"Normal"),3)])]),_.content?(v(),m("div",e4,w(_.content),1)):P("",!0),r("div",t4,[r("span",n4," Created by "+w(_.createdByName||"Unknown")+"  "+w(M(_.createdAt)),1),_.scopeConfigurations?.length&&e.showScope?(v(),Ze(Ql,{key:0,class:"scope-pills","scope-configurations":_.scopeConfigurations,areas:e.areas,locations:e.locations,marshals:e.marshals,"max-expanded-items":3},null,8,["scope-configurations","areas","locations","marshals"])):_.matchedScope&&e.showScope?(v(),m("span",o4,w(_.matchedScope),1)):P("",!0)])],2))),128))]))]))}},Lc=Ge(s4,[["__scopeId","data-v-9887fcb2"]]),a4={class:"checklist-preview"},i4={class:"preview-actions"},l4={class:"preview-header"},r4={key:0,class:"add-item-form"},c4=["placeholder"],u4=["disabled"],d4={key:1,class:"pending-items"},h4={class:"item-content"},f4={class:"item-header"},p4={class:"item-text"},v4={class:"item-scope"},m4=["onClick"],g4={key:2,class:"empty-state"},y4={key:0,class:"help-text"},k4={key:3,class:"checklist-items"},b4={class:"item-content"},_4={class:"item-header"},w4={class:"item-text"},C4={class:"item-scope"},L4=["title"],S4={key:0,class:"item-context"},I4={__name:"ChecklistPreviewForLocation",props:{allChecklistItems:{type:Array,default:()=>[]},pendingAreaIds:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1},checkpointTermSingular:{type:String,default:""}},emits:["update:modelValue","change"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=e,i=z(()=>s.checkpointTermSingular?s.checkpointTermSingular.toLowerCase():a.value.checkpoint),l=t,u=T(!1),d=T(""),h=T([...s.modelValue]);qe(()=>s.modelValue,_=>{h.value=[..._]},{deep:!0});const p=()=>{d.value.trim()&&(h.value.push({text:d.value.trim(),isNew:!0}),d.value="",u.value=!1,y())},g=_=>{h.value.splice(_,1),y()},y=()=>{l("update:modelValue",[...h.value]),l("change")},b=_=>{const D=_.scope,E=_.itemType,Z=_.ids||[];return(D==="EveryoneAtCheckpoints"||D==="OnePerCheckpoint")&&E==="Checkpoint"?Z.includes("ALL_CHECKPOINTS"):D==="OnePerCheckpoint"&&E==="Area"?Z.includes("ALL_AREAS")?!0:Z.some(A=>s.pendingAreaIds.includes(A)):(D==="EveryoneInAreas"||D==="OnePerArea"||D==="EveryAreaLead"||D==="OneLeadPerArea")&&E==="Area"?Z.includes("ALL_AREAS")?!0:Z.some(A=>s.pendingAreaIds.includes(A)):!1},C=z(()=>s.allChecklistItems.filter(_=>_.scopeConfigurations&&_.scopeConfigurations.length>0?_.scopeConfigurations.some(D=>b(D)):!1)),I=_=>({EveryoneAtCheckpoints:`All at ${a.value.checkpoints}`,OnePerCheckpoint:`One per ${a.value.checkpoint}`,EveryoneInAreas:`All in ${a.value.areas}`,OnePerArea:`One per ${a.value.area}`,EveryAreaLead:`${a.value.area} leads`,OneLeadPerArea:`One lead per ${a.value.area}`})[_]||_,M=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return"Unknown";const D=_.scopeConfigurations.find(Z=>b(Z));if(!D)return I(_.scopeConfigurations[0].scope);const E=D.ids||[];return E.includes("ALL_CHECKPOINTS")?`All ${a.value.checkpoints}`:E.includes("ALL_AREAS")?`All ${a.value.areas}`:I(D.scope)},x=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return"";const D=_.scopeConfigurations.find(Z=>b(Z));return D&&{EveryoneAtCheckpoints:`This item is for everyone at specified ${a.value.checkpoints}`,OnePerCheckpoint:`One person at each ${a.value.checkpoint} needs to complete this`,EveryoneInAreas:`This item is for everyone in specified ${a.value.areas}`,OnePerArea:`One person in each ${a.value.area} needs to complete this`,EveryAreaLead:`This item is for ${a.value.area} leads only`,OneLeadPerArea:`One ${a.value.area} lead needs to complete this`}[D.scope]||""},S=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return null;const D=_.scopeConfigurations.find(A=>b(A));if(!D)return null;const E=D.itemType,Z=D.ids||[];if(Z.includes("ALL_CHECKPOINTS")||Z.includes("ALL_AREAS"))return null;if(E==="Area"){const A=s.areas.filter(N=>Z.includes(N.id)&&s.pendingAreaIds.includes(N.id)).map(N=>N.name);if(A.length>0)return`In: ${A.join(", ")}`}return null};return(_,D)=>(v(),m("div",a4,[r("div",i4,[r("p",l4,w(e.isEditing?`Add new ${O(a).checklist} for this ${i.value}:`:`${O(n).checklists} that will apply at this ${i.value}:`),1),r("button",{type:"button",class:"add-item-btn",onClick:D[0]||(D[0]=E=>u.value=!u.value)},w(u.value?"Cancel":`Add ${O(a).checklist}`),1)]),u.value?(v(),m("div",r4,[ze(r("input",{"onUpdate:modelValue":D[1]||(D[1]=E=>d.value=E),type:"text",placeholder:`Enter ${O(a).checklist} text...`,class:"add-item-input",onKeyup:Yo(p,["enter"])},null,40,c4),[[nt,d.value]]),r("button",{type:"button",class:"save-item-btn",disabled:!d.value.trim(),onClick:p}," Add ",8,u4)])):P("",!0),h.value.length>0?(v(),m("div",d4,[(v(!0),m(Te,null,Fe(h.value,(E,Z)=>(v(),m("div",{key:`pending-${Z}`,class:"checklist-item pending"},[D[3]||(D[3]=r("div",{class:"item-checkbox"},[r("input",{type:"checkbox",checked:!1,disabled:""})],-1)),r("div",h4,[r("div",f4,[r("div",p4,w(E.text),1),r("div",v4,[D[2]||(D[2]=r("span",{class:"scope-pill new-pill",title:"Will be created when saved"}," New ",-1)),r("button",{type:"button",class:"remove-item-btn",onClick:A=>g(Z),title:"Remove"},"  ",8,m4)])])])]))),128))])):P("",!0),!e.isEditing&&C.value.length===0&&h.value.length===0?(v(),m("div",g4,[r("p",null,"No "+w(O(a).checklists)+" will apply based on the current "+w(O(a).area)+" assignments.",1),e.pendingAreaIds.length===0?(v(),m("p",y4," Assign "+w(O(a).areas)+" to see relevant "+w(O(a).checklists)+". ",1)):P("",!0)])):P("",!0),!e.isEditing&&C.value.length>0?(v(),m("div",k4,[(v(!0),m(Te,null,Fe(C.value,E=>(v(),m("div",{key:E.id,class:"checklist-item"},[D[4]||(D[4]=r("div",{class:"item-checkbox"},[r("input",{type:"checkbox",checked:!1,disabled:""})],-1)),r("div",b4,[r("div",_4,[r("div",w4,w(E.text),1),r("div",C4,[r("span",{class:"scope-pill",title:x(E)},w(M(E)),9,L4)])]),S(E)?(v(),m("div",S4,w(S(E)),1)):P("",!0)])]))),128))])):P("",!0)]))}},x4=Ge(I4,[["__scopeId","data-v-7d943b21"]]),$4={class:"notes-preview"},T4={class:"preview-actions"},M4={class:"preview-header"},A4={key:0,class:"add-item-form"},E4={class:"add-form-fields"},P4=["disabled"],D4={key:1,class:"pending-items"},O4={class:"note-header"},R4={class:"note-title"},B4={class:"note-actions"},N4=["onClick"],F4={key:0,class:"note-content"},U4={key:2,class:"empty-state"},z4={key:0,class:"help-text"},H4={key:3,class:"notes-list"},V4={class:"note-header"},G4={class:"note-title"},j4=["title"],Z4={key:0,class:"note-content"},q4={key:1,class:"note-context"},W4={__name:"NotesPreviewForLocation",props:{allNotes:{type:Array,default:()=>[]},pendingAreaIds:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1},checkpointTermSingular:{type:String,default:""}},emits:["update:modelValue","change"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=z(()=>a.checkpointTermSingular?a.checkpointTermSingular.toLowerCase():n.value.checkpoint),l=T(!1),u=T(""),d=T(""),h=T([...a.modelValue]);qe(()=>a.modelValue,_=>{h.value=[..._]},{deep:!0});const p=()=>{!u.value.trim()&&!d.value.trim()||(h.value.push({title:u.value.trim(),content:d.value.trim(),isNew:!0}),u.value="",d.value="",l.value=!1,y())},g=_=>{h.value.splice(_,1),y()},y=()=>{s("update:modelValue",[...h.value]),s("change")},b=_=>{const D=_.scope,E=_.itemType,Z=_.ids||[];return D==="EveryoneAtCheckpoints"&&E==="Checkpoint"?Z.includes("ALL_CHECKPOINTS"):D==="EveryoneInAreas"&&E==="Area"?Z.includes("ALL_AREAS")?!0:Z.some(A=>a.pendingAreaIds.includes(A)):!1},C=z(()=>a.allNotes.filter(_=>_.scopeConfigurations&&_.scopeConfigurations.length>0?_.scopeConfigurations.some(D=>b(D)):!1)),I=_=>({EveryoneAtCheckpoints:`All at ${n.value.checkpoints}`,EveryoneInAreas:`All in ${n.value.areas}`})[_]||_,M=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return"Unknown";const D=_.scopeConfigurations.find(Z=>b(Z));if(!D)return I(_.scopeConfigurations[0].scope);const E=D.ids||[];return E.includes("ALL_CHECKPOINTS")?`All ${n.value.checkpoints}`:E.includes("ALL_AREAS")?`All ${n.value.areas}`:I(D.scope)},x=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return"";const D=_.scopeConfigurations.find(Z=>b(Z));return D&&{EveryoneAtCheckpoints:`This note is for everyone at specified ${n.value.checkpoints}`,EveryoneInAreas:`This note is for everyone in specified ${n.value.areas}`}[D.scope]||""},S=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return null;const D=_.scopeConfigurations.find(A=>b(A));if(!D)return null;const E=D.itemType,Z=D.ids||[];if(Z.includes("ALL_CHECKPOINTS")||Z.includes("ALL_AREAS"))return null;if(E==="Area"){const A=a.areas.filter(N=>Z.includes(N.id)&&a.pendingAreaIds.includes(N.id)).map(N=>N.name);if(A.length>0)return`In: ${A.join(", ")}`}return null};return(_,D)=>(v(),m("div",$4,[r("div",T4,[r("p",M4,w(e.isEditing?`Add new note for this ${i.value}:`:`Notes that will be visible at this ${i.value}:`),1),r("button",{type:"button",class:"add-item-btn",onClick:D[0]||(D[0]=E=>l.value=!l.value)},w(l.value?"Cancel":"Add note"),1)]),l.value?(v(),m("div",A4,[r("div",E4,[ze(r("input",{"onUpdate:modelValue":D[1]||(D[1]=E=>u.value=E),type:"text",placeholder:"Note title...",class:"add-item-input title-input"},null,512),[[nt,u.value]]),ze(r("textarea",{"onUpdate:modelValue":D[2]||(D[2]=E=>d.value=E),placeholder:"Note content...",class:"add-item-input content-input",rows:"3"},null,512),[[nt,d.value]])]),r("button",{type:"button",class:"save-item-btn",disabled:!u.value.trim()&&!d.value.trim(),onClick:p}," Add ",8,P4)])):P("",!0),h.value.length>0?(v(),m("div",D4,[(v(!0),m(Te,null,Fe(h.value,(E,Z)=>(v(),m("div",{key:`pending-${Z}`,class:"note-item pending"},[r("div",O4,[r("span",R4,w(E.title||"Untitled"),1),r("div",B4,[D[3]||(D[3]=r("span",{class:"scope-pill new-pill",title:"Will be created when saved"}," New ",-1)),r("button",{type:"button",class:"remove-item-btn",onClick:A=>g(Z),title:"Remove"},"  ",8,N4)])]),E.content?(v(),m("div",F4,w(E.content),1)):P("",!0)]))),128))])):P("",!0),!e.isEditing&&C.value.length===0&&h.value.length===0?(v(),m("div",U4,[r("p",null,"No notes will apply based on the current "+w(O(n).area)+" assignments.",1),e.pendingAreaIds.length===0?(v(),m("p",z4," Assign "+w(O(n).areas)+" to see relevant notes. ",1)):P("",!0)])):P("",!0),!e.isEditing&&C.value.length>0?(v(),m("div",H4,[(v(!0),m(Te,null,Fe(C.value,E=>(v(),m("div",{key:E.id,class:"note-item"},[r("div",V4,[r("span",G4,w(E.title||"Untitled"),1),r("span",{class:"scope-pill",title:x(E)},w(M(E)),9,j4)]),E.content?(v(),m("div",Z4,w(E.content),1)):P("",!0),S(E)?(v(),m("div",q4,w(S(E)),1)):P("",!0)]))),128))])):P("",!0)]))}},K4=Ge(W4,[["__scopeId","data-v-71646c3f"]]),J4={class:"base-modal-title modal-title-with-icon"},Y4=["innerHTML"],X4={key:7,class:"tab-content appearance-tab"},Q4={class:"accordion-item"},e3=["innerHTML"],t3={class:"accordion-title"},n3={class:"accordion-arrow"},o3={key:0,class:"accordion-content"},s3={class:"section-description"},a3={class:"accordion-item"},i3={class:"accordion-preview"},l3={class:"accordion-arrow"},r3={key:0,class:"accordion-content"},c3={class:"section-description"},u3={class:"terminology-row"},d3={class:"terminology-field"},h3=["value"],f3={value:""},p3=["value"],v3={class:"terminology-field"},m3=["value"],g3={value:""},y3=["value"],k3={key:8,class:"tab-content incidents-tab"},b3={class:"incidents-list"},_3={class:"custom-footer"},w3={class:"footer-left"},kf="edit_location_accordion",C3={__name:"EditLocationModal",props:{show:{type:Boolean,default:!1},location:{type:Object,default:null},assignments:{type:Array,default:()=>[]},isDirty:{type:Boolean,default:!1},eventDate:{type:String,default:""},areas:{type:Array,default:()=>[]},eventId:{type:String,required:!0},allLocations:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},availableMarshals:{type:Array,default:()=>[]},allMarshals:{type:Array,default:()=>[]},allChecklistItems:{type:Array,default:()=>[]},eventDefaultStyleType:{type:String,default:"default"},eventDefaultStyleColor:{type:String,default:""},eventDefaultStyleBackgroundShape:{type:String,default:""},eventDefaultStyleBackgroundColor:{type:String,default:""},eventDefaultStyleBorderColor:{type:String,default:""},eventDefaultStyleIconColor:{type:String,default:""},eventDefaultStyleSize:{type:String,default:""},eventDefaultStyleMapRotation:{type:[String,Number],default:""},eventPeopleTerm:{type:String,default:"Marshals"},zIndex:{type:Number,default:1e3},incidents:{type:Array,default:()=>[]},lockedFromMarshal:{type:Boolean,default:!1}},emits:["close","save","delete","move-location","toggle-check-in","remove-assignment","open-assign-modal","update:isDirty","select-incident","select-marshal"],setup(e,{emit:t}){const{terms:n}=rt(),a=e,s=t,i=T("details"),l=T(!1),u=T(null),d=T(null),h=T([]),p=T([]),g=T([]),y=T({id:null,name:"",description:"",what3Words:"",latitude:0,longitude:0,requiredMarshals:1,useCustomTimes:!1,startTime:"",endTime:"",areaIds:[],styleType:"default",styleColor:"",styleBackgroundShape:"",styleBackgroundColor:"",styleBorderColor:"",styleIconColor:"",styleSize:"",styleMapRotation:"",peopleTerm:"",checkpointTerm:"",isDynamic:!1,locationUpdateScopeConfigurations:[]}),b=T(!1),C=T(null),I=fe=>{C.value=fe,b.value=!0},M=()=>{b.value=!1,C.value=null},x=z(()=>C.value&&C.value.marshalName||""),S=z(()=>y.value.name||a.location?.name||""),_=z(()=>{if(!C.value)return null;const{checkInLatitude:fe,checkInLongitude:q}=C.value;return!fe||!q?null:{lat:fe,lng:q}}),D=z(()=>{const fe=y.value.latitude,q=y.value.longitude;return!fe||!q?null:{lat:fe,lng:q}}),E=z(()=>{if(!C.value)return null;const{checkInLatitude:fe,checkInLongitude:q}=C.value,W=y.value.latitude,ie=y.value.longitude;return!fe||!q||!W||!ie?null:hi(fe,q,W,ie)}),Z=()=>a.eventId?`${kf}_${a.eventId}`:kf,A=T({iconStyle:!1,terminology:!1});tn(()=>{const fe=localStorage.getItem(Z());if(fe)try{const q=JSON.parse(fe);A.value={...A.value,...q}}catch{}});const N=fe=>{A.value[fe]=!A.value[fe],localStorage.setItem(Z(),JSON.stringify(A.value))},B=z(()=>{const fe=y.value.areaIds||[];if(fe.length>0){const q=a.areas.filter(W=>fe.includes(W.id)&&W.peopleTerm).sort((W,ie)=>(W.checkpointCount||0)-(ie.checkpointCount||0));if(q.length>0)return q[0].peopleTerm}return a.eventPeopleTerm||"Marshals"}),j=z(()=>y.value.peopleTerm?y.value.peopleTerm:B.value),R=z(()=>{const fe=y.value.areaIds||[];if(fe.length>0){const q=a.areas.filter(W=>fe.includes(W.id)&&W.checkpointTerm).sort((W,ie)=>(W.checkpointCount||0)-(ie.checkpointCount||0));if(q.length>0)return q[0].checkpointTerm}return n.value.checkpoint});z(()=>R.value.toLowerCase());const G=z(()=>{const fe=y.value.checkpointTerm||a.location?.checkpointTerm||a.location?.CheckpointTerm;if(fe)return ti("checkpoint",fe,j.value);const q=y.value.areaIds||[];let W=null;if(q.length>0){const ie=a.areas.filter(Ue=>q.includes(Ue.id)&&Ue.checkpointTerm).sort((Ue,et)=>(Ue.checkpointCount||0)-(et.checkpointCount||0));ie.length>0&&(W=ie[0].checkpointTerm)}return W?ti("checkpoint",W,j.value):n.value.checkpoint}),ee=z(()=>G.value.toLowerCase()),ne=z(()=>{const fe=j.value;return ti("people",fe)});z(()=>ne.value.toLowerCase());const Ae=z(()=>n.value.area);z(()=>Ae.value.toLowerCase());const J=z(()=>n.value.area),te=z(()=>J.value.toLowerCase()),U=z(()=>n.value.areas),X=z(()=>!!(a.location&&a.location.id)),re=z(()=>X.value?`Edit ${ee.value}: ${a.location?.name||""}`:`Add ${ee.value}`),ke=z(()=>{const fe=[{value:"details",label:"Details",icon:"details"},{value:"location",label:"Location",icon:"location"},{value:"marshals",label:j.value,icon:"marshal"},{value:"checklists",label:n.value.checklists,icon:"checklist"},{value:"notes",label:"Notes",icon:"notes"},{value:"appearance",label:"Appearance",icon:"appearance"}];return a.incidents&&a.incidents.length>0&&fe.push({value:"incidents",label:"Incidents",icon:"incidents"}),fe}),Re=z(()=>ke.value.findIndex(fe=>fe.value===i.value)),Xe=z(()=>Re.value===ke.value.length-1),Ne=z(()=>{const fe=y.value.areaIds||[],q=a.areas.filter(ht=>fe.includes(ht.id)).sort((ht,on)=>(ht.checkpointCount||0)-(on.checkpointCount||0)),W=(ht,on)=>{for(const dn of q){const Et=ht(dn);if(Et&&Et!=="default")return{value:Et,source:"area"}}return on&&on!=="default"?{value:on,source:"event"}:{value:"",source:"none"}},ie=W(ht=>ht.checkpointStyleType||ht.CheckpointStyleType,a.eventDefaultStyleType),Ue=W(ht=>ht.checkpointStyleColor||ht.CheckpointStyleColor,a.eventDefaultStyleColor),et=W(ht=>ht.checkpointStyleBackgroundShape||ht.CheckpointStyleBackgroundShape,a.eventDefaultStyleBackgroundShape),dt=W(ht=>ht.checkpointStyleBackgroundColor||ht.CheckpointStyleBackgroundColor||ht.checkpointStyleColor||ht.CheckpointStyleColor,a.eventDefaultStyleBackgroundColor||a.eventDefaultStyleColor),yt=W(ht=>ht.checkpointStyleBorderColor||ht.CheckpointStyleBorderColor,a.eventDefaultStyleBorderColor),mt=W(ht=>ht.checkpointStyleIconColor||ht.CheckpointStyleIconColor,a.eventDefaultStyleIconColor),St=W(ht=>ht.checkpointStyleSize||ht.CheckpointStyleSize,a.eventDefaultStyleSize),Ct=W(ht=>ht.checkpointStyleMapRotation??ht.CheckpointStyleMapRotation,a.eventDefaultStyleMapRotation),Ft=[ie,et,dt,yt,mt,St,Ct].some(ht=>ht.source==="area");return{type:ie.value||"default",color:Ue.value,backgroundShape:et.value,backgroundColor:dt.value,borderColor:yt.value,iconColor:mt.value,size:St.value,mapRotation:Ct.value,source:Ft?"area":ie.value?"event":"none"}}),Ke=z(()=>Ne.value.source==="area"?`${J.value} default`:"Event default"),We=z(()=>{const fe=y.value.styleType&&y.value.styleType!=="default"&&y.value.styleType!=="custom"?y.value.styleType:Ne.value.type,q=y.value.styleBackgroundShape||Ne.value.backgroundShape||"circle",W=y.value.styleBackgroundColor||Ne.value.backgroundColor||"#667eea",ie=y.value.styleBorderColor||Ne.value.borderColor||"#ffffff",Ue=y.value.styleIconColor||Ne.value.iconColor||"#ffffff";return In({type:fe||"circle",backgroundShape:q,backgroundColor:W,borderColor:ie,iconColor:Ue,size:"100"})}),Q=z(()=>{let fe,q,W,ie,Ue;return X.value&&a.location?(fe=a.location.resolvedStyleType||a.location.ResolvedStyleType,q=a.location.resolvedStyleBackgroundShape||a.location.ResolvedStyleBackgroundShape||"circle",W=a.location.resolvedStyleBackgroundColor||a.location.ResolvedStyleBackgroundColor||a.location.resolvedStyleColor||a.location.ResolvedStyleColor||"#667eea",ie=a.location.resolvedStyleBorderColor||a.location.ResolvedStyleBorderColor||"#ffffff",Ue=a.location.resolvedStyleIconColor||a.location.ResolvedStyleIconColor||"#ffffff"):(fe=y.value.styleType&&y.value.styleType!=="default"&&y.value.styleType!=="custom"?y.value.styleType:Ne.value.type,q=y.value.styleBackgroundShape||Ne.value.backgroundShape||"circle",W=y.value.styleBackgroundColor||Ne.value.backgroundColor||"#667eea",ie=y.value.styleBorderColor||Ne.value.borderColor||"#ffffff",Ue=y.value.styleIconColor||Ne.value.iconColor||"#ffffff"),In({type:fe||"circle",backgroundShape:q,backgroundColor:W,borderColor:ie,iconColor:Ue,size:"100",outputSize:28})}),ge=z(()=>{const fe=!!y.value.checkpointTerm,q=!!y.value.peopleTerm;return fe&&q?`${ti("checkpoint",y.value.checkpointTerm,y.value.peopleTerm)}, ${y.value.peopleTerm}`:fe?ti("checkpoint",y.value.checkpointTerm,j.value):q?y.value.peopleTerm:"Using defaults"}),Ce=z(()=>Xe.value?null:ke.value[Re.value+1]),ve=z(()=>Ce.value?`${Ce.value.label}...`:""),ue=T(!1),F=T(null);qe(()=>a.location,fe=>{if(fe){const q=fe.id||"new";if(F.value!==q){F.value=q,ue.value=!0;let W="",ie="";fe.startTime&&(W=Gl(fe.startTime)),fe.endTime&&(ie=Gl(fe.endTime)),y.value={id:fe.id||null,name:fe.name||"",description:fe.description||"",what3Words:fe.what3Words||"",latitude:fe.latitude||0,longitude:fe.longitude||0,requiredMarshals:fe.requiredMarshals||1,useCustomTimes:!!(fe.startTime||fe.endTime),startTime:W,endTime:ie,areaIds:fe.areaIds||fe.AreaIds||[],styleType:fe.styleType||fe.StyleType||"default",styleColor:fe.styleColor||fe.StyleColor||"",styleBackgroundShape:fe.styleBackgroundShape||fe.StyleBackgroundShape||"",styleBackgroundColor:fe.styleBackgroundColor||fe.StyleBackgroundColor||"",styleBorderColor:fe.styleBorderColor||fe.StyleBorderColor||"",styleIconColor:fe.styleIconColor||fe.StyleIconColor||"",styleSize:fe.styleSize||fe.StyleSize||"",styleMapRotation:fe.styleMapRotation??fe.StyleMapRotation??"",peopleTerm:fe.peopleTerm||"",checkpointTerm:fe.checkpointTerm||"",isDynamic:fe.isDynamic||!1,locationUpdateScopeConfigurations:fe.locationUpdateScopeConfigurations||[]}}}},{immediate:!0,deep:!0}),qe(()=>a.show,fe=>{fe?(i.value="details",l.value=!1,h.value=[],p.value=[],g.value=[],u.value?.clearPendingChanges&&u.value.clearPendingChanges(),d.value?.resetLocalState&&d.value.resetLocalState()):(F.value=null,ue.value=!1)});const K=fe=>{y.value=fe},ae=()=>{s("update:isDirty",!0)},$e=()=>{l.value=!l.value,s("move-location",{isMoving:l.value,formData:{...y.value}})},Be=fe=>{h.value=fe,ae()},Oe=()=>{Ce.value&&(i.value=Ce.value.value)},Le=()=>{const fe={...y.value,startTime:y.value.useCustomTimes&&y.value.startTime?new Date(y.value.startTime).toISOString():null,endTime:y.value.useCustomTimes&&y.value.endTime?new Date(y.value.endTime).toISOString():null,checkInChanges:u.value?.getPendingChanges?.()||[],assignmentsToRemove:u.value?.getMarkedForRemoval?.()||[],checklistChanges:h.value||[],pendingAssignments:a.assignments.filter(q=>q.isPending).map(q=>({marshalId:q.marshalId})),pendingNewChecklistItems:p.value,pendingNewNotes:g.value};s("save",fe)},Y=()=>{a.location&&a.location.id&&s("delete",a.location.id)},he=fe=>{s("remove-assignment",fe)},xe=()=>{s("open-assign-modal")},Ie=fe=>{s("select-marshal",fe)},be=()=>{s("close")},de=(fe,q)=>{y.value[fe]=q,ae()};return(fe,q)=>(v(),Ze(jt,{show:e.show,size:"large","confirm-on-close":!0,"is-dirty":e.isDirty,"z-index":e.zIndex,onClose:be},{header:He(()=>[r("h2",J4,[Q.value?(v(),m("span",{key:0,class:"modal-title-icon",innerHTML:Q.value},null,8,Y4)):P("",!0),Ye(" "+w(re.value),1)])]),"tab-header":He(()=>[Me(Yi,{modelValue:i.value,"onUpdate:modelValue":q[0]||(q[0]=W=>i.value=W),tabs:ke.value},null,8,["modelValue","tabs"])]),footer:He(()=>[r("div",_3,[r("div",w3,[X.value&&!e.lockedFromMarshal?(v(),m("button",{key:0,type:"button",onClick:Y,class:"btn btn-danger"}," Delete ")):P("",!0),!X.value&&!Xe.value?(v(),m("button",{key:1,type:"button",onClick:Oe,class:"btn btn-secondary mobile-only"},w(ve.value),1)):P("",!0)]),r("button",{type:"button",onClick:Le,class:"btn btn-success"}," Save ")])]),default:He(()=>[i.value==="details"?(v(),Ze(PM,{key:0,form:y.value,areas:e.areas,"event-date":e.eventDate,"area-term-singular":J.value,"area-term-plural":U.value,"checkpoint-term-singular":G.value,"people-term-plural":j.value,"onUpdate:form":K,onInput:ae,onSave:Le},null,8,["form","areas","event-date","area-term-singular","area-term-plural","checkpoint-term-singular","people-term-plural"])):P("",!0),i.value==="location"?(v(),Ze(FA,{key:1,form:y.value,"is-moving":l.value,"checkpoint-term-singular":G.value,"people-term-plural":j.value,areas:e.areas,locations:e.allLocations,marshals:e.allMarshals,"is-editing":X.value,"onUpdate:form":K,onInput:ae,onSave:Le,onMoveLocation:$e},null,8,["form","is-moving","checkpoint-term-singular","people-term-plural","areas","locations","marshals","is-editing"])):P("",!0),i.value==="marshals"?(v(),Ze(uE,{key:2,ref_key:"assignmentsTabRef",ref:u,form:y.value,assignments:e.assignments,"people-term":j.value,"person-term":ne.value,"checkpoint-term":G.value,"read-only":e.lockedFromMarshal,"onUpdate:form":K,onInput:ae,onRemoveAssignment:he,onOpenAssignModal:xe,onSelectMarshal:Ie,onDistanceClick:I},null,8,["form","assignments","people-term","person-term","checkpoint-term","read-only"])):P("",!0),i.value==="checklists"&&X.value?(v(),Ze(um,{key:3,ref_key:"checklistTabRef",ref:d,modelValue:h.value,"onUpdate:modelValue":q[1]||(q[1]=W=>h.value=W),"event-id":e.eventId,"location-id":e.location.id,locations:e.allLocations,areas:e.areas,assignments:e.assignments,marshals:e.allMarshals,onChange:Be},null,8,["modelValue","event-id","location-id","locations","areas","assignments","marshals"])):P("",!0),i.value==="checklists"?(v(),Ze(x4,{key:4,modelValue:p.value,"onUpdate:modelValue":q[2]||(q[2]=W=>p.value=W),"all-checklist-items":e.allChecklistItems,"pending-area-ids":y.value.areaIds,areas:e.areas,"is-editing":X.value,"checkpoint-term-singular":G.value,onChange:ae},null,8,["modelValue","all-checklist-items","pending-area-ids","areas","is-editing","checkpoint-term-singular"])):P("",!0),i.value==="notes"&&X.value?(v(),Ze(Lc,{key:5,"event-id":e.eventId,"location-id":e.location?.id,"all-notes":e.notes,locations:e.allLocations,areas:e.areas,assignments:e.assignments,marshals:e.allMarshals},null,8,["event-id","location-id","all-notes","locations","areas","assignments","marshals"])):P("",!0),i.value==="notes"?(v(),Ze(K4,{key:6,modelValue:g.value,"onUpdate:modelValue":q[3]||(q[3]=W=>g.value=W),"all-notes":e.notes,"pending-area-ids":y.value.areaIds,areas:e.areas,"is-editing":X.value,"checkpoint-term-singular":G.value,onChange:ae},null,8,["modelValue","all-notes","pending-area-ids","areas","is-editing","checkpoint-term-singular"])):P("",!0),i.value==="appearance"?(v(),m("div",X4,[r("div",Q4,[r("button",{type:"button",class:pe(["accordion-header",{expanded:A.value.iconStyle}]),onClick:q[4]||(q[4]=W=>N("iconStyle"))},[r("div",{class:"accordion-icon",innerHTML:We.value},null,8,e3),r("span",t3,w(G.value)+" marker style",1),r("span",n3,w(A.value.iconStyle?"":""),1)],2),A.value.iconStyle?(v(),m("div",o3,[r("p",s3," Choose a custom icon for this "+w(ee.value)+", or leave as Default to inherit from "+w(te.value)+" or event settings. ",1),Me(pd,{"style-type":y.value.styleType||"default","style-color":y.value.styleColor||"","style-background-shape":y.value.styleBackgroundShape||"","style-background-color":y.value.styleBackgroundColor||"","style-border-color":y.value.styleBorderColor||"","style-icon-color":y.value.styleIconColor||"","style-size":y.value.styleSize||"","style-map-rotation":y.value.styleMapRotation??"","inherited-style-type":Ne.value.type,"inherited-style-color":Ne.value.color,"inherited-background-shape":Ne.value.backgroundShape||"","inherited-background-color":Ne.value.backgroundColor||Ne.value.color||"","inherited-border-color":Ne.value.borderColor||"","inherited-icon-color":Ne.value.iconColor||"","inherited-size":Ne.value.size||"","inherited-map-rotation":Ne.value.mapRotation??"","default-label":Ke.value,"icon-label":"Marker style",level:"checkpoint","show-preview":!0,"onUpdate:styleType":q[5]||(q[5]=W=>de("styleType",W)),"onUpdate:styleColor":q[6]||(q[6]=W=>de("styleColor",W)),"onUpdate:styleBackgroundShape":q[7]||(q[7]=W=>de("styleBackgroundShape",W)),"onUpdate:styleBackgroundColor":q[8]||(q[8]=W=>de("styleBackgroundColor",W)),"onUpdate:styleBorderColor":q[9]||(q[9]=W=>de("styleBorderColor",W)),"onUpdate:styleIconColor":q[10]||(q[10]=W=>de("styleIconColor",W)),"onUpdate:styleSize":q[11]||(q[11]=W=>de("styleSize",W)),"onUpdate:styleMapRotation":q[12]||(q[12]=W=>de("styleMapRotation",W))},null,8,["style-type","style-color","style-background-shape","style-background-color","style-border-color","style-icon-color","style-size","style-map-rotation","inherited-style-type","inherited-style-color","inherited-background-shape","inherited-background-color","inherited-border-color","inherited-icon-color","inherited-size","inherited-map-rotation","default-label"])])):P("",!0)]),r("div",a3,[r("button",{type:"button",class:pe(["accordion-header",{expanded:A.value.terminology}]),onClick:q[13]||(q[13]=W=>N("terminology"))},[q[17]||(q[17]=r("div",{class:"accordion-icon"},[r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[r("circle",{cx:"9",cy:"8",r:"3",fill:"#6366F1"}),r("path",{d:"M3 18c0-3.3 2.7-6 6-6s6 2.7 6 6",fill:"#6366F1",opacity:"0.5"}),r("circle",{cx:"17",cy:"14",r:"5",fill:"#10B981",opacity:"0.3"}),r("circle",{cx:"17",cy:"14",r:"3",fill:"#10B981"}),r("circle",{cx:"17",cy:"14",r:"1",fill:"white"})])],-1)),q[18]||(q[18]=r("span",{class:"accordion-title"},"Terminology",-1)),r("span",i3,w(ge.value),1),r("span",l3,w(A.value.terminology?"":""),1)],2),A.value.terminology?(v(),m("div",r3,[r("p",c3," Customise what this "+w(ee.value)+" and its "+w(j.value.toLowerCase())+" are called. ",1),r("div",u3,[r("div",d3,[r("label",null,"What is this "+w(ee.value)+" called?",1),r("select",{value:y.value.checkpointTerm,class:"form-input",onChange:q[14]||(q[14]=W=>{K({...y.value,checkpointTerm:W.target.value}),ae()})},[r("option",f3,"Use "+w(te.value)+" default ("+w(G.value)+")",1),q[19]||(q[19]=r("option",{value:"Vehicle"},"Vehicle",-1)),q[20]||(q[20]=r("option",{value:"Car"},"Car",-1)),q[21]||(q[21]=r("option",{value:"Bike"},"Bike",-1)),(v(!0),m(Te,null,Fe(O(zs).checkpoint,W=>(v(),m("option",{key:W,value:W},w(W),9,p3))),128))],40,h3)]),r("div",v3,[r("label",null,"What are "+w(j.value.toLowerCase())+" called here?",1),r("select",{value:y.value.peopleTerm,class:"form-input",onChange:q[15]||(q[15]=W=>{K({...y.value,peopleTerm:W.target.value}),ae()})},[r("option",g3,"Use "+w(te.value)+" default ("+w(B.value)+")",1),(v(!0),m(Te,null,Fe(O(zs).people,W=>(v(),m("option",{key:W,value:W},w(W),9,y3))),128))],40,m3)])])])):P("",!0)])])):P("",!0),i.value==="incidents"?(v(),m("div",k3,[r("div",b3,[(v(!0),m(Te,null,Fe(e.incidents,W=>(v(),Ze(tr,{key:W.incidentId,incident:W,onSelect:q[16]||(q[16]=ie=>fe.$emit("select-incident",ie))},null,8,["incident"]))),128))])])):P("",!0),Me(fd,{show:b.value,"marshal-name":x.value,"checkpoint-name":S.value,"check-in-location":_.value,"checkpoint-location":D.value,distance:E.value,"z-index":e.zIndex+100,onClose:M},null,8,["show","marshal-name","checkpoint-name","check-in-location","checkpoint-location","distance","z-index"])]),_:1},8,["show","is-dirty","z-index"]))}},L3=Ge(C3,[["__scopeId","data-v-4058e569"]]),S3={class:"tab-content"},I3={key:0,class:"error-banner"},x3=["value"],$3={key:0,class:"field-error"},T3={class:"contact-row"},M3=["value"],A3={key:0,class:"field-error"},E3=["value"],P3={key:0,class:"field-error"},D3=["value"],O3={key:0,class:"field-error"},R3={key:1,class:"magic-link-section"},B3={key:0,class:"loading-text"},N3={key:1,class:"magic-link-container"},F3={class:"magic-link-row"},U3=["value"],z3={key:0,class:"error-text"},H3={key:1,class:"magic-link-actions"},V3=["disabled"],G3={key:2,class:"success-text"},j3={key:3,class:"error-text"},Z3={key:2,class:"error-text"},q3={__name:"MarshalDetailsTab",props:{form:{type:Object,required:!0},eventId:{type:String,default:null},marshalId:{type:String,default:null},validationErrors:{type:Object,default:()=>({})}},emits:["update:form","input"],setup(e,{expose:t,emit:n}){const a=e,s=n,i=T(null),l=T(null),u=T(null),d=T(null),h=T(""),p=T(!1),g=T(!1),y=T(""),b=T(!1),C=T(!1),I=T(!1),M=T(""),x=(A,N)=>{s("update:form",{...a.form,[A]:N}),s("input")},S=async()=>{if(!(!a.eventId||!a.marshalId)){g.value=!0,y.value="";try{const A=await _s.getMagicLink(a.eventId,a.marshalId);h.value=A.data.magicLink,p.value=A.data.hasEmail}catch(A){console.error("Failed to fetch magic link:",A),y.value="Failed to load login link"}finally{g.value=!1}}},_=T(""),D=async()=>{_.value="";try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(h.value),b.value=!0,setTimeout(()=>{b.value=!1},2e3);return}}catch(A){console.warn("Clipboard API failed, trying fallback:",A)}try{const A=document.createElement("textarea");A.value=h.value,A.style.position="fixed",A.style.left="-9999px",A.style.top="0",document.body.appendChild(A),A.focus(),A.select();const N=document.execCommand("copy");document.body.removeChild(A),N?(b.value=!0,setTimeout(()=>{b.value=!1},2e3)):(_.value="Copy failed. Please select and copy the link manually.",setTimeout(()=>{_.value=""},4e3))}catch(A){console.error("Fallback copy failed:",A),_.value="Copy not supported. Please select and copy the link manually.",setTimeout(()=>{_.value=""},4e3)}},E=async()=>{if(!(!a.eventId||!a.marshalId)){C.value=!0,I.value=!1,M.value="";try{await _s.sendMagicLink(a.eventId,a.marshalId),I.value=!0,setTimeout(()=>{I.value=!1},3e3)}catch(A){console.error("Failed to send email:",A),M.value=A.response?.data?.message||"Failed to send email"}finally{C.value=!1}}};return qe(()=>a.marshalId,A=>{A?S():(h.value="",p.value=!1)},{immediate:!0}),t({focusField:A=>{an(()=>{const B={name:i,email:l,phoneNumber:u,notes:d}[A];B?.value&&(B.value.focus(),B.value.scrollIntoView({behavior:"smooth",block:"center"}))})}}),(A,N)=>(v(),m("div",S3,[e.validationErrors.general?(v(),m("div",I3,w(e.validationErrors.general),1)):P("",!0),r("div",{class:pe(["form-group",{"has-error":e.validationErrors.name}])},[N[5]||(N[5]=r("label",null,"Name *",-1)),r("input",{ref_key:"nameInputRef",ref:i,value:e.form.name,onInput:N[0]||(N[0]=B=>x("name",B.target.value)),type:"text",required:"",class:pe(["form-input",{"input-error":e.validationErrors.name}])},null,42,x3),e.validationErrors.name?(v(),m("span",$3,w(e.validationErrors.name),1)):P("",!0)],2),r("div",T3,[r("div",{class:pe(["form-group contact-email",{"has-error":e.validationErrors.email}])},[N[6]||(N[6]=r("label",null,"Email",-1)),r("input",{ref_key:"emailInputRef",ref:l,value:e.form.email,onInput:N[1]||(N[1]=B=>x("email",B.target.value)),type:"email",class:pe(["form-input",{"input-error":e.validationErrors.email}])},null,42,M3),e.validationErrors.email?(v(),m("span",A3,w(e.validationErrors.email),1)):P("",!0)],2),r("div",{class:pe(["form-group contact-phone",{"has-error":e.validationErrors.phoneNumber}])},[N[7]||(N[7]=r("label",null,"Phone number",-1)),r("input",{ref_key:"phoneInputRef",ref:u,value:e.form.phoneNumber,onInput:N[2]||(N[2]=B=>x("phoneNumber",B.target.value)),type:"tel",class:pe(["form-input",{"input-error":e.validationErrors.phoneNumber}])},null,42,E3),e.validationErrors.phoneNumber?(v(),m("span",P3,w(e.validationErrors.phoneNumber),1)):P("",!0)],2)]),r("div",{class:pe(["form-group",{"has-error":e.validationErrors.notes}])},[N[8]||(N[8]=r("label",null,"Notes",-1)),r("textarea",{ref_key:"notesInputRef",ref:d,value:e.form.notes,onInput:N[3]||(N[3]=B=>x("notes",B.target.value)),class:pe(["form-input",{"input-error":e.validationErrors.notes}]),rows:"3",placeholder:"e.g., Needs to leave by 11am"},null,42,D3),e.validationErrors.notes?(v(),m("span",O3,w(e.validationErrors.notes),1)):P("",!0)],2),e.marshalId?(v(),m("div",R3,[N[9]||(N[9]=r("label",null,"Login link",-1)),N[10]||(N[10]=r("p",{class:"help-text"},"Share this unique link with the marshal so they can access their dashboard.",-1)),g.value?(v(),m("div",B3,"Loading link...")):h.value?(v(),m("div",N3,[r("div",F3,[r("input",{type:"text",value:h.value,readonly:"",class:"form-input magic-link-input",onFocus:N[4]||(N[4]=B=>B.target.select())},null,40,U3),r("button",{type:"button",class:"btn btn-secondary",onClick:D},w(b.value?"Copied!":"Copy link"),1)]),_.value?(v(),m("p",z3,w(_.value),1)):P("",!0),p.value?(v(),m("div",H3,[r("button",{type:"button",class:"btn btn-primary",disabled:C.value,onClick:E},w(C.value?"Sending...":"Send via email"),9,V3)])):P("",!0),I.value?(v(),m("p",G3,"Email sent successfully!")):P("",!0),M.value?(v(),m("p",j3,w(M.value),1)):P("",!0)])):y.value?(v(),m("div",Z3,w(y.value),1)):P("",!0)])):P("",!0)]))}},W3=Ge(q3,[["__scopeId","data-v-16ffb81b"]]),K3={class:"card-header"},J3={class:"checkpoint-name-row"},Y3=["innerHTML"],X3={class:"checkpoint-name"},Q3={key:0,class:"checkpoint-description"},eP={key:0,class:"card-areas"},tP={key:1,class:"card-check-in"},nP={key:0,class:"check-in-time"},oP={key:0,class:"check-in-method"},sP={key:1,class:"unsaved-indicator"},aP={key:2,class:"card-locked"},iP={class:"locked-badge"},lP={key:3,class:"card-badge"},rP={key:4,class:"card-badge"},cP={__name:"MarshalCheckpointCard",props:{assignment:{type:Object,required:!0},location:{type:Object,default:null},areas:{type:Array,default:()=>[]},effectiveCheckInStatus:{type:Boolean,default:!1},hasUnsavedChanges:{type:Boolean,default:!1},isLocked:{type:Boolean,default:!1},isMarkedForRemoval:{type:Boolean,default:!1}},emits:["click","toggle-check-in","remove","undo-remove","distance-click"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=z(()=>a.location?a.location.areaIds||a.location.AreaIds||[]:[]),l=z(()=>i.value.map(x=>{const S=a.areas.find(_=>_.id===x);return S?S.name:null}).filter(Boolean)),u=z(()=>i.value.map(x=>{const S=a.areas.find(_=>_.id===x);return S?S.color:"#999"})),d=z(()=>{if(!a.location)return"#667eea";const x=a.location,S=x.resolvedStyleBackgroundColor||x.ResolvedStyleBackgroundColor||x.resolvedStyleColor||x.ResolvedStyleColor;if(S)return S;if(i.value.length>0){const _=a.areas.find(D=>D.id===i.value[0]);if(_)return _.color}return"#667eea"}),h=z(()=>{if(!a.location)return`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="10" fill="#667eea" stroke="#fff" stroke-width="2"/>
    </svg>`;const x=a.location,S=x.resolvedStyleType||x.ResolvedStyleType,_=x.resolvedStyleBackgroundColor||x.ResolvedStyleBackgroundColor||x.resolvedStyleColor||x.ResolvedStyleColor,D=x.resolvedStyleBorderColor||x.ResolvedStyleBorderColor,E=x.resolvedStyleIconColor||x.ResolvedStyleIconColor,Z=x.resolvedStyleBackgroundShape||x.ResolvedStyleBackgroundShape;return S&&S!=="default"||_||D||E||Z&&Z!=="circle"?In({type:S||"circle",backgroundShape:Z||"circle",backgroundColor:_||"#667eea",borderColor:D||"#ffffff",iconColor:E||"#ffffff",size:"75",outputSize:24}):`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <circle cx="12" cy="12" r="10" fill="#667eea" stroke="#fff" stroke-width="2"/>
  </svg>`}),p=x=>x?new Date(x).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",g=z(()=>{const{checkedInBy:x,checkInMethod:S,marshalName:_}=a.assignment;return x&&x!==_?x:S||""}),y=z(()=>{const{checkInLatitude:x,checkInLongitude:S}=a.assignment,_=a.location;return!x||!S||!_?.latitude||!_?.longitude?null:hi(x,S,_.latitude,_.longitude)}),b=z(()=>y.value===null?null:y.value<1e3?`${Math.round(y.value)} m`:`${(y.value/1e3).toFixed(2)} km`),C=z(()=>y.value===null?"":y.value<=50?"distance-close":y.value<=100?"distance-medium":"distance-far"),I=()=>{!a.assignment.isPending&&!a.isMarkedForRemoval&&!a.isLocked&&s("click",a.assignment)},M=()=>{s("distance-click",a.assignment)};return(x,S)=>(v(),m("div",{class:pe(["marshal-checkpoint-card",{"is-checked-in":e.effectiveCheckInStatus&&!e.isMarkedForRemoval,"is-pending":e.assignment.isPending,"is-marked-for-removal":e.isMarkedForRemoval,"is-locked":e.isLocked}]),style:Qe({borderLeftColor:e.isMarkedForRemoval?void 0:d.value})},[r("div",K3,[r("div",{class:"card-title",onClick:I},[r("span",J3,[r("span",{class:"checkpoint-icon",innerHTML:h.value},null,8,Y3),r("span",X3,w(e.assignment.locationName),1),e.assignment.locationDescription?(v(),m("span",Q3,"  "+w(e.assignment.locationDescription),1)):P("",!0)])]),!e.isLocked&&!e.isMarkedForRemoval?(v(),m("button",{key:0,type:"button",class:"remove-btn",title:"Remove assignment",onClick:S[0]||(S[0]=it(_=>x.$emit("remove",e.assignment),["stop"]))},"  ")):P("",!0),e.isMarkedForRemoval?(v(),m("button",{key:1,type:"button",class:"undo-btn",title:"Cancel removal",onClick:S[1]||(S[1]=it(_=>x.$emit("undo-remove",e.assignment),["stop"]))}," Undo ")):P("",!0)]),l.value.length>0&&!e.isMarkedForRemoval?(v(),m("div",eP,[(v(!0),m(Te,null,Fe(l.value,(_,D)=>(v(),m("span",{key:D,class:"area-badge",style:Qe({backgroundColor:u.value[D]})},w(_),5))),128))])):P("",!0),!e.assignment.isPending&&!e.isMarkedForRemoval&&!e.isLocked?(v(),m("div",tP,[r("button",{class:pe(["check-in-toggle",{"is-checked-in":e.effectiveCheckInStatus}]),onClick:S[2]||(S[2]=_=>x.$emit("toggle-check-in",e.assignment))},[...S[3]||(S[3]=[r("span",{class:"toggle-icon"},"",-1),r("span",{class:"toggle-label-wrapper"},[r("span",{class:"toggle-label toggle-label-check-in"},"Check in"),r("span",{class:"toggle-label toggle-label-checked-in"},"Checked in")],-1)])],2),e.effectiveCheckInStatus&&e.assignment.checkInTime&&!e.hasUnsavedChanges?(v(),m("span",nP,[Ye(w(p(e.assignment.checkInTime))+" ",1),g.value?(v(),m("span",oP,"("+w(g.value)+")",1)):P("",!0),b.value?(v(),m("span",{key:1,class:pe(["check-in-distance",C.value]),onClick:it(M,["stop"])},w(b.value),3)):P("",!0)])):e.hasUnsavedChanges?(v(),m("span",sP," Unsaved ")):P("",!0)])):P("",!0),e.isLocked&&!e.isMarkedForRemoval?(v(),m("div",aP,[r("span",iP,"Viewing from this "+w(O(n).checkpoint),1)])):P("",!0),e.assignment.isPending?(v(),m("div",lP,[...S[4]||(S[4]=[r("span",{class:"pending-indicator"},"Will be assigned on save",-1)])])):P("",!0),e.isMarkedForRemoval?(v(),m("div",rP,[...S[5]||(S[5]=[r("span",{class:"removal-indicator"},"Will be removed on save",-1)])])):P("",!0)],6))}},uP=Ge(cP,[["__scopeId","data-v-d3de6925"]]),dP={class:"tab-content"},hP={key:0,class:"read-only-notice"},fP={class:"section-title"},pP={key:1,class:"form-group",style:{"margin-top":"1.5rem"}},vP={value:""},mP=["value"],gP={__name:"MarshalCheckpointsTab",props:{assignments:{type:Array,default:()=>[]},availableLocations:{type:Array,default:()=>[]},allLocations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},isNewMarshal:{type:Boolean,default:!1},lockedCheckpointId:{type:String,default:null}},emits:["input","remove-assignment","assign-to-location","select-checkpoint","distance-click"],setup(e,{expose:t,emit:n}){const{termsLower:a}=rt(),s=e,i=n,{pendingCheckInChanges:l,getEffectiveCheckInStatus:u,handleToggleCheckIn:d}=cm(()=>i("input")),h=T(""),p=T(new Set),g=z(()=>s.assignments?.length||0),y=j=>s.allLocations&&s.allLocations.find(R=>R.id===j)||null,b=z(()=>[...s.assignments].sort((j,R)=>(j.locationName||"").localeCompare(R.locationName||"",void 0,{numeric:!0,sensitivity:"base"}))),C=j=>p.value.has(j),I=j=>{j.isPending||i("select-checkpoint",j)},M=T(!1),x=T(null),S=j=>{u(j)?(x.value=j,M.value=!0):d(j)},_=()=>{x.value&&d(x.value),M.value=!1,x.value=null},D=()=>{M.value=!1,x.value=null},E=z(()=>x.value?`Are you sure you want to undo ${x.value.marshalName||"this marshal"}'s check-in?`:""),Z=j=>{j.isPending?i("remove-assignment",j):(p.value.add(j.id),i("input"))},A=j=>{p.value.delete(j.id),i("input")},N=z(()=>{const j=[...s.availableLocations];return j.sort((R,G)=>R.name.localeCompare(G.name,void 0,{numeric:!0,sensitivity:"base"})),j}),B=()=>{h.value&&(i("assign-to-location",h.value),h.value="")};return t({pendingCheckInChanges:l,clearPendingChanges:()=>{l.value.clear(),p.value.clear(),h.value=""},getPendingChanges:()=>Array.from(l.value.entries()).map(([j,R])=>({assignmentId:j,shouldBeCheckedIn:R})),getMarkedForRemoval:()=>Array.from(p.value)}),(j,R)=>(v(),m("div",dP,[e.lockedCheckpointId?(v(),m("div",hP," Viewing from "+w(O(a).checkpoint)+" - "+w(O(a).checkpoints)+" cannot be modified here. ",1)):P("",!0),r("h3",fP,"Assigned "+w(O(a).checkpoints)+" ("+w(g.value)+")",1),Me(er,{"is-empty":e.assignments.length===0,"empty-message":`No ${O(a).checkpoints} assigned yet.`,"empty-hint":e.lockedCheckpointId?"":`Use the dropdown below to assign this ${O(a).person} to ${O(a).checkpoints}.`},{default:He(()=>[(v(!0),m(Te,null,Fe(b.value,G=>(v(),Ze(uP,{key:G.id,assignment:G,location:y(G.locationId),areas:e.areas,"effective-check-in-status":O(u)(G),"has-unsaved-changes":O(l).has(G.id),"is-locked":!!e.lockedCheckpointId,"is-marked-for-removal":C(G.id),onClick:I,onToggleCheckIn:S,onRemove:Z,onUndoRemove:A,onDistanceClick:R[0]||(R[0]=ee=>j.$emit("distance-click",ee))},null,8,["assignment","location","areas","effective-check-in-status","has-unsaved-changes","is-locked","is-marked-for-removal"]))),128))]),_:1},8,["is-empty","empty-message","empty-hint"]),!e.lockedCheckpointId&&N.value.length>0?(v(),m("div",pP,[r("label",null,"Assign to "+w(O(a).checkpoint),1),ze(r("select",{"onUpdate:modelValue":R[1]||(R[1]=G=>h.value=G),class:"form-input",onChange:B},[r("option",vP,"Select a "+w(O(a).checkpoint)+"...",1),(v(!0),m(Te,null,Fe(N.value,G=>(v(),m("option",{key:G.id,value:G.id},[Ye(w(G.name),1),G.description?(v(),m(Te,{key:0},[Ye(" - "+w(G.description),1)],64)):P("",!0)],8,mP))),128))],544),[[Fn,h.value]])])):P("",!0),Me(Aa,{show:M.value,title:"Confirm check-out",message:E.value,"confirm-text":"Check out","is-danger":!0,onConfirm:_,onCancel:D},null,8,["show","message"])]))}},yP=Ge(gP,[["__scopeId","data-v-07754949"]]),kP={class:"marshal-checklist-view"},bP={key:0,class:"loading-state"},_P={key:1,class:"error-state"},wP={key:2,class:"empty-state"},CP={__name:"MarshalChecklistView",props:{eventId:{type:String,required:!0},marshalId:{type:String,required:!0},locations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,{expose:t,emit:n}){const{termsLower:a}=rt(),s=e,i=n,l=T([]),u=T(!1),d=T(null),h=T(new Map),p=z(()=>l.value.map(I=>{const M=h.value.get(I.itemId),x=M!==void 0?M.complete:I.isCompleted,S=M!==void 0&&M.complete!==I.isCompleted;return{...I,localIsCompleted:x,isModified:S}})),g=async()=>{if(!(!s.eventId||!s.marshalId)){u.value=!0,d.value=null;try{const I=await Nt.getMarshalChecklist(s.eventId,s.marshalId);if(l.value=I.data||[],s.modelValue&&s.modelValue.length>0){const M=new Map;s.modelValue.forEach(x=>{M.set(x.itemId,{complete:x.complete,contextType:x.contextType,contextId:x.contextId})}),h.value=M}}catch(I){console.error("Failed to load checklist:",I),d.value=I.response?.data?.message||"Failed to load checklist"}finally{u.value=!1}}},y=I=>{const M=h.value.get(I.itemId),x=M!==void 0?M.complete:I.isCompleted;h.value.set(I.itemId,{complete:!x,contextType:I.completionContextType,contextId:I.completionContextId}),b()},b=()=>{const I=[];for(const[M,x]of h.value.entries()){const S=l.value.find(_=>_.itemId===M);S&&x.complete!==S.isCompleted&&I.push({itemId:M,complete:x.complete,contextType:x.contextType,contextId:x.contextId})}i("update:modelValue",I),i("change",I)};return t({resetLocalState:()=>{if(h.value=new Map,s.modelValue&&s.modelValue.length>0){const I=new Map;s.modelValue.forEach(M=>{I.set(M.itemId,{complete:M.complete,contextType:M.contextType,contextId:M.contextId})}),h.value=I}},loadChecklist:g}),qe(()=>[s.eventId,s.marshalId],()=>{g()},{immediate:!0}),(I,M)=>(v(),m("div",kP,[u.value?(v(),m("div",bP," Loading checklist... ")):d.value?(v(),m("div",_P,[r("p",null,w(d.value),1),r("button",{onClick:g,class:"btn btn-secondary btn-small"}," Retry ")])):l.value.length===0?(v(),m("div",wP,[r("p",null,"No checklist items for this "+w(O(a).person)+".",1)])):(v(),Ze(vd,{key:3,items:p.value,locations:e.locations,areas:e.areas,onToggleComplete:y},null,8,["items","locations","areas"]))]))}},LP=Ge(CP,[["__scopeId","data-v-7460304c"]]),SP={class:"checklist-preview"},IP={class:"preview-actions"},xP={class:"preview-header"},$P={key:0,class:"add-item-form"},TP=["placeholder"],MP=["disabled"],AP={key:1,class:"pending-items"},EP={class:"item-content"},PP={class:"item-header"},DP={class:"item-text"},OP={class:"item-scope"},RP=["onClick"],BP={key:2,class:"empty-state"},NP={key:0,class:"help-text"},FP={key:3,class:"checklist-items"},UP={class:"item-content"},zP={class:"item-header"},HP={class:"item-text"},VP={class:"item-scope"},GP=["title"],jP={key:0,class:"item-context"},ZP={__name:"ChecklistPreview",props:{allChecklistItems:{type:Array,default:()=>[]},pendingLocationIds:{type:Array,default:()=>[]},allLocations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=T(!1),l=T(""),u=T([...a.modelValue]);qe(()=>a.modelValue,S=>{u.value=[...S]},{deep:!0});const d=()=>{l.value.trim()&&(u.value.push({text:l.value.trim(),isNew:!0}),l.value="",i.value=!1,p())},h=S=>{u.value.splice(S,1),p()},p=()=>{s("update:modelValue",[...u.value]),s("change")},g=z(()=>{const S=new Set;for(const _ of a.pendingLocationIds){const D=a.allLocations.find(E=>E.id===_);D&&(D.areaIds||D.AreaIds||[]).forEach(Z=>S.add(Z))}return[...S]}),y=S=>{const _=S.scope,D=S.itemType,E=S.ids||[];return _==="SpecificPeople"&&D==="Marshal"?E.includes("ALL_MARSHALS"):(_==="EveryoneAtCheckpoints"||_==="OnePerCheckpoint")&&D==="Checkpoint"?E.includes("ALL_CHECKPOINTS")?!0:E.some(Z=>a.pendingLocationIds.includes(Z)):_==="OnePerCheckpoint"&&D==="Area"?E.includes("ALL_AREAS")?!0:E.some(Z=>g.value.includes(Z)):(_==="EveryoneInAreas"||_==="OnePerArea"||_==="EveryAreaLead"||_==="OneLeadPerArea")&&D==="Area"?E.includes("ALL_AREAS")?!0:E.some(Z=>g.value.includes(Z)):!1},b=z(()=>a.allChecklistItems.filter(S=>S.scopeConfigurations&&S.scopeConfigurations.length>0?S.scopeConfigurations.some(_=>y(_)):!1)),C=S=>({SpecificPeople:"Everyone",EveryoneAtCheckpoints:`All at ${n.value.checkpoints}`,OnePerCheckpoint:`One per ${n.value.checkpoint}`,EveryoneInAreas:`All in ${n.value.areas}`,OnePerArea:`One per ${n.value.area}`,EveryAreaLead:`${n.value.area} leads`,OneLeadPerArea:`One lead per ${n.value.area}`})[S]||S,I=S=>{if(!S.scopeConfigurations||S.scopeConfigurations.length===0)return"Unknown";const _=S.scopeConfigurations.find(E=>y(E));if(!_)return C(S.scopeConfigurations[0].scope);const D=_.ids||[];return D.includes("ALL_MARSHALS")?"Everyone":D.includes("ALL_CHECKPOINTS")?`All ${n.value.checkpoints}`:D.includes("ALL_AREAS")?`All ${n.value.areas}`:C(_.scope)},M=S=>{if(!S.scopeConfigurations||S.scopeConfigurations.length===0)return"";const _=S.scopeConfigurations.find(E=>y(E));return _&&{SpecificPeople:"This item is for everyone at the event",EveryoneAtCheckpoints:`This item is for everyone at specified ${n.value.checkpoints}`,OnePerCheckpoint:`One person at each ${n.value.checkpoint} needs to complete this`,EveryoneInAreas:`This item is for everyone in specified ${n.value.areas}`,OnePerArea:`One person in each ${n.value.area} needs to complete this`,EveryAreaLead:`This item is for ${n.value.area} leads only`,OneLeadPerArea:`One ${n.value.area} lead needs to complete this`}[_.scope]||""},x=S=>{if(!S.scopeConfigurations||S.scopeConfigurations.length===0)return null;const _=S.scopeConfigurations.find(Z=>y(Z));if(!_)return null;const D=_.itemType,E=_.ids||[];if(E.includes("ALL_MARSHALS")||E.includes("ALL_CHECKPOINTS")||E.includes("ALL_AREAS"))return null;if(D==="Checkpoint"){const Z=a.allLocations.filter(A=>E.includes(A.id)&&a.pendingLocationIds.includes(A.id)).map(A=>A.name);if(Z.length>0)return`At: ${Z.join(", ")}`}if(D==="Area"){const Z=a.areas.filter(A=>E.includes(A.id)&&g.value.includes(A.id)).map(A=>A.name);if(Z.length>0)return`In: ${Z.join(", ")}`}return null};return(S,_)=>(v(),m("div",SP,[r("div",IP,[r("p",xP,w(e.isEditing?`Add new ${O(n).checklist} for this ${O(n).person}:`:`${O(n).checklists} that will apply to this ${O(n).person}:`),1),r("button",{type:"button",class:"add-item-btn",onClick:_[0]||(_[0]=D=>i.value=!i.value)},w(i.value?"Cancel":`Add ${O(n).checklist}`),1)]),i.value?(v(),m("div",$P,[ze(r("input",{"onUpdate:modelValue":_[1]||(_[1]=D=>l.value=D),type:"text",placeholder:`Enter ${O(n).checklist} text...`,class:"add-item-input",onKeyup:Yo(d,["enter"])},null,40,TP),[[nt,l.value]]),r("button",{type:"button",class:"save-item-btn",disabled:!l.value.trim(),onClick:d}," Add ",8,MP)])):P("",!0),u.value.length>0?(v(),m("div",AP,[(v(!0),m(Te,null,Fe(u.value,(D,E)=>(v(),m("div",{key:`pending-${E}`,class:"checklist-item pending"},[_[3]||(_[3]=r("div",{class:"item-checkbox"},[r("input",{type:"checkbox",checked:!1,disabled:""})],-1)),r("div",EP,[r("div",PP,[r("div",DP,w(D.text),1),r("div",OP,[_[2]||(_[2]=r("span",{class:"scope-pill new-pill",title:"Will be created when saved"}," New ",-1)),r("button",{type:"button",class:"remove-item-btn",onClick:Z=>h(E),title:"Remove"},"  ",8,RP)])])])]))),128))])):P("",!0),!e.isEditing&&b.value.length===0&&u.value.length===0?(v(),m("div",BP,[r("p",null,"No "+w(O(n).checklists)+" will apply based on the current "+w(O(n).checkpoint)+" assignments.",1),e.pendingLocationIds.length===0?(v(),m("p",NP," Assign "+w(O(n).checkpoints)+" to see relevant "+w(O(n).checklists)+". ",1)):P("",!0)])):P("",!0),!e.isEditing&&b.value.length>0?(v(),m("div",FP,[(v(!0),m(Te,null,Fe(b.value,D=>(v(),m("div",{key:D.id,class:"checklist-item"},[_[4]||(_[4]=r("div",{class:"item-checkbox"},[r("input",{type:"checkbox",checked:!1,disabled:""})],-1)),r("div",UP,[r("div",zP,[r("div",HP,w(D.text),1),r("div",VP,[r("span",{class:"scope-pill",title:M(D)},w(I(D)),9,GP)])]),x(D)?(v(),m("div",jP,w(x(D)),1)):P("",!0)])]))),128))])):P("",!0)]))}},qP=Ge(ZP,[["__scopeId","data-v-6deaacc2"]]),WP={class:"notes-preview"},KP={class:"preview-actions"},JP={class:"preview-header"},YP={key:0,class:"add-item-form"},XP={class:"add-form-fields"},QP=["disabled"],e6={key:1,class:"pending-items"},t6={class:"note-header"},n6={class:"note-title"},o6={class:"note-actions"},s6=["onClick"],a6={key:0,class:"note-content"},i6={key:2,class:"empty-state"},l6={key:0,class:"help-text"},r6={key:3,class:"notes-list"},c6={class:"note-header"},u6={class:"note-title"},d6=["title"],h6={key:0,class:"note-content"},f6={key:1,class:"note-context"},p6={__name:"NotesPreview",props:{allNotes:{type:Array,default:()=>[]},pendingLocationIds:{type:Array,default:()=>[]},allLocations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=T(!1),l=T(""),u=T(""),d=T([...a.modelValue]);qe(()=>a.modelValue,_=>{d.value=[..._]},{deep:!0});const h=()=>{!l.value.trim()&&!u.value.trim()||(d.value.push({title:l.value.trim(),content:u.value.trim(),isNew:!0}),l.value="",u.value="",i.value=!1,g())},p=_=>{d.value.splice(_,1),g()},g=()=>{s("update:modelValue",[...d.value]),s("change")},y=z(()=>{const _=new Set;for(const D of a.pendingLocationIds){const E=a.allLocations.find(Z=>Z.id===D);E&&(E.areaIds||E.AreaIds||[]).forEach(A=>_.add(A))}return[..._]}),b=_=>{const D=_.scope,E=_.itemType,Z=_.ids||[];return D==="SpecificPeople"&&E==="Marshal"?Z.includes("ALL_MARSHALS"):D==="EveryoneAtCheckpoints"&&E==="Checkpoint"?Z.includes("ALL_CHECKPOINTS")?!0:Z.some(A=>a.pendingLocationIds.includes(A)):D==="EveryoneInAreas"&&E==="Area"?Z.includes("ALL_AREAS")?!0:Z.some(A=>y.value.includes(A)):!1},C=z(()=>a.allNotes.filter(_=>_.scopeConfigurations&&_.scopeConfigurations.length>0?_.scopeConfigurations.some(D=>b(D)):!1)),I=_=>({SpecificPeople:"Everyone",EveryoneAtCheckpoints:`All at ${n.value.checkpoints}`,EveryoneInAreas:`All in ${n.value.areas}`})[_]||_,M=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return"Unknown";const D=_.scopeConfigurations.find(Z=>b(Z));if(!D)return I(_.scopeConfigurations[0].scope);const E=D.ids||[];return E.includes("ALL_MARSHALS")?"Everyone":E.includes("ALL_CHECKPOINTS")?`All ${n.value.checkpoints}`:E.includes("ALL_AREAS")?`All ${n.value.areas}`:I(D.scope)},x=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return"";const D=_.scopeConfigurations.find(Z=>b(Z));return D&&{SpecificPeople:"This note is for everyone at the event",EveryoneAtCheckpoints:`This note is for everyone at specified ${n.value.checkpoints}`,EveryoneInAreas:`This note is for everyone in specified ${n.value.areas}`}[D.scope]||""},S=_=>{if(!_.scopeConfigurations||_.scopeConfigurations.length===0)return null;const D=_.scopeConfigurations.find(A=>b(A));if(!D)return null;const E=D.itemType,Z=D.ids||[];if(Z.includes("ALL_MARSHALS")||Z.includes("ALL_CHECKPOINTS")||Z.includes("ALL_AREAS"))return null;if(E==="Checkpoint"){const A=a.allLocations.filter(N=>Z.includes(N.id)&&a.pendingLocationIds.includes(N.id)).map(N=>N.name);if(A.length>0)return`At: ${A.join(", ")}`}if(E==="Area"){const A=a.areas.filter(N=>Z.includes(N.id)&&y.value.includes(N.id)).map(N=>N.name);if(A.length>0)return`In: ${A.join(", ")}`}return null};return(_,D)=>(v(),m("div",WP,[r("div",KP,[r("p",JP,w(e.isEditing?`Add new note for this ${O(n).person}:`:`Notes that will be visible to this ${O(n).person}:`),1),r("button",{type:"button",class:"add-item-btn",onClick:D[0]||(D[0]=E=>i.value=!i.value)},w(i.value?"Cancel":"Add note"),1)]),i.value?(v(),m("div",YP,[r("div",XP,[ze(r("input",{"onUpdate:modelValue":D[1]||(D[1]=E=>l.value=E),type:"text",placeholder:"Note title...",class:"add-item-input title-input"},null,512),[[nt,l.value]]),ze(r("textarea",{"onUpdate:modelValue":D[2]||(D[2]=E=>u.value=E),placeholder:"Note content...",class:"add-item-input content-input",rows:"3"},null,512),[[nt,u.value]])]),r("button",{type:"button",class:"save-item-btn",disabled:!l.value.trim()&&!u.value.trim(),onClick:h}," Add ",8,QP)])):P("",!0),d.value.length>0?(v(),m("div",e6,[(v(!0),m(Te,null,Fe(d.value,(E,Z)=>(v(),m("div",{key:`pending-${Z}`,class:"note-item pending"},[r("div",t6,[r("span",n6,w(E.title||"Untitled"),1),r("div",o6,[D[3]||(D[3]=r("span",{class:"scope-pill new-pill",title:"Will be created when saved"}," New ",-1)),r("button",{type:"button",class:"remove-item-btn",onClick:A=>p(Z),title:"Remove"},"  ",8,s6)])]),E.content?(v(),m("div",a6,w(E.content),1)):P("",!0)]))),128))])):P("",!0),!e.isEditing&&C.value.length===0&&d.value.length===0?(v(),m("div",i6,[r("p",null,"No notes will be visible based on the current "+w(O(n).checkpoint)+" assignments.",1),e.pendingLocationIds.length===0?(v(),m("p",l6," Assign "+w(O(n).checkpoints)+" to see relevant notes. ",1)):P("",!0)])):P("",!0),!e.isEditing&&C.value.length>0?(v(),m("div",r6,[(v(!0),m(Te,null,Fe(C.value,E=>(v(),m("div",{key:E.id,class:"note-item"},[r("div",c6,[r("span",u6,w(E.title||"Untitled"),1),r("span",{class:"scope-pill",title:x(E)},w(M(E)),9,d6)]),E.content?(v(),m("div",h6,w(E.content),1)):P("",!0),S(E)?(v(),m("div",f6,w(S(E)),1)):P("",!0)]))),128))])):P("",!0)]))}},v6=Ge(p6,[["__scopeId","data-v-e8e0946a"]]),m6={key:6,class:"tab-content incidents-tab"},g6={class:"incidents-list"},y6={class:"custom-footer"},k6={class:"footer-left"},b6={__name:"EditMarshalModal",props:{show:{type:Boolean,default:!1},marshal:{type:Object,default:null},eventId:{type:String,required:!0},assignments:{type:Array,default:()=>[]},availableLocations:{type:Array,default:()=>[]},allLocations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},isEditing:{type:Boolean,default:!1},isDirty:{type:Boolean,default:!1},eventNotes:{type:Array,default:()=>[]},allChecklistItems:{type:Array,default:()=>[]},incidents:{type:Array,default:()=>[]},allMarshals:{type:Array,default:()=>[]},validationErrors:{type:Object,default:()=>({})},lockedCheckpointId:{type:String,default:null},zIndex:{type:Number,default:1e3}},emits:["close","save","delete","toggle-check-in","remove-assignment","assign-to-location","update:isDirty","select-incident","select-checkpoint"],setup(e,{expose:t,emit:n}){const{terms:a,termsLower:s}=rt(),i=e,l=n,u=T("details"),d=T(null),h=T(null),p=T(null),g=T([]),y=T([]),b=T([]),C=T([]),I=T({name:"",email:"",phoneNumber:"",notes:""}),M=T(!1),x=T(null),S=ue=>{x.value=ue,M.value=!0},_=()=>{M.value=!1,x.value=null},D=ue=>i.allLocations.find(F=>F.id===ue),E=z(()=>I.value.name||i.marshal?.name||""),Z=z(()=>x.value&&D(x.value.locationId)?.name||""),A=z(()=>{if(!x.value)return null;const{checkInLatitude:ue,checkInLongitude:F}=x.value;return!ue||!F?null:{lat:ue,lng:F}}),N=z(()=>{if(!x.value)return null;const ue=D(x.value.locationId);return!ue?.latitude||!ue?.longitude?null:{lat:ue.latitude,lng:ue.longitude}}),B=z(()=>{if(!x.value)return null;const{checkInLatitude:ue,checkInLongitude:F,locationId:K}=x.value,ae=D(K);return!ue||!F||!ae?.latitude||!ae?.longitude?null:hi(ue,F,ae.latitude,ae.longitude)}),j=z(()=>{const ue=i.isEditing?`Edit ${s.value.person}`:`Create ${s.value.person}`,F=I.value.name?.trim();return F?`${ue} - ${F}`:ue}),R=z(()=>{const ue=[{value:"details",label:"Details",icon:"details"},{value:"checkpoints",label:a.value.checkpoints,icon:"checkpoint"},{value:"checklists",label:a.value.checklists,icon:"checklist"},{value:"notes",label:"Notes",icon:"notes"}];return i.incidents&&i.incidents.length>0&&ue.push({value:"incidents",label:"Incidents",icon:"incidents"}),ue}),G=z(()=>R.value.findIndex(ue=>ue.value===u.value)),ee=z(()=>G.value===R.value.length-1),ne=z(()=>ee.value?null:R.value[G.value+1]),Ae=z(()=>ne.value?`${ne.value.label}...`:""),J=z(()=>y.value.map(ue=>ue.locationId)),te=z(()=>i.isEditing?i.assignments:y.value.map(ue=>({id:`pending-${ue.locationId}`,locationId:ue.locationId,locationName:i.allLocations.find(F=>F.id===ue.locationId)?.name||"Unknown",isPending:!0}))),U=z(()=>{if(i.isEditing)return i.availableLocations;const ue=y.value.map(F=>F.locationId);return i.allLocations.filter(F=>!ue.includes(F.id))});qe(()=>i.marshal,ue=>{ue?I.value={name:ue.name||"",email:ue.email||"",phoneNumber:ue.phoneNumber||"",notes:ue.notes||""}:I.value={name:"",email:"",phoneNumber:"",notes:""}},{immediate:!0,deep:!0}),qe(()=>i.show,ue=>{ue&&(u.value="details",g.value=[],y.value=[],b.value=[],C.value=[],i.isEditing||(I.value={name:"",email:"",phoneNumber:"",notes:""}),h.value?.clearPendingChanges&&h.value.clearPendingChanges(),p.value?.resetLocalState&&p.value.resetLocalState())});const X=ue=>{I.value=ue},re=()=>{l("update:isDirty",!0)},ke=()=>{l("update:isDirty",!0)},Re=()=>{ne.value&&(u.value=ne.value.value)},Xe=()=>{const ue={...I.value,checkInChanges:h.value?.getPendingChanges?.()||[],assignmentsToRemove:h.value?.getMarkedForRemoval?.()||[],checklistChanges:g.value||[],pendingAssignments:i.isEditing?[]:y.value,pendingNewChecklistItems:b.value,pendingNewNotes:C.value};l("save",ue)},Ne=()=>{l("delete")},Ke=ue=>{!i.isEditing&&ue.isPending?y.value=y.value.filter(F=>F.locationId!==ue.locationId):l("remove-assignment",ue)},We=ue=>{i.isEditing?l("assign-to-location",ue):(y.value.push({locationId:ue}),l("update:isDirty",!0))},Q=ue=>{l("select-checkpoint",ue)},ge=()=>{l("close")};return t({switchToTab:ue=>{u.value=ue},focusField:ue=>{d.value?.focusField&&d.value.focusField(ue)}}),(ue,F)=>(v(),Ze(jt,{show:e.show,title:j.value,size:"large","confirm-on-close":!0,"is-dirty":e.isDirty,"z-index":e.zIndex,onClose:ge},{"tab-header":He(()=>[Me(Yi,{modelValue:u.value,"onUpdate:modelValue":F[0]||(F[0]=K=>u.value=K),tabs:R.value},null,8,["modelValue","tabs"])]),footer:He(()=>[r("div",y6,[r("div",k6,[e.isEditing&&!e.lockedCheckpointId?(v(),m("button",{key:0,type:"button",onClick:Ne,class:"btn btn-danger"}," Delete ")):P("",!0),!e.isEditing&&!ee.value?(v(),m("button",{key:1,type:"button",onClick:Re,class:"btn btn-secondary mobile-only"},w(Ae.value),1)):P("",!0)]),r("button",{type:"button",onClick:Xe,class:"btn btn-success"}," Save ")])]),default:He(()=>[u.value==="details"?(v(),Ze(W3,{key:0,ref_key:"detailsTabRef",ref:d,form:I.value,"event-id":e.eventId,"marshal-id":e.isEditing?e.marshal?.id:null,"validation-errors":e.validationErrors,"onUpdate:form":X,onInput:re},null,8,["form","event-id","marshal-id","validation-errors"])):P("",!0),u.value==="checkpoints"?(v(),Ze(yP,{key:1,ref_key:"checkpointsTabRef",ref:h,assignments:te.value,"available-locations":U.value,"all-locations":e.allLocations,areas:e.areas,"is-new-marshal":!e.isEditing,"locked-checkpoint-id":e.lockedCheckpointId,onInput:re,onRemoveAssignment:Ke,onAssignToLocation:We,onSelectCheckpoint:Q,onDistanceClick:S},null,8,["assignments","available-locations","all-locations","areas","is-new-marshal","locked-checkpoint-id"])):P("",!0),u.value==="checklists"&&e.isEditing?(v(),Ze(LP,{key:2,ref_key:"checklistTabRef",ref:p,modelValue:g.value,"onUpdate:modelValue":F[1]||(F[1]=K=>g.value=K),"event-id":e.eventId,"marshal-id":e.marshal.id,locations:e.allLocations,areas:e.areas,onChange:ke},null,8,["modelValue","event-id","marshal-id","locations","areas"])):P("",!0),u.value==="checklists"?(v(),Ze(qP,{key:3,modelValue:b.value,"onUpdate:modelValue":F[2]||(F[2]=K=>b.value=K),"all-checklist-items":e.allChecklistItems,"pending-location-ids":J.value,"all-locations":e.allLocations,areas:e.areas,"is-editing":e.isEditing,onChange:re},null,8,["modelValue","all-checklist-items","pending-location-ids","all-locations","areas","is-editing"])):P("",!0),u.value==="notes"&&e.isEditing?(v(),Ze(Lc,{key:4,"event-id":e.eventId,"marshal-id":e.marshal?.id,"all-notes":e.eventNotes,locations:e.allLocations,areas:e.areas,assignments:e.assignments,marshals:e.allMarshals},null,8,["event-id","marshal-id","all-notes","locations","areas","assignments","marshals"])):P("",!0),u.value==="notes"?(v(),Ze(v6,{key:5,modelValue:C.value,"onUpdate:modelValue":F[3]||(F[3]=K=>C.value=K),"all-notes":e.eventNotes,"pending-location-ids":J.value,"all-locations":e.allLocations,areas:e.areas,"is-editing":e.isEditing,onChange:re},null,8,["modelValue","all-notes","pending-location-ids","all-locations","areas","is-editing"])):P("",!0),u.value==="incidents"?(v(),m("div",m6,[r("div",g6,[(v(!0),m(Te,null,Fe(e.incidents,K=>(v(),Ze(tr,{key:K.incidentId,incident:K,onSelect:F[4]||(F[4]=ae=>ue.$emit("select-incident",ae))},null,8,["incident"]))),128))])])):P("",!0),Me(fd,{show:M.value,"marshal-name":E.value,"checkpoint-name":Z.value,"check-in-location":A.value,"checkpoint-location":N.value,distance:B.value,"z-index":e.zIndex+100,onClose:_},null,8,["show","marshal-name","checkpoint-name","check-in-location","checkpoint-location","distance","z-index"])]),_:1},8,["show","title","is-dirty","z-index"]))}},_6=Ge(b6,[["__scopeId","data-v-f4e8a66c"]]),w6={class:"locations-list"},C6={class:"conflict-actions"},L6={__name:"AssignmentConflictModal",props:{show:{type:Boolean,default:!1},conflictData:{type:Object,default:()=>({marshalName:"",locations:[]})}},emits:["close","choice"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=t,i=u=>{s("choice",u)},l=()=>{s("close")};return(u,d)=>(v(),Ze(jt,{show:e.show,title:`${O(n).person} already assigned`,size:"medium","z-index":1100,onClose:l},{actions:He(()=>[r("div",C6,[r("button",{onClick:d[0]||(d[0]=h=>i("move")),class:"btn btn-primary btn-full"}," Move to this "+w(O(a).checkpoint)+" (remove from others) ",1),r("button",{onClick:d[1]||(d[1]=h=>i("both")),class:"btn btn-secondary btn-full"}," Assign to both (keep existing assignments) "),r("button",{onClick:d[2]||(d[2]=h=>i("choose-other")),class:"btn btn-secondary btn-full"}," Choose someone else "),r("button",{onClick:d[3]||(d[3]=h=>i("cancel")),class:"btn btn-secondary btn-full"}," Cancel ")])]),default:He(()=>[r("p",null,[r("strong",null,w(e.conflictData.marshalName),1),d[4]||(d[4]=Ye(" is currently assigned to: ",-1))]),r("ul",w6,[(v(!0),m(Te,null,Fe(e.conflictData.locations,h=>(v(),m("li",{key:h},w(h),1))),128))]),d[5]||(d[5]=r("p",null,"What would you like to do?",-1))]),_:1},8,["show","title"]))}},S6=Ge(L6,[["__scopeId","data-v-997e8aaa"]]),I6={key:0,class:"assign-marshal-section"},x6={value:""},$6=["value"],T6=["disabled"],M6={key:1,class:"assign-marshal-section create-mode"},A6={class:"form-group"},E6={class:"form-group"},P6={class:"form-group"},D6={__name:"AssignMarshalModal",props:{show:{type:Boolean,default:!1},locationName:{type:String,default:""},marshals:{type:Array,default:()=>[]}},emits:["close","assign-existing","create-and-assign"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=T(!1),l=T(""),u=T({name:"",email:"",phoneNumber:""});qe(()=>a.show,b=>{b||(i.value=!1,l.value="",u.value={name:"",email:"",phoneNumber:""})});const d=()=>{i.value=!0},h=()=>{l.value&&s("assign-existing",l.value)},p=()=>{u.value.name&&s("create-and-assign",{...u.value})},g=()=>{i.value=!1,u.value={name:"",email:"",phoneNumber:""}},y=()=>{s("close")};return(b,C)=>(v(),Ze(jt,{show:e.show,title:i.value?`Create new ${O(n).person}`:`Assign ${O(n).person} to ${e.locationName}`,size:"medium",onClose:y},{actions:He(()=>[i.value?(v(),m(Te,{key:0},[r("button",{onClick:g,class:"btn btn-secondary"}," Cancel "),r("button",{onClick:p,class:"btn btn-primary"}," Create & assign ")],64)):P("",!0)]),default:He(()=>[i.value?(v(),m("div",M6,[r("h3",null,"Create new "+w(O(n).person),1),r("div",A6,[C[5]||(C[5]=r("label",null,"Name *",-1)),ze(r("input",{"onUpdate:modelValue":C[1]||(C[1]=I=>u.value.name=I),type:"text",required:"",class:"form-input"},null,512),[[nt,u.value.name]])]),r("div",E6,[C[6]||(C[6]=r("label",null,"Email",-1)),ze(r("input",{"onUpdate:modelValue":C[2]||(C[2]=I=>u.value.email=I),type:"email",class:"form-input"},null,512),[[nt,u.value.email]])]),r("div",P6,[C[7]||(C[7]=r("label",null,"Phone",-1)),ze(r("input",{"onUpdate:modelValue":C[3]||(C[3]=I=>u.value.phoneNumber=I),type:"tel",class:"form-input"},null,512),[[nt,u.value.phoneNumber]])])])):(v(),m("div",I6,[r("h3",null,"Select existing "+w(O(n).person),1),ze(r("select",{"onUpdate:modelValue":C[0]||(C[0]=I=>l.value=I),class:"form-input"},[r("option",x6,"Choose a "+w(O(n).person)+"...",1),(v(!0),m(Te,null,Fe(e.marshals,I=>(v(),m("option",{key:I.id,value:I.id},[Ye(w(I.name)+" ",1),I.assignedLocationIds&&I.assignedLocationIds.length>0?(v(),m(Te,{key:0},[Ye(" (assigned to "+w(I.assignedLocationIds.length)+" "+w(I.assignedLocationIds.length>1?O(n).checkpoints:O(n).checkpoint)+") ",1)],64)):P("",!0)],8,$6))),128))],512),[[Fn,l.value]]),r("button",{onClick:h,class:"btn btn-primary btn-full",style:{"margin-top":"1rem"},disabled:!l.value}," Assign selected "+w(O(n).person),9,T6),C[4]||(C[4]=r("div",{class:"divider"},"OR",-1)),r("button",{onClick:d,class:"btn btn-secondary btn-full"}," Create new "+w(O(n).person),1)]))]),_:1},8,["show","title"]))}},O6=Ge(D6,[["__scopeId","data-v-fa70b913"]]),R6={class:"shift-times-content"},B6={class:"info-text"},N6={class:"time-delta-info"},F6={class:"delta-detail"},U6={class:"delta-detail"},z6={class:"delta-summary"},H6={class:"affected-checkpoints"},V6={class:"option-selection"},G6={class:"radio-option"},j6={class:"radio-option"},Z6={__name:"ShiftCheckpointTimesModal",props:{show:{type:Boolean,default:!1},oldEventDate:{type:String,required:!0},newEventDate:{type:String,required:!0},affectedCheckpointsCount:{type:Number,default:0}},emits:["confirm","cancel"],setup(e,{emit:t}){const{terms:n,termsLower:a}=rt(),s=e,i=t,l=T("shift"),u=z(()=>{const y=new Date(s.oldEventDate);return new Date(s.newEventDate)-y}),d=y=>new Date(y).toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),h=y=>{const b=Math.abs(y),C=y>=0?"+":"-",I=Math.floor(b/(1e3*60*60*24)),M=Math.floor(b%(1e3*60*60*24)/(1e3*60*60)),x=Math.floor(b%(1e3*60*60)/(1e3*60)),S=[];return I>0&&S.push(`${I}d`),M>0&&S.push(`${M}h`),x>0&&S.push(`${x}m`),`${C}${S.join(" ")}`},p=()=>{i("confirm",{shouldShift:l.value==="shift",timeDelta:u.value})},g=()=>{i("cancel")};return(y,b)=>(v(),Ze(jt,{show:e.show,title:`Shift ${O(n).checkpoint} Times?`,size:"medium",onClose:g},{actions:He(()=>[r("button",{type:"button",onClick:g,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:p,class:"btn btn-primary"},w(l.value==="shift"?"Shift Times":"Keep Times"),1)]),default:He(()=>[r("div",R6,[r("p",B6," You've changed the event date/time. Some "+w(O(a).checkpoints)+" have custom times set. ",1),r("div",N6,[b[2]||(b[2]=r("strong",null,"Event time change:",-1)),r("div",F6," Old: "+w(d(e.oldEventDate)),1),r("div",U6," New: "+w(d(e.newEventDate)),1),r("div",z6," Delta: "+w(h(u.value)),1)]),r("p",H6,[r("strong",null,w(e.affectedCheckpointsCount)+" "+w(e.affectedCheckpointsCount===1?O(a).checkpoint:O(a).checkpoints),1),b[3]||(b[3]=Ye(" with custom times will be shifted by the same amount. ",-1))]),r("div",V6,[r("label",G6,[ze(r("input",{"onUpdate:modelValue":b[0]||(b[0]=C=>l.value=C),type:"radio",value:"shift",name:"shift-option"},null,512),[[_h,l.value]]),r("div",null,[r("strong",null,"Shift all "+w(O(a).checkpoint)+" times",1),b[4]||(b[4]=r("small",null,"Recommended: Maintains relative timing",-1))])]),r("label",j6,[ze(r("input",{"onUpdate:modelValue":b[1]||(b[1]=C=>l.value=C),type:"radio",value:"keep",name:"shift-option"},null,512),[[_h,l.value]]),r("div",null,[r("strong",null,"Keep "+w(O(a).checkpoint)+" times unchanged",1),r("small",null,w(O(n).checkpoint)+" times will stay at their current values",1)])])])])]),_:1},8,["show","title"]))}},q6=Ge(Z6,[["__scopeId","data-v-a6454aff"]]),W6={class:"checklist-preview"},K6={class:"preview-actions"},J6={class:"preview-header"},Y6={key:0,class:"add-item-form"},X6=["placeholder"],Q6=["disabled"],e5={key:1,class:"pending-items"},t5={class:"item-content"},n5={class:"item-header"},o5={class:"item-text"},s5={class:"item-scope"},a5=["onClick"],i5={key:2,class:"empty-state"},l5={__name:"ChecklistPreviewForArea",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=T(!1),l=T(""),u=T([...a.modelValue]);qe(()=>a.modelValue,g=>{u.value=[...g]},{deep:!0});const d=()=>{l.value.trim()&&(u.value.push({text:l.value.trim(),isNew:!0}),l.value="",i.value=!1,p())},h=g=>{u.value.splice(g,1),p()},p=()=>{s("update:modelValue",[...u.value]),s("change")};return(g,y)=>(v(),m("div",W6,[r("div",K6,[r("p",J6," Add new "+w(O(n).checklist)+" for this "+w(O(n).area)+": ",1),r("button",{type:"button",class:"add-item-btn",onClick:y[0]||(y[0]=b=>i.value=!i.value)},w(i.value?"Cancel":`Add ${O(n).checklist}`),1)]),i.value?(v(),m("div",Y6,[ze(r("input",{"onUpdate:modelValue":y[1]||(y[1]=b=>l.value=b),type:"text",placeholder:`Enter ${O(n).checklist} text...`,class:"add-item-input",onKeyup:Yo(d,["enter"])},null,40,X6),[[nt,l.value]]),r("button",{type:"button",class:"save-item-btn",disabled:!l.value.trim(),onClick:d}," Add ",8,Q6)])):P("",!0),u.value.length>0?(v(),m("div",e5,[(v(!0),m(Te,null,Fe(u.value,(b,C)=>(v(),m("div",{key:`pending-${C}`,class:"checklist-item pending"},[y[3]||(y[3]=r("div",{class:"item-checkbox"},[r("input",{type:"checkbox",checked:!1,disabled:""})],-1)),r("div",t5,[r("div",n5,[r("div",o5,w(b.text),1),r("div",s5,[y[2]||(y[2]=r("span",{class:"scope-pill new-pill",title:"Will be created when saved"}," New ",-1)),r("button",{type:"button",class:"remove-item-btn",onClick:I=>h(C),title:"Remove"},"  ",8,a5)])])])]))),128))])):P("",!0),u.value.length===0&&!i.value?(v(),m("div",i5,[r("p",null,"No new "+w(O(n).checklists)+" to add. Click the button above to create one.",1)])):P("",!0)]))}},r5=Ge(l5,[["__scopeId","data-v-a394c400"]]),c5={class:"notes-preview"},u5={class:"preview-actions"},d5={class:"preview-header"},h5={key:0,class:"add-item-form"},f5={class:"add-form-fields"},p5=["disabled"],v5={key:1,class:"pending-items"},m5={class:"note-header"},g5={class:"note-title"},y5={class:"note-actions"},k5=["onClick"],b5={key:0,class:"note-content"},_5={key:2,class:"empty-state"},w5={__name:"NotesPreviewForArea",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=T(!1),l=T(""),u=T(""),d=T([...a.modelValue]);qe(()=>a.modelValue,y=>{d.value=[...y]},{deep:!0});const h=()=>{!l.value.trim()&&!u.value.trim()||(d.value.push({title:l.value.trim(),content:u.value.trim(),isNew:!0}),l.value="",u.value="",i.value=!1,g())},p=y=>{d.value.splice(y,1),g()},g=()=>{s("update:modelValue",[...d.value]),s("change")};return(y,b)=>(v(),m("div",c5,[r("div",u5,[r("p",d5," Add new note for this "+w(O(n).area)+": ",1),r("button",{type:"button",class:"add-item-btn",onClick:b[0]||(b[0]=C=>i.value=!i.value)},w(i.value?"Cancel":"Add note"),1)]),i.value?(v(),m("div",h5,[r("div",f5,[ze(r("input",{"onUpdate:modelValue":b[1]||(b[1]=C=>l.value=C),type:"text",placeholder:"Note title...",class:"add-item-input title-input"},null,512),[[nt,l.value]]),ze(r("textarea",{"onUpdate:modelValue":b[2]||(b[2]=C=>u.value=C),placeholder:"Note content...",class:"add-item-input content-input",rows:"3"},null,512),[[nt,u.value]])]),r("button",{type:"button",class:"save-item-btn",disabled:!l.value.trim()&&!u.value.trim(),onClick:h}," Add ",8,p5)])):P("",!0),d.value.length>0?(v(),m("div",v5,[(v(!0),m(Te,null,Fe(d.value,(C,I)=>(v(),m("div",{key:`pending-${I}`,class:"note-item pending"},[r("div",m5,[r("span",g5,w(C.title||"Untitled"),1),r("div",y5,[b[3]||(b[3]=r("span",{class:"scope-pill new-pill",title:"Will be created when saved"}," New ",-1)),r("button",{type:"button",class:"remove-item-btn",onClick:M=>p(I),title:"Remove"},"  ",8,k5)])]),C.content?(v(),m("div",b5,w(C.content),1)):P("",!0)]))),128))])):P("",!0),d.value.length===0&&!i.value?(v(),m("div",_5,[...b[4]||(b[4]=[r("p",null,"No new notes to add. Click the button above to create one.",-1)])])):P("",!0)]))}},C5=Ge(w5,[["__scopeId","data-v-5e6bdcab"]]),L5={class:"search-section"},S5={class:"form-group"},I5={class:"suggestions-list"},x5={class:"suggestion-content"},$5={key:0,class:"suggestion-detail"},T5=["onClick"],M5={class:"suggestion-content"},A5={class:"suggestion-name"},E5={key:0,class:"suggestion-detail"},P5=["onClick"],D5={class:"suggestion-content"},O5={class:"suggestion-name"},R5={key:0,class:"suggestion-detail"},B5={key:1,class:"no-results"},N5={key:2,class:"no-results"},F5={__name:"AddAreaContactModal",props:{show:{type:Boolean,default:!1},areaName:{type:String,default:""},areaId:{type:String,default:""},contacts:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},excludeContactIds:{type:Array,default:()=>[]}},emits:["close","select-contact","create-from-marshal","create-new"],setup(e,{emit:t}){const{terms:n}=rt(),a=e,s=t,i=T(""),l=T(null),u=z(()=>a.contacts.filter(A=>a.excludeContactIds.includes(A.contactId)&&A.marshalId).map(A=>A.marshalId)),d=z(()=>a.contacts.filter(A=>A.marshalId).map(A=>A.marshalId)),h=z(()=>a.contacts.filter(A=>!a.excludeContactIds.includes(A.contactId))),p=z(()=>a.marshals.filter(A=>!u.value.includes(A.id)&&!d.value.includes(A.id))),g=A=>A?A.toLowerCase().replace(/[.,\-_'"()]/g," ").replace(/\s+/g," ").trim():"",y=z(()=>{const A=g(i.value);return A?A.split(" ").filter(N=>N.length>0):[]}),b=(A,N)=>{if(N.length===0)return{score:1,isPartial:!1};const B=g(A);let j=0;for(const R of N)B.includes(R)&&j++;return{score:j,isPartial:j>0&&j<N.length,isFullMatch:j===N.length}},C=z(()=>{const A=y.value,N=[];return h.value.forEach(B=>{const j=`${B.name||""} ${B.role||""}`,R=b(j,A);(A.length===0||R.score>0)&&N.push({key:`contact-${B.contactId}`,type:"contact",name:B.name,detail:B.role?Z(B.role):null,data:B,matchScore:R.score,isPartial:R.isPartial,isFullMatch:R.isFullMatch})}),p.value.forEach(B=>{const j=`${B.name||""} ${B.email||""}`,R=b(j,A);(A.length===0||R.score>0)&&N.push({key:`marshal-${B.id}`,type:"marshal",name:B.name,detail:B.email||B.phoneNumber||null,data:B,matchScore:R.score,isPartial:R.isPartial,isFullMatch:R.isFullMatch})}),N.sort((B,j)=>j.matchScore!==B.matchScore?j.matchScore-B.matchScore:B.name.localeCompare(j.name,void 0,{sensitivity:"base"})),N}),I=z(()=>y.value.length===0?C.value:C.value.filter(A=>A.isFullMatch)),M=z(()=>y.value.length===0?[]:C.value.filter(A=>A.isPartial)),x=z(()=>M.value.length>0);qe(()=>a.show,async A=>{A&&(i.value="",await an(),l.value?.focus())});const S=A=>{const N=a.contacts.find(B=>B.marshalId===A.id);if(N){if(a.excludeContactIds.includes(N.contactId))return;s("select-contact",N)}else s("create-from-marshal",A)},_=A=>{s("select-contact",A)},D=()=>{s("create-new",i.value.trim())},E=()=>{s("close")},Z=A=>A?A.replace(/([A-Z])/g," $1").replace(/^./,N=>N.toUpperCase()).trim():"";return(A,N)=>(v(),Ze(jt,{show:e.show,title:`Add contact to ${e.areaName}`,size:"medium",onClose:E},{actions:He(()=>[r("button",{onClick:E,class:"btn btn-secondary"}," Cancel ")]),default:He(()=>[r("div",L5,[r("div",S5,[N[1]||(N[1]=r("label",null,"Search or create",-1)),ze(r("input",{ref_key:"searchInputRef",ref:l,"onUpdate:modelValue":N[0]||(N[0]=B=>i.value=B),type:"text",class:"form-input",placeholder:"Filter by name..."},null,512),[[nt,i.value]])]),r("div",I5,[r("div",{class:"suggestion-item create-new",onClick:D},[N[3]||(N[3]=r("span",{class:"suggestion-icon create-icon"},"+",-1)),r("div",x5,[N[2]||(N[2]=r("span",{class:"suggestion-name"},"Create new contact",-1)),i.value.trim()?(v(),m("span",$5,'"'+w(i.value.trim())+'"',1)):P("",!0)])]),(v(!0),m(Te,null,Fe(I.value,B=>(v(),m("div",{key:B.key,class:"suggestion-item",onClick:j=>B.type==="marshal"?S(B.data):_(B.data)},[r("span",{class:pe(["suggestion-icon",B.type==="marshal"?"marshal-icon":"contact-icon"])},w(B.type==="marshal"?"M":"C"),3),r("div",M5,[r("span",A5,w(B.name),1),B.detail?(v(),m("span",E5,w(B.detail),1)):P("",!0)]),r("span",{class:pe(["suggestion-badge",{"contact-badge":B.type==="contact"}])},w(B.type==="marshal"?O(n).person:"Contact"),3)],8,T5))),128)),x.value?(v(),m(Te,{key:0},[N[4]||(N[4]=r("div",{class:"suggestion-section-header"},"Partial matches",-1)),(v(!0),m(Te,null,Fe(M.value,B=>(v(),m("div",{key:B.key,class:"suggestion-item",onClick:j=>B.type==="marshal"?S(B.data):_(B.data)},[r("span",{class:pe(["suggestion-icon",B.type==="marshal"?"marshal-icon":"contact-icon"])},w(B.type==="marshal"?"M":"C"),3),r("div",D5,[r("span",O5,w(B.name),1),B.detail?(v(),m("span",R5,w(B.detail),1)):P("",!0)]),r("span",{class:pe(["suggestion-badge",{"contact-badge":B.type==="contact"}])},w(B.type==="marshal"?O(n).person:"Contact"),3)],8,P5))),128))],64)):P("",!0),i.value.trim()&&I.value.length===0&&M.value.length===0?(v(),m("div",B5," No matching "+w(O(n).people.toLowerCase())+" or contacts found. ",1)):P("",!0),!i.value.trim()&&I.value.length===0?(v(),m("div",N5," No "+w(O(n).people.toLowerCase())+" or contacts available to add. ",1)):P("",!0)])])]),_:1},8,["show","title"]))}},U5=Ge(F5,[["__scopeId","data-v-e25ca97b"]]),z5={key:0,class:"tab-content"},H5={class:"form-group"},V5=["disabled"],G5={class:"form-group"},j5={key:1,class:"tab-content"},Z5={class:"boundary-section"},q5={key:0,class:"boundary-preview"},W5={class:"boundary-actions"},K5={key:2,class:"tab-content"},J5={class:"contacts-header"},Y5={class:"section-title"},X5={key:3,class:"tab-content"},Q5={class:"section-title"},e8={key:4,class:"placeholder-message"},t8={key:7,class:"placeholder-message"},n8={key:10,class:"placeholder-message"},o8={key:11,class:"tab-content appearance-tab"},s8={class:"accordion-item"},a8=["innerHTML"],i8={class:"accordion-title"},l8={class:"accordion-arrow"},r8={key:0,class:"accordion-content"},c8={class:"section-description"},u8={class:"color-picker"},d8=["title","onClick"],h8={class:"accordion-item"},f8=["innerHTML"],p8={class:"accordion-title"},v8={class:"accordion-arrow"},m8={key:0,class:"accordion-content"},g8={class:"section-description"},y8={class:"accordion-item"},k8={class:"accordion-title"},b8={class:"accordion-preview"},_8={class:"accordion-arrow"},w8={key:0,class:"accordion-content"},C8={class:"section-description"},L8={class:"form-group"},S8={value:""},I8=["value"],x8={class:"accordion-item"},$8={class:"accordion-title"},T8={class:"accordion-preview"},M8={class:"accordion-arrow"},A8={key:0,class:"accordion-content"},E8={class:"section-description"},P8={class:"form-group"},D8={value:""},O8=["value"],R8={key:12,class:"tab-content incidents-tab"},B8={class:"incidents-list"},N8={class:"custom-footer"},F8={class:"footer-left"},bf="edit_area_accordion",U8={__name:"EditAreaModal",props:{show:{type:Boolean,default:!1},area:{type:Object,default:null},checkpoints:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},isDirty:{type:Boolean,default:!1},eventId:{type:String,required:!0},allLocations:{type:Array,default:()=>[]},assignments:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},contacts:{type:Array,default:()=>[]},eventDefaultStyleType:{type:String,default:"default"},eventDefaultStyleColor:{type:String,default:""},eventDefaultStyleBackgroundShape:{type:String,default:""},eventDefaultStyleBackgroundColor:{type:String,default:""},eventDefaultStyleBorderColor:{type:String,default:""},eventDefaultStyleIconColor:{type:String,default:""},eventDefaultStyleSize:{type:String,default:""},eventDefaultStyleMapRotation:{type:[String,Number],default:""},eventPeopleTerm:{type:String,default:"Marshals"},eventCheckpointTerm:{type:String,default:"Checkpoints"},incidents:{type:Array,default:()=>[]},initialTab:{type:String,default:"details"},route:{type:Array,default:()=>[]}},emits:["close","save","delete","draw-boundary","update:isDirty","select-checkpoint","create-contact-from-marshal","create-new-contact","edit-contact","select-incident"],setup(e,{expose:t,emit:n}){const{terms:a,termsLower:s}=rt(),i=()=>E.value.peopleTerm?E.value.peopleTerm:d.eventPeopleTerm||"Marshals",l=(q=!0)=>{const W=E.value.checkpointTerm||d.eventCheckpointTerm||"Checkpoints",ie=i();return q?Yv("checkpoint",W,ie):ti("checkpoint",W,ie)},u=(q=!0)=>l(q).toLowerCase(),d=e,h=n,p=T("details"),g=T(null),y=T([]),b=T({}),C=T({}),I=T(!1),M=T(!1),x=T([]),S=T([]),_=T([]),D=T([]),E=T({name:"",description:"",color:Tr,displayOrder:0,isDefault:!1,polygon:[],checkpointStyleType:"default",checkpointStyleColor:"",checkpointStyleBackgroundShape:"",checkpointStyleBackgroundColor:"",checkpointStyleBorderColor:"",checkpointStyleIconColor:"",checkpointStyleSize:"",checkpointStyleMapRotation:"",peopleTerm:"",checkpointTerm:""}),Z=()=>({name:"",description:"",color:q2(d.areas),displayOrder:d.areas.length,isDefault:!1,polygon:[],checkpointStyleType:"default",checkpointStyleColor:"",checkpointStyleBackgroundShape:"",checkpointStyleBackgroundColor:"",checkpointStyleBorderColor:"",checkpointStyleIconColor:"",checkpointStyleSize:"",checkpointStyleMapRotation:"",peopleTerm:"",checkpointTerm:""}),A=()=>d.eventId?`${bf}_${d.eventId}`:bf,N=T({polygonColor:!1,iconStyle:!1,peopleTerm:!1,checkpointTerm:!1});tn(()=>{const q=localStorage.getItem(A());if(q)try{const W=JSON.parse(q);N.value={...N.value,...W}}catch{}});const B=q=>{N.value[q]=!N.value[q],localStorage.setItem(A(),JSON.stringify(N.value))},j=z(()=>`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <polygon points="4,8 7,3 14,2 20,5 22,12 19,18 12,21 5,19 2,14" fill="${E.value.color||Tr}" stroke="#fff" stroke-width="1.5" opacity="0.8"/>
  </svg>`),R=z(()=>{const q=E.value.checkpointStyleType!=="default"||E.value.checkpointStyleBackgroundShape||E.value.checkpointStyleBackgroundColor||E.value.checkpointStyleBorderColor||E.value.checkpointStyleIconColor||E.value.checkpointStyleSize,W=d.eventDefaultStyleType!=="default"||d.eventDefaultStyleBackgroundShape||d.eventDefaultStyleBackgroundColor||d.eventDefaultStyleColor||d.eventDefaultStyleBorderColor||d.eventDefaultStyleIconColor||d.eventDefaultStyleSize;if(!q&&!W)return`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="areaDefaultGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#10B981"/>
          <stop offset="50%" style="stop-color:#F59E0B"/>
          <stop offset="100%" style="stop-color:#EF4444"/>
        </linearGradient>
      </defs>
      <circle cx="${24/2}" cy="${24/2}" r="${24/2-2}" fill="url(#areaDefaultGrad)" stroke="#fff" stroke-width="1.5"/>
    </svg>`;const ie=E.value.checkpointStyleType&&E.value.checkpointStyleType!=="default"?E.value.checkpointStyleType:d.eventDefaultStyleType&&d.eventDefaultStyleType!=="default"?d.eventDefaultStyleType:"default",Ue=E.value.checkpointStyleBackgroundShape||d.eventDefaultStyleBackgroundShape||"circle",et=E.value.checkpointStyleBackgroundColor||d.eventDefaultStyleBackgroundColor||d.eventDefaultStyleColor||"#667eea",dt=E.value.checkpointStyleBorderColor||d.eventDefaultStyleBorderColor||"#ffffff",yt=E.value.checkpointStyleIconColor||d.eventDefaultStyleIconColor||"#ffffff",mt=E.value.checkpointStyleSize||d.eventDefaultStyleSize||"100";return In({type:ie!=="default"?ie:Ue,backgroundShape:Ue,backgroundColor:et,borderColor:dt,iconColor:yt,size:mt,outputSize:24})}),G=z(()=>d.area&&d.area.id),ee=z(()=>!E.value.polygon||E.value.polygon.length===0?[]:E.value.polygon.map((q,W)=>({id:`polygon-point-${W}`,latitude:q.lat,longitude:q.lng}))),ne=z(()=>d.area?.id?d.areas.filter(q=>q.id!==d.area.id).map(q=>({...q,color:"#999999"})):d.areas.map(q=>({...q,color:"#999999"})));z(()=>ke.value.map(q=>q.id));const Ae=z(()=>{const q=[{value:"details",label:"Details",icon:"details"},{value:"boundary",label:"Boundary",icon:"area"},{value:"contacts",label:"Contacts",icon:"marshal"},{value:"checkpoints",label:l(),icon:"checkpoint"},{value:"checklists",label:a.value.checklists,icon:"checklist"},{value:"notes",label:"Notes",icon:"notes"},{value:"appearance",label:"Appearance",icon:"appearance"}];return d.incidents&&d.incidents.length>0&&q.push({value:"incidents",label:"Incidents",icon:"incidents"}),q}),J=z(()=>Ae.value.findIndex(q=>q.value===p.value)),te=z(()=>J.value===Ae.value.length-1),U=z(()=>te.value?null:Ae.value[J.value+1]),X=z(()=>U.value?`${U.value.label}...`:""),re=z(()=>{if(!d.area||!d.area.id)return[];const q=d.checkpoints.filter(W=>W.areaIds&&W.areaIds.includes(d.area.id)).map(W=>W.id);return d.assignments.filter(W=>q.includes(W.locationId))}),ke=z(()=>!d.area||!d.area.id?[]:d.checkpoints.filter(q=>q.areaIds&&q.areaIds.includes(d.area.id))),Re=z(()=>{const q=[...ke.value];return q.sort((W,ie)=>{const Ue=W.name.match(/^(\d+)/),et=ie.name.match(/^(\d+)/);if(Ue&&et){const dt=parseInt(Ue[1]),yt=parseInt(et[1]);if(dt!==yt)return dt-yt}return W.name.localeCompare(ie.name,void 0,{numeric:!0,sensitivity:"base"})}),q}),Xe=z(()=>!d.area||!d.area.id?[]:d.contacts.filter(q=>q.scopeConfigurations?q.scopeConfigurations.some(W=>W.scope==="EveryoneInAreas"&&W.itemType==="Area"?W.ids?.includes("ALL_AREAS")?!0:W.ids?.includes(d.area.id):!1):!1)),Ne=z(()=>{const q=new Set(Xe.value.map(Ue=>Ue.contactId)),W=Xe.value.map(Ue=>({...Ue,isPending:!1,isExisting:!0,isMarkedForRemoval:S.value.includes(Ue.contactId)})),ie=x.value.filter(Ue=>!q.has(Ue.contactId)).map(Ue=>({...Ue,isPending:!0,isExisting:!1,isMarkedForRemoval:!1}));return[...W,...ie].sort((Ue,et)=>Ue.name.localeCompare(et.name,void 0,{sensitivity:"base"}))}),Ke=z(()=>{const q=Xe.value.map(ie=>ie.contactId),W=x.value.map(ie=>ie.contactId);return[...q,...W]}),We=async q=>{if(!(b.value[q]||C.value[q])){C.value[q]=!0;try{const ie=(await Nt.getCheckpointChecklist(d.eventId,q)).data||[];b.value[q]={total:ie.length,completed:ie.filter(Ue=>Ue.isCompleted).length}}catch(W){console.error("Failed to load checklist status for checkpoint:",q,W),b.value[q]={total:0,completed:0}}finally{C.value[q]=!1}}};qe(()=>d.area,q=>{if(q){const W=q.polygon?typeof q.polygon=="string"?JSON.parse(q.polygon):q.polygon:[];E.value={name:q.name||"",description:q.description||"",color:q.color||Tr,displayOrder:q.displayOrder||0,isDefault:q.isDefault||!1,polygon:W,checkpointStyleType:q.checkpointStyleType||"default",checkpointStyleColor:q.checkpointStyleColor||"",checkpointStyleBackgroundShape:q.checkpointStyleBackgroundShape||"",checkpointStyleBackgroundColor:q.checkpointStyleBackgroundColor||"",checkpointStyleBorderColor:q.checkpointStyleBorderColor||"",checkpointStyleIconColor:q.checkpointStyleIconColor||"",checkpointStyleSize:q.checkpointStyleSize||"",checkpointStyleMapRotation:q.checkpointStyleMapRotation??"",peopleTerm:q.peopleTerm||"",checkpointTerm:q.checkpointTerm||""}}else E.value=Z()},{immediate:!0,deep:!0}),qe(()=>d.show,q=>{q&&(p.value=d.initialTab||"details",y.value=[],b.value={},C.value={},x.value=[],S.value=[],_.value=[],D.value=[],M.value=!1,G.value||(E.value=Z()),g.value?.resetLocalState&&g.value.resetLocalState())}),qe(p,q=>{q==="checkpoints"&&d.area&&d.area.id&&ke.value.forEach(W=>{setTimeout(()=>We(W.id),0)})});const Q=()=>{h("update:isDirty",!0)},ge=q=>{E.value.color=q,Q()},Ce=(q,W)=>{E.value[q]=W,Q()},ve=()=>{h("draw-boundary",E.value)},ue=q=>{E.value.polygon=q,Q()},F=()=>{E.value.polygon=[],I.value=!1,Q()},K=q=>{M.value=!1,h("create-contact-from-marshal",{marshal:q,area:d.area})},ae=q=>{M.value=!1,h("create-new-contact",{name:q,area:d.area})},$e=q=>{x.value.find(W=>W.contactId===q.contactId)||(x.value.push(q),Q()),M.value=!1},Be=q=>{x.value=x.value.filter(W=>W.contactId!==q),Q()},Oe=q=>{S.value.includes(q)||(S.value.push(q),Q())},Le=q=>q.isPending?"Remove pending contact":`Remove from ${s.value.area}`,Y=q=>{Ne.value.find(ie=>ie.contactId===q)?.isPending?Be(q):Oe(q)},he=q=>{S.value=S.value.filter(W=>W!==q),Q()},xe=q=>{y.value=q,Q()},Ie=()=>{U.value&&(p.value=U.value.value)},be=()=>{const q=d.area?{name:E.value.name,description:E.value.description,color:E.value.color,polygon:E.value.polygon.length>0?E.value.polygon:null,displayOrder:E.value.displayOrder,checkpointStyleType:E.value.checkpointStyleType,checkpointStyleColor:E.value.checkpointStyleColor,checkpointStyleBackgroundShape:E.value.checkpointStyleBackgroundShape,checkpointStyleBackgroundColor:E.value.checkpointStyleBackgroundColor,checkpointStyleBorderColor:E.value.checkpointStyleBorderColor,checkpointStyleIconColor:E.value.checkpointStyleIconColor,checkpointStyleSize:E.value.checkpointStyleSize,checkpointStyleMapRotation:E.value.checkpointStyleMapRotation!=null&&E.value.checkpointStyleMapRotation!==""?String(E.value.checkpointStyleMapRotation):null,peopleTerm:E.value.peopleTerm,checkpointTerm:E.value.checkpointTerm,checklistChanges:y.value||[],pendingContacts:x.value||[],contactsToRemove:S.value||[],pendingNewChecklistItems:_.value||[],pendingNewNotes:D.value||[]}:{name:E.value.name,description:E.value.description,color:E.value.color,polygon:E.value.polygon.length>0?E.value.polygon:null,checkpointStyleType:E.value.checkpointStyleType,checkpointStyleColor:E.value.checkpointStyleColor,checkpointStyleBackgroundShape:E.value.checkpointStyleBackgroundShape,checkpointStyleBackgroundColor:E.value.checkpointStyleBackgroundColor,checkpointStyleBorderColor:E.value.checkpointStyleBorderColor,checkpointStyleIconColor:E.value.checkpointStyleIconColor,checkpointStyleSize:E.value.checkpointStyleSize,checkpointStyleMapRotation:E.value.checkpointStyleMapRotation!=null&&E.value.checkpointStyleMapRotation!==""?String(E.value.checkpointStyleMapRotation):null,peopleTerm:E.value.peopleTerm,checkpointTerm:E.value.checkpointTerm,pendingContacts:x.value||[]};h("save",q)},de=()=>{h("delete",d.area.id)},fe=()=>{h("close")};return t({addPendingContact:q=>{q&&!x.value.find(W=>W.contactId===q.contactId)&&(x.value.push(q),Q())},removeContactById:q=>{const W=x.value.some(ie=>ie.contactId===q);x.value=x.value.filter(ie=>ie.contactId!==q),S.value=S.value.filter(ie=>ie!==q),W&&Q()}}),(q,W)=>(v(),Ze(jt,{show:e.show,title:e.area&&e.area.id?`Edit ${O(s).area}: ${e.area.name}`:`Create new ${O(s).area}`,size:"large","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:fe},{"tab-header":He(()=>[Me(Yi,{modelValue:p.value,"onUpdate:modelValue":W[0]||(W[0]=ie=>p.value=ie),tabs:Ae.value},null,8,["modelValue","tabs"])]),footer:He(()=>[r("div",N8,[r("div",F8,[G.value&&!E.value.isDefault?(v(),m("button",{key:0,type:"button",onClick:de,class:"btn btn-danger"}," Delete ")):P("",!0),!G.value&&!te.value?(v(),m("button",{key:1,type:"button",onClick:Ie,class:"btn btn-secondary mobile-only"},w(X.value),1)):P("",!0)]),r("button",{type:"button",onClick:be,class:"btn btn-success"}," Save ")])]),default:He(()=>[p.value==="details"?(v(),m("div",z5,[r("form",{onSubmit:it(be,["prevent"])},[r("div",H5,[W[27]||(W[27]=r("label",null,"Name *",-1)),ze(r("input",{"onUpdate:modelValue":W[1]||(W[1]=ie=>E.value.name=ie),type:"text",required:"",class:"form-input",disabled:E.value.isDefault,onInput:Q},null,40,V5),[[nt,E.value.name]])]),r("div",G5,[W[28]||(W[28]=r("label",null,"Description",-1)),ze(r("textarea",{"onUpdate:modelValue":W[2]||(W[2]=ie=>E.value.description=ie),class:"form-input",rows:"3",onInput:Q},null,544),[[nt,E.value.description]])])],32)])):P("",!0),p.value==="boundary"?(v(),m("div",j5,[r("div",Z5,[E.value.polygon&&E.value.polygon.length>0?(v(),m("div",q5,[Me(fi,{mode:"edit-polygon","editing-polygon":E.value.polygon,route:e.route,locations:e.checkpoints,areas:ne.value,"all-locations-for-bounds":ee.value,height:"300px",onPolygonUpdate:ue},null,8,["editing-polygon","route","locations","areas","all-locations-for-bounds"]),W[29]||(W[29]=r("p",{class:"boundary-hint"},"Drag points to move them. Click a point to delete it (minimum 3 required).",-1))])):P("",!0),r("div",W5,[!E.value.polygon||E.value.polygon.length===0?(v(),m("button",{key:0,onClick:ve,class:"btn btn-primary btn-full"}," Draw on map ")):(v(),m(Te,{key:1},[r("button",{onClick:ve,class:"btn btn-secondary"}," Redraw "),r("button",{onClick:W[3]||(W[3]=ie=>I.value=!0),class:"btn btn-danger"}," Delete boundary ")],64))])])])):P("",!0),Me(Aa,{show:I.value,title:"Delete boundary",message:"Are you sure you want to delete this boundary? This cannot be undone.","confirm-text":"Delete","is-danger":!0,onConfirm:F,onCancel:W[4]||(W[4]=ie=>I.value=!1)},null,8,["show"]),p.value==="contacts"?(v(),m("div",K5,[r("div",J5,[r("h3",Y5,w(O(a).area)+" contacts ("+w(Ne.value.length)+")",1),r("button",{onClick:W[5]||(W[5]=ie=>M.value=!0),class:"btn btn-primary btn-small"}," Add contact ")]),Me(sm,{contacts:Ne.value,"show-remove-button":!0,"remove-title":Le,"empty-message":`No contacts assigned to this ${O(s).area}.`,"empty-hint":`Click 'Add contact' to assign contacts who will be visible to ${O(s).people} in this ${O(s).area}.`,onSelect:W[6]||(W[6]=ie=>q.$emit("edit-contact",ie)),onRemove:Y,onUndoRemove:he},null,8,["contacts","empty-message","empty-hint"])])):P("",!0),Me(U5,{show:M.value,"area-name":E.value.name||"this "+O(s).area,"area-id":d.area?.id||"",contacts:d.contacts,marshals:d.marshals,"exclude-contact-ids":Ke.value,onClose:W[7]||(W[7]=ie=>M.value=!1),onSelectContact:$e,onCreateFromMarshal:K,onCreateNew:ae},null,8,["show","area-name","area-id","contacts","marshals","exclude-contact-ids"]),p.value==="checkpoints"&&G.value?(v(),m("div",X5,[r("h3",Q5,w(l())+" in "+w(e.area?.name)+" ("+w(ke.value.length)+")",1),Me(rm,{checkpoints:Re.value,areas:e.areas,"empty-message":`No ${u()} in this ${O(s).area} yet.`,onSelect:W[8]||(W[8]=ie=>q.$emit("select-checkpoint",ie))},null,8,["checkpoints","areas","empty-message"])])):P("",!0),p.value==="checkpoints"&&!G.value?(v(),m("div",e8,[r("p",null,w(l())+" will be automatically assigned based on boundaries after the "+w(O(s).area)+" is created.",1)])):P("",!0),p.value==="checklists"&&G.value?(v(),Ze(um,{key:5,ref_key:"checklistTabRef",ref:g,modelValue:y.value,"onUpdate:modelValue":W[9]||(W[9]=ie=>y.value=ie),"event-id":e.eventId,"area-id":e.area.id,locations:e.allLocations,areas:e.areas,assignments:re.value,marshals:e.marshals,onChange:xe},null,8,["modelValue","event-id","area-id","locations","areas","assignments","marshals"])):P("",!0),p.value==="checklists"&&G.value?(v(),Ze(r5,{key:6,modelValue:_.value,"onUpdate:modelValue":W[10]||(W[10]=ie=>_.value=ie),onChange:Q},null,8,["modelValue"])):P("",!0),p.value==="checklists"&&!G.value?(v(),m("div",t8,[r("p",null,w(O(a).checklists)+" can be assigned after the "+w(O(s).area)+" is created.",1)])):P("",!0),p.value==="notes"&&G.value?(v(),Ze(Lc,{key:8,"event-id":e.eventId,"area-id":e.area?.id,"all-notes":e.notes,locations:e.allLocations,areas:e.areas,assignments:e.assignments,marshals:e.marshals},null,8,["event-id","area-id","all-notes","locations","areas","assignments","marshals"])):P("",!0),p.value==="notes"&&G.value?(v(),Ze(C5,{key:9,modelValue:D.value,"onUpdate:modelValue":W[11]||(W[11]=ie=>D.value=ie),onChange:Q},null,8,["modelValue"])):P("",!0),p.value==="notes"&&!G.value?(v(),m("div",n8,[r("p",null,"Notes can be viewed after the "+w(O(s).area)+" is created.",1)])):P("",!0),p.value==="appearance"?(v(),m("div",o8,[r("div",s8,[r("button",{type:"button",class:pe(["accordion-header",{expanded:N.value.polygonColor}]),onClick:W[12]||(W[12]=ie=>B("polygonColor"))},[r("div",{class:"accordion-icon",innerHTML:j.value},null,8,a8),r("span",i8,w(O(a).area)+" polygon colour",1),r("span",l8,w(N.value.polygonColor?"":""),1)],2),N.value.polygonColor?(v(),m("div",r8,[r("p",c8," Choose a colour for this "+w(O(s).area)+"'s boundary on the map. ",1),r("div",u8,[(v(!0),m(Te,null,Fe(O(Pn),ie=>(v(),m("div",{key:ie.hex,class:pe(["color-swatch",{selected:E.value.color===ie.hex}]),style:Qe({backgroundColor:ie.hex}),title:ie.name,onClick:Ue=>ge(ie.hex)},null,14,d8))),128))])])):P("",!0)]),r("div",h8,[r("button",{type:"button",class:pe(["accordion-header",{expanded:N.value.iconStyle}]),onClick:W[13]||(W[13]=ie=>B("iconStyle"))},[r("div",{class:"accordion-icon",innerHTML:R.value},null,8,f8),r("span",p8,w(l(!1))+" marker style",1),r("span",v8,w(N.value.iconStyle?"":""),1)],2),N.value.iconStyle?(v(),m("div",m8,[r("p",g8," Set a default marker style for all "+w(u())+" in this "+w(O(s).area)+". Individual "+w(u())+" can override this setting. ",1),Me(pd,{"style-type":E.value.checkpointStyleType||"default","style-color":E.value.checkpointStyleColor||"","style-background-shape":E.value.checkpointStyleBackgroundShape||"","style-background-color":E.value.checkpointStyleBackgroundColor||"","style-border-color":E.value.checkpointStyleBorderColor||"","style-icon-color":E.value.checkpointStyleIconColor||"","style-size":E.value.checkpointStyleSize||"","style-map-rotation":E.value.checkpointStyleMapRotation??"","inherited-style-type":e.eventDefaultStyleType,"inherited-style-color":e.eventDefaultStyleColor,"inherited-background-shape":e.eventDefaultStyleBackgroundShape||"","inherited-background-color":e.eventDefaultStyleBackgroundColor||e.eventDefaultStyleColor||"","inherited-border-color":e.eventDefaultStyleBorderColor||"","inherited-icon-color":e.eventDefaultStyleIconColor||"","inherited-size":e.eventDefaultStyleSize||"","inherited-map-rotation":e.eventDefaultStyleMapRotation??"","default-label":"Event default","icon-label":"Marker style",level:"area","show-preview":!0,"onUpdate:styleType":W[14]||(W[14]=ie=>Ce("checkpointStyleType",ie)),"onUpdate:styleColor":W[15]||(W[15]=ie=>Ce("checkpointStyleColor",ie)),"onUpdate:styleBackgroundShape":W[16]||(W[16]=ie=>Ce("checkpointStyleBackgroundShape",ie)),"onUpdate:styleBackgroundColor":W[17]||(W[17]=ie=>Ce("checkpointStyleBackgroundColor",ie)),"onUpdate:styleBorderColor":W[18]||(W[18]=ie=>Ce("checkpointStyleBorderColor",ie)),"onUpdate:styleIconColor":W[19]||(W[19]=ie=>Ce("checkpointStyleIconColor",ie)),"onUpdate:styleSize":W[20]||(W[20]=ie=>Ce("checkpointStyleSize",ie)),"onUpdate:styleMapRotation":W[21]||(W[21]=ie=>Ce("checkpointStyleMapRotation",ie))},null,8,["style-type","style-color","style-background-shape","style-background-color","style-border-color","style-icon-color","style-size","style-map-rotation","inherited-style-type","inherited-style-color","inherited-background-shape","inherited-background-color","inherited-border-color","inherited-icon-color","inherited-size","inherited-map-rotation"])])):P("",!0)]),r("div",y8,[r("button",{type:"button",class:pe(["accordion-header",{expanded:N.value.peopleTerm}]),onClick:W[22]||(W[22]=ie=>B("peopleTerm"))},[W[30]||(W[30]=r("div",{class:"accordion-icon"},[r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[r("circle",{cx:"12",cy:"8",r:"4",fill:"#6366F1"}),r("path",{d:"M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8",fill:"#6366F1",opacity:"0.6"})])],-1)),r("span",k8,w(i())+" terminology",1),r("span",b8,w(E.value.peopleTerm||`${e.eventPeopleTerm} (event default)`),1),r("span",_8,w(N.value.peopleTerm?"":""),1)],2),N.value.peopleTerm?(v(),m("div",w8,[r("p",C8," Choose what "+w(i().toLowerCase())+" are called in this "+w(O(s).area)+". This will be inherited by "+w(u())+" unless they override it. ",1),r("div",L8,[W[31]||(W[31]=r("label",null,"What are people called?",-1)),ze(r("select",{"onUpdate:modelValue":W[23]||(W[23]=ie=>E.value.peopleTerm=ie),class:"form-input",onChange:Q},[r("option",S8,"Use event default ("+w(e.eventPeopleTerm)+")",1),(v(!0),m(Te,null,Fe(O(zs).people,ie=>(v(),m("option",{key:ie,value:ie},w(ie),9,I8))),128))],544),[[Fn,E.value.peopleTerm]])])])):P("",!0)]),r("div",x8,[r("button",{type:"button",class:pe(["accordion-header",{expanded:N.value.checkpointTerm}]),onClick:W[24]||(W[24]=ie=>B("checkpointTerm"))},[W[32]||(W[32]=r("div",{class:"accordion-icon"},[r("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z",fill:"#10B981"}),r("circle",{cx:"12",cy:"9",r:"2.5",fill:"white"})])],-1)),r("span",$8,w(l(!1))+" terminology",1),r("span",T8,w(E.value.checkpointTerm?O(Au)(E.value.checkpointTerm,i()):`${e.eventCheckpointTerm} (event default)`),1),r("span",M8,w(N.value.checkpointTerm?"":""),1)],2),N.value.checkpointTerm?(v(),m("div",A8,[r("p",E8," Choose what "+w(u())+" are called in this "+w(O(s).area)+". ",1),r("div",P8,[r("label",null,"What are "+w(u())+" called?",1),ze(r("select",{"onUpdate:modelValue":W[25]||(W[25]=ie=>E.value.checkpointTerm=ie),class:"form-input",onChange:Q},[r("option",D8,"Use event default ("+w(e.eventCheckpointTerm)+")",1),(v(!0),m(Te,null,Fe(O(zs).checkpoint,ie=>(v(),m("option",{key:ie,value:ie},w(O(Au)(ie,i())),9,O8))),128))],544),[[Fn,E.value.checkpointTerm]])])])):P("",!0)])])):P("",!0),p.value==="incidents"?(v(),m("div",R8,[r("div",B8,[(v(!0),m(Te,null,Fe(e.incidents,ie=>(v(),Ze(tr,{key:ie.incidentId,incident:ie,onSelect:W[26]||(W[26]=Ue=>q.$emit("select-incident",Ue))},null,8,["incident"]))),128))])])):P("",!0)]),_:1},8,["show","title","is-dirty"]))}},z8=Ge(U8,[["__scopeId","data-v-1f35a436"]]),H8=["innerHTML"],V8={__name:"InfoModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Information"},message:{type:String,required:!0},okText:{type:String,default:"OK"}},emits:["close"],setup(e,{emit:t}){const n=t,a=()=>{n("close")};return(s,i)=>(v(),Ze(jt,{show:e.show,title:e.title,size:"small","z-index":2e3,onClose:a},{actions:He(()=>[r("button",{onClick:a,class:"btn btn-primary"},w(e.okText),1)]),default:He(()=>[r("div",{class:"info-content",innerHTML:e.message},null,8,H8)]),_:1},8,["show","title"]))}},Sc=Ge(V8,[["__scopeId","data-v-a6e7148c"]]),G8={class:"tab-content"},j8={class:"form-group"},Z8={for:"text"},q8=["placeholder"],W8={key:0,class:"checkbox-label-inline create-separate-items"},K8={class:"tab-content"},J8={class:"custom-footer"},Y8={class:"footer-left"},X8={__name:"EditChecklistItemModal",props:{show:{type:Boolean,default:!1},checklistItem:{type:Object,default:null},initialTab:{type:String,default:"details"},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},isDirty:{type:Boolean,default:!1}},emits:["close","save","delete","update:isDirty"],setup(e,{emit:t}){const{termsLower:n,termsSentence:a}=rt(),s=e,i=t,l=T(!1),u=T(""),d=T("details"),h=T({text:"",scopeConfigurations:[{scope:"Everyone",itemType:null,ids:[]}],displayOrder:0,isRequired:!0,visibleFrom:null,visibleUntil:null,mustCompleteBy:null,createSeparateItems:!0}),p=z(()=>!!s.checklistItem),g=[{value:"details",label:"Details"},{value:"visibility",label:"Visibility"}],y=z(()=>g.findIndex(A=>A.value===d.value)),b=z(()=>y.value===g.length-1),C=z(()=>b.value?"":g[y.value+1]?.label||"");qe(()=>s.show,A=>{A&&(d.value=s.initialTab,s.checklistItem?h.value={text:s.checklistItem.text||"",scopeConfigurations:s.checklistItem.scopeConfigurations?JSON.parse(JSON.stringify(s.checklistItem.scopeConfigurations)):[{scope:"Everyone",itemType:null,ids:[]}],displayOrder:s.checklistItem.displayOrder||0,isRequired:s.checklistItem.isRequired!==!1,visibleFrom:s.checklistItem.visibleFrom?I(s.checklistItem.visibleFrom):null,visibleUntil:s.checklistItem.visibleUntil?I(s.checklistItem.visibleUntil):null,mustCompleteBy:s.checklistItem.mustCompleteBy?I(s.checklistItem.mustCompleteBy):null,createSeparateItems:!1}:h.value={text:"",scopeConfigurations:[{scope:"Everyone",itemType:null,ids:[]}],displayOrder:0,isRequired:!0,visibleFrom:null,visibleUntil:null,mustCompleteBy:null,createSeparateItems:!0},i("update:isDirty",!1))});const I=A=>{if(!A)return null;const N=new Date(A),B=N.getTimezoneOffset();return new Date(N.getTime()-B*60*1e3).toISOString().slice(0,16)},M=A=>A?new Date(A).toISOString():null,x=()=>{i("update:isDirty",!0)},S=()=>{i("close")},_=()=>{b.value||(d.value=g[y.value+1].value)},D=A=>{u.value=A,l.value=!0},E=()=>{if(!h.value.text||!h.value.text.trim()){D(`Please enter ${n.value.checklist} text`);return}if(!h.value.scopeConfigurations||h.value.scopeConfigurations.length===0){D("Please select at least one scope");return}if(!h.value.scopeConfigurations.some(B=>!(B.itemType!==null&&(!B.ids||B.ids.length===0)))){D("Please configure at least one scope with valid selections");return}const N={text:h.value.text,scopeConfigurations:h.value.scopeConfigurations,displayOrder:h.value.displayOrder||0,isRequired:h.value.isRequired,visibleFrom:M(h.value.visibleFrom),visibleUntil:M(h.value.visibleUntil),mustCompleteBy:M(h.value.mustCompleteBy)};p.value||(N.createSeparateItems=h.value.createSeparateItems),i("save",N)},Z=()=>{i("delete",s.checklistItem.itemId)};return(A,N)=>(v(),m(Te,null,[Me(jt,{show:e.show,title:p.value?`Edit ${O(n).checklist}`:`Create ${O(n).checklist}`,size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:S},{"tab-header":He(()=>[Me(Yi,{modelValue:d.value,"onUpdate:modelValue":N[0]||(N[0]=B=>d.value=B),tabs:g},null,8,["modelValue"])]),footer:He(()=>[r("div",J8,[r("div",Y8,[p.value?(v(),m("button",{key:0,type:"button",onClick:Z,class:"btn btn-danger"}," Delete ")):P("",!0),!p.value&&!b.value?(v(),m("button",{key:1,type:"button",onClick:_,class:"btn btn-secondary mobile-only"},w(C.value)+"... ",1)):P("",!0)]),r("button",{type:"button",onClick:E,class:"btn btn-success"}," Save ")])]),default:He(()=>[r("form",{onSubmit:it(E,["prevent"]),class:"checklist-form"},[ze(r("div",G8,[r("div",j8,[r("label",Z8,w(O(a).checklist)+" text: *",1),ze(r("textarea",{id:"text","onUpdate:modelValue":N[1]||(N[1]=B=>h.value.text=B),onInput:x,required:"",rows:"3",placeholder:h.value.createSeparateItems?`Enter ${O(n).checklists}, one per line...`:`Enter the ${O(n).checklist} text...`},null,40,q8),[[nt,h.value.text]]),p.value?P("",!0):(v(),m("label",W8,[ze(r("input",{type:"checkbox","onUpdate:modelValue":N[2]||(N[2]=B=>h.value.createSeparateItems=B),onChange:x},null,544),[[Ws,h.value.createSeparateItems]]),N[5]||(N[5]=r("span",null,"Each line creates a new item",-1))]))])],512),[[ws,d.value==="details"]]),ze(r("div",K8,[Me(Cc,{modelValue:h.value.scopeConfigurations,"onUpdate:modelValue":N[3]||(N[3]=B=>h.value.scopeConfigurations=B),areas:e.areas,locations:e.locations,marshals:e.marshals,"is-editing":p.value,onUserChanged:x},null,8,["modelValue","areas","locations","marshals","is-editing"])],512),[[ws,d.value==="visibility"]])],32)]),_:1},8,["show","title","is-dirty"]),Me(Sc,{show:l.value,title:"Validation error",message:u.value,onClose:N[4]||(N[4]=B=>l.value=!1)},null,8,["show","message"])],64))}},Q8=Ge(X8,[["__scopeId","data-v-eddaaf3c"]]),eD={class:"tab-content"},tD={class:"form-group"},nD={class:"form-group"},oD={class:"form-row"},sD={class:"form-group"},aD={class:"checkbox-label-inline show-emergency-checkbox"},iD={class:"form-group"},lD={class:"form-row"},rD={class:"form-group"},cD={class:"form-group checkbox-group-inline"},uD={class:"checkbox-label-inline"},dD={class:"tab-content"},hD={class:"custom-footer"},fD={class:"footer-left"},pD={__name:"EditNoteModal",props:{show:{type:Boolean,default:!1},note:{type:Object,default:null},initialTab:{type:String,default:"details"},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},isDirty:{type:Boolean,default:!1}},emits:["close","save","delete","update:isDirty"],setup(e,{emit:t}){const n=e,a=t,s=T(!1),i=T(""),l=T("details"),u=T({title:"",content:"",scopeConfigurations:[{scope:"SpecificPeople",itemType:"Marshal",ids:["ALL_MARSHALS"]}],displayOrder:0,priority:"Normal",category:"",isPinned:!1,showInEmergencyInfo:!1}),d=D=>D==="Urgent"||D==="Emergency",h=z(()=>!!n.note),p=[{value:"details",label:"Details"},{value:"visibility",label:"Visibility"}],g=z(()=>p.findIndex(D=>D.value===l.value)),y=z(()=>g.value===p.length-1),b=z(()=>y.value?"":p[g.value+1]?.label||"");qe(()=>n.show,D=>{D&&(l.value=n.initialTab,n.note?u.value={title:n.note.title||"",content:n.note.content||"",scopeConfigurations:n.note.scopeConfigurations?JSON.parse(JSON.stringify(n.note.scopeConfigurations)):[{scope:"SpecificPeople",itemType:"Marshal",ids:["ALL_MARSHALS"]}],displayOrder:n.note.displayOrder||0,priority:n.note.priority||"Normal",category:n.note.category||"",isPinned:n.note.isPinned||!1,showInEmergencyInfo:n.note.showInEmergencyInfo??d(n.note.priority)}:u.value={title:"",content:"",scopeConfigurations:[{scope:"SpecificPeople",itemType:"Marshal",ids:["ALL_MARSHALS"]}],displayOrder:0,priority:"Normal",category:"",isPinned:!1,showInEmergencyInfo:!1},a("update:isDirty",!1))}),qe(()=>u.value.priority,(D,E)=>{!h.value&&D!==E&&(d(D)?u.value.showInEmergencyInfo=!0:d(E)&&(u.value.showInEmergencyInfo=!1))});const C=()=>{a("update:isDirty",!0)},I=()=>{a("close")},M=()=>{y.value||(l.value=p[g.value+1].value)},x=D=>{i.value=D,s.value=!0},S=()=>{if(!u.value.title||!u.value.title.trim()){x("Please enter a note title");return}if(!u.value.scopeConfigurations||u.value.scopeConfigurations.length===0){x("Please select at least one visibility scope");return}if(!u.value.scopeConfigurations.some(Z=>!(Z.itemType!==null&&(!Z.ids||Z.ids.length===0)))){x("Please configure at least one scope with valid selections");return}const E={title:u.value.title.trim(),content:u.value.content||"",scopeConfigurations:u.value.scopeConfigurations,displayOrder:u.value.displayOrder||0,priority:u.value.priority||"Normal",category:u.value.category?.trim()||null,isPinned:u.value.isPinned||!1,showInEmergencyInfo:u.value.showInEmergencyInfo};a("save",E)},_=()=>{a("delete",n.note.noteId)};return(D,E)=>(v(),m(Te,null,[Me(jt,{show:e.show,title:h.value?"Edit note":"Create note",size:"large","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:I},{"tab-header":He(()=>[Me(Yi,{modelValue:l.value,"onUpdate:modelValue":E[0]||(E[0]=Z=>l.value=Z),tabs:p},null,8,["modelValue"])]),footer:He(()=>[r("div",hD,[r("div",fD,[h.value?(v(),m("button",{key:0,type:"button",onClick:_,class:"btn btn-danger"}," Delete ")):P("",!0),!h.value&&!y.value?(v(),m("button",{key:1,type:"button",onClick:M,class:"btn btn-secondary mobile-only"},w(b.value)+"... ",1)):P("",!0)]),r("button",{type:"button",onClick:S,class:"btn btn-success"}," Save ")])]),default:He(()=>[r("form",{onSubmit:it(S,["prevent"]),class:"note-form"},[ze(r("div",eD,[r("div",tD,[E[10]||(E[10]=r("label",{for:"title"},"Title: *",-1)),ze(r("input",{id:"title","onUpdate:modelValue":E[1]||(E[1]=Z=>u.value.title=Z),type:"text",onInput:C,required:"",placeholder:"Enter note title..."},null,544),[[nt,u.value.title]])]),r("div",nD,[E[11]||(E[11]=r("label",{for:"content"},"Content:",-1)),ze(r("textarea",{id:"content","onUpdate:modelValue":E[2]||(E[2]=Z=>u.value.content=Z),onInput:C,rows:"6",placeholder:"Enter note content (supports markdown)..."},null,544),[[nt,u.value.content]])]),r("div",oD,[r("div",sD,[E[14]||(E[14]=r("label",{for:"priority"},"Priority:",-1)),ze(r("select",{id:"priority","onUpdate:modelValue":E[3]||(E[3]=Z=>u.value.priority=Z),onChange:C},[...E[12]||(E[12]=[r("option",{value:"Emergency"},"Emergency",-1),r("option",{value:"Urgent"},"Urgent",-1),r("option",{value:"High"},"High",-1),r("option",{value:"Normal"},"Normal",-1),r("option",{value:"Low"},"Low",-1)])],544),[[Fn,u.value.priority]]),r("label",aD,[ze(r("input",{type:"checkbox","onUpdate:modelValue":E[4]||(E[4]=Z=>u.value.showInEmergencyInfo=Z),onChange:C},null,544),[[Ws,u.value.showInEmergencyInfo]]),E[13]||(E[13]=r("span",null,"Show in emergency info",-1))])]),r("div",iD,[E[15]||(E[15]=r("label",{for:"category"},"Category:",-1)),ze(r("input",{id:"category","onUpdate:modelValue":E[5]||(E[5]=Z=>u.value.category=Z),type:"text",onInput:C,placeholder:"e.g., Safety, Logistics..."},null,544),[[nt,u.value.category]])])]),r("div",lD,[r("div",rD,[E[16]||(E[16]=r("label",{for:"displayOrder"},"Display order:",-1)),ze(r("input",{id:"displayOrder","onUpdate:modelValue":E[6]||(E[6]=Z=>u.value.displayOrder=Z),type:"number",onInput:C,min:"0"},null,544),[[nt,u.value.displayOrder,void 0,{number:!0}]]),E[17]||(E[17]=r("span",{class:"help-text"},"Lower numbers appear first",-1))]),r("div",cD,[r("label",uD,[ze(r("input",{type:"checkbox","onUpdate:modelValue":E[7]||(E[7]=Z=>u.value.isPinned=Z),onChange:C},null,544),[[Ws,u.value.isPinned]]),E[18]||(E[18]=r("span",null,"Pin to top",-1))]),E[19]||(E[19]=r("span",{class:"help-text"},"Pinned notes always appear at the top",-1))])])],512),[[ws,l.value==="details"]]),ze(r("div",dD,[Me(Cc,{modelValue:u.value.scopeConfigurations,"onUpdate:modelValue":E[8]||(E[8]=Z=>u.value.scopeConfigurations=Z),areas:e.areas,locations:e.locations,marshals:e.marshals,"is-editing":h.value,"exclude-scopes":["OnePerCheckpoint","OnePerArea","OneLeadPerArea"],"header-text":"Who can see this note?",onUserChanged:C},null,8,["modelValue","areas","locations","marshals","is-editing"])],512),[[ws,l.value==="visibility"]])],32)]),_:1},8,["show","title","is-dirty"]),Me(Sc,{show:s.value,title:"Validation error",message:i.value,onClose:E[9]||(E[9]=Z=>s.value=!1)},null,8,["show","message"])],64))}},vD=Ge(pD,[["__scopeId","data-v-e8488047"]]),mD={class:"incident-detail-header"},gD={class:"header-title-row"},yD={class:"modal-title"},kD={class:"header-badges"},bD=["disabled"],_D={key:0,class:"status-dropdown-menu"},wD=["onClick","disabled"],CD={key:0,class:"incident-detail-content"},LD={class:"accordion-section"},SD={class:"accordion-arrow"},ID={key:0,class:"accordion-content"},xD={class:"description-text"},$D={class:"accordion-section"},TD={class:"accordion-arrow"},MD={key:0,class:"accordion-content"},AD={class:"info-grid"},ED={class:"info-item"},PD={class:"info-value"},DD={class:"info-item"},OD={class:"info-value"},RD={key:0,class:"info-item"},BD={class:"info-label"},ND={class:"info-value"},FD={key:1,class:"info-item"},UD={class:"info-label"},zD={class:"info-value"},HD={key:2,class:"info-item"},VD={class:"info-value"},GD={key:0,class:"incident-map-container"},jD={class:"accordion-section"},ZD={class:"accordion-preview"},qD={class:"accordion-arrow"},WD={key:0,class:"accordion-content"},KD={class:"reporter-info"},JD={class:"reporter-name"},YD={key:0,class:"accordion-section"},XD={class:"accordion-title"},QD={class:"accordion-preview"},eO={class:"accordion-arrow"},tO={key:0,class:"accordion-content"},nO={class:"marshals-list"},oO={class:"marshal-name"},sO={key:0,class:"checkin-badge success"},aO={key:1,class:"checkin-badge not-checked-in"},iO={class:"accordion-section"},lO={key:0,class:"accordion-preview"},rO={class:"accordion-arrow"},cO={key:0,class:"accordion-content"},uO={key:0,class:"notes-timeline"},dO={class:"note-header"},hO={class:"note-author"},fO={class:"note-time"},pO={key:0,class:"note-status-change"},vO={key:1,class:"note-text"},mO={key:1,class:"no-notes"},gO={__name:"IncidentDetailModal",props:{show:{type:Boolean,required:!0},incident:{type:Object,default:null},canManage:{type:Boolean,default:!1},route:{type:Array,default:()=>[]},checkpoints:{type:Array,default:()=>[]}},emits:["close","status-change","open-add-note"],setup(e,{emit:t}){const{terms:n,termsSentence:a}=rt(),s=e,i=t,l=T(!1),u=T(!1),d=T(null),h=T({description:!0,timeLocation:!1,reporter:!1,marshals:!1,notes:!1});qe(()=>s.show,j=>{j&&(h.value={description:!0,timeLocation:!1,reporter:!1,marshals:!1,notes:!1},u.value=!1)});const p=j=>{d.value&&!d.value.contains(j.target)&&(u.value=!1)};qe(u,j=>{j?document.addEventListener("click",p):document.removeEventListener("click",p)});const g=()=>{u.value=!u.value},y=j=>{s.incident?.status!==j&&(u.value=!1,B(j))},b=j=>{const R=h.value[j];Object.keys(h.value).forEach(G=>{h.value[G]=!1}),R||(h.value[j]=!0)},C=z(()=>s.incident?.latitude!=null&&s.incident?.longitude!=null),I=z(()=>C.value?{lat:s.incident.latitude,lng:s.incident.longitude}:null),M=z(()=>C.value?{lat:s.incident.latitude,lng:s.incident.longitude}:null),x=z(()=>{if(!s.incident)return"Incident Details";if(s.incident.title)return s.incident.title;const j=s.incident.description||"";return j.length<=50?j:j.substring(0,47)+"..."}),S=z(()=>[...s.incident?.context?.marshalsPresentAtCheckpoint||[]].sort((R,G)=>(R.name||"").localeCompare(G.name||"",void 0,{sensitivity:"base"}))),_=[{value:"open",label:"Open"},{value:"acknowledged",label:"Acknowledged"},{value:"in_progress",label:"In Progress"},{value:"resolved",label:"Resolved"},{value:"closed",label:"Closed"}],D=j=>({low:"Low",medium:"Medium",high:"High",critical:"Critical"})[j]||j,E=j=>({open:"Open",acknowledged:"Acknowledged",in_progress:"In Progress",resolved:"Resolved",closed:"Closed"})[j]||j,Z=j=>{if(!j)return"";let R=j.name||"";if(j.description){const G=j.description,ee=40,ne=G.length>ee?G.substring(0,ee-3)+"...":G;R+=` - ${ne}`}return R},A=j=>j?new Date(j).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",N=j=>{if(!j)return"";const R=new Date(j),ee=new Date-R,ne=Math.floor(ee/6e4),Ae=Math.floor(ee/36e5),J=Math.floor(ee/864e5);return ne<1?"just now":ne<60?`${ne}m ago`:Ae<24?`${Ae}h ago`:J<7?`${J}d ago`:R.toLocaleDateString()},B=async j=>{if(s.incident?.status!==j){l.value=!0;try{i("status-change",{incidentId:s.incident.incidentId,status:j})}finally{l.value=!1}}};return(j,R)=>(v(),Ze(jt,{show:e.show,title:x.value,size:"large",onClose:R[7]||(R[7]=G=>j.$emit("close"))},{header:He(()=>[r("div",mD,[r("div",gD,[r("span",{class:pe(["severity-indicator",e.incident?.severity])},null,2),r("h2",yD,w(x.value),1)]),r("div",kD,[r("span",{class:pe(["severity-badge",e.incident?.severity])},w(D(e.incident?.severity)),3),e.canManage?(v(),m("div",{key:0,class:"status-dropdown-container",ref_key:"statusDropdownRef",ref:d},[r("button",{type:"button",class:pe(["status-badge status-dropdown-trigger",e.incident?.status]),onClick:g,disabled:l.value},[Ye(w(E(e.incident?.status))+" ",1),R[8]||(R[8]=r("span",{class:"dropdown-arrow"},"",-1))],10,bD),u.value?(v(),m("div",_D,[(v(),m(Te,null,Fe(_,G=>r("button",{key:G.value,type:"button",class:pe(["status-dropdown-item",{active:e.incident?.status===G.value}]),onClick:ee=>y(G.value),disabled:e.incident?.status===G.value},[r("span",{class:pe(["status-dot",G.value])},null,2),Ye(" "+w(G.label),1)],10,wD)),64))])):P("",!0)],512)):(v(),m("span",{key:1,class:pe(["status-badge",e.incident?.status])},w(E(e.incident?.status)),3))])])]),footer:He(()=>[r("button",{class:"btn btn-secondary",onClick:R[6]||(R[6]=G=>j.$emit("close"))},"Close")]),default:He(()=>[e.incident?(v(),m("div",CD,[r("div",LD,[r("button",{type:"button",class:pe(["accordion-header",{expanded:h.value.description}]),onClick:R[0]||(R[0]=G=>b("description"))},[R[9]||(R[9]=r("span",{class:"accordion-title"},"Description",-1)),r("span",SD,w(h.value.description?"":""),1)],2),h.value.description?(v(),m("div",ID,[r("p",xD,w(e.incident.description),1)])):P("",!0)]),r("div",$D,[r("button",{type:"button",class:pe(["accordion-header",{expanded:h.value.timeLocation}]),onClick:R[1]||(R[1]=G=>b("timeLocation"))},[R[10]||(R[10]=r("span",{class:"accordion-title"},"Time & location",-1)),r("span",TD,w(h.value.timeLocation?"":""),1)],2),h.value.timeLocation?(v(),m("div",MD,[r("div",AD,[r("div",ED,[R[11]||(R[11]=r("span",{class:"info-label"},"Incident time",-1)),r("span",PD,w(A(e.incident.incidentTime)),1)]),r("div",DD,[R[12]||(R[12]=r("span",{class:"info-label"},"Reported at",-1)),r("span",OD,w(A(e.incident.createdAt)),1)]),e.incident.context?.checkpoint?(v(),m("div",RD,[r("span",BD,w(O(a).checkpoint),1),r("span",ND,w(Z(e.incident.context.checkpoint)),1)])):P("",!0),e.incident.area?(v(),m("div",FD,[r("span",UD,w(O(a).area),1),r("span",zD,w(e.incident.area.areaName),1)])):P("",!0),C.value?(v(),m("div",HD,[R[13]||(R[13]=r("span",{class:"info-label"},"GPS location",-1)),r("span",VD,w(e.incident.latitude.toFixed(6))+", "+w(e.incident.longitude.toFixed(6)),1)])):P("",!0)]),C.value?(v(),m("div",GD,[Me(fi,{locations:e.checkpoints,route:e.route,center:I.value,zoom:15,"user-location":M.value,height:"200px"},null,8,["locations","route","center","user-location"])])):P("",!0)])):P("",!0)]),r("div",jD,[r("button",{type:"button",class:pe(["accordion-header",{expanded:h.value.reporter}]),onClick:R[2]||(R[2]=G=>b("reporter"))},[R[14]||(R[14]=r("span",{class:"accordion-title"},"Reported by",-1)),r("span",ZD,w(e.incident.reportedBy?.name||"Unknown"),1),r("span",qD,w(h.value.reporter?"":""),1)],2),h.value.reporter?(v(),m("div",WD,[r("div",KD,[r("span",JD,w(e.incident.reportedBy?.name||"Unknown"),1)])])):P("",!0)]),S.value.length?(v(),m("div",YD,[r("button",{type:"button",class:pe(["accordion-header",{expanded:h.value.marshals}]),onClick:R[3]||(R[3]=G=>b("marshals"))},[r("span",XD,w(O(n).peoplePlural)+" at "+w(O(n).checkpoint.toLowerCase()),1),r("span",QD,w(S.value.length),1),r("span",eO,w(h.value.marshals?"":""),1)],2),h.value.marshals?(v(),m("div",tO,[r("div",nO,[(v(!0),m(Te,null,Fe(S.value,G=>(v(),m("div",{key:G.marshalId,class:pe(["marshal-item",{"checked-in":G.wasCheckedIn}])},[r("span",oO,w(G.name),1),G.wasCheckedIn?(v(),m("span",sO," Checked in "+w(N(G.checkInTime)),1)):(v(),m("span",aO," Not checked in "))],2))),128))])])):P("",!0)])):P("",!0),r("div",iO,[r("button",{type:"button",class:pe(["accordion-header",{expanded:h.value.notes}]),onClick:R[4]||(R[4]=G=>b("notes"))},[R[15]||(R[15]=r("span",{class:"accordion-title"},"Updates",-1)),e.incident.updates?.length?(v(),m("span",lO,w(e.incident.updates.length),1)):P("",!0),r("span",rO,w(h.value.notes?"":""),1)],2),h.value.notes?(v(),m("div",cO,[e.incident.updates?.length?(v(),m("div",uO,[(v(!0),m(Te,null,Fe(e.incident.updates,(G,ee)=>(v(),m("div",{key:ee,class:"note-item"},[r("div",dO,[r("span",hO,w(G.authorName||"System"),1),r("span",fO,w(N(G.timestamp)),1)]),G.statusChange?(v(),m("div",pO,[R[16]||(R[16]=Ye(" Status changed to ",-1)),r("span",{class:pe(["status-badge",G.statusChange])},w(E(G.statusChange)),3)])):G.note?(v(),m("p",vO,w(G.note),1)):P("",!0)]))),128))])):(v(),m("div",mO," No updates yet. ")),r("button",{type:"button",class:"btn btn-primary add-note-btn",onClick:R[5]||(R[5]=G=>j.$emit("open-add-note"))}," Add update ")])):P("",!0)])])):P("",!0)]),_:1},8,["show","title"]))}},dm=Ge(gO,[["__scopeId","data-v-df0707d4"]]),yO={class:"form-group"},kO={class:"form-group"},bO={class:"form-row"},_O={class:"form-group form-group-half"},wO=["value"],CO={class:"form-group form-group-half"},LO={key:0,class:"form-group"},SO={for:"checkpoint",class:"form-label"},IO=["value"],xO={key:1,class:"form-group"},$O={class:"form-label"},TO={class:"checkpoint-toggle"},MO={class:"checkbox-label"},AO={class:"checkpoint-name"},EO={key:0,class:"checkpoint-description"},PO={class:"form-group"},DO={class:"location-options"},OO={class:"location-buttons"},RO={key:0,class:"location-status"},BO={key:0,class:"location-getting"},NO={key:1,class:"location-display"},FO={key:0,class:"location-accuracy"},UO={key:2,class:"location-error"},zO={key:1,class:"map-picker-container"},HO={key:0,class:"map-picker-hint"},VO={key:2,class:"location-display"},GO={key:2,class:"error-message"},jO={class:"modal-actions"},ZO=["disabled"],qO={__name:"ReportIncidentModal",props:{show:{type:Boolean,required:!0},eventId:{type:String,required:!0},checkpoint:{type:Object,default:null},initialLocation:{type:Object,default:null},checkpoints:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]}},emits:["close","submit"],setup(e,{emit:t}){const{termsSentence:n}=rt(),a=e,s=t,i=T({title:"",description:"",severity:"medium",incidentTime:""}),l=T(""),u=T(!0),d=T("none"),h=T(!1),p=T(null),g=T(null),y=T(null),b=T(!1),C=T(!1),I=T(null),M=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}],x=()=>{const G=new Date,ee=G.getFullYear(),ne=String(G.getMonth()+1).padStart(2,"0"),Ae=String(G.getDate()).padStart(2,"0"),J=String(G.getHours()).padStart(2,"0"),te=String(G.getMinutes()).padStart(2,"0");return`${ee}-${ne}-${Ae}T${J}:${te}`},S=G=>G?new Date(G).toISOString():null,_=z(()=>a.checkpoints||[]),D=z(()=>{if(p.value?.latitude!=null)return{lat:p.value.latitude,lng:p.value.longitude};if(l.value){const G=_.value.find(ee=>ee.id===l.value);if(G?.latitude!=null)return{lat:G.latitude,lng:G.longitude}}if(a.initialLocation?.latitude!=null)return{lat:a.initialLocation.latitude,lng:a.initialLocation.longitude};if(a.checkpoint?.latitude!=null)return{lat:a.checkpoint.latitude,lng:a.checkpoint.longitude};if(_.value.length>0){const G=_.value[0];if(G.latitude!=null)return{lat:G.latitude,lng:G.longitude}}if(a.route?.length>0){const G=a.route[0];if(G?.lat!=null)return{lat:G.lat,lng:G.lng}}return{lat:-33.9,lng:151.2}}),E=z(()=>i.value.description.trim()!==""),Z=z(()=>i.value.description.trim()!=="");qe(()=>a.show,G=>{G&&(i.value={title:"",description:"",severity:"medium",incidentTime:x()},l.value="",u.value=!0,C.value=!1,I.value=null,y.value=null,p.value=null,g.value=null,a.initialLocation&&a.initialLocation.latitude!=null?(p.value={latitude:a.initialLocation.latitude,longitude:a.initialLocation.longitude},g.value=a.initialLocation.accuracy,d.value="gps",h.value=!1):(d.value="none",h.value=!1),a.checkpoint&&(l.value=a.checkpoint.locationId||a.checkpoint.id||""))});const A=G=>{y.value=null,G==="map"?d.value==="map"?h.value=!h.value:(d.value="map",h.value=!0,g.value=null):G==="gps"?(d.value="gps",h.value=!1,B()):(d.value="none",h.value=!1,p.value=null,g.value=null)},N=G=>{p.value={latitude:G.lat,longitude:G.lng},g.value=null,h.value=!1},B=()=>{if(a.initialLocation&&a.initialLocation.latitude!=null){p.value={latitude:a.initialLocation.latitude,longitude:a.initialLocation.longitude},g.value=a.initialLocation.accuracy;return}if(!navigator.geolocation){y.value="GPS is not available on this device.";return}b.value=!0,navigator.geolocation.getCurrentPosition(G=>{p.value={latitude:G.coords.latitude,longitude:G.coords.longitude},g.value=G.coords.accuracy,b.value=!1},G=>{y.value="Unable to get your location.",b.value=!1},{enableHighAccuracy:!0,timeout:1e4})},j=async()=>{if(!(!Z.value||C.value)){C.value=!0,I.value=null;try{const G=(d.value==="gps"||d.value==="map")&&p.value;let ee=null,ne=!1;_.value.length>0?l.value?ee=l.value:ne=!0:a.checkpoint&&(u.value?ee=a.checkpoint.locationId||a.checkpoint.id||null:ne=!0);const Ae={title:i.value.title.trim()||null,description:i.value.description.trim(),severity:i.value.severity,incidentTime:S(i.value.incidentTime),latitude:G?p.value.latitude:null,longitude:G?p.value.longitude:null,checkpointId:ee,skipCheckpointAutoAssign:ne};s("submit",Ae)}catch(G){I.value=G.message||"Failed to report incident. Please try again.",C.value=!1}}},R=()=>{s("close")};return(G,ee)=>(v(),Ze(jt,{show:e.show,title:"Report Incident",size:"medium","confirm-on-close":!0,"is-dirty":E.value,onClose:R},{footer:He(()=>[r("div",jO,[r("button",{type:"button",class:"btn btn-secondary",onClick:R}," Cancel "),r("button",{type:"button",class:"btn btn-primary",onClick:j,disabled:!Z.value||C.value},w(C.value?"Reporting...":"Report Incident"),9,ZO)])]),default:He(()=>[r("form",{onSubmit:it(j,["prevent"]),class:"incident-form"},[r("div",yO,[ee[10]||(ee[10]=r("label",{for:"title",class:"form-label"},"Title",-1)),ze(r("input",{id:"title","onUpdate:modelValue":ee[0]||(ee[0]=ne=>i.value.title=ne),type:"text",class:"form-input",placeholder:"Brief summary (optional)"},null,512),[[nt,i.value.title]])]),r("div",kO,[ee[11]||(ee[11]=r("label",{for:"description",class:"form-label"},[Ye("Description "),r("span",{class:"required"},"*")],-1)),ze(r("textarea",{id:"description","onUpdate:modelValue":ee[1]||(ee[1]=ne=>i.value.description=ne),class:"form-input form-textarea",placeholder:"Describe what happened...",rows:"3",required:""},null,512),[[nt,i.value.description]])]),r("div",bO,[r("div",_O,[ee[12]||(ee[12]=r("label",{for:"severity",class:"form-label"},"Severity",-1)),ze(r("select",{id:"severity","onUpdate:modelValue":ee[2]||(ee[2]=ne=>i.value.severity=ne),class:"form-input form-select"},[(v(),m(Te,null,Fe(M,ne=>r("option",{key:ne.value,value:ne.value},w(ne.label),9,wO)),64))],512),[[Fn,i.value.severity]])]),r("div",CO,[ee[13]||(ee[13]=r("label",{for:"incidentTime",class:"form-label"},"When",-1)),ze(r("input",{id:"incidentTime","onUpdate:modelValue":ee[3]||(ee[3]=ne=>i.value.incidentTime=ne),type:"datetime-local",class:"form-input"},null,512),[[nt,i.value.incidentTime]])])]),_.value.length>0?(v(),m("div",LO,[r("label",SO,w(O(n).checkpoint),1),ze(r("select",{id:"checkpoint","onUpdate:modelValue":ee[4]||(ee[4]=ne=>l.value=ne),class:"form-input form-select"},[ee[14]||(ee[14]=r("option",{value:""},"-- None / Unknown --",-1)),(v(!0),m(Te,null,Fe(_.value,ne=>(v(),m("option",{key:ne.id,value:ne.id},w(ne.name)+w(ne.description?` - ${ne.description}`:""),9,IO))),128))],512),[[Fn,l.value]])])):e.checkpoint?(v(),m("div",xO,[r("label",$O,w(O(n).checkpoint),1),r("div",TO,[r("label",MO,[ze(r("input",{type:"checkbox","onUpdate:modelValue":ee[5]||(ee[5]=ne=>u.value=ne)},null,512),[[Ws,u.value]]),r("span",AO,w(e.checkpoint.name),1),e.checkpoint.description?(v(),m("span",EO," - "+w(e.checkpoint.description),1)):P("",!0)])])])):P("",!0),r("div",PO,[ee[15]||(ee[15]=r("label",{class:"form-label"},"Location (optional)",-1)),r("div",DO,[r("div",OO,[r("button",{type:"button",class:pe(["location-btn",{active:d.value==="gps"}]),onClick:ee[6]||(ee[6]=ne=>A("gps"))}," GPS ",2),r("button",{type:"button",class:pe(["location-btn",{active:d.value==="map"}]),onClick:ee[7]||(ee[7]=ne=>A("map"))}," Pick on map ",2),r("button",{type:"button",class:pe(["location-btn",{active:d.value==="none"}]),onClick:ee[8]||(ee[8]=ne=>A("none"))}," None ",2)]),d.value==="gps"?(v(),m("div",RO,[b.value?(v(),m("div",BO," Getting location... ")):p.value&&p.value.latitude!=null?(v(),m("div",NO,[r("span",null,w(p.value.latitude.toFixed(5))+", "+w(p.value.longitude.toFixed(5)),1),g.value?(v(),m("span",FO,"("+w(Math.round(g.value))+"m)",1)):P("",!0)])):y.value?(v(),m("div",UO,w(y.value),1)):P("",!0)])):P("",!0),d.value==="map"?(v(),m("div",zO,[h.value?(v(),m("div",HO,"Tap to select location")):P("",!0),h.value?(v(),Ze(fi,{key:1,locations:_.value,route:e.route,center:D.value,zoom:14,mode:"select-point","user-location":e.initialLocation,"highlight-location-id":l.value,height:"150px",onPointSelected:N},null,8,["locations","route","center","user-location","highlight-location-id"])):P("",!0),p.value&&p.value.latitude!=null?(v(),m("div",VO,[r("span",null,w(p.value.latitude.toFixed(5))+", "+w(p.value.longitude.toFixed(5)),1),h.value?P("",!0):(v(),m("button",{key:0,type:"button",class:"location-edit-btn",onClick:ee[9]||(ee[9]=ne=>h.value=!0)},"Edit"))])):P("",!0)])):P("",!0)])]),I.value?(v(),m("div",GO,w(I.value),1)):P("",!0)],32)]),_:1},8,["show","is-dirty"]))}},hm=Ge(qO,[["__scopeId","data-v-20b520b6"]]),WO={class:"tab-content"},KO={key:0,class:"form-group"},JO={for:"marshalId"},YO=["value"],XO={class:"help-text"},QO={key:1,class:"form-group"},eR={class:"linked-marshal-info"},tR={class:"linked-marshal-name"},nR={class:"linked-marshal-hint"},oR={key:2,class:"form-group"},sR={class:"form-group"},aR={class:"role-input-group"},iR={key:0,label:"Built-in Roles"},lR=["value"],rR={key:1,label:"Custom Roles"},cR=["value"],uR={class:"checkbox-label-inline show-emergency-checkbox"},dR={class:"form-row"},hR={class:"form-group"},fR={class:"form-group"},pR={class:"form-group"},vR={class:"form-row"},mR={class:"form-group"},gR={class:"form-group checkbox-group-inline"},yR={class:"checkbox-label-inline"},kR={class:"tab-content"},bR={class:"custom-footer"},_R={class:"footer-left"},wR=["disabled"],CR={__name:"EditContactModal",props:{show:{type:Boolean,default:!1},contact:{type:Object,default:null},initialTab:{type:String,default:"details"},areas:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},availableRoles:{type:Object,default:()=>({builtInRoles:[],customRoles:[]})},isDirty:{type:Boolean,default:!1},preselectedArea:{type:Object,default:null},prefilledName:{type:String,default:""},prefilledMarshalId:{type:String,default:null},createFromAreaContext:{type:Boolean,default:!1}},emits:["close","save","delete","update:isDirty"],setup(e,{emit:t}){const{terms:n}=rt(),a=e,s=t,i=T(!1),l=T(""),u=T("details"),d=T(!1),h=T({role:"",name:"",phone:"",email:"",notes:"",marshalId:null,showInEmergencyInfo:!1,displayOrder:0,isPinned:!1,scopeConfigurations:[{scope:"SpecificPeople",itemType:"Marshal",ids:["ALL_MARSHALS"]}]}),p=j=>j==="EmergencyContact",g=z(()=>!!a.contact),y=z(()=>a.createFromAreaContext?[{value:"details",label:"Details"}]:[{value:"details",label:"Details"},{value:"visibility",label:"Visibility"}]),b=z(()=>!!h.value.marshalId),C=z(()=>!g.value&&!!a.prefilledMarshalId),I=z(()=>g.value&&!!a.contact?.marshalId),M=z(()=>a.contact?.marshalId?a.marshals.find(R=>R.id===a.contact.marshalId)?.name||"Unknown":""),x=z(()=>[...a.marshals].sort((j,R)=>Ks(j.name,R.name)));qe(()=>a.show,j=>{if(j){if(u.value=a.initialTab,a.contact){const R=[...a.availableRoles.builtInRoles||[],...a.availableRoles.customRoles||[]];d.value=a.contact.role&&!R.includes(a.contact.role),h.value={role:a.contact.role||"",name:a.contact.name||"",phone:a.contact.phone||"",email:a.contact.email||"",notes:a.contact.notes||"",marshalId:a.contact.marshalId||null,showInEmergencyInfo:a.contact.showInEmergencyInfo??p(a.contact.role),displayOrder:a.contact.displayOrder||0,isPinned:a.contact.isPinned||!1,scopeConfigurations:a.contact.scopeConfigurations?JSON.parse(JSON.stringify(a.contact.scopeConfigurations)):[{scope:"SpecificPeople",itemType:"Marshal",ids:["ALL_MARSHALS"]}]}}else{d.value=!1;let R;a.createFromAreaContext?R=[]:a.preselectedArea?R=[{scope:"EveryoneInAreas",itemType:"Area",ids:[a.preselectedArea.id]}]:R=[{scope:"SpecificPeople",itemType:"Marshal",ids:["ALL_MARSHALS"]}];let G={name:a.prefilledName||"",phone:"",email:""};if(a.prefilledMarshalId){const ee=a.marshals.find(ne=>ne.id===a.prefilledMarshalId);ee&&(G={name:ee.name||"",phone:ee.phoneNumber||"",email:ee.email||""})}h.value={role:"",name:G.name,phone:G.phone,email:G.email,notes:"",marshalId:a.prefilledMarshalId||null,showInEmergencyInfo:!1,displayOrder:0,isPinned:!1,scopeConfigurations:R}}s("update:isDirty",!1)}}),qe(()=>h.value.role,(j,R)=>{!g.value&&j!==R&&(p(j)?h.value.showInEmergencyInfo=!0:p(R)&&(h.value.showInEmergencyInfo=!1))});const S=j=>j?j==="AreaLead"?`${n.value.area} Lead`:j.replace(/([A-Z])/g," $1").replace(/^./,R=>R.toUpperCase()).trim():"",_=()=>{s("update:isDirty",!0)},D=()=>{if(h.value.marshalId){const j=a.marshals.find(R=>R.id===h.value.marshalId);j&&(h.value.name=j.name,!h.value.phone&&j.phoneNumber&&(h.value.phone=j.phoneNumber),!h.value.email&&j.email&&(h.value.email=j.email))}_()},E=()=>{s("close")},Z=()=>{if(!h.value.role||!h.value.role.trim()){A("Please select or enter a role");return}if(!h.value.name||!h.value.name.trim()){A("Please enter a contact name");return}u.value="visibility"},A=j=>{l.value=j,i.value=!0},N=()=>{if(!h.value.role||!h.value.role.trim()){A("Please select or enter a role");return}if(!h.value.name||!h.value.name.trim()){A("Please enter a contact name");return}if(!a.createFromAreaContext){if(!h.value.scopeConfigurations||h.value.scopeConfigurations.length===0){A("Please select at least one visibility scope");return}if(!h.value.scopeConfigurations.some(G=>!(G.itemType!==null&&(!G.ids||G.ids.length===0)))){A("Please configure at least one scope with valid selections");return}}const j={role:h.value.role.trim(),name:h.value.name.trim(),phone:h.value.phone?.trim()||null,email:h.value.email?.trim()||null,notes:h.value.notes?.trim()||null,marshalId:h.value.marshalId||null,showInEmergencyInfo:h.value.showInEmergencyInfo,displayOrder:h.value.displayOrder||0,isPinned:h.value.isPinned||!1,scopeConfigurations:h.value.scopeConfigurations};s("save",j)},B=()=>{s("delete",a.contact.contactId)};return(j,R)=>(v(),m(Te,null,[Me(jt,{show:e.show,title:g.value?"Edit contact":"Create contact",size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:E},{"tab-header":He(()=>[Me(Yi,{modelValue:u.value,"onUpdate:modelValue":R[0]||(R[0]=G=>u.value=G),tabs:y.value},null,8,["modelValue","tabs"])]),footer:He(()=>[r("div",bR,[r("div",_R,[g.value?(v(),m("button",{key:0,type:"button",onClick:B,class:"btn btn-danger"}," Delete ")):P("",!0),!g.value&&u.value==="details"?(v(),m("button",{key:1,type:"button",onClick:Z,class:"btn btn-secondary mobile-only"}," Visibility... ")):P("",!0)]),r("button",{type:"button",onClick:N,class:"btn btn-success",disabled:g.value&&!e.isDirty}," Save ",8,wR)])]),default:He(()=>[r("form",{onSubmit:it(N,["prevent"]),class:"contact-form"},[ze(r("div",WO,[!C.value&&!I.value?(v(),m("div",KO,[r("label",JO,"Link to "+w(O(n).person.toLowerCase())+":",1),ze(r("select",{id:"marshalId","onUpdate:modelValue":R[1]||(R[1]=G=>h.value.marshalId=G),onChange:D},[R[14]||(R[14]=r("option",{value:null},"-- Not linked --",-1)),(v(!0),m(Te,null,Fe(x.value,G=>(v(),m("option",{key:G.id,value:G.id},w(G.name),9,YO))),128))],544),[[Fn,h.value.marshalId]]),r("span",XO,"Optionally link to an existing "+w(O(n).person.toLowerCase())+" in the system",1)])):P("",!0),I.value?(v(),m("div",QO,[r("label",null,"Linked "+w(O(n).person.toLowerCase())+":",1),r("div",eR,[r("span",tR,w(M.value),1),r("span",nR,"Contact details are synced with this "+w(O(n).person.toLowerCase()),1)])])):P("",!0),b.value?P("",!0):(v(),m("div",oR,[R[15]||(R[15]=r("label",{for:"name"},"Name: *",-1)),ze(r("input",{id:"name","onUpdate:modelValue":R[2]||(R[2]=G=>h.value.name=G),type:"text",onInput:_,placeholder:"Contact name..."},null,544),[[nt,h.value.name]])])),r("div",sR,[R[18]||(R[18]=r("label",{for:"role"},"Role: *",-1)),r("div",aR,[d.value?ze((v(),m("input",{key:1,id:"customRole","onUpdate:modelValue":R[4]||(R[4]=G=>h.value.role=G),type:"text",onInput:_,placeholder:"Enter custom role name..."},null,544)),[[nt,h.value.role]]):ze((v(),m("select",{key:0,id:"role","onUpdate:modelValue":R[3]||(R[3]=G=>h.value.role=G),onChange:_},[R[16]||(R[16]=r("option",{value:"",disabled:""},"Select a role...",-1)),e.availableRoles.builtInRoles?.length>0?(v(),m("optgroup",iR,[(v(!0),m(Te,null,Fe(e.availableRoles.builtInRoles,G=>(v(),m("option",{key:G,value:G},w(S(G)),9,lR))),128))])):P("",!0),e.availableRoles.customRoles?.length>0?(v(),m("optgroup",rR,[(v(!0),m(Te,null,Fe(e.availableRoles.customRoles,G=>(v(),m("option",{key:G,value:G},w(S(G)),9,cR))),128))])):P("",!0)],544)),[[Fn,h.value.role]]),r("button",{type:"button",class:"toggle-custom-btn",onClick:R[5]||(R[5]=G=>d.value=!d.value)},w(d.value?"Use existing":"Custom"),1)]),r("label",uR,[ze(r("input",{type:"checkbox","onUpdate:modelValue":R[6]||(R[6]=G=>h.value.showInEmergencyInfo=G),onChange:_},null,544),[[Ws,h.value.showInEmergencyInfo]]),R[17]||(R[17]=r("span",null,"Show in emergency info",-1))])]),r("div",dR,[r("div",hR,[R[19]||(R[19]=r("label",{for:"phone"},"Phone:",-1)),ze(r("input",{id:"phone","onUpdate:modelValue":R[7]||(R[7]=G=>h.value.phone=G),type:"tel",onInput:_,placeholder:"Phone number..."},null,544),[[nt,h.value.phone]])]),r("div",fR,[R[20]||(R[20]=r("label",{for:"email"},"Email:",-1)),ze(r("input",{id:"email","onUpdate:modelValue":R[8]||(R[8]=G=>h.value.email=G),type:"email",onInput:_,placeholder:"Email address..."},null,544),[[nt,h.value.email]])])]),r("div",pR,[R[21]||(R[21]=r("label",{for:"notes"},"Notes / Instructions:",-1)),ze(r("textarea",{id:"notes","onUpdate:modelValue":R[9]||(R[9]=G=>h.value.notes=G),onInput:_,rows:"3",placeholder:"Additional notes or instructions for when to contact..."},null,544),[[nt,h.value.notes]])]),r("div",vR,[r("div",mR,[R[22]||(R[22]=r("label",{for:"displayOrder"},"Display order:",-1)),ze(r("input",{id:"displayOrder","onUpdate:modelValue":R[10]||(R[10]=G=>h.value.displayOrder=G),type:"number",onInput:_,min:"0"},null,544),[[nt,h.value.displayOrder,void 0,{number:!0}]]),R[23]||(R[23]=r("span",{class:"help-text"},"Lower numbers appear first",-1))]),r("div",gR,[r("label",yR,[ze(r("input",{type:"checkbox","onUpdate:modelValue":R[11]||(R[11]=G=>h.value.isPinned=G),onChange:_},null,544),[[Ws,h.value.isPinned]]),R[24]||(R[24]=r("span",null,"Pin to top",-1))]),R[25]||(R[25]=r("span",{class:"help-text"},"Pinned contacts always appear at the top",-1))])])],512),[[ws,u.value==="details"]]),ze(r("div",kR,[Me(Cc,{modelValue:h.value.scopeConfigurations,"onUpdate:modelValue":R[12]||(R[12]=G=>h.value.scopeConfigurations=G),areas:e.areas,locations:e.locations,marshals:e.marshals,"is-editing":g.value,"exclude-scopes":["OnePerCheckpoint","OnePerArea","OneLeadPerArea"],"header-text":"Who can see this contact?",onUserChanged:_},null,8,["modelValue","areas","locations","marshals","is-editing"])],512),[[ws,u.value==="visibility"]])],32)]),_:1},8,["show","title","is-dirty"]),Me(Sc,{show:i.value,title:"Validation error",message:l.value,onClose:R[13]||(R[13]=G=>i.value=!1)},null,8,["show","message"])],64))}},LR=Ge(CR,[["__scopeId","data-v-21d18628"]]),SR={key:0,class:"fullscreen-map-overlay"},IR={class:"fullscreen-map-header"},xR={class:"context-info"},$R={key:0},TR={class:"action-buttons"},MR=["disabled"],AR={class:"fullscreen-map-container"},ER={key:0,class:"drawing-controls"},PR={class:"point-count"},DR={class:"undo-redo-buttons"},OR=["disabled"],RR=["disabled"],BR=Object.assign({inheritAttrs:!1},{__name:"FullscreenMapOverlay",props:{show:{type:Boolean,required:!0},mode:{type:String,validator:e=>["place-checkpoint","move-checkpoint","draw-area","add-multiple","view"].includes(e)},contextTitle:{type:String,default:""},contextDescription:{type:String,default:""},canComplete:{type:Boolean,default:!1},drawingMode:{type:Boolean,default:!1}},emits:["done","cancel","map-click","polygon-complete","polygon-drawing","location-click","area-click"],setup(e,{emit:t}){const n=e,a=t,s=T(null),i=T(0),l=T(!1),u=T(!1),d=()=>{a("done")},h=()=>{a("cancel")},p=I=>{i.value=I?.length||0,g(),a("polygon-drawing",I)},g=()=>{s.value&&(l.value=s.value.canUndo(),u.value=s.value.canRedo())},y=()=>{s.value&&(s.value.undoPolygonPoint(),g())},b=()=>{s.value&&(s.value.redoPolygonPoint(),g())};qe(()=>n.show,I=>{I||(i.value=0,l.value=!1,u.value=!1)});const C=I=>{I.key==="Escape"&&n.show&&h(),n.show&&n.drawingMode&&((I.ctrlKey||I.metaKey)&&I.key==="z"&&!I.shiftKey?(I.preventDefault(),y()):(I.ctrlKey||I.metaKey)&&(I.key==="y"||I.key==="z"&&I.shiftKey)&&(I.preventDefault(),b()))};return tn(()=>{document.addEventListener("keydown",C)}),bn(()=>{document.removeEventListener("keydown",C)}),(I,M)=>(v(),Ze(Rl,{to:"body"},[e.show?(v(),m("div",SR,[r("div",IR,[r("div",xR,[r("h3",null,w(e.contextTitle),1),e.contextDescription?(v(),m("p",$R,w(e.contextDescription),1)):P("",!0)]),r("div",TR,[e.mode==="view"?(v(),m("button",{key:0,onClick:h,class:"btn btn-done"}," Close ")):(v(),m(Te,{key:1},[r("button",{onClick:h,class:"btn btn-cancel"}," Cancel "),r("button",{onClick:d,class:"btn btn-done",disabled:!e.canComplete}," Done ",8,MR)],64))])]),r("div",AR,[Me(Ou,jp({ref_key:"mapViewRef",ref:s,"drawing-mode":e.drawingMode},I.$attrs,{onMapClick:M[0]||(M[0]=x=>I.$emit("map-click",x)),onPolygonComplete:M[1]||(M[1]=x=>I.$emit("polygon-complete",x)),onPolygonDrawing:p,onLocationClick:M[2]||(M[2]=x=>I.$emit("location-click",x)),onAreaClick:M[3]||(M[3]=x=>I.$emit("area-click",x))}),null,16,["drawing-mode"]),e.drawingMode&&i.value>0?(v(),m("div",ER,[r("div",PR,w(i.value)+" point"+w(i.value!==1?"s":""),1),r("div",DR,[r("button",{onClick:y,class:"btn-drawing undo-btn",disabled:!l.value,title:"Undo last point"},"  Undo ",8,OR),r("button",{onClick:b,class:"btn-drawing redo-btn",disabled:!u.value,title:"Redo point"}," Redo  ",8,RR)])])):P("",!0)])])):P("",!0)]))}}),NR=Ge(BR,[["__scopeId","data-v-9ce62b55"]]),FR={class:"form-group"},UR={class:"form-group"},zR={class:"form-group"},HR={key:0,class:"form-error"},VR={class:"form-row"},GR={class:"form-group",style:{flex:"1"}},jR={class:"form-group",style:{flex:"1"}},ZR={class:"form-group",style:{flex:"0 0 auto"}},qR={class:"form-group"},WR={__name:"AddLocationModal",props:{show:{type:Boolean,default:!1},location:{type:Object,default:()=>({name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""})},isDirty:{type:Boolean,default:!1}},emits:["close","save","set-on-map","update:isDirty","update:location"],setup(e,{emit:t}){const{termsLower:n}=rt(),a=e,s=t,i=T({name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""});qe(()=>a.location,h=>{h&&(i.value={...h})},{immediate:!0,deep:!0});const l=()=>{s("update:isDirty",!0),s("update:location",{...i.value})},u=()=>{if(!Wr(i.value.what3Words)&&i.value.what3Words){alert("Invalid What3Words format.");return}s("save",i.value)},d=()=>{s("close")};return(h,p)=>(v(),Ze(jt,{show:e.show,title:`Add ${O(n).checkpoint}`,size:"medium","confirm-on-close":!0,"is-dirty":e.isDirty,onClose:d},{actions:He(()=>[r("button",{type:"button",onClick:d,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:u,class:"btn btn-primary"}," Add "+w(O(n).checkpoint),1)]),default:He(()=>[r("form",{onSubmit:it(u,["prevent"])},[r("div",FR,[p[7]||(p[7]=r("label",null,"Name",-1)),ze(r("input",{"onUpdate:modelValue":p[0]||(p[0]=g=>i.value.name=g),type:"text",required:"",class:"form-input",onInput:l},null,544),[[nt,i.value.name]])]),r("div",UR,[p[8]||(p[8]=r("label",null,"Description",-1)),ze(r("input",{"onUpdate:modelValue":p[1]||(p[1]=g=>i.value.description=g),type:"text",class:"form-input",onInput:l},null,544),[[nt,i.value.description]])]),r("div",zR,[p[9]||(p[9]=r("label",null,"What3Words (optional)",-1)),ze(r("input",{"onUpdate:modelValue":p[2]||(p[2]=g=>i.value.what3Words=g),type:"text",class:"form-input",placeholder:"e.g. filled.count.soap or filled/count/soap",onInput:l},null,544),[[nt,i.value.what3Words]]),i.value.what3Words&&!O(Wr)(i.value.what3Words)?(v(),m("small",HR," Invalid format. Must be word.word.word or word/word/word (lowercase letters only, 1-20 characters each) ")):P("",!0)]),r("div",VR,[r("div",GR,[p[10]||(p[10]=r("label",null,"Longitude",-1)),ze(r("input",{"onUpdate:modelValue":p[3]||(p[3]=g=>i.value.longitude=g),type:"number",step:"0.00001",required:"",class:"form-input",onInput:l},null,544),[[nt,i.value.longitude,void 0,{number:!0}]])]),r("div",jR,[p[11]||(p[11]=r("label",null,"Latitude",-1)),ze(r("input",{"onUpdate:modelValue":p[4]||(p[4]=g=>i.value.latitude=g),type:"number",step:"0.00001",required:"",class:"form-input",onInput:l},null,544),[[nt,i.value.latitude,void 0,{number:!0}]])]),r("div",ZR,[p[12]||(p[12]=r("label",null,"",-1)),r("button",{type:"button",class:"icon-btn",title:"Set location on map",onClick:p[5]||(p[5]=g=>h.$emit("set-on-map"))},"  ")])]),r("div",qR,[r("label",null,"Required "+w(O(n).people),1),ze(r("input",{"onUpdate:modelValue":p[6]||(p[6]=g=>i.value.requiredMarshals=g),type:"number",min:"1",required:"",class:"form-input",onInput:l},null,544),[[nt,i.value.requiredMarshals,void 0,{number:!0}]])])],32)]),_:1},8,["show","title","is-dirty"]))}},KR=Ge(WR,[["__scopeId","data-v-fb51fed0"]]),JR=["aria-expanded","title"],YR=["innerHTML"],XR={key:0,class:"dropdown-menu"},QR=["onClick"],eB=["innerHTML"],tB={__name:"ThemeToggle",setup(e){const{theme:t,isDark:n,setTheme:a}=Qv(),s=T(!1),i=T(null),l={light:`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
  </svg>`,dark:`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
  </svg>`,system:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
    <line x1="8" y1="21" x2="16" y2="21"></line>
    <line x1="12" y1="17" x2="12" y2="21"></line>
  </svg>`},u=[{value:"system",label:"System",icon:l.system},{value:"light",label:"Light",icon:l.light},{value:"dark",label:"Dark",icon:l.dark}],d=z(()=>n.value?l.dark:l.light),h=()=>{s.value=!s.value},p=y=>{a(y),s.value=!1},g=y=>{i.value&&!i.value.contains(y.target)&&(s.value=!1)};return tn(()=>{document.addEventListener("click",g)}),bn(()=>{document.removeEventListener("click",g)}),(y,b)=>(v(),m("div",{class:"theme-dropdown",ref_key:"dropdownRef",ref:i},[r("button",{class:"theme-toggle-btn",onClick:h,type:"button","aria-expanded":s.value,title:O(n)?"Dark mode":"Light mode"},[r("span",{class:"theme-icon",innerHTML:d.value},null,8,YR)],8,JR),s.value?(v(),m("div",XR,[(v(),m(Te,null,Fe(u,C=>r("button",{key:C.value,class:pe(["dropdown-item",{active:O(t)===C.value}]),onClick:I=>p(C.value)},[r("span",{class:"option-icon",innerHTML:C.icon},null,8,eB),r("span",null,w(C.label),1)],10,QR)),64))])):P("",!0)],512))}},nB=Ge(tB,[["__scopeId","data-v-969124a4"]]),oB={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"app-logo"},sB=["id"],aB=["filter"],iB={__name:"AppLogo",props:{size:{type:[Number,String],default:48},animate:{type:Boolean,default:!1}},setup(e){Py(n=>({v1c2199cd:typeof e.size=="number"?e.size+"px":e.size}));const t=z(()=>`discShadow-${Math.random().toString(36).substr(2,9)}`);return(n,a)=>(v(),m("svg",oB,[r("defs",null,[r("filter",{id:t.value,x:"-20%",y:"-20%",width:"140%",height:"140%"},[...a[0]||(a[0]=[r("feDropShadow",{dx:"0",dy:"6",stdDeviation:"8","flood-color":"#000","flood-opacity":"0.25"},null,-1)])],8,sB)]),r("ellipse",{cx:"256",cy:"400",rx:"220",ry:"70",fill:"#667eea",filter:`url(#${t.value})`},null,8,aB),a[2]||(a[2]=r("ellipse",{cx:"256",cy:"394",rx:"185",ry:"55",fill:"none",stroke:"rgba(255,255,255,0.3)","stroke-width":"4"},null,-1)),r("g",{class:pe({"marshal-figure":e.animate})},[...a[1]||(a[1]=[r("circle",{cx:"256",cy:"160",r:"55",fill:"currentColor"},null,-1),r("path",{d:"M365 380 v-30 a55 55 0 0 0-55-55 H202 a55 55 0 0 0-55 55 v30",fill:"currentColor"},null,-1)])],2)]))}},lB=Ge(iB,[["__scopeId","data-v-3e647831"]]),rB={class:"header"},cB={class:"header-left"},uB={key:0},dB={class:"event-date"},hB={class:"header-actions"},fB={class:"container"},pB={class:"tabs-nav"},vB={class:"tab-content-wrapper"},mB={class:"add-note-form"},gB={class:"modal-footer-actions"},yB=["disabled"],kB=6e4,bB={__name:"AdminEventManage",setup(e){const t=gc(),n=qi(),a=Kv(),s=z(()=>t.params.eventId),{activeTab:i,switchTab:l}=Jv("details",["details","course","areas","checkpoints","marshals","notes","checklists","contacts","settings"]),{showConfirmModal:u,confirmModalTitle:d,confirmModalMessage:h,confirmModalIsDanger:p,confirmModalConfirmText:g,showConfirm:y,handleConfirmModalConfirm:b,handleConfirmModalCancel:C}=e_(),{tabLabels:I,terms:M,termsLower:x}=rt(),S=t_(),_=o_(s),D=n_(s),{colorScheme:E}=Qv(),Z=z(()=>[{value:"details",label:"Event details",icon:"details"},{value:"course",label:I.value.course,icon:"course"},{value:"areas",label:I.value.areas,icon:"area"},{value:"checkpoints",label:I.value.checkpoints,icon:"checkpoint"},{value:"marshals",label:I.value.marshals,icon:"marshal"},{value:"notes",label:"Notes",icon:"notes"},{value:"incidents",label:"Incidents",icon:"incidents"},{value:"checklists",label:I.value.checklists,icon:"checklist"},{value:"contacts",label:"Contacts",icon:"contacts"},{value:"settings",label:"Settings",icon:"settings"}]),A=T(null),N=T([]),B=T([]),j=T({marshals:0,areas:0,checkpoints:0,checklists:0,notes:0,incidents:0,contacts:0}),R=T(null),G=T(!1),ee=T(!1),ne=T(null),Ae=T(null),J=T(!1),te=T(!1),U=T(null),X=T(""),re=D.eventAdmins,ke=D.showAddAdmin,Re=_.showUploadRoute,Xe=_.uploading,Ne=_.uploadError,Ke=_.showImportLocations,We=_.showImportMarshals,Q=_.importing,ge=_.importingMarshals,Ce=_.importError,ve=_.importResult,ue=_.importMarshalsResult,F=T(!1),K=T(!1),ae=T({id:"",name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""}),$e=T(!1),Be=T(!1),Oe=T({marshalName:"",locations:[],marshal:null}),Le=T(null),Y=T([]),he=T(!1),xe=T(null),Ie=T(null),be=T(null),de=T({}),fe=T({id:"",name:"",email:"",phoneNumber:"",notes:""}),q=T(!1),W=T([]),ie=T([]),Ue=T([]),et=T([]),dt=T(!1),yt=T(""),mt=T(""),St=T({name:"",description:"",eventDate:"",timeZoneId:"UTC",peopleTerm:"Marshals",defaultCheckpointStyleBackgroundShape:"",defaultCheckpointStyleBackgroundColor:"",defaultCheckpointStyleBorderColor:"",defaultCheckpointStyleIconColor:"",defaultCheckpointStyleSize:"",defaultCheckpointStyleMapRotation:"",checkpointTerm:"Checkpoints",areaTerm:"Areas",checklistTerm:"Checklists",courseTerm:"Course",defaultCheckpointStyleType:"default",defaultCheckpointStyleColor:""}),Ct=T(!1),Rt=T(!1),Ft=T(""),ht=T(""),on=T(0),dn=T({name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""}),Et=T([]),Lt=T(null),Qn=T(!1),zn=T("details"),eo=T(null),fo=T(null),Ht=T(null),ls=S.isAddingMultipleCheckpoints,to=S.multiCheckpointCounter,So=S.isFullscreenMapActive,le=S.fullscreenMode,ce=S.fullscreenContext,ye=S.tempLocationCoords,st=S.tempCheckpoints,je=S.savedMapCenter,Tt=S.savedMapZoom,Wt=S.isDrawingAreaBoundary,Xt=T(null),No=T([]),po=T(null),Fo=T(!1),Hn=T("details"),Da=T(null),Cs=T([]),Uo=T(null),rs=T(!1),Xs=T("details"),Vn=T([]),Qs=T(!1),hn=T(null),Io=T(!1),xo=T(!1),Ls=T(!1),vo=T(""),mo=T(!1),no=T([]),$o=T({builtInRoles:[],customRoles:[]}),mn=T(null),go=T(!1),oo=T("details"),kt=T(null),Pt=T(""),To=T(null),zo=T(null),yo=z(()=>zo.value?.marshalId!=null),ea=()=>{n.push(`/event/${t.params.eventId}`)},ft=z(()=>`${window.location.origin}/#/event/${t.params.eventId}`),Vt=z(()=>{const H=[];return B.value.forEach(se=>{se.assignments&&H.push(...se.assignments)}),H}),Oa=z(()=>{if(!xe.value)return B.value;const H=xe.value.assignedLocationIds||[],se=Ue.value.map(_e=>_e.locationId),me=et.value;return B.value.filter(_e=>!H.includes(_e.id)&&!se.includes(_e.id)||me.includes(_e.id))}),Ss=z(()=>{let H=Y.value;if(R.value){const se=R.value.assignments.map(_e=>_e.marshalName),me=W.value.map(_e=>_e.marshalName);H=Y.value.filter(_e=>!se.includes(_e.name)&&!me.includes(_e.name))}return H.slice().sort((se,me)=>se.name.localeCompare(me.name))}),$n=z(()=>le.value==="draw-area"&&Lt.value?.polygon?.length>0||S.canCompleteFullscreen.value),Xi=z(()=>le.value==="move-checkpoint"&&R.value?.id?R.value.id:null),cs=z(()=>{const H=[...B.value];return le.value==="place-checkpoint"&&ye.value&&H.push({id:"temp-single",name:dn.value.name||"New Checkpoint",latitude:ye.value.lat,longitude:ye.value.lng,requiredMarshals:dn.value.requiredMarshals||1,assignments:[],isTemporary:!0}),le.value==="move-checkpoint"&&ye.value&&R.value&&H.push({id:"temp-move",name:R.value.name+" (new position)",latitude:ye.value.lat,longitude:ye.value.lng,requiredMarshals:R.value.requiredMarshals,assignments:[],isTemporary:!0}),le.value==="add-multiple"&&H.push(...st.value),H}),Mo=z(()=>{let H=[...Et.value];return le.value==="draw-area"&&Lt.value?.id&&(H=H.filter(se=>se.id!==Lt.value.id)),le.value==="draw-area"&&Lt.value?.polygon?.length>0&&H.push({...Lt.value,id:Lt.value.id||"temp-area"}),H}),Kt=z(()=>{if(!xe.value||!Vn.value.length)return[];const H=xe.value.id,se=xe.value.assignedLocationIds||[];return Vn.value.filter(me=>{if(me.reportedBy?.marshalId===H)return!0;const _e=me.context?.checkpoint?.checkpointId;return!!(_e&&se.includes(_e))}).sort((me,_e)=>new Date(_e.incidentTime||_e.createdAt)-new Date(me.incidentTime||me.createdAt))}),Ho=z(()=>{if(!R.value||!Vn.value.length)return[];const H=R.value.id;return Vn.value.filter(se=>se.context?.checkpoint?.checkpointId===H).sort((se,me)=>new Date(me.incidentTime||me.createdAt)-new Date(se.incidentTime||se.createdAt))}),Vo=z(()=>{if(!Lt.value||!Vn.value.length)return[];const H=Lt.value.id,se=B.value.filter(me=>me.areaIds&&me.areaIds.includes(H)).map(me=>me.id);return Vn.value.filter(me=>{const _e=me.context?.checkpoint?.checkpointId;return _e&&se.includes(_e)}).sort((me,_e)=>new Date(_e.incidentTime||_e.createdAt)-new Date(me.incidentTime||me.createdAt))}),Is=H=>{hn.value=H,Io.value=!0},Ra=H=>{hn.value=H,Io.value=!0},_n=H=>{hn.value=H,Io.value=!0},so=()=>{n.push("/sessions")},Zt=(H=!0)=>{q.value=H},wn=()=>{Ct.value=!0},ta=async H=>{try{H&&(St.value={...H});const se=Gl(A.value.eventDate),me=St.value.eventDate;if(se!==me){const _e=N.value.filter(at=>at.startTime||at.endTime);if(_e.length>0){Ft.value=se,ht.value=me,on.value=_e.length,Rt.value=!0;return}}await na(!1,null)}catch(se){console.error("Failed to update event:",se),alert("Failed to update event. Please try again.")}},na=async(H,se)=>{try{if(await a.updateEvent(t.params.eventId,{...St.value,defaultCheckpointStyleMapRotation:St.value.defaultCheckpointStyleMapRotation!=null?String(St.value.defaultCheckpointStyleMapRotation):null}),H&&se!==null){const me=Math.floor(Math.abs(se)/1e3),_e=se<0,at=Math.floor(me/3600),bt=Math.floor(me%3600/60),Mt=me%60,gn=`${_e?"-":""}${at.toString().padStart(2,"0")}:${bt.toString().padStart(2,"0")}:${Mt.toString().padStart(2,"0")}`;await a.bulkUpdateLocationTimes(t.params.eventId,gn)}await Tn(),Ct.value=!1}catch(me){console.error("Failed to update event:",me),alert("Failed to update event. Please try again.")}},oa=async({shouldShift:H,timeDelta:se})=>{Rt.value=!1,await na(H,se)},pi=()=>{Rt.value=!1,Tn()},Tn=async()=>{try{await a.fetchEvent(t.params.eventId),A.value=a.currentEvent,A.value&&(St.value={name:A.value.name||"",description:A.value.description||"",eventDate:Gl(A.value.eventDate),timeZoneId:A.value.timeZoneId||"UTC",peopleTerm:A.value.peopleTerm||"Marshals",checkpointTerm:A.value.checkpointTerm||"Checkpoints",areaTerm:A.value.areaTerm||"Areas",checklistTerm:A.value.checklistTerm||"Checklists",courseTerm:A.value.courseTerm||"Course",defaultCheckpointStyleType:A.value.defaultCheckpointStyleType||"default",defaultCheckpointStyleColor:A.value.defaultCheckpointStyleColor||"",defaultCheckpointStyleBackgroundShape:A.value.defaultCheckpointStyleBackgroundShape||"",defaultCheckpointStyleBackgroundColor:A.value.defaultCheckpointStyleBackgroundColor||"",defaultCheckpointStyleBorderColor:A.value.defaultCheckpointStyleBorderColor||"",defaultCheckpointStyleIconColor:A.value.defaultCheckpointStyleIconColor||"",defaultCheckpointStyleSize:A.value.defaultCheckpointStyleSize||"",defaultCheckpointStyleMapRotation:A.value.defaultCheckpointStyleMapRotation??"",brandingHeaderGradientStart:A.value.brandingHeaderGradientStart||"",brandingHeaderGradientEnd:A.value.brandingHeaderGradientEnd||"",brandingLogoUrl:A.value.brandingLogoUrl||"",brandingLogoPosition:A.value.brandingLogoPosition||"",brandingAccentColor:A.value.brandingAccentColor||"",brandingPageGradientStart:A.value.brandingPageGradientStart||"",brandingPageGradientEnd:A.value.brandingPageGradientEnd||""},Ct.value=!1,Eu(A.value));const H=await Promise.allSettled([a.fetchLocations(t.params.eventId),a.fetchEventStatus(t.params.eventId),$t(),sa(),ct(),fn(),It(),us(),Go()]);N.value=a.locations,B.value=a.eventStatus.locations,H.forEach((se,me)=>{se.status==="rejected"&&console.error(`Failed to load ${["locations","eventStatus","admins","marshals","areas","checklists","notes","contacts"][me]}:`,se.reason)})}catch(H){console.error("Failed to load event data:",H)}},sa=async()=>{try{const H=await _s.getByEvent(t.params.eventId);Y.value=H.data,j.value.marshals=Date.now()}catch(H){console.error("Failed to load marshals:",H)}},ct=async()=>{try{const H=await Us.getByEvent(t.params.eventId);Et.value=H.data,j.value.areas=Date.now()}catch(H){console.error("Failed to load areas:",H)}},fn=async()=>{try{const[H,se]=await Promise.all([Nt.getByEvent(t.params.eventId),Nt.getReport(t.params.eventId)]);No.value=H.data,Da.value=se.data,j.value.checklists=Date.now()}catch(H){console.error("Failed to load checklists:",H)}},It=async()=>{try{const H=await gs.getByEvent(t.params.eventId);Cs.value=H.data,j.value.notes=Date.now()}catch(H){console.error("Failed to load notes:",H)}},us=async()=>{Qs.value=!0;try{const H=await ks.getAll(t.params.eventId);Vn.value=H.data.incidents||[],j.value.incidents=Date.now()}catch(H){console.error("Failed to load incidents:",H)}finally{Qs.value=!1}},Go=async()=>{try{const[H,se]=await Promise.all([ya.getByEvent(t.params.eventId),ya.getRoles(t.params.eventId)]);no.value=H.data,$o.value=se.data,j.value.contacts=Date.now()}catch(H){console.error("Failed to load contacts:",H)}},Ao=async()=>{await Promise.all([a.fetchLocations(t.params.eventId),a.fetchEventStatus(t.params.eventId)]),N.value=a.locations,j.value.checkpoints=Date.now(),B.value=a.eventStatus.locations},ds=async()=>{await Promise.all([sa(),a.fetchEventStatus(t.params.eventId)]),B.value=a.eventStatus.locations},Eo=async()=>{await Promise.all([a.fetchLocations(t.params.eventId),a.fetchEventStatus(t.params.eventId),ct()]),N.value=a.locations,B.value=a.eventStatus.locations},Ba=async()=>{await a.fetchEventStatus(t.params.eventId),B.value=a.eventStatus.locations},ao=()=>{Lt.value=null,zn.value="details",q.value=!1,Qn.value=!0},Jt=H=>{Lt.value=H,fo.value=H.id,zn.value="details",q.value=!1,Qn.value=!0},Mn=async H=>{try{let se;if(Lt.value&&Lt.value.id){if(se=Lt.value.id,await Us.update(t.params.eventId,se,H),H.checklistChanges&&H.checklistChanges.length>0)for(const me of H.checklistChanges)try{me.complete?await Nt.complete(t.params.eventId,me.itemId,{marshalId:me.marshalId,contextType:me.contextType,contextId:me.contextId}):await Nt.uncomplete(t.params.eventId,me.itemId,{marshalId:me.marshalId,contextType:me.contextType,contextId:me.contextId})}catch(_e){console.error("Failed to update checklist item:",me,_e)}}else se=(await Us.create({eventId:t.params.eventId,...H})).data.id;if(H.pendingContacts&&H.pendingContacts.length>0&&se)for(const me of H.pendingContacts)try{const _e=me.scopeConfigurations?JSON.parse(JSON.stringify(me.scopeConfigurations)):[],at=_e.find(bt=>bt.scope==="EveryoneInAreas"&&bt.itemType==="Area");at?(at.ids||(at.ids=[]),at.ids.includes(se)||at.ids.push(se)):_e.push({scope:"EveryoneInAreas",itemType:"Area",ids:[se]}),await ya.update(t.params.eventId,me.contactId,{...me,scopeConfigurations:_e})}catch(_e){console.error("Failed to add area to contact:",me,_e)}if(H.contactsToRemove&&H.contactsToRemove.length>0&&se)for(const me of H.contactsToRemove)try{const _e=no.value.find(Mt=>Mt.contactId===me);if(!_e)continue;const at=_e.scopeConfigurations?JSON.parse(JSON.stringify(_e.scopeConfigurations)):[],bt=at.find(Mt=>Mt.scope==="EveryoneInAreas"&&Mt.itemType==="Area");if(bt&&bt.ids){bt.ids=bt.ids.filter(gn=>gn!==se);const Mt=bt.ids.length>0?at:at.filter(gn=>!(gn.scope==="EveryoneInAreas"&&gn.itemType==="Area"));await ya.update(t.params.eventId,me,{..._e,scopeConfigurations:Mt})}}catch(_e){console.error("Failed to remove area from contact:",me,_e)}if((H.pendingContacts&&H.pendingContacts.length>0||H.contactsToRemove&&H.contactsToRemove.length>0)&&await Go(),H.pendingNewChecklistItems&&H.pendingNewChecklistItems.length>0&&se){for(const me of H.pendingNewChecklistItems)if(me.text?.trim())try{await Nt.create(t.params.eventId,{text:me.text,scopeConfigurations:[{scope:"EveryoneInAreas",itemType:"Area",ids:[se]}],displayOrder:0,isRequired:!1})}catch(_e){console.error("Failed to create checklist item:",me,_e)}await fn()}if(H.pendingNewNotes&&H.pendingNewNotes.length>0&&se){for(const me of H.pendingNewNotes)if(!(!me.title?.trim()&&!me.content?.trim()))try{await gs.create(t.params.eventId,{title:me.title||"Untitled",content:me.content||"",scopeConfigurations:[{scope:"EveryoneInAreas",itemType:"Area",ids:[se]}],displayOrder:0,priority:"Normal",isPinned:!1})}catch(_e){console.error("Failed to create note:",me,_e)}await It()}await ct(),await Tn(),xs()}catch(se){console.error("Failed to save area:",se),alert(se.response?.data?.message||"Failed to save area. Please try again.")}},aa=async H=>{y(`Delete ${x.value.area}`,`Are you sure you want to delete this ${x.value.area}? ${M.value.checkpoints} will be automatically reassigned.`,async()=>{try{await Us.delete(t.params.eventId,H),await Us.recalculate(t.params.eventId),await ct(),await Tn(),xs()}catch(se){console.error(`Failed to delete ${x.value.area}:`,se),alert(se.response?.data?.message||`Failed to delete ${x.value.area}. Please try again.`)}},{isDanger:!0,confirmText:"Delete"})},xs=()=>{Qn.value=!1,Lt.value=null,fo.value=null,q.value=!1,Wt.value=!1,Ht.value=null},vi=({marshal:H,area:se})=>{mn.value=null,oo.value="details",q.value=!1,kt.value=se,Pt.value="",To.value=H.id,go.value=!0},Na=({name:H,area:se})=>{mn.value=null,oo.value="details",q.value=!1,kt.value=se,Pt.value=H,To.value=null,go.value=!0},Fa=H=>{mn.value=H,oo.value="details",q.value=!1,go.value=!0},Qi=()=>{po.value=null,Hn.value="details",q.value=!1,Fo.value=!0},Ua=(H,se="details")=>{po.value=H,Hn.value=se,q.value=!1,Fo.value=!0},_t=async H=>{try{const se={...H,scopeConfigurations:nu(H.scopeConfigurations,{areas:Et.value,locations:B.value,marshals:Y.value})};if(po.value&&po.value.itemId)await Nt.update(t.params.eventId,po.value.itemId,se);else{const me=await Nt.create(t.params.eventId,se);me.data.count&&me.data.count>1&&(yt.value="Checklist Items Created",mt.value=`Successfully created ${me.data.count} checklist items.`,dt.value=!0)}await fn(),Cn()}catch(se){console.error("Failed to save checklist item:",se);const me=se.response?.data?.message||"Failed to save checklist item. Please try again.";alert(me)}},el=async H=>{y(`Delete ${x.value.checklist}`,`Are you sure you want to delete this ${x.value.checklist}?`,async()=>{try{await Nt.delete(t.params.eventId,H),await fn(),Cn()}catch(se){console.error(`Failed to delete ${x.value.checklist}:`,se),alert(se.response?.data?.message||`Failed to delete ${x.value.checklist}. Please try again.`)}},{isDanger:!0,confirmText:"Delete"})},Cn=()=>{Fo.value=!1,po.value=null,q.value=!1},hs=()=>{Uo.value=null,Xs.value="details",q.value=!1,rs.value=!0},za=H=>{Uo.value=H,Xs.value="details",q.value=!1,rs.value=!0},tl=async H=>{try{const se={...H,scopeConfigurations:nu(H.scopeConfigurations,{areas:Et.value,locations:B.value,marshals:Y.value})};Uo.value&&Uo.value.noteId?await gs.update(t.params.eventId,Uo.value.noteId,se):await gs.create(t.params.eventId,se),await It(),ia()}catch(se){console.error("Failed to save note:",se);const me=se.response?.data?.message||"Failed to save note. Please try again.";alert(me)}},$s=async H=>{y("Delete note","Are you sure you want to delete this note?",async()=>{try{await gs.delete(t.params.eventId,H),await It(),ia()}catch(se){console.error("Failed to delete note:",se),alert(se.response?.data?.message||"Failed to delete note. Please try again.")}},{isDanger:!0,confirmText:"Delete"})},ia=()=>{rs.value=!1,Uo.value=null,q.value=!1},mi=()=>{xo.value=!0},nl=async H=>{try{await ks.create(t.params.eventId,H),xo.value=!1,await us()}catch(se){console.error("Failed to report incident:",se),alert(se.response?.data?.message||"Failed to report incident. Please try again.")}},ol=H=>{hn.value=H,Io.value=!0},la=()=>{Io.value=!1,hn.value=null},gi=async({incidentId:H,status:se})=>{try{if(await ks.updateStatus(t.params.eventId,H,{status:se}),await us(),hn.value?.incidentId===H){const me=Vn.value.find(_e=>_e.incidentId===H);me&&(hn.value=me)}}catch(me){console.error("Failed to update incident status:",me),alert(me.response?.data?.message||"Failed to update status. Please try again.")}},Gn=()=>{vo.value="",Ls.value=!0},Ha=()=>{Ls.value=!1,vo.value=""},De=async()=>{if(!(!vo.value.trim()||!hn.value)){mo.value=!0;try{await ks.addNote(t.params.eventId,hn.value.incidentId,vo.value.trim()),Ha(),await us();const H=Vn.value.find(se=>se.incidentId===hn.value.incidentId);H&&(hn.value=H)}catch(H){console.error("Failed to add note to incident:",H),alert(H.response?.data?.message||"Failed to add note. Please try again.")}finally{mo.value=!1}}},Se=()=>{mn.value=null,oo.value="details",kt.value=null,q.value=!1,go.value=!0},tt=H=>{mn.value=H,oo.value="details",q.value=!1,go.value=!0},pt=async H=>{try{const se={...H,scopeConfigurations:nu(H.scopeConfigurations,{areas:Et.value,locations:B.value,marshals:Y.value})};let me=null;const _e=!mn.value||!mn.value.contactId,at=!!kt.value;if(mn.value&&mn.value.contactId)await ya.update(t.params.eventId,mn.value.contactId,se);else{const bt=await ya.create(t.params.eventId,se);me=bt.data?.contactId||bt.data?.id}if(await Go(),_e&&at&&me&&eo.value){const bt=no.value.find(Mt=>Mt.contactId===me);bt&&eo.value.addPendingContact(bt)}xt()}catch(se){console.error("Failed to save contact:",se);const me=se.response?.data?.message||"Failed to save contact. Please try again.";alert(me)}},Yt=async H=>{y("Delete contact","Are you sure you want to delete this contact?",async()=>{try{await ya.delete(t.params.eventId,H),await Go(),eo.value&&eo.value.removeContactById(H),xt()}catch(se){console.error("Failed to delete contact:",se),alert(se.response?.data?.message||"Failed to delete contact. Please try again.")}},{isDanger:!0,confirmText:"Delete"})},xt=()=>{go.value=!1,mn.value=null,kt.value=null,Pt.value="",To.value=null,q.value=!1},pn=H=>{Ht.value={...H,id:Lt.value?.id};const se={...H,id:Lt.value?.id,polygon:[]};Lt.value=se;let me=!1;if(H.polygon&&H.polygon.length>0){const _e=H.polygon.map(Sn=>Sn.lat||Sn[0]),at=H.polygon.map(Sn=>Sn.lng||Sn[1]),bt=Math.min(..._e),Mt=Math.max(..._e),gn=Math.min(...at),fa=Math.max(...at);je.value={lat:(bt+Mt)/2,lng:(gn+fa)/2};const xi=Mt-bt,Ms=fa-gn,pa=Math.max(xi,Ms);Tt.value=pa<.005?17:pa<.01?16:pa<.02?15:pa<.05?14:13,me=!0}if(!me&&H.checkpointIds&&H.checkpointIds.length>0){const _e=B.value.filter(at=>H.checkpointIds.includes(at.id));if(_e.length>0){const at=_e.map(Mt=>Mt.latitude).filter(Boolean),bt=_e.map(Mt=>Mt.longitude).filter(Boolean);if(at.length>0&&bt.length>0){const Mt=Math.min(...at),gn=Math.max(...at),fa=Math.min(...bt),xi=Math.max(...bt);je.value={lat:(Mt+gn)/2,lng:(fa+xi)/2};const Ms=gn-Mt,pa=xi-fa,Sn=Math.max(Ms,pa);Tt.value=Sn<.005?16:Sn<.01?15:Sn<.02?14:Sn<.05?13:12,me=!0}}}if(!me&&ne.value){const _e=ne.value.getMapCenter(),at=ne.value.getMapZoom();_e&&at!==null&&(je.value=_e,Tt.value=at)}So.value=!0,le.value="draw-area",Wt.value=!0,ce.value={title:"Draw area boundary",description:"Click to add points. Click Done when finished to complete the area."}},An=H=>{Ht.value?Lt.value={...Lt.value||{},...Ht.value,polygon:H}:Lt.value={...Lt.value,polygon:H}},Ut=H=>{S.handlePolygonDrawing(H)},Ln=()=>{Wt.value=!1,Ht.value&&(Lt.value=Ht.value,Qn.value=!0,Ht.value=null)},$t=()=>D.loadEventAdmins(),sn=async H=>{try{await D.addAdmin(H),await $t(),Po()}catch(se){console.error("Failed to add admin:",se),alert(se.response?.data?.message||"Failed to add administrator. Please try again.")}},jn=async H=>{y("Remove administrator",`Remove ${H} as an administrator?`,async()=>{try{await D.removeAdmin(H),await $t()}catch(se){console.error("Failed to remove admin:",se),alert(se.response?.data?.message||"Failed to remove administrator. Please try again.")}},{isDanger:!0,confirmText:"Remove"})},Po=()=>{D.closeAddAdminModal(),q.value=!1},En=async H=>{await _.uploadRoute(H)&&(await Ao(),ko())},ko=()=>{_.closeUploadRouteModal()},sl=async({file:H,deleteExisting:se})=>{const me=await _.importLocations(H,se);if(me){await Eo(),ra();const _e=_.formatImportResultMessage(me,"location");yt.value="Import Complete",mt.value=_e,dt.value=!0}},ra=()=>{_.closeImportLocationsModal()},io=async H=>{if(ee.value)dn.value.latitude=H.lat,dn.value.longitude=H.lng;else if(K.value)ae.value.latitude=H.lat,ae.value.longitude=H.lng,R.value&&(R.value={...R.value,latitude:H.lat,longitude:H.lng}),K.value=!1,F.value=!0,Zt();else if(ls.value)try{await a.createLocation({eventId:t.params.eventId,name:`Checkpoint ${to.value}`,description:"",latitude:H.lat,longitude:H.lng,requiredMarshals:1,what3Words:""}),to.value++,await Tn()}catch(se){console.error("Failed to create checkpoint:",se),alert("Failed to create checkpoint. Please try again.")}},nr=H=>{S.handleFullscreenMapClick(H)},or=H=>{dn.value={...H}},Ic=()=>{ee.value=!1,S.enterPlaceCheckpointMode()},al=()=>{S.saveMapState(ne.value),dn.value={name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""},S.enterPlaceCheckpointMode()},il=()=>{S.saveMapState(ne.value),So.value=!0,le.value="view",ce.value={title:"Course map",description:""}},xc=()=>{S.saveMapState(ne.value),Lt.value={id:null,name:"",description:"",color:"#667eea",polygon:[],checkpointIds:[],marshalIds:[],displayOrder:Et.value.length},S.enterDrawAreaMode()},$c=()=>{R.value={id:null,name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:"",areaIds:[],assignments:[]},ae.value={id:null,name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""},W.value=[],ie.value=[],q.value=!1,F.value=!0},sr=()=>{const H=S.calculateStartingNumber(B);S.saveMapState(ne.value),S.enterAddMultipleMode(H)},Tc=()=>{if(le.value==="place-checkpoint"){const H=S.getPlacedCoords()||{lat:0,lng:0};R.value={id:null,name:"",description:"",latitude:H.lat,longitude:H.lng,requiredMarshals:1,what3Words:"",areaIds:[],assignments:[]},ae.value={id:null,name:"",description:"",latitude:H.lat,longitude:H.lng,requiredMarshals:1,what3Words:""},W.value=[],ie.value=[],q.value=!1,yi(),F.value=!0}else if(le.value==="move-checkpoint"){const H=S.getPlacedCoords();H&&(ae.value.latitude=H.lat,ae.value.longitude=H.lng,R.value&&(R.value={...R.value,...Xt.value||{},latitude:H.lat,longitude:H.lng}),Zt()),Xt.value=null,yi(),F.value=!0}else if(le.value==="draw-area"){const H=S.getCompletedPolygon();H&&(Ht.value?Lt.value={...Lt.value||{},...Ht.value,polygon:H}:Lt.value={...Lt.value||{},polygon:H}),Ht.value=null,yi()}else le.value==="add-multiple"&&bo()},bo=async()=>{const H=S.getTempCheckpoints();try{for(const se of H)await a.createLocation({eventId:t.params.eventId,name:se.name,description:se.description,latitude:se.latitude,longitude:se.longitude,requiredMarshals:se.requiredMarshals,what3Words:se.what3Words});S.clearTempCheckpoints(),yi(),await Tn()}catch(se){console.error("Failed to create checkpoints:",se),alert("Failed to create checkpoints. Please try again.")}},ca=()=>{le.value==="draw-area"?Ht.value&&(Lt.value=Ht.value,Ht.value=null):le.value==="move-checkpoint"&&(Xt.value&&R.value&&Object.assign(R.value,Xt.value),F.value=!0,K.value=!1),S.cancelFullscreen()},yi=()=>{S.exitFullscreen()},jo=H=>{ki(H)},ki=H=>{R.value=H,ae.value={id:H.id,name:H.name,description:H.description||"",latitude:H.latitude,longitude:H.longitude,requiredMarshals:H.requiredMarshals,what3Words:H.what3Words||""},W.value=[],ie.value=[],q.value=!1,F.value=!0,setTimeout(()=>{ne.value?.scrollMapIntoView()},100)},ua=async H=>{if(!Wr(H.what3Words)){alert("Invalid What3Words format. Please use word.word.word or word/word/word (lowercase letters only, 1-20 characters each)");return}try{await a.createLocation({eventId:t.params.eventId,...H}),await Tn(),ar()}catch(se){console.error("Failed to save location:",se),alert("Failed to save location. Please try again.")}},ar=()=>{ee.value=!1,dn.value={name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""},q.value=!1,q.value=!1},Ts=()=>{F.value=!1,R.value=null,G.value=!1,K.value=!1,$e.value=!1,Xt.value=null,ae.value={id:"",name:"",description:"",latitude:0,longitude:0,requiredMarshals:1,what3Words:""},W.value=[],ie.value=[],q.value=!1},bi=()=>{$e.value=!1},_i=()=>{$e.value=!0},Mc=H=>{H?.formData&&(Xt.value=H.formData),F.value=!1,ye.value=null;const se=Xt.value?.latitude??R.value?.latitude,me=Xt.value?.longitude??R.value?.longitude;if(se&&me)je.value={lat:se,lng:me},Tt.value=16;else if(ne.value){const at=ne.value.getMapCenter(),bt=ne.value.getMapZoom();at&&bt!==null&&(je.value=at,Tt.value=bt)}const _e=Xt.value?.name||R.value?.name;So.value=!0,le.value="move-checkpoint",ce.value={title:`Move ${x.value.checkpoint}: ${_e}`,description:"Click on the map to set the new location"}},fs=async H=>{if(!Wr(H.what3Words)){alert("Invalid What3Words format.");return}try{const se=!R.value.id;if(se){const me=await a.createLocation({eventId:t.params.eventId,name:H.name,description:H.description,latitude:H.latitude,longitude:H.longitude,requiredMarshals:H.requiredMarshals,what3Words:H.what3Words||null,startTime:H.startTime,endTime:H.endTime,styleType:H.styleType,styleColor:H.styleColor,styleBackgroundShape:H.styleBackgroundShape,styleBackgroundColor:H.styleBackgroundColor,styleBorderColor:H.styleBorderColor,styleIconColor:H.styleIconColor,styleSize:H.styleSize,styleMapRotation:H.styleMapRotation!=null?String(H.styleMapRotation):null,peopleTerm:H.peopleTerm,checkpointTerm:H.checkpointTerm,isDynamic:H.isDynamic||!1,locationUpdateScopeConfigurations:H.locationUpdateScopeConfigurations||[],pendingNewChecklistItems:H.pendingNewChecklistItems||[],pendingNewNotes:H.pendingNewNotes||[]});if(H.pendingAssignments&&H.pendingAssignments.length>0)for(const _e of H.pendingAssignments)await a.createAssignment({eventId:t.params.eventId,locationId:me.id,marshalId:_e.marshalId})}else{const me=R.value.id;if(await Yn.update(t.params.eventId,me,{eventId:t.params.eventId,name:H.name,description:H.description,latitude:H.latitude,longitude:H.longitude,requiredMarshals:H.requiredMarshals,what3Words:H.what3Words||null,startTime:H.startTime,endTime:H.endTime,styleType:H.styleType,styleColor:H.styleColor,styleBackgroundShape:H.styleBackgroundShape,styleBackgroundColor:H.styleBackgroundColor,styleBorderColor:H.styleBorderColor,styleIconColor:H.styleIconColor,styleSize:H.styleSize,styleMapRotation:H.styleMapRotation!=null?String(H.styleMapRotation):null,peopleTerm:H.peopleTerm,checkpointTerm:H.checkpointTerm,isDynamic:H.isDynamic||!1,locationUpdateScopeConfigurations:H.locationUpdateScopeConfigurations||[]}),H.pendingNewChecklistItems&&H.pendingNewChecklistItems.length>0)for(const _e of H.pendingNewChecklistItems)_e.text?.trim()&&await Nt.create(t.params.eventId,{text:_e.text,scopeConfigurations:[{scope:"EveryoneAtCheckpoints",itemType:"Checkpoint",ids:[me]}],displayOrder:0,isRequired:!1});if(H.pendingNewNotes&&H.pendingNewNotes.length>0)for(const _e of H.pendingNewNotes)!_e.title?.trim()&&!_e.content?.trim()||await gs.create(t.params.eventId,{title:_e.title||"Untitled",content:_e.content||"",scopeConfigurations:[{scope:"EveryoneAtCheckpoints",itemType:"Checkpoint",ids:[me]}],displayOrder:0,priority:"Normal",isPinned:!1});for(const _e of ie.value)await a.deleteAssignment(t.params.eventId,_e);if(H.assignmentsToRemove&&H.assignmentsToRemove.length>0)for(const _e of H.assignmentsToRemove)await a.deleteAssignment(t.params.eventId,_e);for(const _e of W.value)await a.createAssignment({eventId:t.params.eventId,locationId:R.value.id,marshalId:_e.marshalId});if(H.checkInChanges&&H.checkInChanges.length>0)for(const _e of H.checkInChanges){const at=R.value.assignments.find(bt=>bt.id===_e.assignmentId);at&&at.isCheckedIn!==_e.shouldBeCheckedIn&&await $a.adminCheckIn(t.params.eventId,_e.assignmentId)}}if(!se&&H.checklistChanges&&H.checklistChanges.length>0)for(const me of H.checklistChanges)try{me.complete?await Nt.complete(t.params.eventId,me.itemId,{marshalId:me.marshalId,contextType:me.contextType,contextId:me.contextId}):await Nt.uncomplete(t.params.eventId,me.itemId,{marshalId:me.marshalId,contextType:me.contextType,contextId:me.contextId})}catch(_e){console.error("Failed to update checklist item:",me,_e)}await Tn(),Ts()}catch(se){console.error("Failed to update location:",se),alert("Failed to update location. Please try again.")}},wi=async H=>{y(`Delete ${x.value.checkpoint}`,`Are you sure you want to delete this ${x.value.checkpoint}?`,async()=>{try{await Yn.delete(t.params.eventId,H),await Eo(),Ts()}catch(se){console.error(`Failed to delete ${x.value.checkpoint}:`,se),alert(`Failed to delete ${x.value.checkpoint}. Please try again.`)}},{isDanger:!0,confirmText:"Delete"})},Ac=async H=>{try{if(Ae.value&&Ae.value.setCheckingIn(H.id),await $a.adminCheckIn(t.params.eventId,H.id),await Ba(),R.value){const se=B.value.find(me=>me.id===R.value.id);se&&(R.value=se)}}catch(se){console.error("Failed to toggle check-in:",se),alert("Failed to toggle check-in. Please try again.")}finally{Ae.value&&Ae.value.setCheckingIn(null)}},ll=H=>{const se=H?.id??H;if(se?.toString().startsWith("temp-")){const me=R.value.assignments.find(_e=>_e.id===se);me&&(W.value=W.value.filter(_e=>_e.marshalId!==me.marshalId)),R.value.assignments=R.value.assignments.filter(_e=>_e.id!==se),Zt()}else ie.value.includes(se)||(ie.value.push(se),R.value.assignments=R.value.assignments.filter(me=>me.id!==se),Zt())},Ec=async H=>{const se=Y.value.find(_e=>_e.id===H);if(!se)return;const me=B.value.filter(_e=>_e.assignments?.some(at=>at.marshalId===H&&_e.id!==R.value.id));if(me.length>0){Oe.value={marshalName:se.name,locations:me.map(at=>at.name),marshal:se};const _e=await new Promise(at=>{Le.value=at,Be.value=!0});if(_e==="cancel"||_e==="choose-other")return;if(_e==="move")for(const at of me){const bt=at.assignments.find(Mt=>Mt.marshalId===H);if(bt){ie.value.push(bt.id);const Mt=B.value.findIndex(gn=>gn.id===at.id);Mt!==-1&&(B.value[Mt].assignments=B.value[Mt].assignments.filter(gn=>gn.id!==bt.id))}}}W.value.push({marshalId:se.id,marshalName:se.name}),R.value.assignments||(R.value.assignments=[]),R.value.assignments.push({id:`temp-${Date.now()}`,marshalId:se.id,marshalName:se.name,locationId:R.value.id,isCheckedIn:!1,isPending:!0}),Zt(),bi()},Zo=async H=>{try{const me=(await _s.create({eventId:t.params.eventId,name:H.name,email:H.email,phoneNumber:H.phoneNumber})).data;await sa(),W.value.push({marshalId:me.id,marshalName:me.name}),R.value&&(R.value.assignments||(R.value.assignments=[]),R.value.assignments.push({id:`temp-${Date.now()}`,marshalId:me.id,marshalName:me.name,locationId:R.value.id,isCheckedIn:!1,isPending:!0})),Zt(),bi()}catch(se){console.error("Failed to create marshal:",se),alert("Failed to create marshal. Please try again.")}},Pc=()=>{xe.value=null,de.value={},fe.value={id:"",name:"",email:"",phoneNumber:"",notes:""},Ue.value=[],et.value=[],q.value=!1,he.value=!0},da=H=>{xe.value=H,de.value={},fe.value={id:H.id,name:H.name,email:H.email||"",phoneNumber:H.phoneNumber||"",notes:H.notes||""},Ue.value=[],et.value=[],q.value=!1,he.value=!0},ir=z(()=>{if(!xe.value)return[];const H=[];return B.value.forEach(se=>{se.assignments.filter(_e=>_e.marshalName===xe.value.name&&!et.value.includes(_e.id)).forEach(_e=>{H.push({..._e,locationName:se.name,locationDescription:se.description||""})})}),Ue.value.forEach((se,me)=>{const _e=B.value.find(at=>at.id===se.locationId);_e&&H.push({id:`pending-${me}`,locationId:se.locationId,locationName:_e.name,locationDescription:_e.description||"",marshalId:xe.value.id,marshalName:xe.value.name,isCheckedIn:!1,isPending:!0})}),H}),qo=async H=>{try{let se=xe.value?.id,me=!1;if(xe.value){if(await _s.update(t.params.eventId,xe.value.id,{name:H.name,email:H.email,phoneNumber:H.phoneNumber,notes:H.notes}),H.pendingNewChecklistItems&&H.pendingNewChecklistItems.length>0)for(const _e of H.pendingNewChecklistItems)_e.text?.trim()&&await Nt.create(t.params.eventId,{text:_e.text,scopeConfigurations:[{scope:"SpecificPeople",itemType:"Marshal",ids:[se]}],displayOrder:0,isRequired:!1});if(H.pendingNewNotes&&H.pendingNewNotes.length>0)for(const _e of H.pendingNewNotes)!_e.title?.trim()&&!_e.content?.trim()||await gs.create(t.params.eventId,{title:_e.title||"Untitled",content:_e.content||"",scopeConfigurations:[{scope:"SpecificPeople",itemType:"Marshal",ids:[se]}],displayOrder:0,priority:"Normal",isPinned:!1})}else se=(await _s.create({eventId:t.params.eventId,name:H.name,email:H.email,phoneNumber:H.phoneNumber,notes:H.notes,pendingNewChecklistItems:H.pendingNewChecklistItems||[],pendingNewNotes:H.pendingNewNotes||[]})).data.id,me=!0;for(const _e of et.value)await a.deleteAssignment(t.params.eventId,_e);if(H.assignmentsToRemove&&H.assignmentsToRemove.length>0)for(const _e of H.assignmentsToRemove)await a.deleteAssignment(t.params.eventId,_e);for(const _e of Ue.value)await a.createAssignment({eventId:t.params.eventId,locationId:_e.locationId,marshalId:se});if(H.pendingAssignments&&H.pendingAssignments.length>0)for(const _e of H.pendingAssignments)await a.createAssignment({eventId:t.params.eventId,locationId:_e.locationId,marshalId:se});if(H.checkInChanges&&H.checkInChanges.length>0){const _e=ir.value;for(const at of H.checkInChanges){const bt=_e.find(Mt=>Mt.id===at.assignmentId);bt&&bt.isCheckedIn!==at.shouldBeCheckedIn&&await $a.adminCheckIn(t.params.eventId,at.assignmentId)}}if(H.checklistChanges&&H.checklistChanges.length>0)for(const _e of H.checklistChanges)try{const at={marshalId:se};_e.contextType&&_e.contextId&&(at.contextType=_e.contextType,at.contextId=_e.contextId),_e.complete?await Nt.complete(t.params.eventId,_e.itemId,at):await Nt.uncomplete(t.params.eventId,_e.itemId,at)}catch(at){console.error("Failed to process checklist change:",at);const bt=at.response?.data?.message||"Failed to update checklist item";alert(`Error: ${bt}`)}if(await Tn(),R.value){const _e=B.value.find(at=>at.id===R.value.id);_e&&(R.value=_e)}Ga(),me&&(U.value=se,X.value=H.name,te.value=!0)}catch(se){console.error("Failed to save marshal:",se);const me=se.response?.data?.message||"Failed to save marshal. Please try again.";if(se.response?.status===400){const _e=me.toLowerCase();_e.includes("name")?(de.value={name:me},be.value&&(be.value.switchToTab("details"),be.value.focusField("name"))):_e.includes("email")?(de.value={email:me},be.value&&(be.value.switchToTab("details"),be.value.focusField("email"))):(de.value={general:me},be.value&&be.value.switchToTab("details"))}else de.value={general:me},be.value&&be.value.switchToTab("details")}},Va=async H=>{const se=H||xe.value?.id;if(!se){console.error("No marshal ID to delete");return}const me=x.value.person;y(`Delete ${me}`,`Are you sure you want to delete this ${me}?`,async()=>{try{await _s.delete(t.params.eventId,se),await ds(),Ga()}catch(_e){console.error(`Failed to delete ${me}:`,_e),alert(`Failed to delete ${me}. Please try again.`)}},{isDanger:!0,confirmText:"Delete"})},lr=H=>{Va(H.id)},rl=H=>{const se=H?.id??H;if(se?.toString().startsWith("pending-")){const me=H?.locationId;me&&(Ue.value=Ue.value.filter(_e=>_e.locationId!==me)),Zt()}else et.value.includes(se)||(et.value.push(se),Zt())},Ci=H=>{Ue.value.push({locationId:H}),Zt()},Ga=()=>{he.value=!1,xe.value=null,Ie.value=null,de.value={},fe.value={id:"",name:"",email:"",phoneNumber:"",notes:""},Ue.value=[],et.value=[],q.value=!1},Li=async H=>{const se=Y.value.find(me=>me.id===H.marshalId);if(!se){console.error("Marshal not found:",H.marshalId);return}Ie.value=R.value?.id||null,q.value=!1,xe.value=se,he.value=!0},ha=H=>{const se=B.value.find(me=>me.id===H.locationId);if(!se){console.error("Location not found:",H.locationId);return}G.value=!0,q.value=!1,R.value=se,F.value=!0},Si=async({file:H})=>{const se=await _.importMarshals(H);if(se){await ds(),Ii();const me=_.formatImportResultMessage(se,"marshal");yt.value="Import Complete",mt.value=me,dt.value=!0}},Ii=()=>{_.closeImportMarshalsModal()},rr=H=>{Le.value&&(Le.value(H),Le.value=null),Be.value=!1};let ja=null;const Za=async()=>{try{const H=t.params.eventId,se=await Yn.getDynamicCheckpoints(H);if(se.data&&Array.isArray(se.data))for(const me of se.data){const _e=B.value.find(at=>at.id===me.checkpointId);_e&&(_e.latitude=me.latitude,_e.longitude=me.longitude,_e.lastLocationUpdate=me.lastLocationUpdate)}}catch(H){console.warn("Failed to poll dynamic checkpoints:",H)}},cr=()=>{ja||!B.value.some(se=>se.isDynamic||se.IsDynamic)||(Za(),ja=setInterval(Za,6e4))},cl=()=>{ja&&(clearInterval(ja),ja=null)};return qe(i,H=>{H==="course"?cr():cl();const se=Date.now(),me=_e=>se-j.value[_e]>kB;switch(H){case"marshals":me("marshals")&&sa();break;case"areas":me("areas")&&ct();break;case"checkpoints":me("checkpoints")&&Ao();break;case"checklists":me("checklists")&&fn();break;case"notes":me("notes")&&It();break;case"incidents":me("incidents")&&us();break;case"contacts":me("contacts")&&Go();break}}),tn(async()=>{await Tn();try{const H=await bs.getMe(t.params.eventId);zo.value=H.data}catch(H){console.warn("Failed to fetch user claims:",H)}i.value==="course"&&cr()}),qe(A,H=>{H&&(document.title="OnTheDay App - Admin")},{immediate:!0}),bn(()=>{cl()}),(H,se)=>(v(),m("div",{class:"admin-event-manage",style:Qe({colorScheme:O(E)})},[r("header",rB,[r("div",cB,[r("button",{onClick:so,class:"btn-back",title:"Back to sessions"},[Me(lB,{size:48,animate:""})]),A.value?(v(),m("div",uB,[r("h1",null,w(A.value.name),1),r("p",dB,w(O(em)(A.value.eventDate)),1)])):P("",!0)]),r("div",hB,[yo.value?(v(),m("button",{key:0,onClick:ea,class:"btn btn-marshal-mode"}," Switch to Marshal ")):P("",!0)]),Me(nB,{class:"theme-toggle-fixed"})]),r("div",fB,[r("div",pB,[Me(rT,{tabs:Z.value,"model-value":O(i),"onUpdate:modelValue":O(l)},null,8,["tabs","model-value","onUpdate:modelValue"])]),r("div",vB,[O(i)==="course"?(v(),Ze(bw,{key:0,ref_key:"courseAreasTab",ref:ne,checkpoints:B.value,areas:Et.value,route:A.value?.route||[],"selected-area-id":fo.value,"drawing-mode":O(Wt),onMapClick:io,onLocationClick:jo,onAreaClick:Jt,onImportCheckpoints:se[0]||(se[0]=me=>Ke.value=!0),onUploadRoute:se[1]||(se[1]=me=>Re.value=!0),onSelectLocation:ki,onAddArea:ao,onSelectArea:Jt,onPolygonComplete:An,onCancelDrawing:Ln,onAddCheckpointFromMap:al,onAddManyCheckpointsFromMap:sr,onAddAreaFromMap:xc,onFullscreen:il},null,8,["checkpoints","areas","route","selected-area-id","drawing-mode"])):P("",!0),O(i)==="checkpoints"?(v(),Ze(E$,{key:1,locations:B.value,areas:Et.value,onAddCheckpointManually:$c,onImportCheckpoints:se[2]||(se[2]=me=>Ke.value=!0),onSelectLocation:ki},null,8,["locations","areas"])):P("",!0),O(i)==="areas"?(v(),Ze(X$,{key:2,areas:Et.value,checkpoints:B.value,contacts:no.value,"event-people-term":A.value?.peopleTerm||"Marshals","event-checkpoint-term":A.value?.checkpointTerm||"Checkpoints",onAddArea:ao,onSelectArea:Jt},null,8,["areas","checkpoints","contacts","event-people-term","event-checkpoint-term"])):P("",!0),O(i)==="marshals"?(v(),Ze(wC,{key:3,ref_key:"marshalsTabRef",ref:Ae,marshals:Y.value,assignments:Vt.value,locations:B.value,onAddMarshal:Pc,onImportMarshals:se[3]||(se[3]=me=>We.value=!0),onSelectMarshal:da,onDeleteMarshal:lr,onToggleCheckIn:Ac},null,8,["marshals","assignments","locations"])):P("",!0),O(i)==="checklists"?(v(),Ze(RC,{key:4,"checklist-items":No.value,areas:Et.value,locations:B.value,marshals:Y.value,"completion-report":Da.value,onAddChecklistItem:Qi,onSelectChecklistItem:Ua},null,8,["checklist-items","areas","locations","marshals","completion-report"])):P("",!0),O(i)==="notes"?(v(),Ze(e2,{key:5,notes:Cs.value,areas:Et.value,locations:B.value,marshals:Y.value,onAddNote:hs,onSelectNote:za},null,8,["notes","areas","locations","marshals"])):P("",!0),O(i)==="incidents"?(v(),Ze(f$,{key:6,incidents:Vn.value,areas:Et.value,loading:Qs.value,onSelectIncident:ol,onReportIncident:mi},null,8,["incidents","areas","loading"])):P("",!0),O(i)==="contacts"?(v(),Ze($2,{key:7,contacts:no.value,areas:Et.value,locations:B.value,marshals:Y.value,"available-roles":$o.value,onAddContact:Se,onSelectContact:tt},null,8,["contacts","areas","locations","marshals","available-roles"])):P("",!0),O(i)==="details"?(v(),Ze(U2,{key:8,"event-data":St.value,"form-dirty":Ct.value,onSubmit:ta,"onUpdate:formDirty":wn},null,8,["event-data","form-dirty"])):P("",!0),O(i)==="settings"?(v(),Ze(Vx,{key:9,"event-data":St.value,"event-id":O(t).params.eventId,admins:O(re),"form-dirty":Ct.value,onSubmit:ta,onAddAdmin:se[4]||(se[4]=me=>ke.value=!0),onRemoveAdmin:jn,"onUpdate:formDirty":wn},null,8,["event-data","event-id","admins","form-dirty"])):P("",!0)])]),Me(KR,{show:ee.value,location:dn.value,"is-dirty":q.value,onClose:ar,onSave:ua,onSetOnMap:Ic,"onUpdate:isDirty":Zt,"onUpdate:location":or},null,8,["show","location","is-dirty"]),Me(L3,{show:F.value,location:R.value,assignments:R.value?.assignments||[],"event-date":A.value?.eventDate||"",areas:Et.value,"event-id":O(t).params.eventId,"all-locations":B.value,notes:Cs.value,"available-marshals":Ss.value,"all-marshals":Y.value,"all-checklist-items":No.value,incidents:Ho.value,"is-dirty":q.value,"event-default-style-type":A.value?.defaultCheckpointStyleType||A.value?.DefaultCheckpointStyleType||"default","event-default-style-color":A.value?.defaultCheckpointStyleColor||A.value?.DefaultCheckpointStyleColor||"","event-default-style-background-shape":A.value?.defaultCheckpointStyleBackgroundShape||A.value?.DefaultCheckpointStyleBackgroundShape||"","event-default-style-background-color":A.value?.defaultCheckpointStyleBackgroundColor||A.value?.DefaultCheckpointStyleBackgroundColor||"","event-default-style-border-color":A.value?.defaultCheckpointStyleBorderColor||A.value?.DefaultCheckpointStyleBorderColor||"","event-default-style-icon-color":A.value?.defaultCheckpointStyleIconColor||A.value?.DefaultCheckpointStyleIconColor||"","event-default-style-size":A.value?.defaultCheckpointStyleSize||A.value?.DefaultCheckpointStyleSize||"","event-default-style-map-rotation":A.value?.defaultCheckpointStyleMapRotation??A.value?.DefaultCheckpointStyleMapRotation??"","event-people-term":A.value?.peopleTerm||"Marshals","z-index":Qn.value?1200:G.value?1100:1e3,"locked-from-marshal":G.value,onClose:Ts,onSave:fs,onDelete:wi,onMoveLocation:Mc,onRemoveAssignment:ll,onOpenAssignModal:_i,"onUpdate:isDirty":Zt,onSelectIncident:Ra,onSelectMarshal:Li},null,8,["show","location","assignments","event-date","areas","event-id","all-locations","notes","available-marshals","all-marshals","all-checklist-items","incidents","is-dirty","event-default-style-type","event-default-style-color","event-default-style-background-shape","event-default-style-background-color","event-default-style-border-color","event-default-style-icon-color","event-default-style-size","event-default-style-map-rotation","event-people-term","z-index","locked-from-marshal"]),Me(fT,{show:J.value,link:ft.value,"is-dirty":!1,onClose:se[5]||(se[5]=me=>J.value=!1)},null,8,["show","link"]),Me(xT,{show:te.value,"event-id":O(t).params.eventId,"marshal-id":U.value,"marshal-name":X.value,onClose:se[6]||(se[6]=me=>te.value=!1)},null,8,["show","event-id","marshal-id","marshal-name"]),Me(MT,{show:O(ke),"is-dirty":q.value,onClose:Po,onSubmit:sn,"onUpdate:isDirty":Zt},null,8,["show","is-dirty"]),Me(OT,{show:O(Re),uploading:O(Xe),error:O(Ne),"is-dirty":q.value,onClose:ko,onSubmit:En,"onUpdate:isDirty":Zt},null,8,["show","uploading","error","is-dirty"]),Me(jT,{show:O(Ke),importing:O(Q),error:O(Ce),result:O(ve),"is-dirty":q.value,onClose:ra,onSubmit:sl,"onUpdate:isDirty":Zt},null,8,["show","importing","error","result","is-dirty"]),Me(_6,{ref_key:"editMarshalModalRef",ref:be,show:he.value,marshal:xe.value,"event-id":O(t).params.eventId,assignments:ir.value,"available-locations":Oa.value,"all-locations":B.value,areas:Et.value,"is-editing":!!xe.value,"event-notes":Cs.value,"all-checklist-items":No.value,incidents:Kt.value,"all-marshals":Y.value,"is-dirty":q.value,"validation-errors":de.value,"locked-checkpoint-id":Ie.value,"z-index":Ie.value?1100:1e3,onClose:Ga,onSave:qo,onDelete:Va,onRemoveAssignment:rl,onAssignToLocation:Ci,"onUpdate:isDirty":Zt,onSelectIncident:Is,onSelectCheckpoint:ha},null,8,["show","marshal","event-id","assignments","available-locations","all-locations","areas","is-editing","event-notes","all-checklist-items","incidents","all-marshals","is-dirty","validation-errors","locked-checkpoint-id","z-index"]),Me(QT,{show:O(We),importing:O(ge),error:O(Ce),result:O(ue),"is-dirty":q.value,onClose:Ii,onSubmit:Si,"onUpdate:isDirty":Zt},null,8,["show","importing","error","result","is-dirty"]),Me(S6,{show:Be.value,"conflict-data":Oe.value,onClose:se[7]||(se[7]=me=>Be.value=!1),onChoice:rr},null,8,["show","conflict-data"]),Me(O6,{show:$e.value,"location-name":R.value?.name||"",marshals:Ss.value,onClose:bi,onAssignExisting:Ec,onCreateAndAssign:Zo},null,8,["show","location-name","marshals"]),Me(q6,{show:Rt.value,"old-event-date":Ft.value,"new-event-date":ht.value,"affected-checkpoints-count":on.value,onConfirm:oa,onCancel:pi},null,8,["show","old-event-date","new-event-date","affected-checkpoints-count"]),Me(z8,{ref_key:"editAreaModalRef",ref:eo,show:Qn.value,area:Lt.value,"initial-tab":zn.value,checkpoints:B.value,marshals:Y.value,areas:Et.value,route:A.value?.route||[],"is-dirty":q.value,"event-id":O(t).params.eventId,"all-locations":B.value,assignments:Vt.value,notes:Cs.value,contacts:no.value,incidents:Vo.value,"event-default-style-type":A.value?.defaultCheckpointStyleType||A.value?.DefaultCheckpointStyleType||"default","event-default-style-color":A.value?.defaultCheckpointStyleColor||A.value?.DefaultCheckpointStyleColor||"","event-default-style-background-shape":A.value?.defaultCheckpointStyleBackgroundShape||A.value?.DefaultCheckpointStyleBackgroundShape||"","event-default-style-background-color":A.value?.defaultCheckpointStyleBackgroundColor||A.value?.DefaultCheckpointStyleBackgroundColor||"","event-default-style-border-color":A.value?.defaultCheckpointStyleBorderColor||A.value?.DefaultCheckpointStyleBorderColor||"","event-default-style-icon-color":A.value?.defaultCheckpointStyleIconColor||A.value?.DefaultCheckpointStyleIconColor||"","event-default-style-size":A.value?.defaultCheckpointStyleSize||A.value?.DefaultCheckpointStyleSize||"","event-default-style-map-rotation":A.value?.defaultCheckpointStyleMapRotation??A.value?.DefaultCheckpointStyleMapRotation??"","event-people-term":A.value?.peopleTerm||"Marshals","event-checkpoint-term":A.value?.checkpointTerm||"Checkpoints",onClose:xs,onSave:Mn,onDelete:aa,onDrawBoundary:pn,"onUpdate:isDirty":Zt,onSelectCheckpoint:ki,onCreateContactFromMarshal:vi,onCreateNewContact:Na,onEditContact:Fa,onSelectIncident:_n},null,8,["show","area","initial-tab","checkpoints","marshals","areas","route","is-dirty","event-id","all-locations","assignments","notes","contacts","incidents","event-default-style-type","event-default-style-color","event-default-style-background-shape","event-default-style-background-color","event-default-style-border-color","event-default-style-icon-color","event-default-style-size","event-default-style-map-rotation","event-people-term","event-checkpoint-term"]),Me(Q8,{show:Fo.value,"checklist-item":po.value,"initial-tab":Hn.value,areas:Et.value,locations:B.value,marshals:Y.value,"is-dirty":q.value,onClose:Cn,onSave:_t,onDelete:el,"onUpdate:isDirty":Zt},null,8,["show","checklist-item","initial-tab","areas","locations","marshals","is-dirty"]),Me(vD,{show:rs.value,note:Uo.value,"initial-tab":Xs.value,areas:Et.value,locations:B.value,marshals:Y.value,"is-dirty":q.value,onClose:ia,onSave:tl,onDelete:$s,"onUpdate:isDirty":Zt},null,8,["show","note","initial-tab","areas","locations","marshals","is-dirty"]),Me(dm,{show:Io.value,incident:hn.value,route:A.value?.route||[],checkpoints:B.value,"can-manage":!0,onClose:la,onStatusChange:gi,onOpenAddNote:Gn},null,8,["show","incident","route","checkpoints"]),Me(jt,{show:Ls.value,title:"Add update",size:"small",onClose:Ha},{footer:He(()=>[r("div",gB,[r("button",{type:"button",class:"btn btn-secondary",onClick:Ha}," Cancel "),r("button",{type:"button",class:"btn btn-primary",onClick:De,disabled:!vo.value.trim()||mo.value},w(mo.value?"Adding...":"Add update"),9,yB)])]),default:He(()=>[r("div",mB,[ze(r("textarea",{"onUpdate:modelValue":se[8]||(se[8]=me=>vo.value=me),class:"note-textarea",placeholder:"Enter your update...",rows:"4"},null,512),[[nt,vo.value]])])]),_:1},8,["show"]),Me(hm,{show:xo.value,"event-id":O(t).params.eventId,checkpoint:null,"initial-location":null,checkpoints:B.value,route:A.value?.route||[],onClose:se[9]||(se[9]=me=>xo.value=!1),onSubmit:nl},null,8,["show","event-id","checkpoints","route"]),Me(LR,{show:go.value,contact:mn.value,"initial-tab":oo.value,areas:Et.value,locations:B.value,marshals:Y.value,"available-roles":$o.value,"is-dirty":q.value,"prefilled-name":Pt.value,"prefilled-marshal-id":To.value,"create-from-area-context":!!kt.value,onClose:xt,onSave:pt,onDelete:Yt,"onUpdate:isDirty":Zt},null,8,["show","contact","initial-tab","areas","locations","marshals","available-roles","is-dirty","prefilled-name","prefilled-marshal-id","create-from-area-context"]),Me(NR,{show:O(So),mode:O(le),"context-title":O(ce).title,"context-description":O(ce).description,"can-complete":$n.value,clickable:O(le)!=="draw-area","drawing-mode":O(le)==="draw-area"&&O(Wt),locations:cs.value,areas:Mo.value,route:A.value?.route||[],"selected-area-id":fo.value,center:O(je),zoom:O(Tt),"highlight-location-id":Xi.value,onMapClick:nr,onPolygonComplete:An,onPolygonDrawing:Ut,onDone:Tc,onCancel:ca},null,8,["show","mode","context-title","context-description","can-complete","clickable","drawing-mode","locations","areas","route","selected-area-id","center","zoom","highlight-location-id"]),Me(Sc,{show:dt.value,title:yt.value,message:mt.value,onClose:se[10]||(se[10]=me=>dt.value=!1)},null,8,["show","title","message"]),Me(Aa,{show:O(u),title:O(d),message:O(h),"is-danger":O(p),"confirm-text":O(g),onConfirm:O(b),onCancel:O(C)},null,8,["show","title","message","is-danger","confirm-text","onConfirm","onCancel"])],4))}},_B=Ge(bB,[["__scopeId","data-v-c98a4d14"]]),wB={key:0,class:"emergency-notes-section"},CB={class:"emergency-notes-list"},LB={class:"note-header"},SB={key:0,class:"note-content"},IB={key:1,class:"emergency-contacts-section"},xB={class:"emergency-contacts-list"},$B={class:"contact-header"},TB={key:0,class:"role-badge"},MB={class:"contact-details"},AB={key:0,class:"info-section"},EB=["href"],PB={key:1,class:"info-section"},DB=["href"],OB={key:2,class:"info-section"},RB=["href"],BB={key:2,class:"no-contacts"},NB={__name:"EmergencyContactModal",props:{show:{type:Boolean,default:!1},contacts:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]}},emits:["close"],setup(e,{emit:t}){const n=e,a=t,s=z(()=>n.notes?[...n.notes].filter(d=>d.showInEmergencyInfo||d.ShowInEmergencyInfo).sort((d,h)=>{const p=d.isPinned||d.IsPinned,g=h.isPinned||h.IsPinned;if(p!==g)return p?-1:1;const y=d.displayOrder||d.DisplayOrder||0,b=h.displayOrder||h.DisplayOrder||0;if(y!==b)return y-b;const C=d.priority||d.Priority,I=h.priority||h.Priority;return C==="Emergency"&&I!=="Emergency"?-1:I==="Emergency"&&C!=="Emergency"?1:0}):[]),i=z(()=>n.contacts?n.contacts.filter(d=>d.showInEmergencyInfo||d.ShowInEmergencyInfo).sort((d,h)=>{const p=d.isPinned||d.IsPinned,g=h.isPinned||h.IsPinned;if(p!==g)return p?-1:1;const y=d.displayOrder||d.DisplayOrder||0,b=h.displayOrder||h.DisplayOrder||0;if(y!==b)return y-b;const C=d.name||d.Name||"",I=h.name||h.Name||"";return C.localeCompare(I,void 0,{sensitivity:"base"})}):[]),l=()=>{a("close")},u=d=>d?{EmergencyContact:"Emergency Contact",EventDirector:"Event Director",MedicalLead:"Medical Lead",SafetyOfficer:"Safety Officer",Logistics:"Logistics"}[d]||d.replace(/([A-Z])/g," $1").trim():"";return(d,h)=>(v(),Ze(jt,{show:e.show,title:"Emergency information",size:"medium",onClose:l},{actions:He(()=>[r("button",{onClick:l,class:"btn btn-secondary"},"Close")]),default:He(()=>[s.value.length>0?(v(),m("div",wB,[h[0]||(h[0]=r("h2",{class:"section-header"},"Emergency notes",-1)),r("div",CB,[(v(!0),m(Te,null,Fe(s.value,p=>(v(),m("div",{key:p.noteId||p.NoteId,class:pe(["emergency-note-item",{"is-emergency":(p.priority||p.Priority)==="Emergency"}])},[r("div",LB,[r("h3",null,w(p.title||p.Title),1),r("span",{class:pe(["priority-badge",(p.priority||p.Priority).toLowerCase()])},w(p.priority||p.Priority),3)]),p.content||p.Content?(v(),m("div",SB,w(p.content||p.Content),1)):P("",!0)],2))),128))])])):P("",!0),i.value&&i.value.length>0?(v(),m("div",IB,[h[4]||(h[4]=r("h2",{class:"section-header"},"Emergency contacts",-1)),r("div",xB,[(v(!0),m(Te,null,Fe(i.value,p=>(v(),m("div",{key:p.contactId||p.name,class:"emergency-contact-item"},[r("div",$B,[r("h3",null,w(p.name),1),p.role?(v(),m("span",TB,w(u(p.role)),1)):P("",!0)]),r("div",MB,[p.phone?(v(),m("div",AB,[h[1]||(h[1]=r("label",null,"Phone number",-1)),r("a",{href:`tel:${p.phone}`,class:"phone-link"},w(p.phone),9,EB)])):P("",!0),p.email?(v(),m("div",PB,[h[2]||(h[2]=r("label",null,"Email",-1)),r("a",{href:`mailto:${p.email}`,class:"email-link"},w(p.email),9,DB)])):P("",!0),p.notes||p.details?(v(),m("div",OB,[h[3]||(h[3]=r("label",null,"Details",-1)),r("p",null,w(p.notes||p.details),1)])):P("",!0)]),p.phone?(v(),m("a",{key:0,href:`tel:${p.phone}`,class:"btn btn-danger btn-full"}," Call "+w(p.name),9,RB)):P("",!0)]))),128))])])):P("",!0),i.value.length===0&&s.value.length===0?(v(),m("div",BB,[...h[5]||(h[5]=[r("p",null,"No emergency information has been set up for this event.",-1)])])):P("",!0)]),_:1},8,["show"]))}},FB=Ge(NB,[["__scopeId","data-v-57827f4f"]]),bl=T(navigator.onLine),Vs=T(!0),Sa=T(0),br=T(null),ni=T("idle"),Ui=T(null),Nu=T(!1);let _f=null,su=!1,Jo=null,wf=0;function UB(e=1e3,t=1e4){return Math.floor(Math.random()*(t-e+1))+e}function Yr(){Jo&&(clearTimeout(Jo),Jo=null);const e=UB(1e3,1e4);console.log(`Scheduling auto-sync in ${e}ms`),Jo=setTimeout(async()=>{if(Jo=null,!navigator.onLine){console.log("Auto-sync cancelled: offline");return}if(await Zr()===0){console.log("Auto-sync cancelled: no pending actions");return}console.log("Starting auto-sync..."),await Xr();const n=await Zr();n>0&&navigator.onLine&&(console.log(`${n} actions remaining, scheduling retry...`),Yr())},e)}async function Oi(){if(!navigator.onLine)return Vs.value=!1,!1;try{return await gb.check(),Vs.value=!0,!0}catch(e){return e.response?.status===404?(Vs.value=!0,!0):(e.code==="ECONNABORTED"&&console.warn("Server health check timed out"),Vs.value=!1,!1)}}async function md(){const e=Date.now();if(e-wf<2e3)return;wf=e;const t=navigator.onLine;if(bl.value=t,!t){Vs.value=!1;return}Nu.value=!0;try{await Oi()&&Sa.value>0&&Yr()}finally{Nu.value=!1}}function Cf(){document.visibilityState==="visible"&&(console.log("Page became visible, checking connectivity..."),md())}function Lf(){console.log("Window focused, checking connectivity..."),md()}async function zB(e){try{switch(e.type){case"checkin":await $a.checkIn(e.payload);break;case"checkin_toggle":await $a.toggleCheckIn(e.payload.eventId,e.payload.assignmentId,e.payload.gpsData||{});break;case"checkin_admin":await $a.adminCheckIn(e.payload.eventId,e.payload.assignmentId);break;case"checklist_complete":await Nt.complete(e.payload.eventId,e.payload.itemId,e.payload.data);break;case"checklist_uncomplete":await Nt.uncomplete(e.payload.eventId,e.payload.itemId,e.payload.data);break;default:return console.warn("Unknown action type:",e.type),!1}return!0}catch(t){if(console.error("Failed to sync action:",e,t),t.response&&t.response.status===400){const n=t.response.data?.message||t.response.data||"",a=typeof n=="string"?n.toLowerCase():"";if(a.includes("already checked in"))return console.log("Action already completed (already checked in), treating as success"),!0;if(a.includes("already completed")||a.includes("already uncompleted"))return console.log("Action already completed (checklist state), treating as success"),!0}return t.response&&t.response.status>=400&&t.response.status<500?"permanent_failure":!1}}async function Xr(){if(!su&&navigator.onLine){su=!0,ni.value="syncing",Ui.value=null;try{const e=await Gv();if(e.length===0){ni.value="success",Sa.value=0;return}let t=0,n=0;for(const a of e){const s=await zB(a);if(s===!0)await cf(a.id),t++;else if(s==="permanent_failure")await cf(a.id),n++;else{const i=(a.attempts||0)+1;i>=5?(await rf(a.id,{status:"failed",attempts:i,lastAttempt:new Date().toISOString()}),n++):await rf(a.id,{status:"retrying",attempts:i,lastAttempt:new Date().toISOString()})}}Sa.value=await Zr(),n>0?(ni.value="error",Ui.value=`${n} action(s) failed to sync`):ni.value="success"}catch(e){console.error("Sync error:",e),ni.value="error",Ui.value="Failed to sync pending actions"}finally{su=!1}}}function HB(){_f||(_f=setInterval(async()=>{navigator.onLine&&(await Oi(),Vs.value&&Sa.value>0&&await Xr())},3e4))}function gd(){const e=z(()=>bl.value&&Vs.value);async function t(){Sa.value=await Zr()}async function n(){bl.value=!0,await Oi()&&Sa.value>0&&Yr()}function a(){bl.value=!1,Vs.value=!1,Jo&&(clearTimeout(Jo),Jo=null)}tn(async()=>{await Ys(),await t(),window.addEventListener("online",n),window.addEventListener("offline",a),document.addEventListener("visibilitychange",Cf),window.addEventListener("focus",Lf),navigator.onLine&&await Oi()&&Sa.value>0&&Yr(),HB()}),bn(()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a),document.removeEventListener("visibilitychange",Cf),window.removeEventListener("focus",Lf),Jo&&(clearTimeout(Jo),Jo=null)});async function s(d,h){if(!e.value)return console.warn("Cannot refresh cache while offline"),!1;try{const p=await h();return await Vl(d,p),br.value=new Date().toISOString(),!0}catch(p){return console.error("Failed to refresh cache:",p),!1}}async function i(d){const h=await xa(d);return h&&(br.value=h.cachedAt),h}async function l(d){br.value=await cb(d)}async function u(){return navigator.onLine?await Oi()?(await Xr(),ni.value==="success"):(Ui.value="Server is not responding",!1):(Ui.value="Cannot sync while offline",!1)}return{isOnline:bl,isServerHealthy:Vs,isFullyOnline:e,isCheckingStatus:Nu,pendingActionsCount:Sa,lastSyncTime:br,syncStatus:ni,syncError:Ui,checkServerHealth:Oi,quickConnectivityCheck:md,syncPendingActions:Xr,updatePendingCount:t,refreshCache:s,getCachedData:i,loadLastSyncTime:l,forcSync:u}}const VB={class:"offline-indicator-container"},GB={class:"offline-icon"},jB={key:0,viewBox:"0 0 24 24",fill:"currentColor"},ZB={key:1,class:"spinner",viewBox:"0 0 24 24",fill:"currentColor"},qB={class:"offline-text"},WB={key:0,class:"last-sync"},KB={class:"pending-text"},JB={key:0,class:"pending-subtext"},YB={key:1,class:"syncing-text"},XB={__name:"OfflineIndicator",setup(e){const{isOnline:t,isFullyOnline:n,isCheckingStatus:a,pendingActionsCount:s,lastSyncTime:i,syncStatus:l,syncError:u,forcSync:d}=gd(),h=T(!1),p=T(""),g=T(""),y=z(()=>{if(!i.value)return"";const C=new Date(i.value),M=new Date-C,x=Math.floor(M/6e4),S=Math.floor(x/60);return x<1?"just now":x<60?`${x}m ago`:S<24?`${S}h ago`:C.toLocaleDateString()}),b=async()=>{await d()};return qe(l,C=>{C==="success"&&s.value===0?(p.value="All actions synced successfully!",g.value="success",h.value=!0,setTimeout(()=>{h.value=!1},3e3)):C==="error"&&(p.value=u.value||"Sync failed",g.value="error",h.value=!0,setTimeout(()=>{h.value=!1},5e3))}),(C,I)=>(v(),m("div",VB,[Me(ts,{name:"slide"},{default:He(()=>[O(n)?P("",!0):(v(),m("div",{key:0,class:pe(["offline-banner",{checking:O(a)}])},[r("span",GB,[O(a)?(v(),m("svg",ZB,[...I[1]||(I[1]=[r("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8z"},null,-1)])])):(v(),m("svg",jB,[...I[0]||(I[0]=[r("path",{d:"M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.76.59 6.82.36 7l11.63 14.49.01.01.01-.01 3.9-4.86 3.32 3.32 1.27-1.27-3.46-3.46z"},null,-1)])]))]),r("span",qB,w(O(a)?"Checking connection...":O(t)?"Server unavailable":"You're offline"),1),O(i)&&!O(a)?(v(),m("span",WB," Last synced: "+w(y.value),1)):P("",!0)],2))]),_:1}),Me(ts,{name:"fade"},{default:He(()=>[O(s)>0?(v(),m("div",{key:0,class:pe(["pending-banner",{"offline-pending":!O(n)}])},[I[2]||(I[2]=r("span",{class:"pending-icon"},[r("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"})])],-1)),r("span",KB,[Ye(w(O(s))+" pending action"+w(O(s)!==1?"s":"")+" ",1),O(n)?P("",!0):(v(),m("span",JB,"(will sync when online)"))]),O(n)&&O(l)!=="syncing"?(v(),m("button",{key:0,onClick:b,class:"sync-button"}," Sync Now ")):O(l)==="syncing"?(v(),m("span",YB,"Syncing...")):P("",!0)],2)):P("",!0)]),_:1}),Me(ts,{name:"fade"},{default:He(()=>[h.value?(v(),m("div",{key:0,class:pe(["sync-toast",g.value])},w(p.value),3)):P("",!0)]),_:1})]))}},QB=Ge(XB,[["__scopeId","data-v-9c1e58f4"]]),eN={class:"modal-content check-in-reminder-modal"},tN={class:"modal-header warning"},nN={class:"modal-body"},oN={class:"reminder-message"},sN={key:0},aN={class:"reminder-hint"},iN={class:"modal-footer"},lN={__name:"CheckInReminderModal",props:{show:{type:Boolean,required:!0},checkpoint:{type:Object,default:null},accentButtonStyle:{type:Object,default:()=>({})}},emits:["dismiss","go-to-checkpoint"],setup(e){const{termsLower:t}=rt();return(n,a)=>(v(),Ze(ts,{name:"modal"},{default:He(()=>[e.show&&e.checkpoint?(v(),m("div",{key:0,class:"modal-overlay",onClick:a[3]||(a[3]=it(s=>n.$emit("dismiss"),["self"]))},[r("div",eN,[r("div",tN,[a[4]||(a[4]=r("h3",null,"Check-in reminder",-1)),r("button",{class:"modal-close",onClick:a[0]||(a[0]=s=>n.$emit("dismiss"))},"")]),r("div",nN,[a[6]||(a[6]=r("div",{class:"reminder-icon"},"",-1)),r("p",oN,[Ye(" You have not checked in yet to "+w(O(t).checkpoint)+" ",1),r("strong",null,w(e.checkpoint.location?.name),1),e.checkpoint.location?.description?(v(),m("span",sN," - "+w(e.checkpoint.location.description),1)):P("",!0),a[5]||(a[5]=Ye(". ",-1))]),r("p",aN," Please check in when you arrive at your "+w(O(t).checkpoint)+". ",1)]),r("div",iN,[r("button",{onClick:a[1]||(a[1]=s=>n.$emit("dismiss")),class:"btn btn-secondary"}," Dismiss "),r("button",{onClick:a[2]||(a[2]=s=>n.$emit("go-to-checkpoint")),class:"btn btn-primary",style:Qe(e.accentButtonStyle)}," Go to "+w(O(t).checkpoint),5)])])])):P("",!0)]),_:1}))}},rN=Ge(lN,[["__scopeId","data-v-4761fdb9"]]),cN={class:"modal-content location-update-modal"},uN={class:"modal-header"},dN={class:"modal-body"},hN={key:0,class:"success-message"},fN={key:1},pN={class:"modal-description"},vN={key:0,class:"last-update-info"},mN={key:1,class:"gps-status active"},gN={class:"update-option"},yN=["disabled"],kN={class:"update-option auto-update-option"},bN={class:"checkbox-label"},_N=["checked"],wN={class:"option-hint"},CN={class:"update-option"},LN=["disabled"],SN={class:"update-option"},IN={class:"option-label"},xN={key:0,class:"checkpoint-list"},$N=["onClick","disabled"],TN={class:"checkpoint-name"},MN={key:0,class:"checkpoint-description"},AN={key:1,class:"no-checkpoints"},EN={key:2,class:"error"},PN={class:"modal-footer"},DN={__name:"LocationUpdateModal",props:{show:{type:Boolean,required:!0},assignment:{type:Object,default:null},userLocation:{type:Object,default:null},autoUpdateEnabled:{type:Boolean,default:!1},updating:{type:Boolean,default:!1},error:{type:String,default:""},success:{type:String,default:""},availableCheckpoints:{type:Array,default:()=>[]},accentButtonStyle:{type:Object,default:()=>({})}},emits:["close","update-gps","toggle-auto-update","select-on-map","copy-from-checkpoint"],setup(e){const{termsLower:t}=rt(),n=s=>s?new Date(s).toLocaleString():"",a=(s,i=50)=>s?s.length<=i?s:s.substring(0,i).trim()+"...":"";return(s,i)=>(v(),Ze(ts,{name:"modal"},{default:He(()=>[e.show?(v(),m("div",{key:0,class:"modal-overlay",onClick:i[5]||(i[5]=it(l=>s.$emit("close"),["self"]))},[r("div",cN,[r("div",uN,[r("h3",null,"Update "+w(O(t).checkpoint)+" location",1),r("button",{class:"modal-close",onClick:i[0]||(i[0]=l=>s.$emit("close"))},"")]),r("div",dN,[e.success?(v(),m("div",hN,w(e.success),1)):(v(),m("div",fN,[r("p",pN,[i[6]||(i[6]=Ye(" Update the position of ",-1)),r("strong",null,w(e.assignment?.location?.name),1)]),e.assignment?.location?.lastLocationUpdate?(v(),m("div",vN," Last updated: "+w(n(e.assignment.location.lastLocationUpdate)),1)):P("",!0),e.userLocation?(v(),m("div",mN,[...i[7]||(i[7]=[r("svg",{class:"status-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})],-1),Ye(" GPS active ",-1)])])):P("",!0),r("div",gN,[r("button",{onClick:i[1]||(i[1]=l=>s.$emit("update-gps")),class:"btn btn-primary btn-full",disabled:e.updating,style:Qe(e.accentButtonStyle)},[i[8]||(i[8]=r("svg",{class:"btn-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})],-1)),Ye(" "+w(e.updating?"Updating...":"Use current GPS location"),1)],12,yN)]),r("div",kN,[r("label",bN,[r("input",{type:"checkbox",checked:e.autoUpdateEnabled,onChange:i[2]||(i[2]=l=>s.$emit("toggle-auto-update"))},null,40,_N),i[9]||(i[9]=r("span",null,"Auto-update every 60 seconds",-1))]),r("p",wN,"Automatically updates the "+w(O(t).checkpoint)+" location using your GPS every minute.",1)]),r("div",CN,[r("button",{onClick:i[3]||(i[3]=l=>s.$emit("select-on-map")),class:"btn btn-secondary btn-full",disabled:e.updating},[...i[10]||(i[10]=[r("svg",{class:"btn-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"})],-1),Ye(" Select location on map ",-1)])],8,LN)]),r("div",SN,[r("label",IN,"Or copy location from another "+w(O(t).checkpoint)+":",1),e.availableCheckpoints.length>0?(v(),m("div",xN,[(v(!0),m(Te,null,Fe(e.availableCheckpoints,l=>(v(),m("button",{key:l.id,onClick:u=>s.$emit("copy-from-checkpoint",l.id),class:"btn btn-secondary btn-checkpoint-source",disabled:e.updating},[r("span",TN,w(l.name),1),l.description?(v(),m("span",MN,w(a(l.description)),1)):P("",!0)],8,$N))),128))])):(v(),m("p",AN," No other "+w(O(t).checkpoints)+" available to copy from. ",1))]),e.error?(v(),m("div",EN,w(e.error),1)):P("",!0)]))]),r("div",PN,[r("button",{onClick:i[4]||(i[4]=l=>s.$emit("close")),class:"btn btn-secondary"},w(e.success?"Ok":"Cancel"),1)])])])):P("",!0)]),_:1}))}},ON=Ge(DN,[["__scopeId","data-v-b3924a32"]]),RN={class:"contact-info"},BN={class:"contact-name-row"},NN={key:0,class:"primary-badge"},FN={class:"contact-name"},UN={key:0,class:"contact-notes-text"},zN={key:1,class:"contact-detail"},HN={key:2,class:"contact-detail"},VN={class:"contact-actions"},GN=["href"],jN=["href"],ZN=["href"],qN={__name:"ContactCard",props:{name:{type:String,required:!0},role:{type:String,default:""},phone:{type:String,default:""},email:{type:String,default:""},notes:{type:String,default:""},isPrimary:{type:Boolean,default:!1}},setup(e){const t=e,n=["Emergency","Safety","Medical","First Aid"],a=z(()=>t.role?n.some(i=>t.role.toLowerCase().includes(i.toLowerCase())):!1),s=z(()=>t.role?t.role.replace(/([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase()).trim():"");return(i,l)=>(v(),m("div",{class:pe(["contact-item",{"primary-contact":e.isPrimary}])},[r("div",RN,[r("div",BN,[e.isPrimary?(v(),m("span",NN,"")):P("",!0),r("span",FN,w(e.name),1),e.role?(v(),m("span",{key:1,class:pe(["contact-role-badge",{"emergency-role":a.value}])},w(s.value),3)):P("",!0)]),e.notes?(v(),m("div",UN,w(e.notes),1)):P("",!0),e.phone?(v(),m("div",zN,w(e.phone),1)):P("",!0),e.email?(v(),m("div",HN,w(e.email),1)):P("",!0)]),r("div",VN,[e.phone?(v(),m("a",{key:0,href:`tel:${e.phone}`,class:"contact-link"},[...l[0]||(l[0]=[r("svg",{class:"contact-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})],-1),Ye(" Call ",-1)])],8,GN)):P("",!0),e.phone?(v(),m("a",{key:1,href:`sms:${e.phone}`,class:"contact-link"},[...l[1]||(l[1]=[r("svg",{class:"contact-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"})],-1),Ye(" Text ",-1)])],8,jN)):P("",!0),e.email?(v(),m("a",{key:2,href:`mailto:${e.email}`,class:"contact-link"},[...l[2]||(l[2]=[r("svg",{class:"contact-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})],-1),Ye(" Email ",-1)])],8,ZN)):P("",!0)])],2))}},fm=Ge(qN,[["__scopeId","data-v-6cf4fca2"]]),WN={key:0,class:"accordion-section"},KN={class:"accordion-title"},JN=["innerHTML"],YN={class:"accordion-icon"},XN={key:0,class:"accordion-content"},QN={key:0,class:"loading"},e9={key:1,class:"contact-list"},t9={__name:"MarshalContactsSection",props:{contacts:{type:Array,required:!0},loading:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1}},emits:["toggle"],setup(e){return(t,n)=>e.contacts.length>0||e.loading?(v(),m("div",WN,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:n[0]||(n[0]=a=>t.$emit("toggle"))},[r("span",KN,[r("span",{class:"section-icon",innerHTML:O(Xn)("contacts")},null,8,JN),Ye(" Your "+w(e.contacts.length===1?"contact":"contacts")+w(e.contacts.length>1?` (${e.contacts.length})`:""),1)]),r("span",YN,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",XN,[e.loading?(v(),m("div",QN,"Loading contacts...")):(v(),m("div",e9,[(v(!0),m(Te,null,Fe(e.contacts,a=>(v(),Ze(fm,{key:a.contactId,name:a.name,role:a.role,phone:a.phone,email:a.email,notes:a.notes,"is-primary":a.isPrimary},null,8,["name","role","phone","email","notes","is-primary"]))),128))]))])):P("",!0)])):P("",!0)}},n9=Ge(t9,[["__scopeId","data-v-246302be"]]),o9={key:0,class:"accordion-section"},s9={class:"accordion-title"},a9=["innerHTML"],i9={class:"accordion-icon"},l9={key:0,class:"accordion-content"},r9={key:0,class:"loading-state"},c9={key:1,class:"empty-state"},u9={key:2,class:"incidents-list"},d9={__name:"MarshalIncidentsSection",props:{incidents:{type:Array,required:!0},loading:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1}},emits:["toggle","select-incident"],setup(e){return(t,n)=>e.incidents.length>0||e.loading?(v(),m("div",o9,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:n[0]||(n[0]=a=>t.$emit("toggle"))},[r("span",s9,[r("span",{class:"section-icon",innerHTML:O(Xn)("incidents")},null,8,a9),Ye(" Your "+w(e.incidents.length===1?"incident":"incidents")+w(e.incidents.length>1?` (${e.incidents.length})`:""),1)]),r("span",i9,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",l9,[e.loading?(v(),m("div",r9," Loading incidents... ")):e.incidents.length===0?(v(),m("div",c9,[...n[1]||(n[1]=[r("p",null,"No incidents to show.",-1)])])):(v(),m("div",u9,[(v(!0),m(Te,null,Fe(e.incidents,a=>(v(),Ze(tr,{key:a.incidentId,incident:a,onSelect:s=>t.$emit("select-incident",a)},null,8,["incident","onSelect"]))),128))]))])):P("",!0)])):P("",!0)}},h9=Ge(d9,[["__scopeId","data-v-e84cbdf1"]]),f9={key:0,class:"accordion-section"},p9={class:"accordion-title"},v9=["innerHTML"],m9={class:"accordion-icon"},g9={key:0,class:"accordion-content"},y9={class:"event-details"},k9={key:0,class:"event-detail-row"},b9={class:"detail-value"},_9={key:1,class:"event-description"},w9={class:"detail-value"},C9={__name:"MarshalEventDetailsSection",props:{eventDate:{type:String,default:null},description:{type:String,default:""},isExpanded:{type:Boolean,default:!1}},emits:["toggle"],setup(e){const t=n=>n?new Date(n).toLocaleString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"}):"";return(n,a)=>e.eventDate||e.description?(v(),m("div",f9,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:a[0]||(a[0]=s=>n.$emit("toggle"))},[r("span",p9,[r("span",{class:"section-icon",innerHTML:O(Xn)("event")},null,8,v9),a[1]||(a[1]=Ye(" Event details ",-1))]),r("span",m9,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",g9,[r("div",y9,[e.eventDate?(v(),m("div",k9,[a[2]||(a[2]=r("span",{class:"detail-label"},"Date and time",-1)),r("span",b9,w(t(e.eventDate)),1)])):P("",!0),e.description?(v(),m("div",_9,[a[3]||(a[3]=r("span",{class:"detail-label"},"Description",-1)),r("p",w9,w(e.description),1)])):P("",!0)])])):P("",!0)])):P("",!0)}},L9=Ge(C9,[["__scopeId","data-v-7c880ad1"]]),S9={class:"accordion-section"},I9={class:"accordion-title"},x9=["innerHTML"],$9={class:"accordion-icon"},T9={key:0,class:"accordion-content"},M9={key:0,class:"loading"},A9={key:1,class:"error"},E9={key:2,class:"empty-state"},P9={class:"checklist-section"},D9={key:0,class:"empty-state small"},O9={key:1,class:"my-jobs-list"},R9=["checked","disabled","onChange"],B9={key:0,class:"checklist-section"},N9={class:"checklist-section-title"},F9={key:0,class:"checklist-items"},U9={class:"item-checkbox"},z9=["checked","disabled","onChange"],H9={class:"item-content"},V9={key:0,class:"item-context"},G9={key:1,class:"completion-info"},j9={class:"completion-text"},Z9={class:"completion-time"},q9={key:1,class:"checklist-groups"},W9=["onClick"],K9={class:"group-title"},J9={class:"group-status"},Y9={class:"group-count"},X9={class:"group-expand-icon"},Q9={key:0,class:"checklist-group-items"},eF={class:"item-checkbox"},tF=["checked","disabled","onChange"],nF={class:"item-content"},oF={key:0,class:"completion-info"},sF={class:"completion-text"},aF={class:"completion-time"},iF={__name:"MarshalChecklistSection",props:{loading:{type:Boolean,default:!1},error:{type:String,default:""},isExpanded:{type:Boolean,default:!1},isAreaLead:{type:Boolean,default:!1},myItems:{type:Array,default:()=>[]},areaItems:{type:Array,default:()=>[]},areaItemsWithLocalState:{type:Array,default:()=>[]},visibleItems:{type:Array,default:()=>[]},groupedItems:{type:Array,default:()=>[]},completedCount:{type:Number,default:0},saving:{type:Boolean,default:!1},effectiveGroupBy:{type:String,default:"none"},expandedGroup:{type:String,default:null},locations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},marshals:{type:Array,default:()=>[]},getContextName:{type:Function,default:()=>""}},emits:["toggle","toggle-item","toggle-group"],setup(e){const{termsLower:t}=rt(),n=e,a=z(()=>n.visibleItems.length),s=i=>i?new Date(i).toLocaleString():"";return(i,l)=>(v(),m("div",S9,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:l[0]||(l[0]=u=>i.$emit("toggle"))},[r("span",I9,[r("span",{class:"section-icon",innerHTML:O(Xn)("checklist")},null,8,x9),Ye(" Your "+w(O(t).checklists)+" ("+w(e.completedCount)+" of "+w(a.value)+" complete) ",1)]),r("span",$9,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",T9,[e.loading?(v(),m("div",M9,"Loading checklist...")):e.error?(v(),m("div",A9,w(e.error),1)):a.value===0?(v(),m("div",E9,[r("p",null,"No "+w(O(t).checklists)+" for you.",1)])):e.isAreaLead?(v(),m(Te,{key:3},[r("div",P9,[l[3]||(l[3]=r("h4",{class:"checklist-section-title"},"Your jobs",-1)),e.myItems.length===0?(v(),m("div",D9,[...l[2]||(l[2]=[r("p",null,"No jobs assigned to you.",-1)])])):(v(),m("div",O9,[(v(!0),m(Te,null,Fe(e.myItems,u=>(v(),m("div",{key:`${u.itemId}_${u.completionContextType}_${u.completionContextId}`,class:"my-job-item"},[r("input",{type:"checkbox",checked:u.isCompleted,disabled:e.saving,onChange:d=>i.$emit("toggle-item",u)},null,40,R9),r("span",{class:pe(["my-job-text",{completed:u.isCompleted}])},w(u.text),3)]))),128))]))]),e.areaItems.length>0?(v(),m("div",B9,[r("h4",N9,"Your "+w(O(t).area)+"'s jobs",1),Me(vd,{items:e.areaItemsWithLocalState,locations:e.locations,areas:e.areas,marshals:e.marshals,onToggleComplete:l[1]||(l[1]=u=>i.$emit("toggle-item",u))},null,8,["items","locations","areas","marshals"])])):P("",!0)],64)):(v(),m(Te,{key:4},[e.effectiveGroupBy==="none"?(v(),m("div",F9,[(v(!0),m(Te,null,Fe(e.visibleItems,u=>(v(),m("div",{key:`${u.itemId}_${u.completionContextType}_${u.completionContextId}`,class:pe(["checklist-item",{"item-completed":u.isCompleted}])},[r("div",U9,[r("input",{type:"checkbox",checked:u.isCompleted,disabled:!u.canBeCompletedByMe||e.saving,onChange:d=>i.$emit("toggle-item",u)},null,40,z9)]),r("div",H9,[r("div",{class:pe(["item-text",{"text-completed":u.isCompleted}])},w(u.text),3),e.getContextName(u)?(v(),m("div",V9,w(e.getContextName(u)),1)):P("",!0),u.isCompleted?(v(),m("div",G9,[r("span",j9," Completed by "+w(u.completedByActorName||"Unknown"),1),r("span",Z9,w(s(u.completedAt)),1)])):P("",!0)])],2))),128))])):(v(),m("div",q9,[(v(!0),m(Te,null,Fe(e.groupedItems,u=>(v(),m("div",{key:u.key,class:"checklist-group"},[r("button",{class:pe(["checklist-group-header",{expanded:e.expandedGroup===u.key,"all-complete":u.completedCount===u.items.length}]),onClick:d=>i.$emit("toggle-group",u.key)},[r("span",K9,w(u.name),1),r("span",J9,[r("span",Y9,w(u.completedCount)+"/"+w(u.items.length),1),r("span",X9,w(e.expandedGroup===u.key?"":"+"),1)])],10,W9),e.expandedGroup===u.key?(v(),m("div",Q9,[(v(!0),m(Te,null,Fe(u.items,d=>(v(),m("div",{key:`${d.itemId}_${d.completionContextType}_${d.completionContextId}`,class:pe(["checklist-item",{"item-completed":d.isCompleted}])},[r("div",eF,[r("input",{type:"checkbox",checked:d.isCompleted,disabled:!d.canBeCompletedByMe||e.saving,onChange:h=>i.$emit("toggle-item",d)},null,40,tF)]),r("div",nF,[r("div",{class:pe(["item-text",{"text-completed":d.isCompleted}])},w(d.text),3),d.isCompleted?(v(),m("div",oF,[r("span",sF,w(d.completedByActorName||"Unknown"),1),r("span",aF,w(s(d.completedAt)),1)])):P("",!0)])],2))),128))])):P("",!0)]))),128))]))],64))])):P("",!0)]))}},lF=Ge(iF,[["__scopeId","data-v-b2878e4f"]]),rF={class:"accordion-section"},cF={class:"accordion-title"},uF=["innerHTML"],dF={class:"accordion-icon"},hF={key:0,class:"accordion-content"},fF={__name:"MarshalNotesSection",props:{eventId:{type:String,required:!0},notes:{type:Array,default:()=>[]},locations:{type:Array,default:()=>[]},areas:{type:Array,default:()=>[]},assignments:{type:Array,default:()=>[]},isExpanded:{type:Boolean,default:!1}},emits:["toggle","notes-changed"],setup(e){return(t,n)=>(v(),m("div",rF,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:n[0]||(n[0]=a=>t.$emit("toggle"))},[r("span",cF,[r("span",{class:"section-icon",innerHTML:O(Xn)("notes")},null,8,uF),Ye(" Your "+w(e.notes.length===1?"note":"notes")+w(e.notes.length>1?` (${e.notes.length})`:""),1)]),r("span",dF,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",hF,[Me(Lc,{"event-id":e.eventId,"all-notes":e.notes,locations:e.locations,areas:e.areas,assignments:e.assignments,"show-scope":!1,onNotesChanged:n[1]||(n[1]=a=>t.$emit("notes-changed"))},null,8,["event-id","all-notes","locations","areas","assignments"])])):P("",!0)]))}},pF=Ge(fF,[["__scopeId","data-v-10b7523a"]]),vF={class:"accordion-section"},mF={class:"accordion-title"},gF=["innerHTML"],yF={key:0,class:"location-status active"},kF={key:1,class:"location-status"},bF={class:"accordion-icon"},_F={key:0,class:"accordion-content map-content"},wF={key:0,class:"map-selection-banner"},CF={class:"map-wrapper"},LF={__name:"MarshalRouteSection",props:{isExpanded:{type:Boolean,default:!1},userLocation:{type:Object,default:null},selectingLocation:{type:Boolean,default:!1},selectingLocationName:{type:String,default:""},locations:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]},center:{type:Object,default:null},highlightLocationIds:{type:Array,default:()=>[]},clickable:{type:Boolean,default:!1},toolbarActions:{type:Array,default:()=>[]}},emits:["toggle","cancel-select","map-click","location-click","action-click","visibility-change"],setup(e,{expose:t}){const{terms:n}=rt(),a=co("marshalBranding",{headerStyle:{},headerTextColor:""}),s=di({headerStyle:z(()=>Ar(a.headerStyle)),headerTextColor:z(()=>Ar(a.headerTextColor))}),i=T(null);return t({mapRef:i,recenterOnLocation:(l,u,d)=>i.value?.recenterOnLocation?.(l,u,d),recenterOnUserLocation:()=>i.value?.recenterOnUserLocation?.()}),(l,u)=>(v(),m("div",vF,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:u[0]||(u[0]=d=>l.$emit("toggle"))},[r("span",mF,[r("span",{class:"section-icon",innerHTML:O(Xn)("course")},null,8,gF),Ye(" "+w(O(n).course)+" ",1),e.userLocation?(v(),m("span",yF,"GPS Active")):(v(),m("span",kF,"GPS Inactive"))]),r("span",bF,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",_F,[e.selectingLocation?(v(),m("div",wF,[r("span",null,[u[7]||(u[7]=Ye("Click on the map to set the new location for ",-1)),r("strong",null,w(e.selectingLocationName),1)]),r("button",{onClick:u[1]||(u[1]=d=>l.$emit("cancel-select")),class:"btn btn-secondary btn-sm"},"Cancel")])):P("",!0),r("div",CF,[Me(fi,{ref_key:"mapRef",ref:i,locations:e.locations,route:e.route,center:e.center,zoom:15,"user-location":e.userLocation,"highlight-location-ids":e.highlightLocationIds,"marshal-mode":!0,"simplify-non-highlighted":!0,clickable:e.clickable,"show-fullscreen":!0,"fullscreen-title":O(n).course,"fullscreen-header-style":s.headerStyle,"fullscreen-header-text-color":s.headerTextColor,"toolbar-actions":e.toolbarActions,"hide-recenter-button":!0,class:pe({"selecting-location":e.selectingLocation}),height:"100%",onMapClick:u[3]||(u[3]=d=>l.$emit("map-click",d)),onLocationClick:u[4]||(u[4]=d=>l.$emit("location-click",d)),onActionClick:u[5]||(u[5]=d=>l.$emit("action-click",d)),onVisibilityChange:u[6]||(u[6]=d=>l.$emit("visibility-change",d))},Xu({_:2},[e.selectingLocation?{name:"fullscreen-banner",fn:He(()=>[r("span",null,[u[8]||(u[8]=Ye("Click on the map to set the new location for ",-1)),r("strong",null,w(e.selectingLocationName),1)]),r("button",{onClick:u[2]||(u[2]=d=>l.$emit("cancel-select")),class:"btn btn-secondary btn-sm"},"Cancel")]),key:"0"}:void 0]),1032,["locations","route","center","user-location","highlight-location-ids","clickable","fullscreen-title","fullscreen-header-style","fullscreen-header-text-color","toolbar-actions","class"])])])):P("",!0)]))}},SF=Ge(LF,[["__scopeId","data-v-e6feec0c"]]),IF={class:"area-lead-content"},xF={key:0,class:"loading-state"},$F={key:1,class:"error-state"},TF={key:2,class:"empty-state"},MF={key:3,class:"checkpoint-accordion"},AF=["onClick"],EF={class:"checkpoint-header-content"},PF={class:"checkpoint-title-row"},DF={class:"checkpoint-name"},OF={key:0,class:"area-badge"},RF={key:0,class:"checkpoint-description-preview"},BF={class:"checkpoint-status-row"},NF={class:"status-badge marshals-status"},FF={key:0,class:"status-badge tasks-status"},UF={class:"accordion-icon"},zF={key:0,class:"checkpoint-accordion-content"},HF={class:"checkpoint-mini-map"},VF={class:"checkpoint-marshals-section"},GF={class:"marshals-label"},jF={key:0,class:"empty-state"},ZF={key:1,class:"marshals-list"},qF=["onClick"],WF={class:"marshal-header"},KF={class:"marshal-name-row"},JF={class:"marshal-name"},YF={key:0,class:"task-count"},XF={class:"check-status-row"},QF=["onClick","disabled"],e7={key:0,class:"check-in-time"},t7={key:0},n7={key:1,class:"last-access-time"},o7={key:0,class:"checkpoint-tasks-section"},s7={class:"marshals-label"},a7={class:"tasks-list"},i7=["disabled","onChange"],l7={class:"task-text"},r7=["disabled","onChange"],c7={class:"task-text"},u7={key:0,class:"marshal-details-modal"},d7={class:"details-section"},h7={class:"contact-info"},f7={key:0,class:"contact-row"},p7=["href"],v7={key:1,class:"contact-row"},m7=["href"],g7={key:2,class:"no-contact"},y7={class:"details-section"},k7={key:0,class:"checked-in-section"},b7={class:"checked-in-details"},_7={class:"check-time-detail"},w7={key:0,class:"check-method"},C7=["disabled"],L7={key:1,class:"not-checked-in-section"},S7=["disabled"],I7={key:2,class:"last-access-detail"},x7={class:"details-section"},$7={key:0,class:"no-tasks"},T7={key:1,class:"tasks-list modal-tasks"},M7=["disabled","onChange"],A7={class:"task-text"},E7={class:"details-section contact-actions-section"},P7={class:"contact-buttons"},D7=["href"],O7=["href"],R7=["href"],B7={__name:"AreaLeadSection",props:{eventId:{type:String,required:!0},areaIds:{type:Array,default:()=>[]},marshalId:{type:String,required:!0},route:{type:Array,default:()=>[]}},emits:["checklist-updated","loaded","checkin-updated"],setup(e,{expose:t,emit:n}){const{terms:a,termsLower:s}=rt(),{updatePendingCount:i}=gd(),l=e,u=n,d=T(!1),h=T(null),p=T([]),g=T([]),y=T(null),b=T(!1),C=T(null),I=z(()=>{const U=new Set(l.areaIds);return U.size===0?[...g.value].sort((X,re)=>Ks(X.name,re.name)):g.value.filter(X=>(X.areaIds||[]).some(ke=>U.has(ke))).sort((X,re)=>Ks(X.name,re.name))}),M=(U,X=60)=>U?U.length<=X?U:U.substring(0,X).trim()+"...":"",x=T(!1),S=T(null),_=T(null),D=async()=>{if(!(!l.eventId||l.areaIds.length===0)){if(d.value=!0,h.value=null,On()){try{const U=await xa(l.eventId);if(U?.areaLeadDashboard){p.value=U.areaLeadDashboard.areas||[],g.value=U.areaLeadDashboard.checkpoints||[],d.value=!1;return}}catch(U){console.warn("Failed to load cached dashboard:",U)}h.value="Offline - no cached data available",d.value=!1;return}try{const U=await Us.getAreaLeadDashboard(l.eventId);p.value=U.data.areas||[],g.value=U.data.checkpoints||[];try{const X=JSON.parse(JSON.stringify({areas:p.value,checkpoints:g.value}));await xa(l.eventId)?await $r(l.eventId,"areaLeadDashboard",X):await Vl(l.eventId,{areaLeadDashboard:X})}catch(X){console.warn("Failed to cache dashboard:",X)}}catch(U){console.error("Failed to load area lead dashboard:",U);try{const X=await xa(l.eventId);if(X?.areaLeadDashboard){console.log("Loading area lead dashboard from cache after error"),p.value=X.areaLeadDashboard.areas||[],g.value=X.areaLeadDashboard.checkpoints||[],d.value=!1;return}}catch(X){console.warn("Failed to load cached dashboard:",X)}h.value=U.response?.data?.message||"Failed to load dashboard"}finally{d.value=!1}}},E=U=>{y.value=y.value===U?null:U},Z=U=>U.marshals.filter(X=>X.isCheckedIn).length,A=U=>{const X=U.marshals.reduce((re,ke)=>re+ke.outstandingTaskCount,0);return U.outstandingTaskCount+X},N=(U,X)=>{S.value=U,_.value=X,x.value=!0},B=()=>{x.value=!1,S.value=null,_.value=null},j=async(U,X)=>{if(C.value)return;const re=U.assignmentId||U.id;if(!re){console.error("No assignment ID found for marshal:",U);return}C.value=U.marshalId;try{if(On())await _o("checkin_toggle",{eventId:l.eventId,assignmentId:re}),U.isCheckedIn=!0,U.checkInTime=new Date().toISOString(),U.checkInMethod="AreaLead (pending)",await i(),u("checkin-updated");else if(await $a.toggleCheckIn(l.eventId,re),await D(),u("checkin-updated"),S.value?.marshalId===U.marshalId&&_.value){const ke=g.value.find(Re=>Re.checkpointId===_.value.checkpointId);if(ke){const Re=ke.marshals.find(Xe=>Xe.marshalId===U.marshalId);Re&&(S.value=Re)}}}catch(ke){console.error("Failed to check in marshal:",ke),(On()||!ke.response)&&(await _o("checkin_toggle",{eventId:l.eventId,assignmentId:re}),U.isCheckedIn=!0,U.checkInTime=new Date().toISOString(),U.checkInMethod="AreaLead (pending)",await i(),u("checkin-updated"))}finally{C.value=null}},R=async(U,X)=>{if(b.value)return;b.value=!0;const ke={marshalId:X.marshals.length>0?X.marshals[0].marshalId:l.marshalId,contextType:U.contextType,contextId:U.contextId};try{On()?(await _o("checklist_complete",{eventId:l.eventId,itemId:U.itemId,data:ke}),X.outstandingTasks=X.outstandingTasks.filter(Re=>Re.itemId!==U.itemId),X.outstandingTaskCount=Math.max(0,X.outstandingTaskCount-1),await i(),u("checklist-updated")):(await Nt.complete(l.eventId,U.itemId,ke),await D(),u("checklist-updated"))}catch(Re){console.error("Failed to complete task:",Re),(On()||!Re.response)&&(await _o("checklist_complete",{eventId:l.eventId,itemId:U.itemId,data:ke}),X.outstandingTasks=X.outstandingTasks.filter(Xe=>Xe.itemId!==U.itemId),X.outstandingTaskCount=Math.max(0,X.outstandingTaskCount-1),await i(),u("checklist-updated"))}finally{b.value=!1}},G=async(U,X)=>{if(b.value)return;b.value=!0;const ke={marshalId:X.marshals.length>0?X.marshals[0].marshalId:l.marshalId,contextType:U.contextType,contextId:U.contextId,actorMarshalId:l.marshalId};try{On()?(await _o("checklist_uncomplete",{eventId:l.eventId,itemId:U.itemId,data:ke}),X.completedTasks&&(X.completedTasks=X.completedTasks.filter(Re=>Re.itemId!==U.itemId)),X.outstandingTasks||(X.outstandingTasks=[]),X.outstandingTasks.push(U),X.outstandingTaskCount=(X.outstandingTaskCount||0)+1,await i(),u("checklist-updated")):(await Nt.uncomplete(l.eventId,U.itemId,ke),await D(),u("checklist-updated"))}catch(Re){console.error("Failed to uncomplete task:",Re),(On()||!Re.response)&&(await _o("checklist_uncomplete",{eventId:l.eventId,itemId:U.itemId,data:ke}),X.completedTasks&&(X.completedTasks=X.completedTasks.filter(Xe=>Xe.itemId!==U.itemId)),X.outstandingTasks||(X.outstandingTasks=[]),X.outstandingTasks.push(U),X.outstandingTaskCount=(X.outstandingTaskCount||0)+1,await i(),u("checklist-updated"))}finally{b.value=!1}},ee=async U=>{if(b.value||!S.value)return;b.value=!0;const X={marshalId:S.value.marshalId,contextType:U.contextType,contextId:U.contextId};try{if(On())await _o("checklist_complete",{eventId:l.eventId,itemId:U.itemId,data:X}),S.value.outstandingTasks=S.value.outstandingTasks.filter(re=>re.itemId!==U.itemId),S.value.outstandingTaskCount=Math.max(0,S.value.outstandingTaskCount-1),await i(),u("checklist-updated");else{if(await Nt.complete(l.eventId,U.itemId,X),await D(),S.value&&_.value){const re=g.value.find(ke=>ke.checkpointId===_.value.checkpointId);if(re){const ke=re.marshals.find(Re=>Re.marshalId===S.value.marshalId);ke&&(S.value=ke)}}u("checklist-updated")}}catch(re){console.error("Failed to complete task:",re),(On()||!re.response)&&(await _o("checklist_complete",{eventId:l.eventId,itemId:U.itemId,data:X}),S.value.outstandingTasks=S.value.outstandingTasks.filter(ke=>ke.itemId!==U.itemId),S.value.outstandingTaskCount=Math.max(0,S.value.outstandingTaskCount-1),await i(),u("checklist-updated"))}finally{b.value=!1}},ne=U=>U?new Date(U).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",Ae=U=>U?new Date(U).toLocaleString():"",J=U=>{if(!U)return"";const X=new Date(U),ke=new Date-X,Re=Math.floor(ke/6e4),Xe=Math.floor(Re/60),Ne=Math.floor(Xe/24);return Re<1?"just now":Re<60?`${Re}m ago`:Xe<24?`${Xe}h ago`:Ne===1?"yesterday":Ne<7?`${Ne}d ago`:X.toLocaleDateString()},te=U=>({GPS:"GPS",Manual:"Manual",Admin:"Admin",AreaLead:`${a.value.area} Lead`})[U]||U;return t({areas:p,checkpoints:g,loading:d,loadDashboard:D}),qe(()=>l.eventId,()=>{D()},{immediate:!0}),(U,X)=>(v(),m("div",IF,[d.value?(v(),m("div",xF," Loading dashboard... ")):h.value?(v(),m("div",$F,[r("p",null,w(h.value),1),r("button",{onClick:D,class:"btn btn-secondary"},"Retry")])):I.value.length===0?(v(),m("div",TF,[r("p",null,"No "+w(O(s).checkpoints)+" in your "+w(O(s).areas)+".",1)])):(v(),m("div",MF,[(v(!0),m(Te,null,Fe(I.value,re=>(v(),m("div",{key:re.checkpointId,class:"checkpoint-accordion-section"},[r("button",{class:pe(["checkpoint-accordion-header",{active:y.value===re.checkpointId}]),onClick:ke=>E(re.checkpointId)},[r("div",EF,[r("div",PF,[r("span",DF,w(re.name),1),re.areaName?(v(),m("span",OF,w(re.areaName),1)):P("",!0)]),re.description?(v(),m("div",RF,w(M(re.description)),1)):P("",!0),r("div",BF,[r("span",NF,w(Z(re))+" / "+w(re.marshals.length)+" checked in ",1),A(re)>0?(v(),m("span",FF,w(A(re))+" tasks ",1)):P("",!0)])]),r("span",UF,w(y.value===re.checkpointId?"":"+"),1)],10,AF),y.value===re.checkpointId?(v(),m("div",zF,[r("div",HF,[Me(fi,{locations:[{id:re.checkpointId,name:re.name,description:re.description,latitude:re.latitude,longitude:re.longitude}],route:e.route,center:{lat:re.latitude,lng:re.longitude},zoom:16,"highlight-location-id":re.checkpointId,"marshal-mode":!0,height:"280px"},null,8,["locations","route","center","highlight-location-id"])]),r("div",VF,[r("div",GF,w(O(a).people)+" ("+w(re.marshals.length)+")",1),re.marshals.length===0?(v(),m("div",jF," No "+w(O(s).people)+" assigned to this "+w(O(s).checkpoint)+". ",1)):(v(),m("div",ZF,[(v(!0),m(Te,null,Fe(re.marshals,ke=>(v(),m("div",{key:ke.marshalId,class:pe(["marshal-card",{"is-checked-in":ke.isCheckedIn}]),onClick:Re=>N(ke,re)},[r("div",WF,[r("div",KF,[r("span",JF,w(ke.name),1),ke.outstandingTaskCount>0?(v(),m("span",YF,w(ke.outstandingTaskCount)+" tasks ",1)):P("",!0)]),r("div",XF,[r("div",{class:pe(["check-status",{"checked-in":ke.isCheckedIn}])},w(ke.isCheckedIn?" Checked In":"Not Checked In"),3),r("button",{onClick:it(Re=>j(ke),["stop"]),class:pe(["quick-checkin-btn",{"undo-btn":ke.isCheckedIn}]),disabled:C.value===ke.marshalId},w(C.value===ke.marshalId?"...":ke.isCheckedIn?"Undo":"Check In"),11,QF)])]),ke.isCheckedIn&&ke.checkInTime?(v(),m("div",e7,[Ye(w(ne(ke.checkInTime))+" ",1),ke.checkInMethod?(v(),m("span",t7," ("+w(te(ke.checkInMethod))+")",1)):P("",!0)])):P("",!0),ke.lastAccessedAt?(v(),m("div",n7," Last active: "+w(J(ke.lastAccessedAt)),1)):P("",!0)],10,qF))),128))]))]),re.outstandingTaskCount>0||re.completedTasks&&re.completedTasks.length>0?(v(),m("div",o7,[r("div",s7,w(O(a).checkpoint)+" tasks",1),r("div",a7,[(v(!0),m(Te,null,Fe(re.outstandingTasks,ke=>(v(),m("div",{key:ke.itemId,class:"task-item"},[r("input",{type:"checkbox",disabled:b.value,onChange:Re=>R(ke,re)},null,40,i7),r("span",l7,w(ke.text),1)]))),128)),(v(!0),m(Te,null,Fe(re.completedTasks||[],ke=>(v(),m("div",{key:`completed-${ke.itemId}`,class:"task-item task-completed"},[r("input",{type:"checkbox",checked:"",disabled:b.value,onChange:Re=>G(ke,re)},null,40,r7),r("span",c7,w(ke.text),1)]))),128))])])):P("",!0)])):P("",!0)]))),128))])),Me(jt,{show:x.value,title:S.value?.name||"Marshal Details",size:"large",onClose:B},{actions:He(()=>[r("button",{onClick:B,class:"btn btn-secondary"},"Close")]),default:He(()=>[S.value?(v(),m("div",u7,[r("div",d7,[X[4]||(X[4]=r("h4",null,"Contact Details",-1)),r("div",h7,[S.value.email?(v(),m("div",f7,[X[2]||(X[2]=r("span",{class:"contact-label"},"Email:",-1)),r("a",{href:`mailto:${S.value.email}`},w(S.value.email),9,p7)])):P("",!0),S.value.phoneNumber?(v(),m("div",v7,[X[3]||(X[3]=r("span",{class:"contact-label"},"Phone:",-1)),r("a",{href:`tel:${S.value.phoneNumber}`},w(S.value.phoneNumber),9,m7)])):P("",!0),!S.value.email&&!S.value.phoneNumber?(v(),m("div",g7," No contact details available. ")):P("",!0)])]),r("div",y7,[X[8]||(X[8]=r("h4",null,"Check-in Status",-1)),S.value.isCheckedIn?(v(),m("div",k7,[r("div",b7,[X[6]||(X[6]=r("span",{class:"check-icon"},"",-1)),r("div",null,[X[5]||(X[5]=r("strong",null,"Checked In",-1)),r("p",_7,w(Ae(S.value.checkInTime)),1),S.value.checkInMethod?(v(),m("p",w7," Method: "+w(te(S.value.checkInMethod)),1)):P("",!0)])]),r("button",{onClick:X[0]||(X[0]=re=>j(S.value,_.value)),class:"btn btn-secondary undo-checkin-btn",disabled:C.value===S.value.marshalId},w(C.value===S.value.marshalId?"Undoing...":"Undo Check-in"),9,C7)])):(v(),m("div",L7,[X[7]||(X[7]=r("div",{class:"not-checked-in"},[r("span",{class:"not-checked-icon"},""),r("span",null,"Not checked in")],-1)),r("button",{onClick:X[1]||(X[1]=re=>j(S.value,_.value)),class:"btn btn-primary check-in-btn",disabled:C.value===S.value.marshalId},w(C.value===S.value.marshalId?"Checking in...":"Check In"),9,S7)])),S.value.lastAccessedAt?(v(),m("div",I7," Last active: "+w(J(S.value.lastAccessedAt)),1)):P("",!0)]),r("div",x7,[r("h4",null,w(O(a).checklists)+" ("+w(S.value.outstandingTasks?.length||0)+" outstanding)",1),!S.value.outstandingTasks||S.value.outstandingTasks.length===0?(v(),m("div",$7," No outstanding tasks. ")):(v(),m("div",T7,[(v(!0),m(Te,null,Fe(S.value.outstandingTasks,re=>(v(),m("div",{key:re.itemId,class:"task-item"},[r("input",{type:"checkbox",disabled:b.value,onChange:ke=>ee(re)},null,40,M7),r("span",A7,w(re.text),1)]))),128))]))]),r("div",E7,[r("div",P7,[S.value.phoneNumber?(v(),m("a",{key:0,href:`tel:${S.value.phoneNumber}`,class:"btn btn-primary"}," Call ",8,D7)):P("",!0),S.value.phoneNumber?(v(),m("a",{key:1,href:`sms:${S.value.phoneNumber}`,class:"btn btn-secondary"}," Text ",8,O7)):P("",!0),S.value.email?(v(),m("a",{key:2,href:`mailto:${S.value.email}`,class:"btn btn-secondary"}," Email ",8,R7)):P("",!0)])])])):P("",!0)]),_:1},8,["show","title"])]))}},N7=Ge(B7,[["__scopeId","data-v-067e0528"]]),F7={key:0,class:"accordion-section"},U7={class:"accordion-title"},z7=["innerHTML"],H7={class:"accordion-icon"},V7={key:0,class:"accordion-content area-lead-accordion-content"},G7={key:0,class:"area-filter-pills"},j7=["onClick"],Z7={__name:"MarshalAreaLeadSection",props:{isAreaLead:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1},areas:{type:Array,default:()=>[]},selectedFilters:{type:Set,default:()=>new Set},filteredAreaIds:{type:Array,default:()=>[]},eventId:{type:String,required:!0},marshalId:{type:String,default:""},route:{type:Array,default:()=>[]}},emits:["toggle","toggle-filter","checklist-updated"],setup(e,{expose:t}){const{termsLower:n}=rt(),a=T(null);return t({areaLeadRef:a}),(s,i)=>e.isAreaLead?(v(),m("div",F7,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:i[0]||(i[0]=l=>s.$emit("toggle"))},[r("span",U7,[r("span",{class:"section-icon",innerHTML:O(Xn)("area")},null,8,z7),Ye(" Your "+w(e.areas.length===1?O(n).area:O(n).areas)+w(e.areas.length>1?` (${e.areas.length})`:""),1)]),r("span",H7,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",V7,[e.areas.length>1?(v(),m("div",G7,[(v(!0),m(Te,null,Fe(e.areas,l=>(v(),m("button",{key:l.areaId,class:pe(["area-filter-pill",{selected:e.selectedFilters.has(l.areaId)}]),style:Qe(e.selectedFilters.has(l.areaId)?{backgroundColor:l.color||"#667eea",borderColor:l.color||"#667eea"}:{}),onClick:u=>s.$emit("toggle-filter",l.areaId)},w(l.name),15,j7))),128))])):P("",!0),Me(N7,{ref_key:"areaLeadRef",ref:a,"event-id":e.eventId,"area-ids":e.filteredAreaIds,"marshal-id":e.marshalId,route:e.route,onChecklistUpdated:i[1]||(i[1]=l=>s.$emit("checklist-updated"))},null,8,["event-id","area-ids","marshal-id","route"])])):P("",!0)])):P("",!0)}},q7=Ge(Z7,[["__scopeId","data-v-9278e6a8"]]),W7={key:0,class:"accordion-section"},K7={class:"accordion-title"},J7=["innerHTML"],Y7={class:"accordion-icon"},X7={key:0,class:"accordion-content area-lead-marshals-content"},Q7={class:"area-lead-marshals-list"},eU=["onClick"],tU={class:"marshal-header-info"},nU={class:"marshal-name-row"},oU={class:"marshal-name"},sU={class:"marshal-meta"},aU={class:"marshal-checkpoint"},iU={key:0,class:"marshal-task-count"},lU={class:"accordion-icon"},rU={key:0,class:"area-lead-marshal-content"},cU={class:"marshal-checkin-section"},uU={key:0,class:"marshal-contact-section"},dU=["href"],hU=["href"],fU={key:1,class:"marshal-tasks-section"},pU={class:"tasks-label"},vU={class:"tasks-list"},mU=["checked","disabled","onChange"],gU={class:"task-text"},yU={key:2,class:"no-tasks-message"},kU={__name:"MarshalMarshalsList",props:{isAreaLead:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1},marshals:{type:Array,default:()=>[]},expandedMarshalId:{type:String,default:null},checkingInMarshalId:{type:String,default:null},savingTask:{type:Boolean,default:!1}},emits:["toggle","toggle-marshal","check-in","toggle-task"],setup(e){const{terms:t,termsLower:n}=rt(),a=s=>{if(!s||s.length===0)return"";const i=l=>l.description?`${l.name} - ${l.description}`:l.name;return s.length===1?i(s[0]):s.map(i).join(", ")};return(s,i)=>e.isAreaLead&&e.marshals.length>0?(v(),m("div",W7,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:i[0]||(i[0]=l=>s.$emit("toggle"))},[r("span",K7,[r("span",{class:"section-icon",innerHTML:O(Xn)("marshal")},null,8,J7),Ye(" Your "+w(e.marshals.length===1?O(n).person:O(n).people)+w(e.marshals.length>1?` (${e.marshals.length})`:""),1)]),r("span",Y7,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",X7,[r("div",Q7,[(v(!0),m(Te,null,Fe(e.marshals,l=>(v(),m("div",{key:l.marshalId,class:"area-lead-marshal-item"},[r("button",{class:pe(["area-lead-marshal-header",{active:e.expandedMarshalId===l.marshalId,"is-checked-in":l.isCheckedIn}]),onClick:u=>s.$emit("toggle-marshal",l.marshalId)},[r("div",tU,[r("div",nU,[r("span",oU,w(l.name),1),r("span",{class:pe(["check-status-badge",{"checked-in":l.isCheckedIn}])},w(l.isCheckedIn?"":""),3)]),r("div",sU,[r("span",aU,w(a(l.checkpoints)),1),l.totalTaskCount>0?(v(),m("span",iU,w(l.completedTaskCount)+" / "+w(l.totalTaskCount)+" "+w(O(n).checklists)+" complete ",1)):P("",!0)])]),r("span",lU,w(e.expandedMarshalId===l.marshalId?"":"+"),1)],10,eU),e.expandedMarshalId===l.marshalId?(v(),m("div",rU,[r("div",cU,[Me(Jr,{"is-checked-in":l.isCheckedIn,"check-in-time":l.checkInTime,"check-in-method":l.checkInMethod,"checked-in-by":l.checkedInBy,"marshal-name":l.marshalName,"is-loading":e.checkingInMarshalId===l.id,onToggle:u=>s.$emit("check-in",l)},null,8,["is-checked-in","check-in-time","check-in-method","checked-in-by","marshal-name","is-loading","onToggle"])]),l.email||l.phoneNumber?(v(),m("div",uU,[l.phoneNumber?(v(),m("a",{key:0,href:`tel:${l.phoneNumber}`,class:"contact-link"},w(l.phoneNumber),9,dU)):P("",!0),l.email?(v(),m("a",{key:1,href:`mailto:${l.email}`,class:"contact-link"},w(l.email),9,hU)):P("",!0)])):P("",!0),l.allTasks.length>0?(v(),m("div",fU,[r("div",pU,w(O(t).checklists),1),r("div",vU,[(v(!0),m(Te,null,Fe(l.allTasks,u=>(v(),m("div",{key:`${u.itemId}-${u.contextId}`,class:pe(["task-item",{"task-completed":u.isCompleted}])},[r("input",{type:"checkbox",checked:u.isCompleted,disabled:e.savingTask,onChange:d=>s.$emit("toggle-task",u,l)},null,40,mU),r("span",gU,w(u.text),1)],2))),128))])])):(v(),m("div",yU," No "+w(O(n).checklists)+" assigned. ",1))])):P("",!0)]))),128))])])):P("",!0)])):P("",!0)}},bU=Ge(kU,[["__scopeId","data-v-163cea4d"]]),_U={class:"checkpoint-note-header"},wU={key:0,class:"pin-icon",title:"Pinned"},CU={class:"checkpoint-note-title"},LU={key:0,class:"checkpoint-note-content"},SU={__name:"NoteCard",props:{title:{type:String,required:!0},content:{type:String,default:""},priority:{type:String,default:"Normal"},isPinned:{type:Boolean,default:!1}},setup(e){const t=e,n=z(()=>(t.priority||"Normal").toLowerCase());return(a,s)=>(v(),m("div",{class:pe(["checkpoint-note-item",n.value])},[r("div",_U,[e.isPinned?(v(),m("span",wU,"")):P("",!0),r("span",{class:pe(["priority-indicator",n.value])},null,2),r("strong",CU,w(e.title),1),r("span",{class:pe(["priority-badge",n.value])},w(e.priority),3)]),e.content?(v(),m("div",LU,w(e.content),1)):P("",!0)],2))}},IU=Ge(SU,[["__scopeId","data-v-5f2df920"]]),xU={class:"checkpoint-accordion-section"},$U={class:"checkpoint-header-content"},TU={class:"checkpoint-title-row"},MU=["innerHTML"],AU={key:0,class:"checkpoint-check-icon"},EU={class:"checkpoint-name"},PU={key:1,class:"area-badge"},DU={key:2,class:"checkpoint-time-badge"},OU={key:3,class:"checkpoint-distance-badge"},RU={key:0,class:"checkpoint-description-preview"},BU={class:"accordion-icon"},NU={key:0,class:"checkpoint-accordion-content"},FU={key:0,class:"checkpoint-mini-map"},UU={viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",style:{"margin-right":"0.5rem"}},zU={class:"my-checkin-section"},HU={key:0,class:"check-in-error"},VU={class:"checkpoint-marshals"},GU={class:"marshals-label"},jU={key:0,class:"marshals-list"},ZU={key:0,class:"check-badge"},qU={key:1,class:"marshals-list-expanded"},WU=["onClick"],KU={class:"marshal-name-text"},JU={class:"marshal-status-icons"},YU={key:0,class:"check-badge"},XU={class:"expand-icon"},QU={key:0,class:"marshal-details-panel"},ez={class:"detail-row"},tz={key:0,class:"detail-row"},nz={key:1,class:"detail-row"},oz={key:2,class:"detail-row"},sz=["href"],az={key:3,class:"detail-row"},iz=["href"],lz={key:4,class:"contact-buttons-mini"},rz=["href"],cz=["href"],uz=["href"],dz={key:5,class:"checkpoint-marshal-checkin"},hz={key:1,class:"checkpoint-area-contacts"},fz={class:"marshals-label"},pz={class:"contact-list"},vz={key:2,class:"checkpoint-notes"},mz={class:"checkpoint-notes-list"},gz={key:3,class:"dynamic-location-section"},yz={class:"dynamic-location-header"},kz={class:"dynamic-badge"},bz={key:0,class:"last-update"},_z={key:0,class:"dynamic-location-actions"},wz=["disabled"],Cz=["title"],Lz={__name:"CheckpointCard",props:{assignment:{type:Object,required:!0},isExpanded:{type:Boolean,default:!1},allLocations:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]},userLocation:{type:Object,default:null},toolbarActions:{type:Array,default:()=>[]},hasDynamicAssignment:{type:Boolean,default:!1},currentMarshalId:{type:String,default:""},currentMarshalName:{type:String,default:""},isCheckingIn:{type:Boolean,default:!1},checkInError:{type:String,default:""},checkingInMarshalId:{type:String,default:null},isAreaLeadForCheckpoint:{type:Boolean,default:!1},expandedMarshalId:{type:String,default:null},notes:{type:Array,default:()=>[]},updatingLocation:{type:Boolean,default:!1},autoUpdateEnabled:{type:Boolean,default:!1},areaLeadAreaIds:{type:Array,default:()=>[]},allAssignmentLocationIds:{type:Array,default:()=>[]}},emits:["toggle","map-click","location-click","action-click","visibility-change","update-location","check-in","toggle-marshal","marshal-check-in","toggle-auto-update"],setup(e,{expose:t}){const{terms:n,termsLower:a}=rt(),s=co("marshalBranding",{headerStyle:{},headerTextColor:""}),i=di({headerStyle:z(()=>Ar(s.headerStyle)),headerTextColor:z(()=>Ar(s.headerTextColor))}),l=e,u=T(null),d=z(()=>l.assignment.location?.isDynamic),h=z(()=>{if(!d.value)return!1;const x=l.assignment.location,S=x?.locationUpdateScopeConfigurations||x?.LocationUpdateScopeConfigurations||[];return tm({scopeConfigurations:S,marshalId:l.currentMarshalId,marshalAssignmentLocationIds:l.allAssignmentLocationIds,areaLeadAreaIds:l.areaLeadAreaIds,locationId:l.assignment.locationId,locationAreaIds:l.assignment.areaIds||[]})}),p=z(()=>{if(!l.userLocation?.lat||!l.userLocation?.lng)return null;const x=l.assignment.location;return!x?.latitude||!x?.longitude?null:hi(l.userLocation.lat,l.userLocation.lng,x.latitude,x.longitude)}),g=z(()=>{const x=p.value;return x==null?null:x<1e3?`${Math.round(x/10)*10} m`:`${(Math.round(x/100)/10).toFixed(1)} km`});t({mapRef:u});const y=x=>{const S=x?.iconType||"checkpoint",_=x?.iconColor||"#667eea",D={checkpoint:`<svg viewBox="0 0 24 24" fill="${_}" width="20" height="20"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`,flag:`<svg viewBox="0 0 24 24" fill="${_}" width="20" height="20"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>`,star:`<svg viewBox="0 0 24 24" fill="${_}" width="20" height="20"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`,water:`<svg viewBox="0 0 24 24" fill="${_}" width="20" height="20"><path d="M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8z"/></svg>`,medical:`<svg viewBox="0 0 24 24" fill="${_}" width="20" height="20"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/></svg>`};return D[S]||D.checkpoint},b=(x,S)=>{const _=D=>D?new Date(D).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):"";return x&&S?`${_(x)} - ${_(S)}`:x?`from ${_(x)}`:S?`until ${_(S)}`:""},C=x=>x?new Date(x).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):"",I=x=>({manual:"Manual",qr:"QR Code",gps:"GPS",admin:"Admin"})[x]||x,M=x=>x?new Date(x).toLocaleString():"";return(x,S)=>(v(),m("div",xU,[r("button",{class:pe(["checkpoint-accordion-header",{active:e.isExpanded,"checked-in":e.assignment.effectiveIsCheckedIn}]),onClick:S[0]||(S[0]=_=>x.$emit("toggle"))},[r("div",$U,[r("div",TU,[r("span",{class:"checkpoint-icon",innerHTML:y(e.assignment.location)},null,8,MU),e.assignment.effectiveIsCheckedIn?(v(),m("span",AU,"")):P("",!0),r("span",EU,w(e.assignment.location?.name||e.assignment.locationName),1),e.assignment.areaName?(v(),m("span",PU,w(e.assignment.areaName),1)):P("",!0),e.assignment.location?.startTime||e.assignment.location?.endTime?(v(),m("span",DU,w(b(e.assignment.location.startTime,e.assignment.location.endTime)),1)):P("",!0),g.value?(v(),m("span",OU,w(g.value),1)):P("",!0)]),e.assignment.location?.description?(v(),m("div",RU,w(e.assignment.location.description),1)):P("",!0)]),r("span",BU,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",NU,[e.assignment.location?(v(),m("div",FU,[Me(fi,{ref_key:"mapRef",ref:u,locations:e.allLocations,route:e.route,center:{lat:e.assignment.location.latitude,lng:e.assignment.location.longitude},zoom:16,"user-location":e.userLocation,"highlight-location-id":e.assignment.locationId,"marshal-mode":!0,"simplify-non-highlighted":!0,clickable:e.hasDynamicAssignment,"show-fullscreen":!0,"fullscreen-title":e.assignment.location?.name||e.assignment.locationName,"fullscreen-header-style":i.headerStyle,"fullscreen-header-text-color":i.headerTextColor,"toolbar-actions":e.toolbarActions,"hide-recenter-button":!0,height:"280px",onMapClick:S[2]||(S[2]=_=>x.$emit("map-click",_)),onLocationClick:S[3]||(S[3]=_=>x.$emit("location-click",_)),onActionClick:S[4]||(S[4]=_=>x.$emit("action-click",_)),onVisibilityChange:S[5]||(S[5]=_=>x.$emit("visibility-change",_))},Xu({_:2},[h.value?{name:"fullscreen-footer",fn:He(()=>[r("button",{class:"btn btn-primary",onClick:S[1]||(S[1]=_=>x.$emit("update-location"))},[(v(),m("svg",UU,[...S[9]||(S[9]=[r("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"},null,-1)])])),S[10]||(S[10]=Ye(" Update location ",-1))])]),key:"0"}:void 0]),1032,["locations","route","center","user-location","highlight-location-id","clickable","fullscreen-title","fullscreen-header-style","fullscreen-header-text-color","toolbar-actions"])])):P("",!0),r("div",zU,[Me(Jr,{"is-checked-in":e.assignment.effectiveIsCheckedIn,"check-in-time":e.assignment.checkInTime,"check-in-method":e.assignment.checkInMethod,"checked-in-by":e.assignment.checkedInBy,"marshal-name":e.currentMarshalName,"is-loading":e.isCheckingIn,onToggle:S[6]||(S[6]=_=>x.$emit("check-in"))},null,8,["is-checked-in","check-in-time","check-in-method","checked-in-by","marshal-name","is-loading"]),e.checkInError?(v(),m("div",HU,w(e.checkInError),1)):P("",!0)]),r("div",VU,[r("div",GU,w(O(n).people)+":",1),e.isAreaLeadForCheckpoint?(v(),m("div",qU,[(v(!0),m(Te,null,Fe(e.assignment.allMarshals,_=>(v(),m("div",{key:_.marshalId,class:pe(["marshal-card-mini",{"is-you":_.marshalId===e.currentMarshalId,"checked-in":_.effectiveIsCheckedIn,expanded:e.expandedMarshalId===_.marshalId}])},[r("button",{class:"marshal-card-header",onClick:D=>x.$emit("toggle-marshal",_.marshalId)},[r("span",KU,w(_.marshalName)+w(_.marshalId===e.currentMarshalId?" (you)":""),1),r("span",JU,[_.effectiveIsCheckedIn?(v(),m("span",YU,"")):P("",!0),r("span",XU,w(e.expandedMarshalId===_.marshalId?"":"+"),1)])],8,WU),e.expandedMarshalId===_.marshalId?(v(),m("div",QU,[r("div",ez,[S[11]||(S[11]=r("span",{class:"detail-label"},"Status:",-1)),r("span",{class:pe(_.effectiveIsCheckedIn?"status-checked-in":"status-not-checked-in")},w(_.effectiveIsCheckedIn?"Checked in":"Not checked in"),3)]),_.effectiveIsCheckedIn&&_.checkInTime?(v(),m("div",tz,[S[12]||(S[12]=r("span",{class:"detail-label"},"Check-in time:",-1)),r("span",null,w(C(_.checkInTime)),1)])):P("",!0),_.checkInMethod?(v(),m("div",nz,[S[13]||(S[13]=r("span",{class:"detail-label"},"Method:",-1)),r("span",null,w(I(_.checkInMethod)),1)])):P("",!0),_.email?(v(),m("div",oz,[S[14]||(S[14]=r("span",{class:"detail-label"},"Email:",-1)),r("a",{href:"mailto:"+_.email},w(_.email),9,sz)])):P("",!0),_.phoneNumber?(v(),m("div",az,[S[15]||(S[15]=r("span",{class:"detail-label"},"Phone:",-1)),r("a",{href:"tel:"+_.phoneNumber},w(_.phoneNumber),9,iz)])):P("",!0),_.email||_.phoneNumber?(v(),m("div",lz,[_.phoneNumber?(v(),m("a",{key:0,href:"tel:"+_.phoneNumber,class:"btn btn-sm btn-primary"},"Call",8,rz)):P("",!0),_.phoneNumber?(v(),m("a",{key:1,href:"sms:"+_.phoneNumber,class:"btn btn-sm btn-secondary"},"Text",8,cz)):P("",!0),_.email?(v(),m("a",{key:2,href:"mailto:"+_.email,class:"btn btn-sm btn-secondary"},"Email",8,uz)):P("",!0)])):P("",!0),_.marshalId!==e.currentMarshalId?(v(),m("div",dz,[Me(Jr,{"is-checked-in":_.effectiveIsCheckedIn,"check-in-time":_.checkInTime,"check-in-method":_.checkInMethod,"checked-in-by":_.checkedInBy,"marshal-name":_.marshalName,"is-loading":e.checkingInMarshalId===_.id,onToggle:D=>x.$emit("marshal-check-in",_)},null,8,["is-checked-in","check-in-time","check-in-method","checked-in-by","marshal-name","is-loading","onToggle"])])):P("",!0)])):P("",!0)],2))),128))])):(v(),m("div",jU,[(v(!0),m(Te,null,Fe(e.assignment.allMarshals,_=>(v(),m("span",{key:_.marshalId,class:pe(["marshal-tag",{"is-you":_.marshalId===e.currentMarshalId,"checked-in":_.effectiveIsCheckedIn}])},[Ye(w(_.marshalName)+w(_.marshalId===e.currentMarshalId?" (you)":"")+" ",1),_.effectiveIsCheckedIn?(v(),m("span",ZU,"")):P("",!0)],2))),128))]))]),e.assignment.areaContacts.length>0?(v(),m("div",hz,[r("div",fz,w(O(n).area)+" contacts:",1),r("div",pz,[(v(!0),m(Te,null,Fe(e.assignment.areaContacts,_=>(v(),Ze(fm,{key:_.marshalId,name:_.marshalName,role:_.role,phone:_.phone,email:_.email},null,8,["name","role","phone","email"]))),128))])])):P("",!0),e.notes.length>0?(v(),m("div",vz,[S[16]||(S[16]=r("div",{class:"marshals-label"},"Notes:",-1)),r("div",mz,[(v(!0),m(Te,null,Fe(e.notes,_=>(v(),Ze(IU,{key:_.noteId,title:_.title,content:_.content,priority:_.priority,"is-pinned":_.isPinned},null,8,["title","content","priority","is-pinned"]))),128))])])):P("",!0),d.value?(v(),m("div",gz,[r("div",yz,[r("span",kz,"Dynamic "+w(e.assignment.location.resolvedCheckpointTerm||O(a).checkpoint),1),e.assignment.location.lastLocationUpdate?(v(),m("span",bz," Last updated: "+w(M(e.assignment.location.lastLocationUpdate)),1)):P("",!0)]),h.value?(v(),m("div",_z,[r("button",{onClick:S[7]||(S[7]=_=>x.$emit("update-location")),class:"btn btn-update-location",disabled:e.updatingLocation},[...S[17]||(S[17]=[r("svg",{class:"btn-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1),Ye(" Update location ",-1)])],8,wz),r("button",{onClick:S[8]||(S[8]=_=>x.$emit("toggle-auto-update")),class:pe(["btn btn-auto-update",{active:e.autoUpdateEnabled}]),title:e.autoUpdateEnabled?"Stop auto-updating":"Auto-update every 60 seconds"},[S[18]||(S[18]=r("svg",{class:"btn-icon",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"})],-1)),Ye(" "+w(e.autoUpdateEnabled?"Stop":"Auto"),1)],10,Cz)])):P("",!0)])):P("",!0)])):P("",!0)]))}},Sz=Ge(Lz,[["__scopeId","data-v-bf4c0c36"]]),Iz={class:"accordion-section"},xz={class:"accordion-title"},$z=["innerHTML"],Tz={class:"accordion-icon"},Mz={key:0,class:"accordion-content assignments-accordion-content"},Az={key:0,class:"empty-state"},Ez={key:1,class:"checkpoint-accordion"},Pz={__name:"MarshalAssignmentsSection",props:{isExpanded:{type:Boolean,default:!1},assignments:{type:Array,default:()=>[]},expandedCheckpointId:{type:String,default:null},allLocations:{type:Array,default:()=>[]},route:{type:Array,default:()=>[]},userLocation:{type:Object,default:null},hasDynamicAssignment:{type:Boolean,default:!1},currentMarshalId:{type:String,default:""},currentMarshalName:{type:String,default:""},checkingInId:{type:String,default:null},checkingInAssignmentId:{type:String,default:null},checkInError:{type:String,default:""},checkingInMarshalId:{type:String,default:null},expandedMarshalId:{type:String,default:null},updatingLocation:{type:Boolean,default:!1},autoUpdateEnabled:{type:Boolean,default:!1},areaLeadAreaIds:{type:Array,default:()=>[]},getToolbarActions:{type:Function,default:()=>[]},isAreaLeadForAreas:{type:Function,default:()=>!1},getNotesForCheckpoint:{type:Function,default:()=>[]}},emits:["toggle","toggle-checkpoint","map-click","location-click","action-click","visibility-change","update-location","check-in","toggle-marshal","marshal-check-in","toggle-auto-update"],setup(e,{expose:t}){const{termsLower:n}=rt(),a=e,s=z(()=>a.assignments.map(u=>u.locationId)),i={},l=(u,d)=>{d?i[u]=d:delete i[u]};return t({checkpointRefs:i}),(u,d)=>(v(),m("div",Iz,[r("button",{class:pe(["accordion-header",{active:e.isExpanded}]),onClick:d[0]||(d[0]=h=>u.$emit("toggle"))},[r("span",xz,[r("span",{class:"section-icon",innerHTML:O(Xn)("checkpoint")},null,8,$z),Ye(" Your "+w(e.assignments.length===1?O(n).checkpoint:O(n).checkpoints)+w(e.assignments.length>1?` (${e.assignments.length})`:""),1)]),r("span",Tz,w(e.isExpanded?"":"+"),1)],2),e.isExpanded?(v(),m("div",Mz,[e.assignments.length===0?(v(),m("div",Az,[r("p",null,"You don't have any "+w(O(n).checkpoint)+" assignments yet.",1)])):(v(),m("div",Ez,[(v(!0),m(Te,null,Fe(e.assignments,h=>(v(),Ze(Sz,{key:h.id,ref_for:!0,ref:p=>l(h.id,p),assignment:h,"is-expanded":e.expandedCheckpointId===h.id,"all-locations":e.allLocations,route:e.route,"user-location":e.userLocation,"toolbar-actions":e.getToolbarActions(h.id),"has-dynamic-assignment":e.hasDynamicAssignment,"current-marshal-id":e.currentMarshalId,"current-marshal-name":e.currentMarshalName,"is-checking-in":e.checkingInId===h.id,"check-in-error":e.checkingInAssignmentId===h.id?e.checkInError:"","checking-in-marshal-id":e.checkingInMarshalId,"is-area-lead-for-checkpoint":e.isAreaLeadForAreas(h.areaIds),"expanded-marshal-id":e.expandedMarshalId,notes:e.getNotesForCheckpoint(h.locationId,h.areaIds),"updating-location":e.updatingLocation,"auto-update-enabled":e.autoUpdateEnabled,"area-lead-area-ids":e.areaLeadAreaIds,"all-assignment-location-ids":s.value,onToggle:p=>u.$emit("toggle-checkpoint",h.id),onMapClick:d[1]||(d[1]=p=>u.$emit("map-click",p)),onLocationClick:d[2]||(d[2]=p=>u.$emit("location-click",p)),onActionClick:p=>u.$emit("action-click",h,p),onVisibilityChange:p=>u.$emit("visibility-change",h.id,p),onUpdateLocation:p=>u.$emit("update-location",h),onCheckIn:p=>u.$emit("check-in",h),onToggleMarshal:d[3]||(d[3]=p=>u.$emit("toggle-marshal",p)),onMarshalCheckIn:p=>u.$emit("marshal-check-in",p,h.locationId),onToggleAutoUpdate:p=>u.$emit("toggle-auto-update",h)},null,8,["assignment","is-expanded","all-locations","route","user-location","toolbar-actions","has-dynamic-assignment","current-marshal-id","current-marshal-name","is-checking-in","check-in-error","checking-in-marshal-id","is-area-lead-for-checkpoint","expanded-marshal-id","notes","updating-location","auto-update-enabled","area-lead-area-ids","all-assignment-location-ids","onToggle","onActionClick","onVisibilityChange","onUpdateLocation","onCheckIn","onMarshalCheckIn","onToggleAutoUpdate"]))),128))]))])):P("",!0)]))}},Dz=Ge(Pz,[["__scopeId","data-v-24c613ab"]]),pm="marshal-branding-cache";function Oz(e){if(!e||typeof window>"u")return null;try{const t=localStorage.getItem(`${pm}-${e}`);return t?JSON.parse(t):null}catch{return null}}function Rz(e,t){if(!(!e||typeof window>"u"))try{localStorage.setItem(`${pm}-${e}`,JSON.stringify(t))}catch{}}function Bz(e,t=null){const n=T(t?Oz(t):null);qe(()=>e.value,y=>{if(y&&t){const b={brandingPageGradientStart:y.brandingPageGradientStart,brandingPageGradientEnd:y.brandingPageGradientEnd,brandingHeaderGradientStart:y.brandingHeaderGradientStart,brandingHeaderGradientEnd:y.brandingHeaderGradientEnd,brandingAccentColor:y.brandingAccentColor,brandingLogoUrl:y.brandingLogoUrl,brandingLogoPosition:y.brandingLogoPosition};Rz(t,b),n.value=b}},{immediate:!0});const a=(y,b)=>e.value?.[y]||n.value?.[y]||b,s=z(()=>{const y=a("brandingPageGradientStart",cn.pageGradientStart),b=a("brandingPageGradientEnd",cn.pageGradientEnd);return{background:`linear-gradient(135deg, ${y} 0%, ${b} 100%)`}}),i=z(()=>{const y=a("brandingHeaderGradientStart",cn.headerGradientStart),b=a("brandingHeaderGradientEnd",cn.headerGradientEnd);return{background:`linear-gradient(135deg, ${y} 0%, ${b} 100%)`}}),l=z(()=>{const y=a("brandingHeaderGradientStart",cn.headerGradientStart),b=a("brandingHeaderGradientEnd",cn.headerGradientEnd);return lm(y,b)}),u=z(()=>a("brandingAccentColor",cn.accentColor)),d=z(()=>Bu(u.value)),h=z(()=>({background:u.value,color:d.value})),p=z(()=>{const y=a("brandingLogoUrl","");return y?y.startsWith("/api")?Ca+y.substring(4):y:""}),g=z(()=>a("brandingLogoPosition","left"));return{pageBackgroundStyle:s,headerStyle:i,headerTextColor:l,accentColor:u,accentTextColor:d,accentButtonStyle:h,brandingLogoUrl:p,brandingLogoPosition:g}}function Nz(){const e=T(null),t=T(null);let n=null;const a=()=>{if(!("geolocation"in navigator)){console.warn("Geolocation not supported");return}console.log("Starting location tracking..."),n=navigator.geolocation.watchPosition(i=>{e.value={lat:i.coords.latitude,lng:i.coords.longitude},t.value=Date.now()},i=>{console.warn("Geolocation error:",{1:"Location permission denied. Please allow location access in your browser settings.",2:"Location unavailable. Make sure GPS is enabled on your device.",3:"Location request timed out. Please try again."}[i.code]||i.message)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:1e4})},s=()=>{n!==null&&(navigator.geolocation.clearWatch(n),n=null)};return bn(()=>{s()}),{userLocation:e,locationLastUpdated:t,startLocationTracking:a,stopLocationTracking:s}}function Fz({eventId:e,currentMarshalId:t,currentPerson:n,assignments:a,areaLeadAreaIds:s,isAreaLead:i,allLocations:l,areas:u,terms:d,termsLower:h,areaLeadRef:p,areaLeadCheckpoints:g,sectionLastLoadedAt:y,updateCachedField:b,updatePendingCount:C}){const I=T([]),M=T(!1),x=T(null),S=T(!1),_=T("person"),D=T(null),E=z(()=>I.value.filter(U=>U.isCompleted&&["OnePerCheckpoint","OnePerArea","OneLeadPerArea"].includes(U.matchedScope)?U.completedByActorId===t.value:!0)),Z=z(()=>E.value.filter(U=>U.isCompleted).length),A=z(()=>{const U=a.value.map(X=>X.locationId);return E.value.filter(X=>X.completionContextType==="Personal"?X.contextOwnerMarshalId===t.value:X.completionContextType==="Checkpoint"?U.includes(X.completionContextId):X.completionContextType==="Area"?s.value.includes(X.completionContextId):!0)}),N=z(()=>{if(!i.value)return[];const U=a.value.map(X=>X.locationId);return E.value.filter(X=>X.completionContextType==="Personal"?X.contextOwnerMarshalId!==t.value:X.completionContextType==="Checkpoint"?!U.includes(X.completionContextId):X.completionContextType==="Area"?!s.value.includes(X.completionContextId):!1)}),B=z(()=>A.value.map(U=>({...U,localIsCompleted:U.isCompleted,isModified:!1}))),j=z(()=>N.value.map(U=>({...U,localIsCompleted:U.isCompleted,isModified:!1}))),R=z(()=>{const U=p.value?.checkpoints||g.value||[];if(U.length===0)return[];const X=[],re=new Set;for(const ke of U)for(const Re of ke.marshals||[])re.has(Re.marshalId)||(re.add(Re.marshalId),X.push(Re));return X}),G=z(()=>{if(i.value)return"none";const U=E.value,X=new Set;for(const re of U)re.completionContextType==="Checkpoint"&&re.completionContextId&&X.add(re.completionContextId);return X.size>1?"checkpoint":"none"}),ee=z(()=>{const U=E.value,X={};for(const re of U){let ke,Re;re.completionContextType==="Checkpoint"&&re.completionContextId?(ke=`checkpoint_${re.completionContextId}`,Re=l.value.find(Ne=>Ne.id===re.completionContextId)?.name||"Unknown "+d.value.checkpoint):re.completionContextType==="Area"&&re.completionContextId?(ke=`area_${re.completionContextId}`,Re=u.value.find(Ne=>Ne.id===re.completionContextId)?.name||"Unknown "+d.value.area):(ke="personal",Re="Personal"),X[ke]||(X[ke]={key:ke,name:Re,items:[],completedCount:0}),X[ke].items.push(re),re.isCompleted&&X[ke].completedCount++}return Object.values(X).sort((re,ke)=>re.name.localeCompare(ke.name,void 0,{numeric:!0,sensitivity:"base"}))}),ne=U=>{D.value=D.value===U?null:U},Ae=U=>{if(!U.completionContextType||!U.completionContextId)return null;if(U.completionContextType==="Checkpoint"){const X=l.value.find(ke=>ke.id===U.completionContextId);if(!X)return null;const re=X.description?` - ${X.description}`:"";return`At ${h.value.checkpoint} ${X.name}${re}`}if(U.completionContextType==="Area"){const X=u.value.find(re=>re.id===U.completionContextId);return X?`At ${h.value.area} ${X.name}`:null}return U.completionContextType==="Personal"?"Personal item":null},J=async(U=!1)=>{if(!t.value){console.warn("No marshal ID, skipping checklist load");return}U||(M.value=!0),x.value=null;try{const X=e.value;console.log("Fetching checklist for marshal:",t.value);let ke=(await Nt.getMarshalChecklist(X,t.value)).data||[];if(i.value&&s.value.length>0){console.log("Fetching area checklists for areas:",s.value);const Re=s.value.map(Ke=>Nt.getAreaChecklist(X,Ke).catch(We=>(console.warn(`Failed to fetch checklist for area ${Ke}:`,We),{data:[]}))),Xe=await Promise.all(Re),Ne=new Map;for(const Ke of ke){const We=`${Ke.itemId}_${Ke.completionContextType}_${Ke.completionContextId}`;Ne.set(We,Ke)}for(const Ke of Xe)for(const We of Ke.data||[]){const Q=`${We.itemId}_${We.completionContextType}_${We.completionContextId}`;Ne.has(Q)||Ne.set(Q,We)}ke=Array.from(Ne.values()),console.log("Merged checklist items:",ke.length)}I.value=ke,y?.value&&(y.value.checklist=Date.now()),console.log("Checklist loaded:",I.value.length,"items")}catch(X){console.error("Failed to load checklist:",X.response?.status,X.response?.data),x.value=X.response?.data?.message||"Failed to load checklist"}finally{U||(M.value=!1)}};return{checklistItems:I,checklistLoading:M,checklistError:x,savingChecklist:S,checklistGroupBy:_,expandedChecklistGroup:D,visibleChecklistItems:E,completedChecklistCount:Z,myChecklistItems:A,areaChecklistItems:N,myChecklistItemsWithLocalState:B,areaChecklistItemsWithLocalState:j,areaMarshalsForChecklist:R,effectiveChecklistGroupBy:G,groupedChecklistItems:ee,loadChecklist:J,handleToggleChecklist:async U=>{if(S.value)return;S.value=!0;const X=e.value,re={marshalId:U.contextOwnerMarshalId||t.value,contextType:U.completionContextType,contextId:U.completionContextId,actorMarshalId:t.value};try{U.isCompleted?On()?(await _o("checklist_uncomplete",{eventId:X,itemId:U.itemId,data:re}),U.isCompleted=!1,U.completedAt=null,U.completedByActorName=null,C&&await C()):(await Nt.uncomplete(X,U.itemId,re),await J(!0)):On()?(await _o("checklist_complete",{eventId:X,itemId:U.itemId,data:re}),U.isCompleted=!0,U.completedAt=new Date().toISOString(),U.completedByActorName=n.value?.name||"You",C&&await C()):(await Nt.complete(X,U.itemId,re),await J(!0)),b&&await b(X,"checklist",JSON.parse(JSON.stringify(I.value)))}catch(ke){if(console.error("Failed to toggle checklist item:",ke),On()||!ke.response){const Re=U.isCompleted?"checklist_uncomplete":"checklist_complete";await _o(Re,{eventId:X,itemId:U.itemId,data:re}),U.isCompleted?(U.isCompleted=!1,U.completedAt=null,U.completedByActorName=null):(U.isCompleted=!0,U.completedAt=new Date().toISOString(),U.completedByActorName=n.value?.name||"You"),C&&await C(),b&&await b(X,"checklist",JSON.parse(JSON.stringify(I.value)))}}finally{S.value=!1}},toggleChecklistGroup:ne,getContextName:Ae}}function Uz({eventId:e,allLocations:t,userLocation:n,locationLastUpdated:a}){const s=T(!1),i=T(null),l=T(null),u=T(null),d=T(!1),h=T(!1),p=T(!1);let g=null,y=null;const b=ne=>ne?.isDynamic===!0||ne?.IsDynamic===!0,C=(ne,Ae,J,te)=>{const U=t.value.find(X=>X.id===ne);U&&(U.latitude=Ae,U.longitude=J,U.lastLocationUpdate=te)},I=ne=>{i.value=ne,l.value=null,u.value=null,s.value=!0},M=()=>{s.value=!1,i.value=null,l.value=null,u.value=null,p.value=!1},x=()=>{s.value=!1,p.value=!0},S=()=>{p.value=!1,s.value=!0},_=async(ne,Ae,J,te,U=null)=>{d.value=!0;try{const X=e.value,re={latitude:Ae,longitude:J,sourceType:te};U&&(re.sourceCheckpointId=U);const ke=await Yn.updatePosition(X,ne,re);ke.data.success&&(h.value&&B(),C(ne,ke.data.latitude,ke.data.longitude,ke.data.lastLocationUpdate))}catch(X){console.error("Failed to update location:",X),X.response?.status===403?alert("You do not have permission to update this location."):alert("Failed to update location. Please try again.")}finally{d.value=!1}},D=async()=>{if(i.value){d.value=!0,l.value=null;try{let ne,Ae;if(n.value&&a?.value&&Date.now()-a.value<3e4&&(ne=n.value.lat,Ae=n.value.lng),!ne||!Ae){if(!("geolocation"in navigator))throw new Error("Geolocation is not supported by your browser");const X=await new Promise((re,ke)=>{navigator.geolocation.getCurrentPosition(re,ke,{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4})});ne=X.coords.latitude,Ae=X.coords.longitude}const J=e.value,te=i.value.locationId,U=await Yn.updatePosition(J,te,{latitude:ne,longitude:Ae,sourceType:"gps"});U.data.success&&(u.value="Location updated successfully!",C(te,U.data.latitude,U.data.longitude,U.data.lastLocationUpdate),setTimeout(()=>M(),1500))}catch(ne){console.error("Failed to update location with GPS:",ne),ne.response?.status===403?l.value="You do not have permission to update this location.":ne.code===1?l.value="Location access denied. Please enable location permissions.":ne.code===2?l.value="Unable to determine your location. Please try again.":ne.code===3||ne.message?.includes("Timeout")?l.value="GPS timed out. Please ensure location services are enabled and try again.":l.value="Failed to update location. Please try again."}finally{d.value=!1}}},E=async ne=>{if(!i.value)return;const Ae=t.value.find(J=>J.id===ne);if(!Ae){l.value="Source checkpoint not found.";return}d.value=!0,l.value=null;try{const J=e.value,te=i.value.locationId,U=await Yn.updatePosition(J,te,{latitude:Ae.latitude,longitude:Ae.longitude,sourceType:"checkpoint",sourceCheckpointId:ne});U.data.success&&(h.value&&B(),u.value=`Location copied from ${Ae.name}!`,C(te,U.data.latitude,U.data.longitude,U.data.lastLocationUpdate),setTimeout(()=>M(),1500))}catch(J){console.error("Failed to copy location from checkpoint:",J),J.response?.status===403?l.value="You do not have permission to update this location.":l.value="Failed to update location. Please try again."}finally{d.value=!1}},Z=async(ne,Ae)=>{if(i.value){d.value=!0,l.value=null;try{const J=e.value,te=i.value.locationId,U=await Yn.updatePosition(J,te,{latitude:ne,longitude:Ae,sourceType:"manual"});U.data.success&&(u.value="Location updated successfully!",C(te,U.data.latitude,U.data.longitude,U.data.lastLocationUpdate),setTimeout(()=>M(),1500))}catch(J){console.error("Failed to update location manually:",J),J.response?.status===403?l.value="You do not have permission to update this location.":l.value="Failed to update location. Please try again."}finally{d.value=!1}}},A=async ne=>{if(!(!ne||!("geolocation"in navigator)))try{const Ae=await new Promise((U,X)=>{navigator.geolocation.getCurrentPosition(U,X,{enableHighAccuracy:!0,timeout:15e3})}),J=e.value,te=ne.locationId;await Yn.updatePosition(J,te,{latitude:Ae.coords.latitude,longitude:Ae.coords.longitude,sourceType:"gps"}),C(te,Ae.coords.latitude,Ae.coords.longitude,new Date().toISOString())}catch(Ae){console.warn("Auto-update location failed:",Ae)}},N=ne=>{h.value=!0,A(ne),g=setInterval(()=>{A(ne)},6e4)},B=()=>{h.value=!1,g&&(clearInterval(g),g=null)};return{showLocationUpdateModal:s,updatingLocationFor:i,locationUpdateError:l,locationUpdateSuccess:u,updatingLocation:d,autoUpdateEnabled:h,selectingLocationOnMap:p,isDynamicCheckpoint:b,openLocationUpdateModal:I,closeLocationUpdateModal:M,startMapLocationSelect:x,cancelMapLocationSelect:S,updateDynamicCheckpointLocation:_,updateLocationWithGps:D,updateLocationFromCheckpoint:E,updateLocationManually:Z,toggleAutoUpdate:ne=>{h.value?B():N(ne)},startAutoUpdate:N,stopAutoUpdate:B,startDynamicCheckpointPolling:()=>{y||!t.value.some(Ae=>Ae.isDynamic||Ae.IsDynamic)||(y=setInterval(async()=>{try{const Ae=e.value,J=await Yn.getDynamicCheckpoints(Ae);if(J.data&&Array.isArray(J.data))for(const te of J.data){const U=t.value.find(X=>X.id===te.checkpointId);U&&(U.latitude=te.latitude,U.longitude=te.longitude,U.lastLocationUpdate=te.lastLocationUpdate)}}catch(Ae){console.warn("Failed to poll dynamic checkpoints:",Ae)}},6e4))},stopDynamicCheckpointPolling:()=>{y&&(clearInterval(y),y=null)},handleMapClickForLocation:ne=>{p.value&&i.value&&(_(i.value.locationId,ne.lat,ne.lng,"manual"),p.value=!1)}}}function zz({eventId:e,assignments:t,allLocations:n,areaLeadRef:a,areaLeadCheckpoints:s,areaLeadMarshalDataVersion:i,updatePendingCount:l,updateCachedField:u}){const{termsLower:d}=rt(),h=T(null),p=T(null),g=T(null),y=T(!1),b=T(null),C=T(new Set),I=T(!1),M=T(""),x=j=>{if(!j)return!0;const R=new Date(j);return(new Date-R)/(1e3*60*60)>24},S=j=>j?new Date(j).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",_=j=>{if(!j)return"";switch(j){case"GPS":return"GPS";case"Manual":return"Manual";case"AreaLead":return"By area lead";default:return j}},D=j=>{C.value.add(j),y.value=!1,b.value=null},E=()=>{I.value=!1,M.value=""},Z=j=>j<1e3?`${Math.round(j/10)*10} m`:`${(Math.round(j/100)/10).toFixed(1)} km`,A=(j,R,G)=>{if(j==null||R==null)return;const ee=n.value?.find(te=>te.id===G);if(!ee)return;const ne=ee.latitude,Ae=ee.longitude;if(ne==null||Ae==null)return;const J=hi(j,R,ne,Ae);if(J>50){const te=Z(J);M.value=`Thanks for checking in. Just so you know, it's possible you are more than ${te} from your ${d.value.checkpoint} area.`,I.value=!0}},N=async(j,R=!0,G=null)=>{if(!j?.id){g.value="Cannot check in: Assignment ID is missing";return}h.value=j.id,p.value=j.id,g.value=null;const ee=e.value;if(!ee){g.value="Cannot check in: Event ID is missing",h.value=null,p.value=null;return}const ne=j.effectiveIsCheckedIn!==void 0?j.effectiveIsCheckedIn:j.isCheckedIn&&!x(j.checkInTime),Ae=j.isCheckedIn&&!ne,J=ne?"check-out":Ae?"refresh":"check-in",te=!ne;let U=null,X=null,re="Manual";if(R&&!ne&&"geolocation"in navigator)try{const Re=await new Promise((Xe,Ne)=>{navigator.geolocation.getCurrentPosition(Xe,Ne,{enableHighAccuracy:!0,timeout:5e3})});U=Re.coords.latitude,X=Re.coords.longitude,re="GPS"}catch(Re){console.log("GPS unavailable, using manual check-in:",Re.message)}const ke={latitude:U,longitude:X,action:J};try{if(On()){await _o("checkin_toggle",{eventId:ee,assignmentId:j.id,gpsData:ke});const Re=t.value.findIndex(Xe=>Xe.id===j.id);if(Re!==-1&&(t.value[Re]={...t.value[Re],isCheckedIn:te,checkInTime:te?new Date().toISOString():null,checkInMethod:te?`${re} (pending)`:null,checkInLatitude:U,checkInLongitude:X}),G){const Xe=n.value.find(Ne=>Ne.id===G);if(Xe?.assignments){const Ne=Xe.assignments.find(Ke=>Ke.id===j.id||Ke.marshalId===j.marshalId);Ne&&(Ne.isCheckedIn=te,Ne.checkInTime=te?new Date().toISOString():null)}}l&&await l(),u&&await u(ee,"locations",n.value)}else{const Re=await $a.toggleCheckIn(ee,j.id,ke),Xe=t.value.findIndex(Ne=>Ne.id===j.id);if(Xe!==-1&&(t.value[Xe]=Re.data),G){const Ne=n.value.find(Ke=>Ke.id===G);if(Ne?.assignments){const Ke=Ne.assignments.find(We=>We.id===j.id||We.marshalId===j.marshalId);Ke&&Object.assign(Ke,Re.data)}}}if(G&&a?.value?.loadDashboard&&await a.value.loadDashboard(),i&&i.value++,te&&U!=null&&X!=null){const Re=G||j.locationId;Re&&A(U,X,Re)}}catch(Re){if(On()||!Re.response){await _o("checkin_toggle",{eventId:ee,assignmentId:j.id,gpsData:ke});const Xe=t.value.findIndex(Ne=>Ne.id===j.id);Xe!==-1&&(t.value[Xe]={...t.value[Xe],isCheckedIn:te,checkInTime:te?new Date().toISOString():null,checkInMethod:te?"Manual (pending)":null}),l&&await l()}else Re.response?.data?.message?g.value=Re.response.data.message:Re.message?g.value=Re.message:g.value=`Failed to ${J}. Please try again.`}finally{h.value=null,p.value=null}};return{checkingIn:h,checkingInAssignment:p,checkInError:g,showCheckInReminderModal:y,checkInReminderCheckpoint:b,dismissedCheckInReminders:C,showDistanceWarning:I,distanceWarningMessage:M,isCheckInStale:x,formatCheckInTime:S,formatCheckInMethod:_,handleCheckInToggle:N,handleAreaLeadMarshalCheckIn:async j=>{const G=(a?.value?.checkpoints||s?.value||[]).find(U=>U.marshals?.some(X=>X.marshalId===j.marshalId));if(!G){console.error("Could not find checkpoint for marshal:",j);return}const ee=G.marshals.find(U=>U.marshalId===j.marshalId);if(!ee)return;const ne=ee.assignmentId||ee.id;if(!ne){console.error("No assignment ID found for marshal:",ee);return}const Ae=!j.isCheckedIn,J={id:ne,marshalId:j.marshalId,isCheckedIn:j.isCheckedIn,effectiveIsCheckedIn:j.isCheckedIn};await N(J,!1,G.checkpointId||G.locationId);const te=[a?.value?.checkpoints,s?.value].filter(Boolean);for(const U of te)for(const X of U){const re=X.marshals?.find(ke=>ke.marshalId===j.marshalId);re&&(re.isCheckedIn=Ae,re.checkInTime=Ae?new Date().toISOString():null,re.checkInMethod=Ae?"AreaLead":null)}i&&i.value++},dismissCheckInReminder:D,dismissDistanceWarning:E}}function Hz({eventId:e,currentMarshalId:t,isAreaLead:n,areaLeadAreaIds:a,sectionLastLoadedAt:s,showMessage:i}){const l=T([]),u=T(!1),d=T(null),h=T(!1),p=T(!1),g=T(""),y=T(!1),b=T(!1),C=T(!1),I=z(()=>l.value.filter(N=>N.status==="open"||N.status==="acknowledged"||N.status==="in_progress").length),M=async()=>{const N=e.value;u.value=!0;try{const B=new Map;if(n.value&&a.value.length>0)for(const j of a.value)try{const G=(await ks.getForArea(N,j)).data.incidents||[];for(const ee of G)B.set(ee.incidentId,ee)}catch(R){console.warn(`Failed to load incidents for area ${j}:`,R)}try{const R=(await ks.getAll(N)).data.incidents||[];for(const G of R)G.reportedBy?.marshalId===t.value&&B.set(G.incidentId,G)}catch(j){console.debug("Could not load all incidents:",j)}l.value=Array.from(B.values()).sort((j,R)=>new Date(R.incidentTime||R.createdAt)-new Date(j.incidentTime||j.createdAt)),s?.value&&(s.value.incidents=Date.now()),console.log("My incidents loaded:",l.value.length)}catch(B){console.error("Failed to load incidents:",B)}finally{u.value=!1}},x=async N=>{C.value=!0;try{await ks.create(e.value,N),b.value=!1,M(),i&&i("Incident Reported","An administrator will review it shortly.")}catch(B){console.error("Failed to report incident:",B),i&&i("Error",B.response?.data?.message||"Failed to report incident. Please try again.")}finally{C.value=!1}},S=N=>{d.value=N,h.value=!0},_=()=>{h.value=!1,d.value=null},D=async({incidentId:N,status:B})=>{try{await ks.updateStatus(e.value,N,{status:B});const j=l.value.find(R=>R.incidentId===N);j&&(j.status=B),d.value?.incidentId===N&&(d.value.status=B)}catch(j){console.error("Failed to update incident status:",j),i&&i("Error","Failed to update status. Please try again.")}},E=()=>{g.value="",p.value=!0},Z=()=>{p.value=!1,g.value=""};return{myIncidents:l,incidentsLoading:u,selectedIncident:d,showIncidentDetail:h,showAddIncidentNoteModal:p,incidentNoteText:g,submittingIncidentNote:y,showReportIncident:b,reportingIncident:C,openIncidentsCount:I,loadMyIncidents:M,handleReportIncident:x,openIncidentDetail:S,closeIncidentDetail:_,handleIncidentStatusChange:D,openAddIncidentNoteModal:E,closeAddIncidentNoteModal:Z,submitIncidentNote:async()=>{if(!(!g.value.trim()||!d.value)){y.value=!0;try{await ks.addNote(e.value,d.value.incidentId,g.value.trim()),Z(),M();const N=await ks.get(e.value,d.value.incidentId);d.value=N.data}catch(N){console.error("Failed to add note:",N),i&&i("Error","Failed to add note. Please try again.")}finally{y.value=!1}}}}}const Sf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><circle cx="12" cy="12" r="4"/><path d="M13 4.069V2h-2v2.069A8.01 8.01 0 0 0 4.069 11H2v2h2.069A8.008 8.008 0 0 0 11 19.931V22h2v-2.069A8.007 8.007 0 0 0 19.931 13H22v-2h-2.069A8.008 8.008 0 0 0 13 4.069zM12 18c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6z"/></svg>',If='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>',Vz='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',Gz='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';function jz({userLocation:e,assignmentsWithDetails:t,courseMapRef:n}){const{termsLower:a}=rt(),s=T({userLocationInView:!1,highlightedLocationInView:!1,highlightedLocationsVisibility:{}}),i=T(!1),l=T(-1),u=T({}),d={},h=z(()=>t.value.filter(x=>x.location?.latitude&&x.location?.longitude&&!(x.location.latitude===0&&x.location.longitude===0))),p=z(()=>{const x=[];return x.push({id:"toggle-other-checkpoints",label:i.value?"Show all "+a.value.checkpoints:"Show only mine",icon:"custom",customIcon:i.value?Vz:Gz}),e.value&&!s.value.userLocationInView&&x.push({id:"recenter-user",label:"My location",icon:"custom",customIcon:Sf}),h.value.length>0&&!s.value.highlightedLocationInView&&x.push({id:"recenter-checkpoint",label:"My "+a.value.checkpoint,icon:"custom",customIcon:If}),x}),g=x=>{const S=s.value,_=S.userLocationInView!==x.userLocationInView||S.highlightedLocationInView!==x.highlightedLocationInView,D=JSON.stringify(S.highlightedLocationsVisibility)!==JSON.stringify(x.highlightedLocationsVisibility||{});(_||D)&&(s.value={...x,highlightedLocationsVisibility:x.highlightedLocationsVisibility||{}})},y=()=>{const x=h.value;if(x.length===0)return null;if(x.length===1)return l.value=0,x[0];const S=s.value.highlightedLocationsVisibility||{},_=[];for(let Z=0;Z<x.length;Z++){const A=x[Z].locationId;S[A]===!1&&_.push(Z)}if(_.length===0)return l.value=0,x[0];if(_.length===1)return l.value=_[0],x[_[0]];const D=l.value;let E=-1;for(const Z of _)if(Z>D){E=Z;break}return E===-1&&(E=_[0]),l.value=E,x[E]};return{courseMapVisibility:s,courseMapActions:p,hideOtherCheckpoints:i,handleCourseMapVisibilityChange:g,handleCourseMapAction:({actionId:x})=>{if(x==="toggle-other-checkpoints")i.value=!i.value;else if(x==="recenter-user"&&e.value)n.value?.recenterOnUserLocation();else if(x==="recenter-checkpoint"){const S=y();S?.location&&n.value?.recenterOnLocation(S.location.latitude,S.location.longitude)}},checkpointMapVisibility:u,checkpointMapRefs:d,getCheckpointMapActions:x=>{const S=[],_=u.value[x]||{userLocationInView:!1,highlightedLocationInView:!1};return e.value&&!_.userLocationInView&&S.push({id:"recenter-user",label:"My location",icon:"custom",customIcon:Sf}),_.highlightedLocationInView||S.push({id:"recenter-checkpoint",label:a.value.checkpoint.charAt(0).toUpperCase()+a.value.checkpoint.slice(1),icon:"custom",customIcon:If}),S},handleCheckpointMapVisibilityChange:(x,S)=>{const _=u.value[x];(!_||_.userLocationInView!==S.userLocationInView||_.highlightedLocationInView!==S.highlightedLocationInView)&&(u.value={...u.value,[x]:S})},handleCheckpointMapAction:(x,{actionId:S})=>{const _=d[x.id];S==="recenter-user"&&e.value?_?.recenterOnUserLocation():S==="recenter-checkpoint"&&x.location&&_?.recenterOnLocation(x.location.latitude,x.location.longitude)}}}function Zz({eventId:e,currentMarshalId:t,areaLeadRef:n,areaLeadCheckpoints:a,areaChecklistItems:s,areaLeadAreaIds:i,loadChecklist:l}){const u=T(null),d=T(!1),h=T(0),p=b=>{u.value=u.value===b?null:b},g=z(()=>{h.value;const b=n?.value?.checkpoints,C=a?.value,I=b?.length>0?b:C||[],M=s?.value||[],x=new Map;for(const _ of I){const D=_.marshals||_.Marshals||[],E=_.checkpointId||_.CheckpointId,Z=_.name||_.Name,A=_.description||_.Description,N=_.areaIds||_.AreaIds||[];for(const B of D){const j=B.marshalId||B.MarshalId;if(!j)continue;x.has(j)||x.set(j,{...B,marshalId:j,checkpoints:[],checkpointIds:new Set,areaIds:new Set,allTasks:[],totalTaskCount:0,completedTaskCount:0});const R=x.get(j);R.checkpoints.push({checkpointId:E,name:Z,description:A}),R.checkpointIds.add(E);for(const G of N)R.areaIds.add(G)}}for(const _ of M){const D=_.completionContextType,E=_.completionContextId;let Z=[];if(D==="Personal"){const A=_.contextOwnerMarshalId;A&&x.has(A)&&(Z=[x.get(A)])}else if(D==="Checkpoint")for(const A of x.values())A.checkpointIds.has(E)&&Z.push(A);else if(D==="Area")for(const A of x.values())A.areaIds.has(E)&&Z.push(A);else Z=Array.from(x.values());for(const A of Z)A.allTasks.push({..._,isCompleted:_.isCompleted||_.localIsCompleted}),A.totalTaskCount++,(_.isCompleted||_.localIsCompleted)&&A.completedTaskCount++}return Array.from(x.values()).map(_=>({..._,checkpointIds:Array.from(_.checkpointIds),areaIds:Array.from(_.areaIds)})).sort((_,D)=>(_.name||"").localeCompare(D.name||"",void 0,{sensitivity:"base"}))});return{expandedAreaLeadMarshal:u,savingAreaLeadMarshalTask:d,areaLeadMarshalDataVersion:h,allAreaLeadMarshals:g,toggleAreaLeadMarshalExpansion:p,toggleAreaLeadMarshalTask:async(b,C)=>{if(d.value)return;d.value=!0;const I={marshalId:C.marshalId,contextType:b.contextType,contextId:b.contextId,actorMarshalId:t.value};try{b.isCompleted?await Nt.uncomplete(e.value,b.itemId,I):await Nt.complete(e.value,b.itemId,I),n?.value?.loadDashboard&&await n.value.loadDashboard(),h.value++,l&&await l(!0)}catch(M){console.error("Failed to toggle area lead marshal task:",M)}finally{d.value=!1}}}}function qz({router:e,route:t,onAuthSuccess:n}){const a=T(!1),s=T(!1),i=T(null),l=T(null),u=T(null),d=T(null),h=z(()=>l.value?.name||null),p=z(()=>d.value?.eventRoles?d.value.eventRoles.filter(B=>B.role==="EventAreaLead").flatMap(B=>B.areaIds||[]):[]),g=z(()=>p.value.length>0),y=z(()=>d.value?.eventRoles?d.value.eventRoles.some(N=>N.role==="EventAdmin"):!1),b=z(()=>d.value?.authMethod==="SecureEmailLink"&&y.value),C=z(()=>d.value?.authMethod==="MarshalMagicCode"&&y.value);let I=null;const M=()=>{I||(I=setInterval(async()=>{if(d.value?.marshalId)try{await bs.getMe(t.params.eventId)}catch(N){console.debug("Heartbeat failed:",N)}},300*1e3))},x=()=>{I&&(clearInterval(I),I=null)},S=async(N,B,j=!1)=>{s.value=!0,i.value=null,console.log("Authenticating with magic code:",{eventId:N,code:B,isReauth:j}),eu();try{wo("marshal",N);const R=await bs.marshalLogin(N,B);if(console.log("Auth response:",R.data),R.data.success){Gh(N,{token:R.data.sessionToken,marshalId:R.data.marshalId,marshalName:R.data.person?.name||null}),Mk(N,R.data.marshalId,B),l.value=R.data.person,u.value=R.data.marshalId,a.value=!0,console.log("Authenticated as marshal:",u.value,l.value?.name);try{const G=await bs.getMe(N);d.value=G.data,console.log("User claims:",d.value)}catch(G){console.warn("Failed to fetch claims:",G)}e.replace({path:t.path,query:{}}),M(),n&&await n()}else i.value=R.data.message||"Authentication failed"}catch(R){console.error("Authentication failed:",R),i.value=R.response?.data?.message||"Invalid or expired login link"}finally{s.value=!1}};return{isAuthenticated:a,authenticating:s,loginError:i,currentPerson:l,currentMarshalId:u,userClaims:d,currentMarshalName:h,areaLeadAreaIds:p,isAreaLead:g,isEventAdmin:y,canSwitchToAdmin:b,isAdminButNeedsReauth:C,authenticateWithMagicCode:S,checkExistingSession:async N=>{wo("marshal",N);const B=Gr(N),j=B?.marshalId,R=j?kv(N,j):null;if(!B?.token)return R?(console.log("No session but have stored code, attempting re-authentication..."),eu(),await S(N,R,!0),a.value):!1;try{const G=await bs.getMe(N);if(G.data&&G.data.marshalId)return d.value=G.data,l.value={personId:G.data.personId,name:G.data.personName,email:G.data.personEmail},u.value=G.data.marshalId,a.value=!0,vv(N,G.data.marshalId),M(),!0}catch(G){if(console.log("Session validation failed, attempting re-authentication...",G),R)try{if(eu(),await S(N,R,!0),a.value)return console.log("Re-authentication successful"),!0}catch(ee){console.error("Re-authentication failed:",ee)}B?.sessionKey&&Lu(B.sessionKey)}return!1},handleClose:N=>{x(),wo(null),a.value=!1,l.value=null,u.value=null,d.value=null,N&&N(),e.push("/marshal")},handleRemoveSession:async N=>{const[B]=N.split(":");wo("marshal",B);try{await bs.logout()}catch{}Lu(N),wo(null)},updateSessionEventInfo:(N,B,j)=>{const R=Gr(N);R&&R.marshalId&&Gh(N,{marshalId:R.marshalId,marshalName:R.marshalName,token:R.token,eventName:B,eventDate:j})},switchToAdminMode:()=>{e.push(`/admin/events/${t.params.eventId}`)},startHeartbeat:M,stopHeartbeat:x}}const Wz={key:0,class:"header-logo-cover"},Kz=["src"],Jz={key:2,class:"header-logo header-logo-left"},Yz=["src"],Xz={class:"header-center"},Qz={key:0},eH={key:1,class:"header-event-date"},tH={key:0,class:"header-actions"},nH={key:3,class:"header-logo header-logo-right"},oH=["src"],sH={class:"container"},aH={key:0,class:"selection-card"},iH={key:1,class:"selection-card"},lH={key:0,class:"loading"},rH={key:2,class:"selection-card error-card"},cH={class:"error"},uH={key:3,class:"dashboard"},dH={key:0,class:"welcome-bar"},hH={class:"welcome-info"},fH={key:0,class:"welcome-email"},pH={key:0,class:"mode-switch"},vH={key:1,class:"mode-switch"},mH={class:"accordion"},gH={class:"add-note-form"},yH={class:"modal-actions"},kH=["disabled"],bH=6e4,_H={__name:"MarshalView",setup(e){const{terms:t,termsLower:n}=rt(),{updatePendingCount:a}=gd(),s=gc(),i=qi(),l=z(()=>s.params.eventId),u={onAuthSuccess:null},{isAuthenticated:d,authenticating:h,loginError:p,currentPerson:g,currentMarshalId:y,currentMarshalName:b,areaLeadAreaIds:C,isAreaLead:I,canSwitchToAdmin:M,isAdminButNeedsReauth:x,authenticateWithMagicCode:S,checkExistingSession:_,handleClose:D,updateSessionEventInfo:E,switchToAdminMode:Z,stopHeartbeat:A}=qz({router:i,route:s,onAuthSuccess:()=>u.onAuthSuccess?.()}),N=T(new Set),B=z(()=>C.value.length?J.value.filter(De=>C.value.includes(De.id)).map(De=>({areaId:De.id,name:De.name,color:De.color})).sort((De,Se)=>(De.name||"").localeCompare(Se.name||"",void 0,{numeric:!0,sensitivity:"base"})):[]);qe(B,De=>{De.length>0&&N.value.size===0&&(N.value=new Set(De.map(Se=>Se.areaId)))},{immediate:!0});const j=z(()=>C.value.filter(De=>N.value.has(De))),R=De=>{const Se=new Set(N.value);Se.has(De)?Se.delete(De):Se.add(De),N.value=Se},G=z(()=>{const De=wn.value.find(tt=>tt.isCheckedIn&&!rs(tt.checkInTime)&&tt.location);if(De?.location)return{id:De.location.id,locationId:De.location.id,name:De.location.name,description:De.location.description};if(so.value){const tt=wn.value.find(pt=>pt.id===so.value);if(tt?.location)return{id:tt.location.id,locationId:tt.location.id,name:tt.location.name,description:tt.location.description}}const Se=wn.value[0];return Se?.location?{id:Se.location.id,locationId:Se.location.id,name:Se.location.name,description:Se.location.description}:null}),ee=T(null),ne=T([]),Ae=T([]),J=T([]),te=T(!0),{pageBackgroundStyle:U,headerStyle:X,headerTextColor:re,accentColor:ke,accentTextColor:Re,accentButtonStyle:Xe,brandingLogoUrl:Ne,brandingLogoPosition:Ke}=Bz(ee,s.params.eventId);Ll("marshalBranding",{headerStyle:X,headerTextColor:re,accentButtonStyle:Xe,accentColor:ke,accentTextColor:Re});const We=T("assignments"),Q=T({checklist:0,notes:0,incidents:0,eventContacts:0}),ge=T([]),Ce=T([]),ve=T(null),ue=z(()=>ve.value?.areaLeadRef?.value),{checklistItems:F,checklistLoading:K,checklistError:ae,savingChecklist:$e,expandedChecklistGroup:Be,visibleChecklistItems:Oe,completedChecklistCount:Le,myChecklistItems:Y,areaChecklistItems:he,areaChecklistItemsWithLocalState:xe,areaMarshalsForChecklist:Ie,effectiveChecklistGroupBy:be,groupedChecklistItems:de,loadChecklist:fe,handleToggleChecklist:q,toggleChecklistGroup:W,getContextName:ie}=Fz({eventId:l,currentMarshalId:y,currentPerson:g,assignments:Ae,areaLeadAreaIds:C,isAreaLead:I,allLocations:ne,areas:J,terms:t,termsLower:n,areaLeadRef:ue,areaLeadCheckpoints:ge,sectionLastLoadedAt:Q,updateCachedField:$r,updatePendingCount:a}),{userLocation:Ue,locationLastUpdated:et,startLocationTracking:dt,stopLocationTracking:yt}=Nz(),{showLocationUpdateModal:mt,updatingLocationFor:St,locationUpdateError:Ct,locationUpdateSuccess:Rt,updatingLocation:Ft,autoUpdateEnabled:ht,selectingLocationOnMap:on,openLocationUpdateModal:dn,closeLocationUpdateModal:Et,startMapLocationSelect:Lt,cancelMapLocationSelect:Qn,updateDynamicCheckpointLocation:zn,updateLocationWithGps:eo,updateLocationFromCheckpoint:fo,toggleAutoUpdate:Ht,stopAutoUpdate:ls,startDynamicCheckpointPolling:to,stopDynamicCheckpointPolling:So}=Uz({eventId:l,allLocations:ne,userLocation:Ue,locationLastUpdated:et}),le=()=>{Lt(),We.value="map"},{expandedAreaLeadMarshal:ce,savingAreaLeadMarshalTask:ye,areaLeadMarshalDataVersion:st,allAreaLeadMarshals:je,toggleAreaLeadMarshalExpansion:Tt,toggleAreaLeadMarshalTask:Wt}=Zz({eventId:l,currentMarshalId:y,areaLeadRef:ue,areaLeadCheckpoints:ge,areaChecklistItems:he,areaLeadAreaIds:C,loadChecklist:fe}),{checkingIn:Xt,checkingInAssignment:No,checkInError:po,showCheckInReminderModal:Fo,checkInReminderCheckpoint:Hn,dismissedCheckInReminders:Da,showDistanceWarning:Cs,distanceWarningMessage:Uo,isCheckInStale:rs,handleCheckInToggle:Xs,handleAreaLeadMarshalCheckIn:Vn,dismissCheckInReminder:Qs,dismissDistanceWarning:hn}=zz({eventId:l,assignments:Ae,allLocations:ne,areaLeadRef:ue,areaLeadCheckpoints:ge,areaLeadMarshalDataVersion:st,updatePendingCount:a,updateCachedField:$r}),Io=T(!1),xo=T(!1),Ls=T(""),vo=T(""),mo=T(null),no=T(!1),$o=T(""),mn=T(""),go=(De,Se)=>{$o.value=De,mn.value=Se,no.value=!0},{myIncidents:oo,incidentsLoading:kt,selectedIncident:Pt,showIncidentDetail:To,showAddIncidentNoteModal:zo,incidentNoteText:yo,submittingIncidentNote:ea,showReportIncident:ft,loadMyIncidents:Vt,handleReportIncident:Oa,openIncidentDetail:Ss,handleIncidentStatusChange:$n,openAddIncidentNoteModal:Xi,closeAddIncidentNoteModal:cs,submitIncidentNote:Mo}=Hz({eventId:l,currentMarshalId:y,isAreaLead:I,areaLeadAreaIds:C,sectionLastLoadedAt:Q,showMessage:go}),Kt=T(null),Ho=z(()=>Kt.value),Vo=T(null),Is=De=>!De||De.length===0?!1:De.some(Se=>C.value.includes(Se)),Ra=De=>{Vo.value=Vo.value===De?null:De},_n=De=>{const Se=We.value===De;if(We.value=Se?null:De,!Se){const tt=Date.now(),pt=Yt=>tt-Q.value[Yt]>bH;switch(De){case"checklist":pt("checklist")&&fe();break;case"notes":pt("notes")&&$s();break;case"incidents":pt("incidents")&&Vt();break;case"eventContacts":pt("eventContacts")&&ia();break}}},so=T(null),Zt=De=>{so.value=so.value===De?null:De};qe(()=>Ae.value,De=>{De.length===1&&so.value===null&&(so.value=De[0].id)},{immediate:!0});const wn=z(()=>Ae.value.map(De=>{const Se=ne.value.find($t=>$t.id===De.locationId),tt=Se?.areaIds||Se?.AreaIds||[];let pt=null;tt.length>0&&J.value.length>0&&(pt=J.value.find(sn=>tt.includes(sn.id))?.name);const xt=(Se?.assignments||[]).map($t=>({...$t,effectiveIsCheckedIn:$t.isCheckedIn&&!rs($t.checkInTime)})).sort(($t,sn)=>($t.marshalName||"").localeCompare(sn.marshalName||"",void 0,{sensitivity:"base"})),pn=Ua.value.filter($t=>tt.includes($t.areaId)&&(!$t.marshalId||$t.marshalId!==y.value)),An=new Set,Ut=pn.filter($t=>{const sn=JSON.stringify({name:$t.name||"",marshalId:$t.marshalId||"",role:$t.role||"",phone:$t.phone||"",email:$t.email||"",notes:$t.notes||""});return An.has(sn)?!1:(An.add(sn),!0)}).sort(($t,sn)=>($t.marshalName||$t.name||"").localeCompare(sn.marshalName||sn.name||"",void 0,{sensitivity:"base"})),Ln=De.isCheckedIn&&!rs(De.checkInTime);return{...De,location:Se,areaName:pt,areaIds:tt,allMarshals:xt,areaContacts:Ut,locationName:Se?.name||"Unknown Location",effectiveIsCheckedIn:Ln}})),{courseMapActions:ta,hideOtherCheckpoints:na,handleCourseMapVisibilityChange:oa,handleCourseMapAction:pi,getCheckpointMapActions:Tn,handleCheckpointMapVisibilityChange:sa,handleCheckpointMapAction:ct}=jz({userLocation:Ue,assignmentsWithDetails:wn,courseMapRef:Ho}),fn=z(()=>Ae.value.length>0?Ae.value[0]:null),It=z(()=>Ae.value.map(De=>De.locationId)),us=z(()=>na.value?ne.value.filter(De=>{const Se=It.value.includes(De.id),tt=De.isDynamic||De.IsDynamic;return Se||tt}):ne.value),Go=z(()=>wn.value.some(De=>De.location?.isDynamic||De.location?.IsDynamic)),Ao=z(()=>wn.value.find(De=>De.location?.isDynamic||De.location?.IsDynamic)),ds=z(()=>{const De=Ao.value;if(!De)return!1;const Se=De.location,tt=Se?.locationUpdateScopeConfigurations||Se?.LocationUpdateScopeConfigurations||[];return tm({scopeConfigurations:tt,marshalId:y.value,marshalAssignmentLocationIds:It.value,areaLeadAreaIds:C.value,locationId:De.locationId,locationAreaIds:De.areaIds||[]})}),Eo=z(()=>{if(!ee.value||!wn.value.length)return[];const De=new Date,Se=ee.value.eventDate?new Date(ee.value.eventDate):null;return wn.value.filter(tt=>{if(tt.effectiveIsCheckedIn||Da.value.has(tt.id))return!1;const pt=tt.location;if(!pt)return!1;const Yt=pt.startTime?new Date(pt.startTime):Se;if(!Yt)return!1;let xt;if(pt.endTime)xt=new Date(pt.endTime);else if(Se)xt=new Date(Se.getTime()+7200*1e3);else return!1;return De>=Yt&&De<xt})});qe(Eo,De=>{De.length>0&&!Fo.value&&(Hn.value=De[0],Fo.value=!0)},{immediate:!0}),qe(Cs,De=>{De&&(go("Distance notice",Uo.value),hn())});const Ba=()=>{const De=Hn.value;De&&(Qs(De.id),We.value="assignments",so.value=De.id)},ao=z(()=>ee.value?.route?(typeof ee.value.route=="string"?JSON.parse(ee.value.route):ee.value.route)||[]:[]),Jt=z(()=>!fn.value||!ne.value.length?null:ne.value.find(De=>De.id===fn.value.locationId)),Mn=T([]),aa=T(!1),xs=z(()=>{const De=Mn.value.filter(pt=>!pt.marshalId||pt.marshalId!==y.value),Se=new Set;return De.filter(pt=>{const Yt=JSON.stringify({name:pt.name||"",marshalId:pt.marshalId||"",role:pt.role||"",phone:pt.phone||"",email:pt.email||"",notes:pt.notes||""});return Se.has(Yt)?!1:(Se.add(Yt),!0)}).sort((pt,Yt)=>{if(pt.isPinned!==Yt.isPinned)return pt.isPinned?-1:1;const xt=pt.displayOrder||0,pn=Yt.displayOrder||0;return xt!==pn?xt-pn:(pt.name||"").localeCompare(Yt.name||"",void 0,{sensitivity:"base"})})}),vi=z(()=>xs.value.filter(De=>De.showInEmergencyInfo)),Na=z(()=>Ce.value.filter(De=>De.showInEmergencyInfo)),Fa=z(()=>vi.value.length>0||Na.value.length>0),Qi=(De,Se=[])=>{if(!Ce.value||Ce.value.length===0)return[];const tt=ne.value.find(Ut=>Ut.id===De),pt=tt?.areaIds||tt?.AreaIds||[],Yt=Se.length>0?Se:pt,xt=[],pn=new Set;for(const Ut of Ce.value){const Ln=Ut.noteId||Ut.NoteId||Ut.id;if(pn.has(Ln))continue;const $t=Ut.scopeConfigurations||Ut.ScopeConfigurations||[];let sn=!1;if($t.length>0)for(const jn of $t){const Po=jn.itemType||jn.ItemType,En=jn.ids||jn.Ids||[];if(Po==="Checkpoint"&&(En.includes(De)||En.includes("ALL_CHECKPOINTS"))){sn=!0;break}if(Po==="Area"&&(En.includes("ALL_AREAS")||Yt.length>0&&Yt.some(sl=>En.includes(sl)))){sn=!0;break}}else{const jn=Ut.matchedScope||Ut.MatchedScope||"";["EveryoneInAreas","EveryAreaLead","EveryoneAtCheckpoints","Area","Checkpoint"].some(En=>jn.includes(En)||jn===En)&&(sn=!0)}sn&&(pn.add(Ln),xt.push(Ut))}const An={Emergency:0,Urgent:1,High:2,Normal:3,Low:4};return xt.sort((Ut,Ln)=>{const $t=Ut.isPinned||Ut.IsPinned,sn=Ln.isPinned||Ln.IsPinned;if($t&&!sn)return-1;if(!$t&&sn)return 1;const jn=An[Ut.priority||Ut.Priority||"Normal"]??3,Po=An[Ln.priority||Ln.Priority||"Normal"]??3;if(jn!==Po)return jn-Po;const En=Ut.createdAt||Ut.CreatedAt,ko=Ln.createdAt||Ln.CreatedAt;return new Date(ko)-new Date(En)})},Ua=T([]),_t=(De,Se)=>De.localeCompare(Se,void 0,{numeric:!0,sensitivity:"base"}),el=z(()=>{if(!St.value)return[];const De=St.value.locationId;return ne.value.filter(Se=>Se.id!==De&&Se.latitude!==0&&Se.longitude!==0).sort((Se,tt)=>_t(Se.name,tt.name))}),Cn=z(()=>Jt.value?{lat:Jt.value.latitude,lng:Jt.value.longitude}:Ue.value?Ue.value:ne.value.length>0?{lat:ne.value[0].latitude,lng:ne.value[0].longitude}:{lat:51.505,lng:-.09}),hs=async()=>{const De=s.params.eventId;if(console.log("Loading event data for:",{eventId:De,marshalId:y.value}),On()){console.log("Offline mode detected, attempting to load from cache...");const xt=await xa(De);if(xt){if(console.log("Loaded cached data from:",xt.cachedAt),ee.value=xt.event,J.value=xt.areas||[],ne.value=xt.locations||[],F.value=xt.checklist||[],Mn.value=xt.contacts||[],Ce.value=xt.notes||[],xt.areaLeadDashboard?.checkpoints&&(ge.value=xt.areaLeadDashboard.checkpoints),ee.value&&Eu(ee.value),y.value){const pn=[];for(const An of ne.value){const Ut=An.assignments?.find(Ln=>Ln.marshalId===y.value);Ut&&pn.push(Ut)}Ae.value=pn}return}else console.warn("No cached data available while offline")}console.log("Fetching event data in parallel...");const[Se,tt,pt]=await Promise.allSettled([La.getById(De),Us.getByEvent(De),yl.getEventStatus(De)]);if(Se.status==="fulfilled"?(ee.value=Se.value.data,console.log("Event loaded:",ee.value?.name),ee.value&&(Eu(ee.value),E(De,ee.value.name,ee.value.eventDate))):console.error("Failed to load event:",Se.reason),tt.status==="fulfilled"?(J.value=tt.value.data||[],console.log("Areas loaded:",J.value.length)):console.error("Failed to load areas:",tt.reason),pt.status==="fulfilled"){if(ne.value=pt.value.data?.locations||[],console.log("Locations loaded:",ne.value.length),y.value){const xt=[];for(const pn of ne.value){const An=pn.assignments?.find(Ut=>Ut.marshalId===y.value);An&&xt.push(An)}Ae.value=xt,console.log("Total assignments found:",Ae.value.length)}}else console.error("Failed to load event status:",pt.reason);const Yt=[fe(),ia(),$s(),Vt()];I.value&&Yt.push(tl()),await Promise.allSettled(Yt);try{const xt={event:ee.value,areas:J.value,locations:ne.value,checklist:F.value,contacts:Mn.value,notes:Ce.value,marshalId:y.value};ge.value.length>0&&(xt.areaLeadDashboard={checkpoints:ge.value});const pn=JSON.parse(JSON.stringify(xt));await Vl(De,pn),console.log("Event data cached for offline access")}catch(xt){console.warn("Failed to cache event data:",xt)}to()};u.onAuthSuccess=hs;const za=async()=>{const De=s.params.eventId;if(On()){console.log("Skipping background preload: offline");return}console.log("Starting background preload for offline data...");try{const Se=await Us.getAreaLeadDashboard(De);if(Se.data){ge.value=Se.data.checkpoints||[];const tt=JSON.parse(JSON.stringify({areas:Se.data.areas||[],checkpoints:Se.data.checkpoints||[]}));await xa(De)?await $r(De,"areaLeadDashboard",tt):await Vl(De,{areaLeadDashboard:tt}),console.log("Area lead dashboard cached for offline access")}}catch(Se){Se.response?.status!==403&&console.warn("Failed to preload area lead dashboard:",Se)}console.log("Background preload complete")},tl=async()=>{const De=s.params.eventId;try{const Se=await Us.getAreaLeadDashboard(De);Se.data?.checkpoints&&(ge.value=Se.data.checkpoints,console.log("Area lead dashboard loaded:",ge.value.length,"checkpoints"))}catch(Se){Se.response?.status!==403&&console.warn("Failed to load area lead dashboard:",Se)}},$s=async()=>{const De=s.params.eventId;try{const Se=await gs.getMyNotes(De);Ce.value=Se.data||[],Q.value.notes=Date.now(),console.log("Notes loaded:",Ce.value.length)}catch(Se){console.error("Failed to load notes:",Se)}},ia=async()=>{const De=s.params.eventId;aa.value=!0;try{const Se=await ya.getMyContacts(De);Mn.value=Se.data||[],Q.value.eventContacts=Date.now(),console.log("Contacts loaded:",Mn.value.length)}catch(Se){console.warn("Failed to load contacts:",Se),Mn.value=[]}finally{aa.value=!1}},mi=()=>{xo.value=!1,mo.value&&(mo.value(),mo.value=null)},nl=()=>{xo.value=!1,mo.value=null},ol=()=>{no.value=!1},la=De=>{if(on.value&&St.value){zn(St.value.locationId,De.lat,De.lng,"manual"),on.value=!1,St.value=null;return}if(ds.value&&Ao.value){const Se=Ao.value;Ls.value="Update location",vo.value=`Update ${Se.location?.name||"dynamic checkpoint"} to this location?`,mo.value=async()=>{await zn(Se.locationId,De.lat,De.lng,"manual")},xo.value=!0}},gi=De=>{if(!on.value&&ds.value&&Ao.value){const Se=Ao.value;if(De.id===Se.locationId)return;Ls.value="Copy location",vo.value=`Copy location from "${De.name}" to ${Se.location?.name||"your dynamic checkpoint"}?`,mo.value=async()=>{await zn(Se.locationId,De.latitude,De.longitude,"checkpoint",De.id)},xo.value=!0}},Gn=()=>{D(()=>{Ae.value=[],F.value=[],Ua.value=[]})},Ha=De=>De?new Date(De).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return tn(async()=>{const De=s.params.eventId,Se=s.query.code;te.value=!0;try{Se?await S(De,Se):await _(De)&&await hs()}finally{te.value=!1}d.value&&(dt(),"requestIdleCallback"in window?requestIdleCallback(()=>{za()},{timeout:5e3}):setTimeout(()=>{za()},2e3))}),qe(d,De=>{De?dt():yt()}),qe(()=>s.query.code,async De=>{if(De&&d.value){te.value=!0;try{await S(s.params.eventId,De)}finally{te.value=!1}}}),qe(ee,De=>{De&&(document.title=`OnTheDay App - ${t.value.person}`)},{immediate:!0}),bn(()=>{A(),ls(),So()}),(De,Se)=>(v(),m("div",{class:"marshal-view",style:Qe(O(U))},[Me(QB),r("header",{class:pe(["header",`logo-${O(Ke)}`]),style:Qe(O(X))},[O(Ne)&&O(Ke)==="cover"?(v(),m("div",Wz,[r("img",{src:O(Ne),alt:"Event logo",class:"header-logo-cover-img"},null,8,Kz)])):P("",!0),O(d)&&O(Ke)==="right"?(v(),m("button",{key:1,onClick:Gn,class:"btn-close-session btn-close-left",style:Qe({color:O(re)}),title:"Close session"},"  ",4)):P("",!0),O(Ne)&&O(Ke)==="left"?(v(),m("div",Jz,[r("img",{src:O(Ne),alt:"Event logo",class:"header-logo-img"},null,8,Yz)])):P("",!0),r("div",Xz,[r("div",{class:"header-title",style:Qe({color:O(re)})},[ee.value?(v(),m("h1",Qz,w(ee.value.name),1)):P("",!0),ee.value?.eventDate?(v(),m("div",eH,w(Ha(ee.value.eventDate)),1)):P("",!0)],4),O(d)?(v(),m("div",tH,[r("button",{onClick:Se[0]||(Se[0]=tt=>ft.value=!0),class:"btn-header-action btn-report-incident"}," Report Incident "),Fa.value?(v(),m("button",{key:0,onClick:Se[1]||(Se[1]=tt=>Io.value=!0),class:"btn-header-action btn-emergency"}," Emergency Info ")):P("",!0)])):P("",!0)]),O(Ne)&&O(Ke)==="right"?(v(),m("div",nH,[r("img",{src:O(Ne),alt:"Event logo",class:"header-logo-img"},null,8,oH)])):P("",!0),O(d)&&O(Ke)!=="right"?(v(),m("button",{key:4,onClick:Gn,class:"btn-close-session btn-close-right",style:Qe({color:O(re)}),title:"Close session"},"  ",4)):P("",!0)],6),r("div",sH,[te.value?(v(),m("div",aH,[...Se[22]||(Se[22]=[r("div",{class:"loading"},"Loading...",-1)])])):!O(d)&&!O(p)?(v(),m("div",iH,[Se[23]||(Se[23]=r("h2",null,"Welcome",-1)),Se[24]||(Se[24]=r("p",{class:"instruction"},"Please use the login link sent to you to access your marshal dashboard.",-1)),O(h)?(v(),m("p",lH,"Authenticating...")):P("",!0)])):O(p)?(v(),m("div",rH,[Se[25]||(Se[25]=r("h2",null,"Login failed",-1)),r("p",cH,w(O(p)),1),Se[26]||(Se[26]=r("p",{class:"instruction"},"Please contact the event organiser for a new login link.",-1))])):(v(),m("div",uH,[O(M)||O(x)?(v(),m("div",dH,[r("div",hH,[O(g)?.email?(v(),m("span",fH,w(O(g).email),1)):P("",!0)]),O(M)?(v(),m("div",pH,[r("button",{onClick:Se[2]||(Se[2]=(...tt)=>O(Z)&&O(Z)(...tt)),class:"btn-mode-switch"}," Switch to Admin ")])):O(x)?(v(),m("div",vH,[...Se[27]||(Se[27]=[r("span",{class:"reauth-hint",title:"Login via admin flow to access admin features"}," Admin access requires re-login ",-1)])])):P("",!0)])):P("",!0),r("div",mH,[Me(Dz,{ref:"assignmentsSectionRef","is-expanded":We.value==="assignments",assignments:wn.value,"expanded-checkpoint-id":so.value,"all-locations":ne.value,route:ao.value,"user-location":O(Ue),"has-dynamic-assignment":Go.value,"current-marshal-id":O(y),"current-marshal-name":O(b),"checking-in-id":O(Xt),"checking-in-assignment-id":O(No),"check-in-error":O(po),"checking-in-marshal-id":O(Xt),"expanded-marshal-id":Vo.value,"updating-location":O(Ft),"auto-update-enabled":O(ht),"get-toolbar-actions":O(Tn),"is-area-lead-for-areas":Is,"get-notes-for-checkpoint":Qi,"area-lead-area-ids":O(C),onToggle:Se[3]||(Se[3]=tt=>_n("assignments")),onToggleCheckpoint:Zt,onMapClick:la,onLocationClick:gi,onActionClick:O(ct),onVisibilityChange:O(sa),onUpdateLocation:O(dn),onCheckIn:Se[4]||(Se[4]=tt=>O(Xs)(tt,!0)),onToggleMarshal:Ra,onMarshalCheckIn:Se[5]||(Se[5]=(tt,pt)=>O(Xs)(tt,!1,pt)),onToggleAutoUpdate:O(Ht)},null,8,["is-expanded","assignments","expanded-checkpoint-id","all-locations","route","user-location","has-dynamic-assignment","current-marshal-id","current-marshal-name","checking-in-id","checking-in-assignment-id","check-in-error","checking-in-marshal-id","expanded-marshal-id","updating-location","auto-update-enabled","get-toolbar-actions","area-lead-area-ids","onActionClick","onVisibilityChange","onUpdateLocation","onToggleAutoUpdate"]),Me(lF,{loading:O(K),error:O(ae),"is-expanded":We.value==="checklist","is-area-lead":O(I),"my-items":O(Y),"area-items":O(he),"area-items-with-local-state":O(xe),"visible-items":O(Oe),"grouped-items":O(de),"completed-count":O(Le),saving:O($e),"effective-group-by":O(be),"expanded-group":O(Be),locations:ne.value,areas:J.value,marshals:O(Ie),"get-context-name":O(ie),onToggle:Se[6]||(Se[6]=tt=>_n("checklist")),onToggleItem:O(q),onToggleGroup:O(W)},null,8,["loading","error","is-expanded","is-area-lead","my-items","area-items","area-items-with-local-state","visible-items","grouped-items","completed-count","saving","effective-group-by","expanded-group","locations","areas","marshals","get-context-name","onToggleItem","onToggleGroup"]),Me(pF,{"event-id":O(s).params.eventId,notes:Ce.value,locations:ne.value,areas:J.value,assignments:Ae.value,"is-expanded":We.value==="notes",onToggle:Se[7]||(Se[7]=tt=>_n("notes")),onNotesChanged:$s},null,8,["event-id","notes","locations","areas","assignments","is-expanded"]),Me(n9,{contacts:xs.value,loading:aa.value,"is-expanded":We.value==="eventContacts",onToggle:Se[8]||(Se[8]=tt=>_n("eventContacts"))},null,8,["contacts","loading","is-expanded"]),Me(h9,{incidents:O(oo),loading:O(kt),"is-expanded":We.value==="incidents",onToggle:Se[9]||(Se[9]=tt=>_n("incidents")),onSelectIncident:O(Ss)},null,8,["incidents","loading","is-expanded","onSelectIncident"]),Me(q7,{ref_key:"areaLeadSectionRef",ref:ve,"is-area-lead":O(I),"is-expanded":We.value==="areaLead",areas:B.value,"selected-filters":N.value,"filtered-area-ids":j.value,"event-id":O(s).params.eventId,"marshal-id":O(y),route:ao.value,onToggle:Se[10]||(Se[10]=tt=>_n("areaLead")),onToggleFilter:R,onChecklistUpdated:O(fe)},null,8,["is-area-lead","is-expanded","areas","selected-filters","filtered-area-ids","event-id","marshal-id","route","onChecklistUpdated"]),Me(bU,{"is-area-lead":O(I),"is-expanded":We.value==="areaLeadMarshals",marshals:O(je),"expanded-marshal-id":O(ce),"checking-in-marshal-id":O(Xt),"saving-task":O(ye),onToggle:Se[11]||(Se[11]=tt=>_n("areaLeadMarshals")),onToggleMarshal:O(Tt),onCheckIn:O(Vn),onToggleTask:O(Wt)},null,8,["is-area-lead","is-expanded","marshals","expanded-marshal-id","checking-in-marshal-id","saving-task","onToggleMarshal","onCheckIn","onToggleTask"]),Me(SF,{ref_key:"routeSectionRef",ref:Kt,"is-expanded":We.value==="map","user-location":O(Ue),"selecting-location":O(on),"selecting-location-name":O(St)?.location?.name||"",locations:us.value,route:ao.value,center:Cn.value,"highlight-location-ids":It.value,clickable:O(on)||ds.value,"toolbar-actions":O(ta),onToggle:Se[12]||(Se[12]=tt=>_n("map")),onCancelSelect:O(Qn),onMapClick:la,onLocationClick:gi,onActionClick:O(pi),onVisibilityChange:O(oa)},null,8,["is-expanded","user-location","selecting-location","selecting-location-name","locations","route","center","highlight-location-ids","clickable","toolbar-actions","onCancelSelect","onActionClick","onVisibilityChange"]),Me(L9,{"event-date":ee.value?.eventDate,description:ee.value?.description,"is-expanded":We.value==="eventDetails",onToggle:Se[13]||(Se[13]=tt=>_n("eventDetails"))},null,8,["event-date","description","is-expanded"])])]))]),Me(FB,{show:Io.value,contacts:vi.value,notes:Na.value,onClose:Se[14]||(Se[14]=tt=>Io.value=!1)},null,8,["show","contacts","notes"]),Me(hm,{show:O(ft),"event-id":l.value||"",checkpoint:G.value,"initial-location":O(Ue),checkpoints:ne.value,route:ao.value,onClose:Se[15]||(Se[15]=tt=>ft.value=!1),onSubmit:O(Oa)},null,8,["show","event-id","checkpoint","initial-location","checkpoints","route","onSubmit"]),Me(dm,{show:O(To),incident:O(Pt),route:ao.value,checkpoints:ne.value,"can-manage":O(I),onClose:Se[16]||(Se[16]=tt=>To.value=!1),onStatusChange:O($n),onOpenAddNote:O(Xi)},null,8,["show","incident","route","checkpoints","can-manage","onStatusChange","onOpenAddNote"]),Me(jt,{show:O(zo),title:"Add update",size:"small",onClose:O(cs)},{footer:He(()=>[r("div",yH,[r("button",{type:"button",class:"btn btn-secondary",onClick:Se[18]||(Se[18]=(...tt)=>O(cs)&&O(cs)(...tt))}," Cancel "),r("button",{type:"button",class:"btn btn-primary",onClick:Se[19]||(Se[19]=(...tt)=>O(Mo)&&O(Mo)(...tt)),disabled:!O(yo).trim()||O(ea)},w(O(ea)?"Adding...":"Add update"),9,kH)])]),default:He(()=>[r("div",gH,[ze(r("textarea",{"onUpdate:modelValue":Se[17]||(Se[17]=tt=>Qt(yo)?yo.value=tt:null),class:"note-textarea",placeholder:"Enter your update...",rows:"4"},null,512),[[nt,O(yo)]])])]),_:1},8,["show","onClose"]),Me(Aa,{show:xo.value,title:Ls.value,message:vo.value,onConfirm:mi,onCancel:nl},null,8,["show","title","message"]),Me(Aa,{show:no.value,title:$o.value,message:mn.value,"show-cancel":!1,onConfirm:ol},null,8,["show","title","message"]),Me(rN,{show:O(Fo),checkpoint:O(Hn),"accent-button-style":O(Xe),onDismiss:Se[20]||(Se[20]=tt=>O(Qs)(O(Hn)?.id)),onGoToCheckpoint:Ba},null,8,["show","checkpoint","accent-button-style"]),Me(ON,{show:O(mt),assignment:O(St),"user-location":O(Ue),"auto-update-enabled":O(ht),updating:O(Ft),error:O(Ct),success:O(Rt),"available-checkpoints":el.value,"accent-button-style":O(Xe),onClose:O(Et),onUpdateGps:O(eo),onToggleAutoUpdate:Se[21]||(Se[21]=tt=>O(Ht)(O(St))),onSelectOnMap:le,onCopyFromCheckpoint:O(fo)},null,8,["show","assignment","user-location","auto-update-enabled","updating","error","success","available-checkpoints","accent-button-style","onClose","onUpdateGps","onCopyFromCheckpoint"])],4))}},wH=Ge(_H,[["__scopeId","data-v-dcfd61f1"]]),CH={class:"form-group"},LH={class:"form-group"},SH={class:"form-group"},IH={class:"actions-left"},xH={__name:"EditProfileModal",props:{show:{type:Boolean,default:!1},profile:{type:Object,default:null},isDirty:{type:Boolean,default:!1},zIndex:{type:Number,default:1e3},showLogout:{type:Boolean,default:!1}},emits:["close","submit","update:isDirty","logout"],setup(e,{emit:t}){const n=e,a=t,s=T({name:"",email:"",phone:""});qe(()=>n.profile,h=>{h&&(s.value={name:h.name||"",email:h.email||"",phone:h.phone||""})},{immediate:!0,deep:!0}),qe(()=>n.show,h=>{h&&n.profile&&(s.value={name:n.profile.name||"",email:n.profile.email||"",phone:n.profile.phone||""})});const i=()=>{a("update:isDirty",!0)},l=()=>{if(!s.value.name.trim()){alert("Name is required");return}if(!s.value.email.trim()){alert("Email is required");return}a("submit",{name:s.value.name.trim(),email:s.value.email.trim(),phone:s.value.phone?.trim()||""})},u=()=>{a("close")},d=()=>{a("logout")};return(h,p)=>(v(),Ze(jt,{show:e.show,title:"Edit profile",size:"medium","z-index":e.zIndex,"confirm-on-close":!0,"is-dirty":e.isDirty,onClose:u},{actions:He(()=>[r("div",IH,[e.showLogout?(v(),m("button",{key:0,type:"button",onClick:d,class:"btn btn-danger"}," Log out ")):P("",!0)]),r("button",{type:"button",onClick:l,class:"btn btn-success"}," Save ")]),default:He(()=>[r("form",{onSubmit:it(l,["prevent"])},[r("div",CH,[p[3]||(p[3]=r("label",null,"Name *",-1)),ze(r("input",{"onUpdate:modelValue":p[0]||(p[0]=g=>s.value.name=g),type:"text",required:"",class:"form-input",placeholder:"Your name",onInput:i},null,544),[[nt,s.value.name]])]),r("div",LH,[p[4]||(p[4]=r("label",null,"Email *",-1)),ze(r("input",{"onUpdate:modelValue":p[1]||(p[1]=g=>s.value.email=g),type:"email",required:"",class:"form-input",placeholder:"Your email address",onInput:i},null,544),[[nt,s.value.email]])]),r("div",SH,[p[5]||(p[5]=r("label",null,"Phone",-1)),ze(r("input",{"onUpdate:modelValue":p[2]||(p[2]=g=>s.value.phone=g),type:"tel",class:"form-input",placeholder:"Your phone number",onInput:i},null,544),[[nt,s.value.phone]])])],32)]),_:1},8,["show","z-index","is-dirty"]))}},$H=Ge(xH,[["__scopeId","data-v-178e5f48"]]),TH={class:"tabs"},MH={class:"tab-content"},AH={class:"form-group"},EH={class:"form-group"},PH={class:"form-group"},DH={class:"form-group"},OH=["value"],RH={class:"tab-content"},BH={class:"emergency-contacts-section"},NH={key:0,class:"empty-state"},FH={class:"card-header"},UH=["onClick"],zH={class:"form-group"},HH=["onUpdate:modelValue"],VH={class:"form-group"},GH=["onUpdate:modelValue"],jH={class:"form-group"},ZH=["onUpdate:modelValue"],qH={__name:"EventFormModal",props:{show:{type:Boolean,default:!1},eventData:{type:Object,default:()=>({name:"",description:"",eventDate:"",timeZoneId:"UTC",emergencyContacts:[]})},isEditing:{type:Boolean,default:!1}},emits:["close","submit"],setup(e,{emit:t}){const n=e,a=t,{activeTab:s,switchTab:i,resetTab:l}=Jv("basic",["basic","emergency"]),u=T({...n.eventData});qe(()=>n.eventData,y=>{u.value={...y},u.value.emergencyContacts||(u.value.emergencyContacts=[])},{deep:!0}),qe(()=>n.show,y=>{y&&l()});const d=()=>{u.value.emergencyContacts.push({name:"",phone:"",details:""})},h=y=>{u.value.emergencyContacts.splice(y,1)},p=()=>{a("submit",{...u.value})},g=()=>{a("close")};return(y,b)=>(v(),Ze(jt,{show:e.show,title:e.isEditing?"Edit event":"Create new event",size:"large",onClose:g},{"tab-header":He(()=>[r("div",TH,[r("button",{type:"button",onClick:b[0]||(b[0]=C=>O(i)("basic")),class:pe(["tab-button",{active:O(s)==="basic"}])}," Basic details ",2),r("button",{type:"button",onClick:b[1]||(b[1]=C=>O(i)("emergency")),class:pe(["tab-button",{active:O(s)==="emergency"}])}," Emergency contacts ",2)])]),actions:He(()=>[r("button",{type:"button",onClick:g,class:"btn btn-secondary"}," Cancel "),r("button",{type:"button",onClick:p,class:"btn btn-success"}," Save ")]),default:He(()=>[r("form",{onSubmit:it(p,["prevent"])},[ze(r("div",MH,[r("div",AH,[b[6]||(b[6]=r("label",null,"Event name *",-1)),ze(r("input",{"onUpdate:modelValue":b[2]||(b[2]=C=>u.value.name=C),type:"text",required:"",class:"form-input"},null,512),[[nt,u.value.name]])]),r("div",EH,[b[7]||(b[7]=r("label",null,"Description",-1)),ze(r("textarea",{"onUpdate:modelValue":b[3]||(b[3]=C=>u.value.description=C),rows:"3",class:"form-input"},null,512),[[nt,u.value.description]])]),r("div",PH,[b[8]||(b[8]=r("label",null,"Event date *",-1)),ze(r("input",{"onUpdate:modelValue":b[4]||(b[4]=C=>u.value.eventDate=C),type:"datetime-local",required:"",class:"form-input"},null,512),[[nt,u.value.eventDate]])]),r("div",DH,[b[9]||(b[9]=r("label",null,"Time zone *",-1)),ze(r("select",{"onUpdate:modelValue":b[5]||(b[5]=C=>u.value.timeZoneId=C),required:"",class:"form-input"},[(v(!0),m(Te,null,Fe(O(am),C=>(v(),m("option",{key:C.value,value:C.value},w(C.label),9,OH))),128))],512),[[Fn,u.value.timeZoneId]])])],512),[[ws,O(s)==="basic"]]),ze(r("div",RH,[r("div",BH,[r("div",{class:"section-header-small"},[b[10]||(b[10]=r("h3",null,"Emergency contacts",-1)),r("button",{type:"button",onClick:d,class:"btn btn-small btn-primary"}," Add contact ")]),u.value.emergencyContacts.length===0?(v(),m("div",NH,[...b[11]||(b[11]=[r("p",null,'No emergency contacts added yet. Click "Add contact" to add one.',-1)])])):P("",!0),(v(!0),m(Te,null,Fe(u.value.emergencyContacts,(C,I)=>(v(),m("div",{key:I,class:"emergency-contact-card"},[r("div",FH,[r("h4",null,"Contact "+w(I+1),1),r("button",{type:"button",onClick:M=>h(I),class:"btn-remove"},"  ",8,UH)]),r("div",zH,[b[12]||(b[12]=r("label",null,"Name *",-1)),ze(r("input",{"onUpdate:modelValue":M=>C.name=M,type:"text",required:"",class:"form-input",placeholder:"Contact person name"},null,8,HH),[[nt,C.name]])]),r("div",VH,[b[13]||(b[13]=r("label",null,"Phone *",-1)),ze(r("input",{"onUpdate:modelValue":M=>C.phone=M,type:"tel",required:"",class:"form-input",placeholder:"+1 (555) 123-4567"},null,8,GH),[[nt,C.phone]])]),r("div",jH,[b[14]||(b[14]=r("label",null,"Additional details",-1)),ze(r("textarea",{"onUpdate:modelValue":M=>C.details=M,rows:"2",class:"form-input",placeholder:"Role, availability, or other important information..."},null,8,ZH),[[nt,C.details]])])]))),128))])],512),[[ws,O(s)==="emergency"]])],32)]),_:1},8,["show","title"]))}},WH=Ge(qH,[["__scopeId","data-v-d820eb4f"]]),KH=sd("profile",()=>{const e=T(null),t=T(!1),n=T(null);return{profile:e,loading:t,error:n,fetchProfile:async()=>{t.value=!0,n.value=null;try{const d=await yr.getProfile();return e.value=d.data,d.data}catch(d){throw n.value=d.response?.data?.message||"Failed to load profile",d}finally{t.value=!1}},updateProfile:async d=>{t.value=!0,n.value=null;try{const h=await yr.updateProfile(d);return e.value=h.data,h.data}catch(h){throw n.value=h.response?.data?.message||"Failed to update profile",h}finally{t.value=!1}},fetchPerson:async(d,h)=>{t.value=!0,n.value=null;try{return(await yr.getPerson(d,h)).data}catch(p){throw n.value=p.response?.data?.message||"Failed to load person",p}finally{t.value=!1}},updatePerson:async(d,h,p)=>{t.value=!0,n.value=null;try{return(await yr.updatePerson(d,h,p)).data}catch(g){throw n.value=g.response?.data?.message||"Failed to update person",g}finally{t.value=!1}},clearProfile:()=>{e.value=null,n.value=null}}}),JH={class:"sessions-view"},YH={class:"sessions-container"},XH={key:0,class:"loading-state"},QH={key:1,class:"empty-state"},eV={key:2,class:"sessions-list"},tV={class:"section-header"},nV={class:"section-actions"},oV=["onClick"],sV={class:"session-info"},aV={class:"event-name"},iV={key:0,class:"event-date"},lV={key:1,class:"sign-in-section"},rV={key:2,class:"section-header"},cV=["onClick"],uV={class:"session-info"},dV={class:"event-name"},hV={class:"role-name"},fV={key:0,class:"event-date"},pV=["onClick"],vV={class:"modal-card"},mV={class:"modal-actions"},gV={class:"modal-card"},yV={class:"modal-actions"},kV={__name:"SessionsView",setup(e){const t=qi(),n=Xl(),a=Kv(),s=KH(),i=T([]),l=T([]),u=T(!0),d=T(!1),h=T(!1),p=T(!1),g=T(!1),y=T(null),b=T(!1),C=T({name:"",description:"",eventDate:"",timeZoneId:"UTC",emergencyContacts:[]}),I=z(()=>localStorage.getItem("adminEmail")),M=z(()=>!!I.value),x=()=>{i.value=Tk()},S=te=>{vv(te.eventId,te.marshalId),t.push(`/event/${te.eventId}`)},_=te=>{y.value=te,p.value=!0},D=async()=>{if(!y.value)return;const{sessionKey:te,eventId:U}=y.value;try{wo("marshal",U),await authApi.logout()}catch{}Lu(te),wo(null),x(),p.value=!1,y.value=null},E=()=>{g.value=!0},Z=async()=>{await n.logout(),l.value=[],g.value=!1},A=async()=>{if(h.value=!0,!s.profile)try{await s.fetchProfile()}catch(te){console.error("Failed to load profile:",te)}},N=async te=>{try{await s.updateProfile(te),h.value=!1}catch(U){console.error("Failed to save profile:",U),alert("Failed to save profile. Please try again.")}},B=async()=>{await n.logout(),l.value=[],h.value=!1},j=te=>te?new Date(te).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"",R=async()=>{if(M.value)try{wo("admin");const te=await La.getAll();l.value=te.data||[]}catch(te){console.error("Failed to load admin events:",te),l.value=[]}},G=te=>{t.push(`/admin/event/${te}`)},ee=()=>{t.push("/")},ne=()=>{},Ae=()=>{b.value=!1,C.value={name:"",description:"",eventDate:"",timeZoneId:"UTC",emergencyContacts:[]}},J=async te=>{try{const U={...te,adminEmail:n.adminEmail};await a.createEvent(U),Ae(),await R()}catch(U){console.error("Failed to create event:",U),alert("Failed to create event. Please try again.")}};return tn(async()=>{document.title="OnTheDay App - Sessions",gv(),mv(),x(),await R(),u.value=!1}),(te,U)=>(v(),m("div",JH,[r("div",YH,[Me(qv,{title:"Your sessions"}),u.value?(v(),m("div",XH,[...U[9]||(U[9]=[r("p",null,"Loading sessions...",-1)])])):i.value.length===0&&l.value.length===0?(v(),m("div",QH,[U[10]||(U[10]=r("p",null,"No active sessions.",-1)),U[11]||(U[11]=r("p",{class:"hint"},"Sign in to access your events, or use a login link from your event organiser.",-1)),r("button",{class:"btn btn-primary",onClick:U[0]||(U[0]=X=>d.value=!0)}," Sign in ")])):(v(),m("div",eV,[M.value?(v(),m(Te,{key:0},[r("div",tV,[U[12]||(U[12]=r("span",{class:"section-label"},"Admin events",-1)),r("div",nV,[r("button",{class:"btn btn-small btn-primary",onClick:A}," Profile "),r("button",{class:"btn btn-small btn-primary",onClick:U[1]||(U[1]=X=>b.value=!0)}," Create event ")])]),(v(!0),m(Te,null,Fe(l.value,X=>(v(),m("div",{key:"admin-"+X.id,class:"session-card admin-card",onClick:re=>G(X.id)},[U[14]||(U[14]=r("div",{class:"card-icon admin-icon"},[r("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})])],-1)),r("div",sV,[r("div",aV,w(X.name),1),U[13]||(U[13]=r("div",{class:"role-name"},"Admin",-1)),X.eventDate?(v(),m("div",iV,w(j(X.eventDate)),1)):P("",!0)]),r("button",{class:"btn-logout",onClick:it(E,["stop"]),title:"Log out as admin"},"  ")],8,oV))),128))],64)):(v(),m("div",lV,[r("button",{class:"btn btn-primary",onClick:U[2]||(U[2]=X=>d.value=!0)}," Sign in ")])),i.value.length>0?(v(),m("div",rV,[...U[15]||(U[15]=[r("span",{class:"section-label"},"Marshal sessions",-1)])])):P("",!0),(v(!0),m(Te,null,Fe(i.value,X=>(v(),m("div",{key:X.sessionKey,class:"session-card",onClick:re=>S(X)},[U[16]||(U[16]=r("div",{class:"card-icon marshal-icon"},[r("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})])],-1)),r("div",uV,[r("div",dV,w(X.eventName||"Event"),1),r("div",hV,w(X.marshalName||"Marshal"),1),X.eventDate?(v(),m("div",fV,w(j(X.eventDate)),1)):P("",!0)]),r("button",{class:"btn-logout",onClick:it(re=>_(X),["stop"]),title:"Log out from this session"},"  ",8,pV)],8,cV))),128))])),r("button",{class:"btn-back-home",onClick:ee,title:"Back to home"},"  ")]),Me(Wv,{show:d.value,onClose:U[3]||(U[3]=X=>d.value=!1),onSuccess:ne},null,8,["show"]),Me($H,{show:h.value,profile:O(s).profile,"show-logout":!0,onClose:U[4]||(U[4]=X=>h.value=!1),onSubmit:N,onLogout:B},null,8,["show","profile"]),Me(WH,{show:b.value,"event-data":C.value,"is-editing":!1,onClose:Ae,onSubmit:J},null,8,["show","event-data"]),(v(),Ze(Rl,{to:"body"},[Me(ts,{name:"modal"},{default:He(()=>[g.value?(v(),m("div",{key:0,class:"modal-overlay",onClick:U[6]||(U[6]=it(X=>g.value=!1,["self"]))},[r("div",vV,[U[17]||(U[17]=r("h3",null,"Log out as admin?",-1)),U[18]||(U[18]=r("p",null,"This will log you out from all admin events.",-1)),U[19]||(U[19]=r("p",{class:"hint"},"You can log back in using the sign-in button.",-1)),r("div",mV,[r("button",{class:"btn btn-secondary",onClick:U[5]||(U[5]=X=>g.value=!1)},"Cancel"),r("button",{class:"btn btn-danger",onClick:Z},"Log out")])])])):P("",!0)]),_:1})])),(v(),Ze(Rl,{to:"body"},[Me(ts,{name:"modal"},{default:He(()=>[p.value?(v(),m("div",{key:0,class:"modal-overlay",onClick:U[8]||(U[8]=it(X=>p.value=!1,["self"]))},[r("div",gV,[U[22]||(U[22]=r("h3",null,"Log out from session?",-1)),r("p",null,[U[20]||(U[20]=Ye("This will log you out from ",-1)),r("strong",null,w(y.value?.eventName||"this event"),1),U[21]||(U[21]=Ye(".",-1))]),U[23]||(U[23]=r("p",{class:"hint"},"You can log back in using the link from your event organiser.",-1)),r("div",yV,[r("button",{class:"btn btn-secondary",onClick:U[7]||(U[7]=X=>p.value=!1)},"Cancel"),r("button",{class:"btn btn-danger",onClick:D},"Log out")])])])):P("",!0)]),_:1})]))]))}},bV=Ge(kV,[["__scopeId","data-v-add55e1c"]]);let xf=!1;function _V(){xf||(xf=!0,gv(),mv())}const wV=[{path:"/",name:"Home",component:Nb},{path:"/admin/login",name:"AdminLogin",component:Zb},{path:"/admin/verify",name:"AdminVerify",component:Qb},{path:"/sessions",name:"Sessions",component:bV},{path:"/admin/dashboard",redirect:"/sessions"},{path:"/admin/profile",redirect:"/sessions"},{path:"/admin/event/:eventId",name:"AdminEventManage",component:_B,meta:{requiresAuth:!0}},{path:"/marshal",redirect:"/sessions"},{path:"/event/:eventId",name:"MarshalView",component:wH},{path:"/:pathMatch(.*)*",redirect:"/"}],vm=fk({history:j1("/VolunteerCheckin/testing/"),routes:wV});vm.beforeEach((e,t,n)=>{_V();const a=localStorage.getItem("adminEmail");if(e.meta.requiresAuth&&!a){n({name:"AdminLogin"});return}if(e.meta.requiresAuth?wo("admin"):e.name!=="MarshalView"&&e.name!=="Sessions"&&wo(null),e.name==="MarshalView"){const s=e.params.eventId,i=!!e.query.code,l=Gr(s),u=l?.marshalId?kv(s,l.marshalId):null;if(i){n();return}if(l?.token){n();return}if(u){n();return}if(yv()){n({name:"Sessions"});return}}n()});Ys().then(()=>{console.log("Offline database initialized")}).catch(e=>{console.warn("Failed to initialize offline database:",e)});const yd=Xy(xk);yd.use(t1());yd.use(vm);yd.mount("#app");
